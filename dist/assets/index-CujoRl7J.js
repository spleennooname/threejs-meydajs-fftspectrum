import{g as Ya,C as Ss,M as dn,D as Ps,R as Ts,F as As,a as bi,V as se,b as Xa,S as ir,c as ue,A as Jo,I as kd,d as Nn,B as Ms,e as Od,W as Rd,N as zn,Q as Hn,E as Dd,G as Ld,U as Za,f as Id,h as Ud,i as Bd,j as Nd,k as Vd,l as Fd,m as zd,n as Tt,o as Q,p as At,q as ve,r as nr,s as qt,t as ne,u as Hd,v as jd,w as Gd,L as jn,x as hs,O as Kd,y as On,z as Yi,H as $d,J as ks,K as Qa,P as Si,T as Ja,X as el,Y as tl,Z as il,_ as nl,$ as us,a0 as ea,a1 as Wd,a2 as qd,a3 as Yd,a4 as Xd,a5 as rl,a6 as sl,a7 as Zd,a8 as Qd,a9 as Jd,aa as ep,ab as tp,ac as pi,ad as ui,ae as ta,af as ip,ag as np,ah as rp,ai as sp,aj as op,ak as ap,al as lp,am as hp,an as up,ao as cp,ap as ia,aq as dp,ar as pp,as as fp,at as mp,au as _p}from"./vendor-DtoTWzs6.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const h of l.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&n(h)}).observe(document,{childList:!0,subtree:!0});function t(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(s){if(s.ep)return;s.ep=!0;const l=t(s);fetch(s.href,l)}})();function it(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function ol(r,e){r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.__proto__=e}var De={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},xi={duration:.5,overwrite:!1,delay:0},Os,Ne=1e8,te=1/Ne,cs=Math.PI*2,vp=cs/4,gp=0,al=Math.sqrt,bp=Math.cos,xp=Math.sin,fe=function(e){return typeof e=="string"},pe=function(e){return typeof e=="function"},st=function(e){return typeof e=="number"},Rs=function(e){return typeof e>"u"},ot=function(e){return typeof e=="object"},Te=function(e){return e!==!1},ll=function(){return typeof window<"u"},Rn=function(e){return pe(e)||fe(e)},hl=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},be=Array.isArray,ds=/(?:-?\.?\d|\.)+/gi,ul=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,ci=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,Gr=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,cl=/[+-]=-?[.\d]+/,dl=/[^,'"\[\]\s]+/gi,wp=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,oe,Xe,ps,Ds,Le={},Gn={},pl,fl=function(e){return(Gn=Yt(e,Le))&&Ke},Ls=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},Kn=function(e,t){return!t&&console.warn(e)},ml=function(e,t){return e&&(Le[e]=t)&&Gn&&(Gn[e]=t)||Le},sn=function(){return 0},Is={},yt=[],fs={},_l,Oe={},Kr={},na=30,Vn=[],Us="",Bs=function(e){var t=e[0],n,s;if(ot(t)||pe(t)||(e=[e]),!(n=(t._gsap||{}).harness)){for(s=Vn.length;s--&&!Vn[s].targetTest(t););n=Vn[s]}for(s=e.length;s--;)e[s]&&(e[s]._gsap||(e[s]._gsap=new Nl(e[s],n)))||e.splice(s,1);return e},jt=function(e){return e._gsap||Bs(Ve(e))[0]._gsap},vl=function(e,t,n){return(n=e[t])&&pe(n)?e[t]():Rs(n)&&e.getAttribute&&e.getAttribute(t)||n},Ae=function(e,t){return(e=e.split(",")).forEach(t)||e},le=function(e){return Math.round(e*1e5)/1e5||0},_e=function(e){return Math.round(e*1e7)/1e7||0},fi=function(e,t){var n=t.charAt(0),s=parseFloat(t.substr(2));return e=parseFloat(e),n==="+"?e+s:n==="-"?e-s:n==="*"?e*s:e/s},yp=function(e,t){for(var n=t.length,s=0;e.indexOf(t[s])<0&&++s<n;);return s<n},$n=function(){var e=yt.length,t=yt.slice(0),n,s;for(fs={},yt.length=0,n=0;n<e;n++)s=t[n],s&&s._lazy&&(s.render(s._lazy[0],s._lazy[1],!0)._lazy=0)},gl=function(e,t,n,s){yt.length&&$n(),e.render(t,n,s),yt.length&&$n()},bl=function(e){var t=parseFloat(e);return(t||t===0)&&(e+"").match(dl).length<2?t:fe(e)?e.trim():e},xl=function(e){return e},ze=function(e,t){for(var n in t)n in e||(e[n]=t[n]);return e},Cp=function(e){return function(t,n){for(var s in n)s in t||s==="duration"&&e||s==="ease"||(t[s]=n[s])}},Yt=function(e,t){for(var n in t)e[n]=t[n];return e},ra=function r(e,t){for(var n in t)n!=="__proto__"&&n!=="constructor"&&n!=="prototype"&&(e[n]=ot(t[n])?r(e[n]||(e[n]={}),t[n]):t[n]);return e},Wn=function(e,t){var n={},s;for(s in e)s in t||(n[s]=e[s]);return n},en=function(e){var t=e.parent||oe,n=e.keyframes?Cp(be(e.keyframes)):ze;if(Te(e.inherit))for(;t;)n(e,t.vars.defaults),t=t.parent||t._dp;return e},Ep=function(e,t){for(var n=e.length,s=n===t.length;s&&n--&&e[n]===t[n];);return n<0},wl=function(e,t,n,s,l){var h=e[s],c;if(l)for(c=t[l];h&&h[l]>c;)h=h._prev;return h?(t._next=h._next,h._next=t):(t._next=e[n],e[n]=t),t._next?t._next._prev=t:e[s]=t,t._prev=h,t.parent=t._dp=e,t},rr=function(e,t,n,s){n===void 0&&(n="_first"),s===void 0&&(s="_last");var l=t._prev,h=t._next;l?l._next=h:e[n]===t&&(e[n]=h),h?h._prev=l:e[s]===t&&(e[s]=l),t._next=t._prev=t.parent=null},nt=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove(e),e._act=0},Gt=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var n=e;n;)n._dirty=1,n=n.parent;return e},Sp=function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e},Pp=function r(e){return!e||e._ts&&r(e.parent)},sa=function(e){return e._repeat?wi(e._tTime,e=e.duration()+e._rDelay)*e:0},wi=function(e,t){var n=Math.floor(e/=t);return e&&n===e?n-1:n},qn=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},sr=function(e){return e._end=_e(e._start+(e._tDur/Math.abs(e._ts||e._rts||te)||0))},Ns=function(e,t){var n=e._dp;return n&&n.smoothChildTiming&&e._ts&&(e._start=_e(n._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),sr(e),n._dirty||Gt(n,e)),e},yl=function(e,t){var n;if((t._time||t._initted&&!t._dur)&&(n=qn(e.rawTime(),t),(!t._dur||pn(0,t.totalDuration(),n)-t._tTime>te)&&t.render(n,!0)),Gt(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(n=e;n._dp;)n.rawTime()>=0&&n.totalTime(n._tTime),n=n._dp;e._zTime=-te}},Ze=function(e,t,n,s){return t.parent&&nt(t),t._start=_e((st(n)?n:n||e!==oe?Be(e,n,t):e._time)+t._delay),t._end=_e(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),wl(e,t,"_first","_last",e._sort?"_start":0),ms(t)||(e._recent=t),s||yl(e,t),e},Cl=function(e,t){return(Le.ScrollTrigger||Ls("scrollTrigger",t))&&Le.ScrollTrigger.create(t,e)},El=function(e,t,n,s){if(Fs(e,t),!e._initted)return 1;if(!n&&e._pt&&(e._dur&&e.vars.lazy!==!1||!e._dur&&e.vars.lazy)&&_l!==Re.frame)return yt.push(e),e._lazy=[t,s],1},Tp=function r(e){var t=e.parent;return t&&t._ts&&t._initted&&!t._lock&&(t.rawTime()<0||r(t))},ms=function(e){var t=e.data;return t==="isFromStart"||t==="isStart"},Ap=function(e,t,n,s){var l=e.ratio,h=t<0||!t&&(!e._start&&Tp(e)&&!(!e._initted&&ms(e))||(e._ts<0||e._dp._ts<0)&&!ms(e))?0:1,c=e._rDelay,p=0,d,f,_;if(c&&e._repeat&&(p=pn(0,e._tDur,t),f=wi(p,c),e._yoyo&&f&1&&(h=1-h),f!==wi(e._tTime,c)&&(l=1-h,e.vars.repeatRefresh&&e._initted&&e.invalidate())),h!==l||s||e._zTime===te||!t&&e._zTime){if(!e._initted&&El(e,t,s,n))return;for(_=e._zTime,e._zTime=t||(n?te:0),n||(n=t&&!_),e.ratio=h,e._from&&(h=1-h),e._time=0,e._tTime=p,d=e._pt;d;)d.r(h,d.d),d=d._next;e._startAt&&t<0&&e._startAt.render(t,!0,!0),e._onUpdate&&!n&&Fe(e,"onUpdate"),p&&e._repeat&&!n&&e.parent&&Fe(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===h&&(h&&nt(e,1),n||(Fe(e,h?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)},Mp=function(e,t,n){var s;if(n>t)for(s=e._first;s&&s._start<=n;){if(s.data==="isPause"&&s._start>t)return s;s=s._next}else for(s=e._last;s&&s._start>=n;){if(s.data==="isPause"&&s._start<t)return s;s=s._prev}},yi=function(e,t,n,s){var l=e._repeat,h=_e(t)||0,c=e._tTime/e._tDur;return c&&!s&&(e._time*=h/e._dur),e._dur=h,e._tDur=l?l<0?1e10:_e(h*(l+1)+e._rDelay*l):h,c>0&&!s?Ns(e,e._tTime=e._tDur*c):e.parent&&sr(e),n||Gt(e.parent,e),e},oa=function(e){return e instanceof Pe?Gt(e):yi(e,e._dur)},kp={_start:0,endTime:sn,totalDuration:sn},Be=function r(e,t,n){var s=e.labels,l=e._recent||kp,h=e.duration()>=Ne?l.endTime(!1):e._dur,c,p,d;return fe(t)&&(isNaN(t)||t in s)?(p=t.charAt(0),d=t.substr(-1)==="%",c=t.indexOf("="),p==="<"||p===">"?(c>=0&&(t=t.replace(/=/,"")),(p==="<"?l._start:l.endTime(l._repeat>=0))+(parseFloat(t.substr(1))||0)*(d?(c<0?l:n).totalDuration()/100:1)):c<0?(t in s||(s[t]=h),s[t]):(p=parseFloat(t.charAt(c-1)+t.substr(c+1)),d&&n&&(p=p/100*(be(n)?n[0]:n).totalDuration()),c>1?r(e,t.substr(0,c-1),n)+p:h+p)):t==null?h:+t},tn=function(e,t,n){var s=st(t[1]),l=(s?2:1)+(e<2?0:1),h=t[l],c,p;if(s&&(h.duration=t[1]),h.parent=n,e){for(c=h,p=n;p&&!("immediateRender"in c);)c=p.vars.defaults||{},p=Te(p.vars.inherit)&&p.parent;h.immediateRender=Te(c.immediateRender),e<2?h.runBackwards=1:h.startAt=t[l-1]}return new de(t[0],h,t[l+1])},Mt=function(e,t){return e||e===0?t(e):t},pn=function(e,t,n){return n<e?e:n>t?t:n},ge=function(e,t){return!fe(e)||!(t=wp.exec(e))?"":t[1]},Op=function(e,t,n){return Mt(n,function(s){return pn(e,t,s)})},_s=[].slice,Sl=function(e,t){return e&&ot(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&ot(e[0]))&&!e.nodeType&&e!==Xe},Rp=function(e,t,n){return n===void 0&&(n=[]),e.forEach(function(s){var l;return fe(s)&&!t||Sl(s,1)?(l=n).push.apply(l,Ve(s)):n.push(s)})||n},Ve=function(e,t,n){return fe(e)&&!n&&(ps||!Ci())?_s.call((t||Ds).querySelectorAll(e),0):be(e)?Rp(e,n):Sl(e)?_s.call(e,0):e?[e]:[]},Dp=function(e){return e=Ve(e)[0]||Kn("Invalid scope")||{},function(t){var n=e.current||e.nativeElement||e;return Ve(t,n.querySelectorAll?n:n===e?Kn("Invalid scope")||Ds.createElement("div"):e)}},Pl=function(e){return e.sort(function(){return .5-Math.random()})},Tl=function(e){if(pe(e))return e;var t=ot(e)?e:{each:e},n=Kt(t.ease),s=t.from||0,l=parseFloat(t.base)||0,h={},c=s>0&&s<1,p=isNaN(s)||c,d=t.axis,f=s,_=s;return fe(s)?f=_={center:.5,edges:.5,end:1}[s]||0:!c&&p&&(f=s[0],_=s[1]),function(g,v,w){var b=(w||t).length,x=h[b],S,C,P,M,T,A,R,k,O;if(!x){if(O=t.grid==="auto"?0:(t.grid||[1,Ne])[1],!O){for(R=-Ne;R<(R=w[O++].getBoundingClientRect().left)&&O<b;);O--}for(x=h[b]=[],S=p?Math.min(O,b)*f-.5:s%O,C=O===Ne?0:p?b*_/O-.5:s/O|0,R=0,k=Ne,A=0;A<b;A++)P=A%O-S,M=C-(A/O|0),x[A]=T=d?Math.abs(d==="y"?M:P):al(P*P+M*M),T>R&&(R=T),T<k&&(k=T);s==="random"&&Pl(x),x.max=R-k,x.min=k,x.v=b=(parseFloat(t.amount)||parseFloat(t.each)*(O>b?b-1:d?d==="y"?b/O:O:Math.max(O,b/O))||0)*(s==="edges"?-1:1),x.b=b<0?l-b:l,x.u=ge(t.amount||t.each)||0,n=n&&b<0?Il(n):n}return b=(x[g]-x.min)/x.max||0,_e(x.b+(n?n(b):b)*x.v)+x.u}},vs=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(n){var s=Math.round(parseFloat(n)/e)*e*t;return(s-s%1)/t+(st(n)?0:ge(n))}},Al=function(e,t){var n=be(e),s,l;return!n&&ot(e)&&(s=n=e.radius||Ne,e.values?(e=Ve(e.values),(l=!st(e[0]))&&(s*=s)):e=vs(e.increment)),Mt(t,n?pe(e)?function(h){return l=e(h),Math.abs(l-h)<=s?l:h}:function(h){for(var c=parseFloat(l?h.x:h),p=parseFloat(l?h.y:0),d=Ne,f=0,_=e.length,g,v;_--;)l?(g=e[_].x-c,v=e[_].y-p,g=g*g+v*v):g=Math.abs(e[_]-c),g<d&&(d=g,f=_);return f=!s||d<=s?e[f]:h,l||f===h||st(h)?f:f+ge(h)}:vs(e))},Ml=function(e,t,n,s){return Mt(be(e)?!t:n===!0?!!(n=0):!s,function(){return be(e)?e[~~(Math.random()*e.length)]:(n=n||1e-5)&&(s=n<1?Math.pow(10,(n+"").length-2):1)&&Math.floor(Math.round((e-n/2+Math.random()*(t-e+n*.99))/n)*n*s)/s})},Lp=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(s){return t.reduce(function(l,h){return h(l)},s)}},Ip=function(e,t){return function(n){return e(parseFloat(n))+(t||ge(n))}},Up=function(e,t,n){return Ol(e,t,0,1,n)},kl=function(e,t,n){return Mt(n,function(s){return e[~~t(s)]})},Bp=function r(e,t,n){var s=t-e;return be(e)?kl(e,r(0,e.length),t):Mt(n,function(l){return(s+(l-e)%s)%s+e})},Np=function r(e,t,n){var s=t-e,l=s*2;return be(e)?kl(e,r(0,e.length-1),t):Mt(n,function(h){return h=(l+(h-e)%l)%l||0,e+(h>s?l-h:h)})},on=function(e){for(var t=0,n="",s,l,h,c;~(s=e.indexOf("random(",t));)h=e.indexOf(")",s),c=e.charAt(s+7)==="[",l=e.substr(s+7,h-s-7).match(c?dl:ds),n+=e.substr(t,s-t)+Ml(c?l:+l[0],c?0:+l[1],+l[2]||1e-5),t=h+1;return n+e.substr(t,e.length-t)},Ol=function(e,t,n,s,l){var h=t-e,c=s-n;return Mt(l,function(p){return n+((p-e)/h*c||0)})},Vp=function r(e,t,n,s){var l=isNaN(e+t)?0:function(v){return(1-v)*e+v*t};if(!l){var h=fe(e),c={},p,d,f,_,g;if(n===!0&&(s=1)&&(n=null),h)e={p:e},t={p:t};else if(be(e)&&!be(t)){for(f=[],_=e.length,g=_-2,d=1;d<_;d++)f.push(r(e[d-1],e[d]));_--,l=function(w){w*=_;var b=Math.min(g,~~w);return f[b](w-b)},n=t}else s||(e=Yt(be(e)?[]:{},e));if(!f){for(p in t)Vs.call(c,e,p,"get",t[p]);l=function(w){return js(w,c)||(h?e.p:e)}}}return Mt(n,l)},aa=function(e,t,n){var s=e.labels,l=Ne,h,c,p;for(h in s)c=s[h]-t,c<0==!!n&&c&&l>(c=Math.abs(c))&&(p=h,l=c);return p},Fe=function(e,t,n){var s=e.vars,l=s[t],h,c;if(l)return h=s[t+"Params"],c=s.callbackScope||e,n&&yt.length&&$n(),h?l.apply(c,h):l.call(c)},Xi=function(e){return nt(e),e.scrollTrigger&&e.scrollTrigger.kill(!1),e.progress()<1&&Fe(e,"onInterrupt"),e},di,Fp=function(e){e=!e.name&&e.default||e;var t=e.name,n=pe(e),s=t&&!n&&e.init?function(){this._props=[]}:e,l={init:sn,render:js,add:Vs,kill:nf,modifier:tf,rawVars:0},h={targetTest:0,get:0,getSetter:Hs,aliases:{},register:0};if(Ci(),e!==s){if(Oe[t])return;ze(s,ze(Wn(e,l),h)),Yt(s.prototype,Yt(l,Wn(e,h))),Oe[s.prop=t]=s,e.targetTest&&(Vn.push(s),Is[t]=1),t=(t==="css"?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}ml(t,s),e.register&&e.register(Ke,s,Me)},ee=255,Zi={aqua:[0,ee,ee],lime:[0,ee,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,ee],navy:[0,0,128],white:[ee,ee,ee],olive:[128,128,0],yellow:[ee,ee,0],orange:[ee,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[ee,0,0],pink:[ee,192,203],cyan:[0,ee,ee],transparent:[ee,ee,ee,0]},$r=function(e,t,n){return e+=e<0?1:e>1?-1:0,(e*6<1?t+(n-t)*e*6:e<.5?n:e*3<2?t+(n-t)*(2/3-e)*6:t)*ee+.5|0},Rl=function(e,t,n){var s=e?st(e)?[e>>16,e>>8&ee,e&ee]:0:Zi.black,l,h,c,p,d,f,_,g,v,w;if(!s){if(e.substr(-1)===","&&(e=e.substr(0,e.length-1)),Zi[e])s=Zi[e];else if(e.charAt(0)==="#"){if(e.length<6&&(l=e.charAt(1),h=e.charAt(2),c=e.charAt(3),e="#"+l+l+h+h+c+c+(e.length===5?e.charAt(4)+e.charAt(4):"")),e.length===9)return s=parseInt(e.substr(1,6),16),[s>>16,s>>8&ee,s&ee,parseInt(e.substr(7),16)/255];e=parseInt(e.substr(1),16),s=[e>>16,e>>8&ee,e&ee]}else if(e.substr(0,3)==="hsl"){if(s=w=e.match(ds),!t)p=+s[0]%360/360,d=+s[1]/100,f=+s[2]/100,h=f<=.5?f*(d+1):f+d-f*d,l=f*2-h,s.length>3&&(s[3]*=1),s[0]=$r(p+1/3,l,h),s[1]=$r(p,l,h),s[2]=$r(p-1/3,l,h);else if(~e.indexOf("="))return s=e.match(ul),n&&s.length<4&&(s[3]=1),s}else s=e.match(ds)||Zi.transparent;s=s.map(Number)}return t&&!w&&(l=s[0]/ee,h=s[1]/ee,c=s[2]/ee,_=Math.max(l,h,c),g=Math.min(l,h,c),f=(_+g)/2,_===g?p=d=0:(v=_-g,d=f>.5?v/(2-_-g):v/(_+g),p=_===l?(h-c)/v+(h<c?6:0):_===h?(c-l)/v+2:(l-h)/v+4,p*=60),s[0]=~~(p+.5),s[1]=~~(d*100+.5),s[2]=~~(f*100+.5)),n&&s.length<4&&(s[3]=1),s},Dl=function(e){var t=[],n=[],s=-1;return e.split(Ct).forEach(function(l){var h=l.match(ci)||[];t.push.apply(t,h),n.push(s+=h.length+1)}),t.c=n,t},la=function(e,t,n){var s="",l=(e+s).match(Ct),h=t?"hsla(":"rgba(",c=0,p,d,f,_;if(!l)return e;if(l=l.map(function(g){return(g=Rl(g,t,1))&&h+(t?g[0]+","+g[1]+"%,"+g[2]+"%,"+g[3]:g.join(","))+")"}),n&&(f=Dl(e),p=n.c,p.join(s)!==f.c.join(s)))for(d=e.replace(Ct,"1").split(ci),_=d.length-1;c<_;c++)s+=d[c]+(~p.indexOf(c)?l.shift()||h+"0,0,0,0)":(f.length?f:l.length?l:n).shift());if(!d)for(d=e.split(Ct),_=d.length-1;c<_;c++)s+=d[c]+l[c];return s+d[_]},Ct=(function(){var r="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",e;for(e in Zi)r+="|"+e+"\\b";return new RegExp(r+")","gi")})(),zp=/hsl[a]?\(/,Ll=function(e){var t=e.join(" "),n;if(Ct.lastIndex=0,Ct.test(t))return n=zp.test(t),e[1]=la(e[1],n),e[0]=la(e[0],n,Dl(e[1])),!0},an,Re=(function(){var r=Date.now,e=500,t=33,n=r(),s=n,l=1e3/240,h=l,c=[],p,d,f,_,g,v,w=function b(x){var S=r()-s,C=x===!0,P,M,T,A;if(S>e&&(n+=S-t),s+=S,T=s-n,P=T-h,(P>0||C)&&(A=++_.frame,g=T-_.time*1e3,_.time=T=T/1e3,h+=P+(P>=l?4:l-P),M=1),C||(p=d(b)),M)for(v=0;v<c.length;v++)c[v](T,g,A,x)};return _={time:0,frame:0,tick:function(){w(!0)},deltaRatio:function(x){return g/(1e3/(x||60))},wake:function(){pl&&(!ps&&ll()&&(Xe=ps=window,Ds=Xe.document||{},Le.gsap=Ke,(Xe.gsapVersions||(Xe.gsapVersions=[])).push(Ke.version),fl(Gn||Xe.GreenSockGlobals||!Xe.gsap&&Xe||{}),f=Xe.requestAnimationFrame),p&&_.sleep(),d=f||function(x){return setTimeout(x,h-_.time*1e3+1|0)},an=1,w(2))},sleep:function(){(f?Xe.cancelAnimationFrame:clearTimeout)(p),an=0,d=sn},lagSmoothing:function(x,S){e=x||1/te,t=Math.min(S,e,0)},fps:function(x){l=1e3/(x||240),h=_.time*1e3+l},add:function(x,S,C){var P=S?function(M,T,A,R){x(M,T,A,R),_.remove(P)}:x;return _.remove(x),c[C?"unshift":"push"](P),Ci(),P},remove:function(x,S){~(S=c.indexOf(x))&&c.splice(S,1)&&v>=S&&v--},_listeners:c},_})(),Ci=function(){return!an&&Re.wake()},j={},Hp=/^[\d.\-M][\d.\-,\s]/,jp=/["']/g,Gp=function(e){for(var t={},n=e.substr(1,e.length-3).split(":"),s=n[0],l=1,h=n.length,c,p,d;l<h;l++)p=n[l],c=l!==h-1?p.lastIndexOf(","):p.length,d=p.substr(0,c),t[s]=isNaN(d)?d.replace(jp,"").trim():+d,s=p.substr(c+1).trim();return t},Kp=function(e){var t=e.indexOf("(")+1,n=e.indexOf(")"),s=e.indexOf("(",t);return e.substring(t,~s&&s<n?e.indexOf(")",n+1):n)},$p=function(e){var t=(e+"").split("("),n=j[t[0]];return n&&t.length>1&&n.config?n.config.apply(null,~e.indexOf("{")?[Gp(t[1])]:Kp(e).split(",").map(bl)):j._CE&&Hp.test(e)?j._CE("",e):n},Il=function(e){return function(t){return 1-e(1-t)}},Ul=function r(e,t){for(var n=e._first,s;n;)n instanceof Pe?r(n,t):n.vars.yoyoEase&&(!n._yoyo||!n._repeat)&&n._yoyo!==t&&(n.timeline?r(n.timeline,t):(s=n._ease,n._ease=n._yEase,n._yEase=s,n._yoyo=t)),n=n._next},Kt=function(e,t){return e&&(pe(e)?e:j[e]||$p(e))||t},Zt=function(e,t,n,s){n===void 0&&(n=function(p){return 1-t(1-p)}),s===void 0&&(s=function(p){return p<.5?t(p*2)/2:1-t((1-p)*2)/2});var l={easeIn:t,easeOut:n,easeInOut:s},h;return Ae(e,function(c){j[c]=Le[c]=l,j[h=c.toLowerCase()]=n;for(var p in l)j[h+(p==="easeIn"?".in":p==="easeOut"?".out":".inOut")]=j[c+"."+p]=l[p]}),l},Bl=function(e){return function(t){return t<.5?(1-e(1-t*2))/2:.5+e((t-.5)*2)/2}},Wr=function r(e,t,n){var s=t>=1?t:1,l=(n||(e?.3:.45))/(t<1?t:1),h=l/cs*(Math.asin(1/s)||0),c=function(f){return f===1?1:s*Math.pow(2,-10*f)*xp((f-h)*l)+1},p=e==="out"?c:e==="in"?function(d){return 1-c(1-d)}:Bl(c);return l=cs/l,p.config=function(d,f){return r(e,d,f)},p},qr=function r(e,t){t===void 0&&(t=1.70158);var n=function(h){return h?--h*h*((t+1)*h+t)+1:0},s=e==="out"?n:e==="in"?function(l){return 1-n(1-l)}:Bl(n);return s.config=function(l){return r(e,l)},s};Ae("Linear,Quad,Cubic,Quart,Quint,Strong",function(r,e){var t=e<5?e+1:e;Zt(r+",Power"+(t-1),e?function(n){return Math.pow(n,t)}:function(n){return n},function(n){return 1-Math.pow(1-n,t)},function(n){return n<.5?Math.pow(n*2,t)/2:1-Math.pow((1-n)*2,t)/2})});j.Linear.easeNone=j.none=j.Linear.easeIn;Zt("Elastic",Wr("in"),Wr("out"),Wr());(function(r,e){var t=1/e,n=2*t,s=2.5*t,l=function(c){return c<t?r*c*c:c<n?r*Math.pow(c-1.5/e,2)+.75:c<s?r*(c-=2.25/e)*c+.9375:r*Math.pow(c-2.625/e,2)+.984375};Zt("Bounce",function(h){return 1-l(1-h)},l)})(7.5625,2.75);Zt("Expo",function(r){return r?Math.pow(2,10*(r-1)):0});Zt("Circ",function(r){return-(al(1-r*r)-1)});Zt("Sine",function(r){return r===1?1:-bp(r*vp)+1});Zt("Back",qr("in"),qr("out"),qr());j.SteppedEase=j.steps=Le.SteppedEase={config:function(e,t){e===void 0&&(e=1);var n=1/e,s=e+(t?0:1),l=t?1:0,h=1-te;return function(c){return((s*pn(0,h,c)|0)+l)*n}}};xi.ease=j["quad.out"];Ae("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(r){return Us+=r+","+r+"Params,"});var Nl=function(e,t){this.id=gp++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:vl,this.set=t?t.getSetter:Hs},ln=(function(){function r(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,yi(this,+t.duration,1,1),this.data=t.data,an||Re.wake()}var e=r.prototype;return e.delay=function(n){return n||n===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+n-this._delay),this._delay=n,this):this._delay},e.duration=function(n){return arguments.length?this.totalDuration(this._repeat>0?n+(n+this._rDelay)*this._repeat:n):this.totalDuration()&&this._dur},e.totalDuration=function(n){return arguments.length?(this._dirty=0,yi(this,this._repeat<0?n:(n-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(n,s){if(Ci(),!arguments.length)return this._tTime;var l=this._dp;if(l&&l.smoothChildTiming&&this._ts){for(Ns(this,n),!l._dp||l.parent||yl(l,this);l&&l.parent;)l.parent._time!==l._start+(l._ts>=0?l._tTime/l._ts:(l.totalDuration()-l._tTime)/-l._ts)&&l.totalTime(l._tTime,!0),l=l.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&n<this._tDur||this._ts<0&&n>0||!this._tDur&&!n)&&Ze(this._dp,this,this._start-this._delay)}return(this._tTime!==n||!this._dur&&!s||this._initted&&Math.abs(this._zTime)===te||!n&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=n),gl(this,n,s)),this},e.time=function(n,s){return arguments.length?this.totalTime(Math.min(this.totalDuration(),n+sa(this))%(this._dur+this._rDelay)||(n?this._dur:0),s):this._time},e.totalProgress=function(n,s){return arguments.length?this.totalTime(this.totalDuration()*n,s):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.ratio},e.progress=function(n,s){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-n:n)+sa(this),s):this.duration()?Math.min(1,this._time/this._dur):this.ratio},e.iteration=function(n,s){var l=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(n-1)*l,s):this._repeat?wi(this._tTime,l)+1:1},e.timeScale=function(n){if(!arguments.length)return this._rts===-te?0:this._rts;if(this._rts===n)return this;var s=this.parent&&this._ts?qn(this.parent._time,this):this._tTime;return this._rts=+n||0,this._ts=this._ps||n===-te?0:this._rts,this.totalTime(pn(-this._delay,this._tDur,s),!0),sr(this),Sp(this)},e.paused=function(n){return arguments.length?(this._ps!==n&&(this._ps=n,n?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(Ci(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==te&&(this._tTime-=te)))),this):this._ps},e.startTime=function(n){if(arguments.length){this._start=n;var s=this.parent||this._dp;return s&&(s._sort||!this.parent)&&Ze(s,this,n-this._delay),this}return this._start},e.endTime=function(n){return this._start+(Te(n)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(n){var s=this.parent||this._dp;return s?n&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?qn(s.rawTime(n),this):this._tTime:this._tTime},e.globalTime=function(n){for(var s=this,l=arguments.length?n:s.rawTime();s;)l=s._start+l/(s._ts||1),s=s._dp;return l},e.repeat=function(n){return arguments.length?(this._repeat=n===1/0?-2:n,oa(this)):this._repeat===-2?1/0:this._repeat},e.repeatDelay=function(n){if(arguments.length){var s=this._time;return this._rDelay=n,oa(this),s?this.time(s):this}return this._rDelay},e.yoyo=function(n){return arguments.length?(this._yoyo=n,this):this._yoyo},e.seek=function(n,s){return this.totalTime(Be(this,n),Te(s))},e.restart=function(n,s){return this.play().totalTime(n?-this._delay:0,Te(s))},e.play=function(n,s){return n!=null&&this.seek(n,s),this.reversed(!1).paused(!1)},e.reverse=function(n,s){return n!=null&&this.seek(n||this.totalDuration(),s),this.reversed(!0).paused(!1)},e.pause=function(n,s){return n!=null&&this.seek(n,s),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(n){return arguments.length?(!!n!==this.reversed()&&this.timeScale(-this._rts||(n?-te:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-te,this},e.isActive=function(){var n=this.parent||this._dp,s=this._start,l;return!!(!n||this._ts&&this._initted&&n.isActive()&&(l=n.rawTime(!0))>=s&&l<this.endTime(!0)-te)},e.eventCallback=function(n,s,l){var h=this.vars;return arguments.length>1?(s?(h[n]=s,l&&(h[n+"Params"]=l),n==="onUpdate"&&(this._onUpdate=s)):delete h[n],this):h[n]},e.then=function(n){var s=this;return new Promise(function(l){var h=pe(n)?n:xl,c=function(){var d=s.then;s.then=null,pe(h)&&(h=h(s))&&(h.then||h===s)&&(s.then=d),l(h),s.then=d};s._initted&&s.totalProgress()===1&&s._ts>=0||!s._tTime&&s._ts<0?c():s._prom=c})},e.kill=function(){Xi(this)},r})();ze(ln.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-te,_prom:0,_ps:!1,_rts:1});var Pe=(function(r){ol(e,r);function e(n,s){var l;return n===void 0&&(n={}),l=r.call(this,n)||this,l.labels={},l.smoothChildTiming=!!n.smoothChildTiming,l.autoRemoveChildren=!!n.autoRemoveChildren,l._sort=Te(n.sortChildren),oe&&Ze(n.parent||oe,it(l),s),n.reversed&&l.reverse(),n.paused&&l.paused(!0),n.scrollTrigger&&Cl(it(l),n.scrollTrigger),l}var t=e.prototype;return t.to=function(s,l,h){return tn(0,arguments,this),this},t.from=function(s,l,h){return tn(1,arguments,this),this},t.fromTo=function(s,l,h,c){return tn(2,arguments,this),this},t.set=function(s,l,h){return l.duration=0,l.parent=this,en(l).repeatDelay||(l.repeat=0),l.immediateRender=!!l.immediateRender,new de(s,l,Be(this,h),1),this},t.call=function(s,l,h){return Ze(this,de.delayedCall(0,s,l),h)},t.staggerTo=function(s,l,h,c,p,d,f){return h.duration=l,h.stagger=h.stagger||c,h.onComplete=d,h.onCompleteParams=f,h.parent=this,new de(s,h,Be(this,p)),this},t.staggerFrom=function(s,l,h,c,p,d,f){return h.runBackwards=1,en(h).immediateRender=Te(h.immediateRender),this.staggerTo(s,l,h,c,p,d,f)},t.staggerFromTo=function(s,l,h,c,p,d,f,_){return c.startAt=h,en(c).immediateRender=Te(c.immediateRender),this.staggerTo(s,l,c,p,d,f,_)},t.render=function(s,l,h){var c=this._time,p=this._dirty?this.totalDuration():this._tDur,d=this._dur,f=s<=0?0:_e(s),_=this._zTime<0!=s<0&&(this._initted||!d),g,v,w,b,x,S,C,P,M,T,A,R;if(this!==oe&&f>p&&s>=0&&(f=p),f!==this._tTime||h||_){if(c!==this._time&&d&&(f+=this._time-c,s+=this._time-c),g=f,M=this._start,P=this._ts,S=!P,_&&(d||(c=this._zTime),(s||!l)&&(this._zTime=s)),this._repeat){if(A=this._yoyo,x=d+this._rDelay,this._repeat<-1&&s<0)return this.totalTime(x*100+s,l,h);if(g=_e(f%x),f===p?(b=this._repeat,g=d):(b=~~(f/x),b&&b===f/x&&(g=d,b--),g>d&&(g=d)),T=wi(this._tTime,x),!c&&this._tTime&&T!==b&&(T=b),A&&b&1&&(g=d-g,R=1),b!==T&&!this._lock){var k=A&&T&1,O=k===(A&&b&1);if(b<T&&(k=!k),c=k?0:d,this._lock=1,this.render(c||(R?0:_e(b*x)),l,!d)._lock=0,this._tTime=f,!l&&this.parent&&Fe(this,"onRepeat"),this.vars.repeatRefresh&&!R&&(this.invalidate()._lock=1),c&&c!==this._time||S!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(d=this._dur,p=this._tDur,O&&(this._lock=2,c=k?d:-1e-4,this.render(c,!0),this.vars.repeatRefresh&&!R&&this.invalidate()),this._lock=0,!this._ts&&!S)return this;Ul(this,R)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(C=Mp(this,_e(c),_e(g)),C&&(f-=g-(g=C._start))),this._tTime=f,this._time=g,this._act=!P,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=s,c=0),!c&&g&&!l&&(Fe(this,"onStart"),this._tTime!==f))return this;if(g>=c&&s>=0)for(v=this._first;v;){if(w=v._next,(v._act||g>=v._start)&&v._ts&&C!==v){if(v.parent!==this)return this.render(s,l,h);if(v.render(v._ts>0?(g-v._start)*v._ts:(v._dirty?v.totalDuration():v._tDur)+(g-v._start)*v._ts,l,h),g!==this._time||!this._ts&&!S){C=0,w&&(f+=this._zTime=-te);break}}v=w}else{v=this._last;for(var I=s<0?s:g;v;){if(w=v._prev,(v._act||I<=v._end)&&v._ts&&C!==v){if(v.parent!==this)return this.render(s,l,h);if(v.render(v._ts>0?(I-v._start)*v._ts:(v._dirty?v.totalDuration():v._tDur)+(I-v._start)*v._ts,l,h),g!==this._time||!this._ts&&!S){C=0,w&&(f+=this._zTime=I?-te:te);break}}v=w}}if(C&&!l&&(this.pause(),C.render(g>=c?0:-te)._zTime=g>=c?1:-1,this._ts))return this._start=M,sr(this),this.render(s,l,h);this._onUpdate&&!l&&Fe(this,"onUpdate",!0),(f===p&&this._tTime>=this.totalDuration()||!f&&c)&&(M===this._start||Math.abs(P)!==Math.abs(this._ts))&&(this._lock||((s||!d)&&(f===p&&this._ts>0||!f&&this._ts<0)&&nt(this,1),!l&&!(s<0&&!c)&&(f||c||!p)&&(Fe(this,f===p&&s>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(f<p&&this.timeScale()>0)&&this._prom())))}return this},t.add=function(s,l){var h=this;if(st(l)||(l=Be(this,l,s)),!(s instanceof ln)){if(be(s))return s.forEach(function(c){return h.add(c,l)}),this;if(fe(s))return this.addLabel(s,l);if(pe(s))s=de.delayedCall(0,s);else return this}return this!==s?Ze(this,s,l):this},t.getChildren=function(s,l,h,c){s===void 0&&(s=!0),l===void 0&&(l=!0),h===void 0&&(h=!0),c===void 0&&(c=-Ne);for(var p=[],d=this._first;d;)d._start>=c&&(d instanceof de?l&&p.push(d):(h&&p.push(d),s&&p.push.apply(p,d.getChildren(!0,l,h)))),d=d._next;return p},t.getById=function(s){for(var l=this.getChildren(1,1,1),h=l.length;h--;)if(l[h].vars.id===s)return l[h]},t.remove=function(s){return fe(s)?this.removeLabel(s):pe(s)?this.killTweensOf(s):(rr(this,s),s===this._recent&&(this._recent=this._last),Gt(this))},t.totalTime=function(s,l){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=_e(Re.time-(this._ts>0?s/this._ts:(this.totalDuration()-s)/-this._ts))),r.prototype.totalTime.call(this,s,l),this._forcing=0,this):this._tTime},t.addLabel=function(s,l){return this.labels[s]=Be(this,l),this},t.removeLabel=function(s){return delete this.labels[s],this},t.addPause=function(s,l,h){var c=de.delayedCall(0,l||sn,h);return c.data="isPause",this._hasPause=1,Ze(this,c,Be(this,s))},t.removePause=function(s){var l=this._first;for(s=Be(this,s);l;)l._start===s&&l.data==="isPause"&&nt(l),l=l._next},t.killTweensOf=function(s,l,h){for(var c=this.getTweensOf(s,h),p=c.length;p--;)gt!==c[p]&&c[p].kill(s,l);return this},t.getTweensOf=function(s,l){for(var h=[],c=Ve(s),p=this._first,d=st(l),f;p;)p instanceof de?yp(p._targets,c)&&(d?(!gt||p._initted&&p._ts)&&p.globalTime(0)<=l&&p.globalTime(p.totalDuration())>l:!l||p.isActive())&&h.push(p):(f=p.getTweensOf(c,l)).length&&h.push.apply(h,f),p=p._next;return h},t.tweenTo=function(s,l){l=l||{};var h=this,c=Be(h,s),p=l,d=p.startAt,f=p.onStart,_=p.onStartParams,g=p.immediateRender,v,w=de.to(h,ze({ease:l.ease||"none",lazy:!1,immediateRender:!1,time:c,overwrite:"auto",duration:l.duration||Math.abs((c-(d&&"time"in d?d.time:h._time))/h.timeScale())||te,onStart:function(){if(h.pause(),!v){var x=l.duration||Math.abs((c-(d&&"time"in d?d.time:h._time))/h.timeScale());w._dur!==x&&yi(w,x,0,1).render(w._time,!0,!0),v=1}f&&f.apply(w,_||[])}},l));return g?w.render(0):w},t.tweenFromTo=function(s,l,h){return this.tweenTo(l,ze({startAt:{time:Be(this,s)}},h))},t.recent=function(){return this._recent},t.nextLabel=function(s){return s===void 0&&(s=this._time),aa(this,Be(this,s))},t.previousLabel=function(s){return s===void 0&&(s=this._time),aa(this,Be(this,s),1)},t.currentLabel=function(s){return arguments.length?this.seek(s,!0):this.previousLabel(this._time+te)},t.shiftChildren=function(s,l,h){h===void 0&&(h=0);for(var c=this._first,p=this.labels,d;c;)c._start>=h&&(c._start+=s,c._end+=s),c=c._next;if(l)for(d in p)p[d]>=h&&(p[d]+=s);return Gt(this)},t.invalidate=function(){var s=this._first;for(this._lock=0;s;)s.invalidate(),s=s._next;return r.prototype.invalidate.call(this)},t.clear=function(s){s===void 0&&(s=!0);for(var l=this._first,h;l;)h=l._next,this.remove(l),l=h;return this._dp&&(this._time=this._tTime=this._pTime=0),s&&(this.labels={}),Gt(this)},t.totalDuration=function(s){var l=0,h=this,c=h._last,p=Ne,d,f,_;if(arguments.length)return h.timeScale((h._repeat<0?h.duration():h.totalDuration())/(h.reversed()?-s:s));if(h._dirty){for(_=h.parent;c;)d=c._prev,c._dirty&&c.totalDuration(),f=c._start,f>p&&h._sort&&c._ts&&!h._lock?(h._lock=1,Ze(h,c,f-c._delay,1)._lock=0):p=f,f<0&&c._ts&&(l-=f,(!_&&!h._dp||_&&_.smoothChildTiming)&&(h._start+=f/h._ts,h._time-=f,h._tTime-=f),h.shiftChildren(-f,!1,-1/0),p=0),c._end>l&&c._ts&&(l=c._end),c=d;yi(h,h===oe&&h._time>l?h._time:l,1,1),h._dirty=0}return h._tDur},e.updateRoot=function(s){if(oe._ts&&(gl(oe,qn(s,oe)),_l=Re.frame),Re.frame>=na){na+=De.autoSleep||120;var l=oe._first;if((!l||!l._ts)&&De.autoSleep&&Re._listeners.length<2){for(;l&&!l._ts;)l=l._next;l||Re.sleep()}}},e})(ln);ze(Pe.prototype,{_lock:0,_hasPause:0,_forcing:0});var Wp=function(e,t,n,s,l,h,c){var p=new Me(this._pt,e,t,0,1,Gl,null,l),d=0,f=0,_,g,v,w,b,x,S,C;for(p.b=n,p.e=s,n+="",s+="",(S=~s.indexOf("random("))&&(s=on(s)),h&&(C=[n,s],h(C,e,t),n=C[0],s=C[1]),g=n.match(Gr)||[];_=Gr.exec(s);)w=_[0],b=s.substring(d,_.index),v?v=(v+1)%5:b.substr(-5)==="rgba("&&(v=1),w!==g[f++]&&(x=parseFloat(g[f-1])||0,p._pt={_next:p._pt,p:b||f===1?b:",",s:x,c:w.charAt(1)==="="?fi(x,w)-x:parseFloat(w)-x,m:v&&v<4?Math.round:0},d=Gr.lastIndex);return p.c=d<s.length?s.substring(d,s.length):"",p.fp=c,(cl.test(s)||S)&&(p.e=0),this._pt=p,p},Vs=function(e,t,n,s,l,h,c,p,d){pe(s)&&(s=s(l||0,e,h));var f=e[t],_=n!=="get"?n:pe(f)?d?e[t.indexOf("set")||!pe(e["get"+t.substr(3)])?t:"get"+t.substr(3)](d):e[t]():f,g=pe(f)?d?Qp:Hl:zs,v;if(fe(s)&&(~s.indexOf("random(")&&(s=on(s)),s.charAt(1)==="="&&(v=fi(_,s)+(ge(_)||0),(v||v===0)&&(s=v))),_!==s||gs)return!isNaN(_*s)&&s!==""?(v=new Me(this._pt,e,t,+_||0,s-(_||0),typeof f=="boolean"?ef:jl,0,g),d&&(v.fp=d),c&&v.modifier(c,this,e),this._pt=v):(!f&&!(t in e)&&Ls(t,s),Wp.call(this,e,t,_,s,g,p||De.stringFilter,d))},qp=function(e,t,n,s,l){if(pe(e)&&(e=nn(e,l,t,n,s)),!ot(e)||e.style&&e.nodeType||be(e)||hl(e))return fe(e)?nn(e,l,t,n,s):e;var h={},c;for(c in e)h[c]=nn(e[c],l,t,n,s);return h},Vl=function(e,t,n,s,l,h){var c,p,d,f;if(Oe[e]&&(c=new Oe[e]).init(l,c.rawVars?t[e]:qp(t[e],s,l,h,n),n,s,h)!==!1&&(n._pt=p=new Me(n._pt,l,e,0,1,c.render,c,0,c.priority),n!==di))for(d=n._ptLookup[n._targets.indexOf(l)],f=c._props.length;f--;)d[c._props[f]]=p;return c},gt,gs,Fs=function r(e,t){var n=e.vars,s=n.ease,l=n.startAt,h=n.immediateRender,c=n.lazy,p=n.onUpdate,d=n.onUpdateParams,f=n.callbackScope,_=n.runBackwards,g=n.yoyoEase,v=n.keyframes,w=n.autoRevert,b=e._dur,x=e._startAt,S=e._targets,C=e.parent,P=C&&C.data==="nested"?C.parent._targets:S,M=e._overwrite==="auto"&&!Os,T=e.timeline,A,R,k,O,I,V,G,Z,K,F,L,ae,we;if(T&&(!v||!s)&&(s="none"),e._ease=Kt(s,xi.ease),e._yEase=g?Il(Kt(g===!0?s:g,xi.ease)):0,g&&e._yoyo&&!e._repeat&&(g=e._yEase,e._yEase=e._ease,e._ease=g),e._from=!T&&!!n.runBackwards,!T||v&&!n.stagger){if(Z=S[0]?jt(S[0]).harness:0,ae=Z&&n[Z.prop],A=Wn(n,Is),x&&(nt(x.render(-1,!0)),x._lazy=0),l)if(nt(e._startAt=de.set(S,ze({data:"isStart",overwrite:!1,parent:C,immediateRender:!0,lazy:Te(c),startAt:null,delay:0,onUpdate:p,onUpdateParams:d,callbackScope:f,stagger:0},l))),t<0&&!h&&!w&&e._startAt.render(-1,!0),h){if(t>0&&!w&&(e._startAt=0),b&&t<=0){t&&(e._zTime=t);return}}else w===!1&&(e._startAt=0);else if(_&&b){if(x)!w&&(e._startAt=0);else if(t&&(h=!1),k=ze({overwrite:!1,data:"isFromStart",lazy:h&&Te(c),immediateRender:h,stagger:0,parent:C},A),ae&&(k[Z.prop]=ae),nt(e._startAt=de.set(S,k)),t<0&&e._startAt.render(-1,!0),e._zTime=t,!h)r(e._startAt,te);else if(!t)return}for(e._pt=e._ptCache=0,c=b&&Te(c)||c&&!b,R=0;R<S.length;R++){if(I=S[R],G=I._gsap||Bs(S)[R]._gsap,e._ptLookup[R]=F={},fs[G.id]&&yt.length&&$n(),L=P===S?R:P.indexOf(I),Z&&(K=new Z).init(I,ae||A,e,L,P)!==!1&&(e._pt=O=new Me(e._pt,I,K.name,0,1,K.render,K,0,K.priority),K._props.forEach(function(ye){F[ye]=O}),K.priority&&(V=1)),!Z||ae)for(k in A)Oe[k]&&(K=Vl(k,A,e,L,I,P))?K.priority&&(V=1):F[k]=O=Vs.call(e,I,k,"get",A[k],L,P,0,n.stringFilter);e._op&&e._op[R]&&e.kill(I,e._op[R]),M&&e._pt&&(gt=e,oe.killTweensOf(I,F,e.globalTime(t)),we=!e.parent,gt=0),e._pt&&c&&(fs[G.id]=1)}V&&Kl(e),e._onInit&&e._onInit(e)}e._onUpdate=p,e._initted=(!e._op||e._pt)&&!we,v&&t<=0&&T.render(Ne,!0,!0)},Yp=function(e,t,n,s,l,h,c){var p=(e._pt&&e._ptCache||(e._ptCache={}))[t],d,f,_;if(!p)for(p=e._ptCache[t]=[],f=e._ptLookup,_=e._targets.length;_--;){if(d=f[_][t],d&&d.d&&d.d._pt)for(d=d.d._pt;d&&d.p!==t;)d=d._next;if(!d)return gs=1,e.vars[t]="+=0",Fs(e,c),gs=0,1;p.push(d)}for(_=p.length;_--;)d=p[_],d.s=(s||s===0)&&!l?s:d.s+(s||0)+h*d.c,d.c=n-d.s,d.e&&(d.e=le(n)+ge(d.e)),d.b&&(d.b=d.s+ge(d.b))},Xp=function(e,t){var n=e[0]?jt(e[0]).harness:0,s=n&&n.aliases,l,h,c,p;if(!s)return t;l=Yt({},t);for(h in s)if(h in l)for(p=s[h].split(","),c=p.length;c--;)l[p[c]]=l[h];return l},Zp=function(e,t,n,s){var l=t.ease||s||"power1.inOut",h,c;if(be(t))c=n[e]||(n[e]=[]),t.forEach(function(p,d){return c.push({t:d/(t.length-1)*100,v:p,e:l})});else for(h in t)c=n[h]||(n[h]=[]),h==="ease"||c.push({t:parseFloat(e),v:t[h],e:l})},nn=function(e,t,n,s,l){return pe(e)?e.call(t,n,s,l):fe(e)&&~e.indexOf("random(")?on(e):e},Fl=Us+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",zl={};Ae(Fl+",id,stagger,delay,duration,paused,scrollTrigger",function(r){return zl[r]=1});var de=(function(r){ol(e,r);function e(n,s,l,h){var c;typeof s=="number"&&(l.duration=s,s=l,l=null),c=r.call(this,h?s:en(s))||this;var p=c.vars,d=p.duration,f=p.delay,_=p.immediateRender,g=p.stagger,v=p.overwrite,w=p.keyframes,b=p.defaults,x=p.scrollTrigger,S=p.yoyoEase,C=s.parent||oe,P=(be(n)||hl(n)?st(n[0]):"length"in s)?[n]:Ve(n),M,T,A,R,k,O,I,V;if(c._targets=P.length?Bs(P):Kn("GSAP target "+n+" not found. https://greensock.com",!De.nullTargetWarn)||[],c._ptLookup=[],c._overwrite=v,w||g||Rn(d)||Rn(f)){if(s=c.vars,M=c.timeline=new Pe({data:"nested",defaults:b||{}}),M.kill(),M.parent=M._dp=it(c),M._start=0,g||Rn(d)||Rn(f)){if(R=P.length,I=g&&Tl(g),ot(g))for(k in g)~Fl.indexOf(k)&&(V||(V={}),V[k]=g[k]);for(T=0;T<R;T++)A=Wn(s,zl),A.stagger=0,S&&(A.yoyoEase=S),V&&Yt(A,V),O=P[T],A.duration=+nn(d,it(c),T,O,P),A.delay=(+nn(f,it(c),T,O,P)||0)-c._delay,!g&&R===1&&A.delay&&(c._delay=f=A.delay,c._start+=f,A.delay=0),M.to(O,A,I?I(T,O,P):0),M._ease=j.none;M.duration()?d=f=0:c.timeline=0}else if(w){en(ze(M.vars.defaults,{ease:"none"})),M._ease=Kt(w.ease||s.ease||"none");var G=0,Z,K,F;if(be(w))w.forEach(function(L){return M.to(P,L,">")});else{A={};for(k in w)k==="ease"||k==="easeEach"||Zp(k,w[k],A,w.easeEach);for(k in A)for(Z=A[k].sort(function(L,ae){return L.t-ae.t}),G=0,T=0;T<Z.length;T++)K=Z[T],F={ease:K.e,duration:(K.t-(T?Z[T-1].t:0))/100*d},F[k]=K.v,M.to(P,F,G),G+=F.duration;M.duration()<d&&M.to({},{duration:d-M.duration()})}}d||c.duration(d=M.duration())}else c.timeline=0;return v===!0&&!Os&&(gt=it(c),oe.killTweensOf(P),gt=0),Ze(C,it(c),l),s.reversed&&c.reverse(),s.paused&&c.paused(!0),(_||!d&&!w&&c._start===_e(C._time)&&Te(_)&&Pp(it(c))&&C.data!=="nested")&&(c._tTime=-te,c.render(Math.max(0,-f))),x&&Cl(it(c),x),c}var t=e.prototype;return t.render=function(s,l,h){var c=this._time,p=this._tDur,d=this._dur,f=s>p-te&&s>=0?p:s<te?0:s,_,g,v,w,b,x,S,C,P;if(!d)Ap(this,s,l,h);else if(f!==this._tTime||!s||h||!this._initted&&this._tTime||this._startAt&&this._zTime<0!=s<0){if(_=f,C=this.timeline,this._repeat){if(w=d+this._rDelay,this._repeat<-1&&s<0)return this.totalTime(w*100+s,l,h);if(_=_e(f%w),f===p?(v=this._repeat,_=d):(v=~~(f/w),v&&v===f/w&&(_=d,v--),_>d&&(_=d)),x=this._yoyo&&v&1,x&&(P=this._yEase,_=d-_),b=wi(this._tTime,w),_===c&&!h&&this._initted)return this._tTime=f,this;v!==b&&(C&&this._yEase&&Ul(C,x),this.vars.repeatRefresh&&!x&&!this._lock&&(this._lock=h=1,this.render(_e(w*v),!0).invalidate()._lock=0))}if(!this._initted){if(El(this,s<0?s:_,h,l))return this._tTime=0,this;if(c!==this._time)return this;if(d!==this._dur)return this.render(s,l,h)}if(this._tTime=f,this._time=_,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=S=(P||this._ease)(_/d),this._from&&(this.ratio=S=1-S),_&&!c&&!l&&(Fe(this,"onStart"),this._tTime!==f))return this;for(g=this._pt;g;)g.r(S,g.d),g=g._next;C&&C.render(s<0?s:!_&&x?-te:C._dur*C._ease(_/this._dur),l,h)||this._startAt&&(this._zTime=s),this._onUpdate&&!l&&(s<0&&this._startAt&&this._startAt.render(s,!0,h),Fe(this,"onUpdate")),this._repeat&&v!==b&&this.vars.onRepeat&&!l&&this.parent&&Fe(this,"onRepeat"),(f===this._tDur||!f)&&this._tTime===f&&(s<0&&this._startAt&&!this._onUpdate&&this._startAt.render(s,!0,!0),(s||!d)&&(f===this._tDur&&this._ts>0||!f&&this._ts<0)&&nt(this,1),!l&&!(s<0&&!c)&&(f||c)&&(Fe(this,f===p?"onComplete":"onReverseComplete",!0),this._prom&&!(f<p&&this.timeScale()>0)&&this._prom()))}return this},t.targets=function(){return this._targets},t.invalidate=function(){return this._pt=this._op=this._startAt=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(),r.prototype.invalidate.call(this)},t.resetTo=function(s,l,h,c){an||Re.wake(),this._ts||this.play();var p=Math.min(this._dur,(this._dp._time-this._start)*this._ts),d;return this._initted||Fs(this,p),d=this._ease(p/this._dur),Yp(this,s,l,h,c,d,p)?this.resetTo(s,l,h,c):(Ns(this,0),this.parent||wl(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},t.kill=function(s,l){if(l===void 0&&(l="all"),!s&&(!l||l==="all"))return this._lazy=this._pt=0,this.parent?Xi(this):this;if(this.timeline){var h=this.timeline.totalDuration();return this.timeline.killTweensOf(s,l,gt&&gt.vars.overwrite!==!0)._first||Xi(this),this.parent&&h!==this.timeline.totalDuration()&&yi(this,this._dur*this.timeline._tDur/h,0,1),this}var c=this._targets,p=s?Ve(s):c,d=this._ptLookup,f=this._pt,_,g,v,w,b,x,S;if((!l||l==="all")&&Ep(c,p))return l==="all"&&(this._pt=0),Xi(this);for(_=this._op=this._op||[],l!=="all"&&(fe(l)&&(b={},Ae(l,function(C){return b[C]=1}),l=b),l=Xp(c,l)),S=c.length;S--;)if(~p.indexOf(c[S])){g=d[S],l==="all"?(_[S]=l,w=g,v={}):(v=_[S]=_[S]||{},w=l);for(b in w)x=g&&g[b],x&&((!("kill"in x.d)||x.d.kill(b)===!0)&&rr(this,x,"_pt"),delete g[b]),v!=="all"&&(v[b]=1)}return this._initted&&!this._pt&&f&&Xi(this),this},e.to=function(s,l){return new e(s,l,arguments[2])},e.from=function(s,l){return tn(1,arguments)},e.delayedCall=function(s,l,h,c){return new e(l,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:s,onComplete:l,onReverseComplete:l,onCompleteParams:h,onReverseCompleteParams:h,callbackScope:c})},e.fromTo=function(s,l,h){return tn(2,arguments)},e.set=function(s,l){return l.duration=0,l.repeatDelay||(l.repeat=0),new e(s,l)},e.killTweensOf=function(s,l,h){return oe.killTweensOf(s,l,h)},e})(ln);ze(de.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});Ae("staggerTo,staggerFrom,staggerFromTo",function(r){de[r]=function(){var e=new Pe,t=_s.call(arguments,0);return t.splice(r==="staggerFromTo"?5:4,0,0),e[r].apply(e,t)}});var zs=function(e,t,n){return e[t]=n},Hl=function(e,t,n){return e[t](n)},Qp=function(e,t,n,s){return e[t](s.fp,n)},Jp=function(e,t,n){return e.setAttribute(t,n)},Hs=function(e,t){return pe(e[t])?Hl:Rs(e[t])&&e.setAttribute?Jp:zs},jl=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e6)/1e6,t)},ef=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},Gl=function(e,t){var n=t._pt,s="";if(!e&&t.b)s=t.b;else if(e===1&&t.e)s=t.e;else{for(;n;)s=n.p+(n.m?n.m(n.s+n.c*e):Math.round((n.s+n.c*e)*1e4)/1e4)+s,n=n._next;s+=t.c}t.set(t.t,t.p,s,t)},js=function(e,t){for(var n=t._pt;n;)n.r(e,n.d),n=n._next},tf=function(e,t,n,s){for(var l=this._pt,h;l;)h=l._next,l.p===s&&l.modifier(e,t,n),l=h},nf=function(e){for(var t=this._pt,n,s;t;)s=t._next,t.p===e&&!t.op||t.op===e?rr(this,t,"_pt"):t.dep||(n=1),t=s;return!n},rf=function(e,t,n,s){s.mSet(e,t,s.m.call(s.tween,n,s.mt),s)},Kl=function(e){for(var t=e._pt,n,s,l,h;t;){for(n=t._next,s=l;s&&s.pr>t.pr;)s=s._next;(t._prev=s?s._prev:h)?t._prev._next=t:l=t,(t._next=s)?s._prev=t:h=t,t=n}e._pt=l},Me=(function(){function r(t,n,s,l,h,c,p,d,f){this.t=n,this.s=l,this.c=h,this.p=s,this.r=c||jl,this.d=p||this,this.set=d||zs,this.pr=f||0,this._next=t,t&&(t._prev=this)}var e=r.prototype;return e.modifier=function(n,s,l){this.mSet=this.mSet||this.set,this.set=rf,this.m=n,this.mt=l,this.tween=s},r})();Ae(Us+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(r){return Is[r]=1});Le.TweenMax=Le.TweenLite=de;Le.TimelineLite=Le.TimelineMax=Pe;oe=new Pe({sortChildren:!1,defaults:xi,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});De.stringFilter=Ll;var Yn={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach(function(s){return Fp(s)})},timeline:function(e){return new Pe(e)},getTweensOf:function(e,t){return oe.getTweensOf(e,t)},getProperty:function(e,t,n,s){fe(e)&&(e=Ve(e)[0]);var l=jt(e||{}).get,h=n?xl:bl;return n==="native"&&(n=""),e&&(t?h((Oe[t]&&Oe[t].get||l)(e,t,n,s)):function(c,p,d){return h((Oe[c]&&Oe[c].get||l)(e,c,p,d))})},quickSetter:function(e,t,n){if(e=Ve(e),e.length>1){var s=e.map(function(f){return Ke.quickSetter(f,t,n)}),l=s.length;return function(f){for(var _=l;_--;)s[_](f)}}e=e[0]||{};var h=Oe[t],c=jt(e),p=c.harness&&(c.harness.aliases||{})[t]||t,d=h?function(f){var _=new h;di._pt=0,_.init(e,n?f+n:f,di,0,[e]),_.render(1,_),di._pt&&js(1,di)}:c.set(e,p);return h?d:function(f){return d(e,p,n?f+n:f,c,1)}},quickTo:function(e,t,n){var s,l=Ke.to(e,Yt((s={},s[t]="+=0.1",s.paused=!0,s),n||{})),h=function(p,d,f){return l.resetTo(t,p,d,f)};return h.tween=l,h},isTweening:function(e){return oe.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=Kt(e.ease,xi.ease)),ra(xi,e||{})},config:function(e){return ra(De,e||{})},registerEffect:function(e){var t=e.name,n=e.effect,s=e.plugins,l=e.defaults,h=e.extendTimeline;(s||"").split(",").forEach(function(c){return c&&!Oe[c]&&!Le[c]&&Kn(t+" effect requires "+c+" plugin.")}),Kr[t]=function(c,p,d){return n(Ve(c),ze(p||{},l),d)},h&&(Pe.prototype[t]=function(c,p,d){return this.add(Kr[t](c,ot(p)?p:(d=p)&&{},this),d)})},registerEase:function(e,t){j[e]=Kt(t)},parseEase:function(e,t){return arguments.length?Kt(e,t):j},getById:function(e){return oe.getById(e)},exportRoot:function(e,t){e===void 0&&(e={});var n=new Pe(e),s,l;for(n.smoothChildTiming=Te(e.smoothChildTiming),oe.remove(n),n._dp=0,n._time=n._tTime=oe._time,s=oe._first;s;)l=s._next,(t||!(!s._dur&&s instanceof de&&s.vars.onComplete===s._targets[0]))&&Ze(n,s,s._start-s._delay),s=l;return Ze(oe,n,0),n},utils:{wrap:Bp,wrapYoyo:Np,distribute:Tl,random:Ml,snap:Al,normalize:Up,getUnit:ge,clamp:Op,splitColor:Rl,toArray:Ve,selector:Dp,mapRange:Ol,pipe:Lp,unitize:Ip,interpolate:Vp,shuffle:Pl},install:fl,effects:Kr,ticker:Re,updateRoot:Pe.updateRoot,plugins:Oe,globalTimeline:oe,core:{PropTween:Me,globals:ml,Tween:de,Timeline:Pe,Animation:ln,getCache:jt,_removeLinkedListItem:rr,suppressOverwrites:function(e){return Os=e}}};Ae("to,from,fromTo,delayedCall,set,killTweensOf",function(r){return Yn[r]=de[r]});Re.add(Pe.updateRoot);di=Yn.to({},{duration:0});var sf=function(e,t){for(var n=e._pt;n&&n.p!==t&&n.op!==t&&n.fp!==t;)n=n._next;return n},of=function(e,t){var n=e._targets,s,l,h;for(s in t)for(l=n.length;l--;)h=e._ptLookup[l][s],h&&(h=h.d)&&(h._pt&&(h=sf(h,s)),h&&h.modifier&&h.modifier(t[s],e,n[l],s))},Yr=function(e,t){return{name:e,rawVars:1,init:function(s,l,h){h._onInit=function(c){var p,d;if(fe(l)&&(p={},Ae(l,function(f){return p[f]=1}),l=p),t){p={};for(d in l)p[d]=t(l[d]);l=p}of(c,l)}}}},Ke=Yn.registerPlugin({name:"attr",init:function(e,t,n,s,l){var h,c;for(h in t)c=this.add(e,"setAttribute",(e.getAttribute(h)||0)+"",t[h],s,l,0,0,h),c&&(c.op=h),this._props.push(h)}},{name:"endArray",init:function(e,t){for(var n=t.length;n--;)this.add(e,n,e[n]||0,t[n])}},Yr("roundProps",vs),Yr("modifiers"),Yr("snap",Al))||Yn;de.version=Pe.version=Ke.version="3.10.4";pl=1;ll()&&Ci();j.Power0;j.Power1;j.Power2;j.Power3;j.Power4;j.Linear;j.Quad;j.Cubic;j.Quart;j.Quint;j.Strong;j.Elastic;j.Back;j.SteppedEase;j.Bounce;j.Sine;j.Expo;j.Circ;var ha,bt,mi,Gs,Ht,ua,af=function(){return typeof window<"u"},Et={},Vt=180/Math.PI,_i=Math.PI/180,li=Math.atan2,ca=1e8,$l=/([A-Z])/g,lf=/(left|right|width|margin|padding|x)/i,hf=/[\s,\(]\S/,xt={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},Wl=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},uf=function(e,t){return t.set(t.t,t.p,e===1?t.e:Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},cf=function(e,t){return t.set(t.t,t.p,e?Math.round((t.s+t.c*e)*1e4)/1e4+t.u:t.b,t)},df=function(e,t){var n=t.s+t.c*e;t.set(t.t,t.p,~~(n+(n<0?-.5:.5))+t.u,t)},ql=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},Yl=function(e,t){return t.set(t.t,t.p,e!==1?t.b:t.e,t)},pf=function(e,t,n){return e.style[t]=n},ff=function(e,t,n){return e.style.setProperty(t,n)},mf=function(e,t,n){return e._gsap[t]=n},_f=function(e,t,n){return e._gsap.scaleX=e._gsap.scaleY=n},vf=function(e,t,n,s,l){var h=e._gsap;h.scaleX=h.scaleY=n,h.renderTransform(l,h)},gf=function(e,t,n,s,l){var h=e._gsap;h[t]=n,h.renderTransform(l,h)},me="transform",St=me+"Origin",Xl,bs=function(e,t){var n=bt.createElementNS?bt.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):bt.createElement(e);return n.style?n:bt.createElement(e)},rt=function r(e,t,n){var s=getComputedStyle(e);return s[t]||s.getPropertyValue(t.replace($l,"-$1").toLowerCase())||s.getPropertyValue(t)||!n&&r(e,Ei(t)||t,1)||""},da="O,Moz,ms,Ms,Webkit".split(","),Ei=function(e,t,n){var s=t||Ht,l=s.style,h=5;if(e in l&&!n)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);h--&&!(da[h]+e in l););return h<0?null:(h===3?"ms":h>=0?da[h]:"")+e},xs=function(){af()&&window.document&&(ha=window,bt=ha.document,mi=bt.documentElement,Ht=bs("div")||{style:{}},bs("div"),me=Ei(me),St=me+"Origin",Ht.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",Xl=!!Ei("perspective"),Gs=1)},Xr=function r(e){var t=bs("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),n=this.parentNode,s=this.nextSibling,l=this.style.cssText,h;if(mi.appendChild(t),t.appendChild(this),this.style.display="block",e)try{h=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=r}catch{}else this._gsapBBox&&(h=this._gsapBBox());return n&&(s?n.insertBefore(this,s):n.appendChild(this)),mi.removeChild(t),this.style.cssText=l,h},pa=function(e,t){for(var n=t.length;n--;)if(e.hasAttribute(t[n]))return e.getAttribute(t[n])},Zl=function(e){var t;try{t=e.getBBox()}catch{t=Xr.call(e,!0)}return t&&(t.width||t.height)||e.getBBox===Xr||(t=Xr.call(e,!0)),t&&!t.width&&!t.x&&!t.y?{x:+pa(e,["x","cx","x1"])||0,y:+pa(e,["y","cy","y1"])||0,width:0,height:0}:t},Ql=function(e){return!!(e.getCTM&&(!e.parentNode||e.ownerSVGElement)&&Zl(e))},hn=function(e,t){if(t){var n=e.style;t in Et&&t!==St&&(t=me),n.removeProperty?((t.substr(0,2)==="ms"||t.substr(0,6)==="webkit")&&(t="-"+t),n.removeProperty(t.replace($l,"-$1").toLowerCase())):n.removeAttribute(t)}},wt=function(e,t,n,s,l,h){var c=new Me(e._pt,t,n,0,1,h?Yl:ql);return e._pt=c,c.b=s,c.e=l,e._props.push(n),c},fa={deg:1,rad:1,turn:1},Pt=function r(e,t,n,s){var l=parseFloat(n)||0,h=(n+"").trim().substr((l+"").length)||"px",c=Ht.style,p=lf.test(t),d=e.tagName.toLowerCase()==="svg",f=(d?"client":"offset")+(p?"Width":"Height"),_=100,g=s==="px",v=s==="%",w,b,x,S;return s===h||!l||fa[s]||fa[h]?l:(h!=="px"&&!g&&(l=r(e,t,n,"px")),S=e.getCTM&&Ql(e),(v||h==="%")&&(Et[t]||~t.indexOf("adius"))?(w=S?e.getBBox()[p?"width":"height"]:e[f],le(v?l/w*_:l/100*w)):(c[p?"width":"height"]=_+(g?h:s),b=~t.indexOf("adius")||s==="em"&&e.appendChild&&!d?e:e.parentNode,S&&(b=(e.ownerSVGElement||{}).parentNode),(!b||b===bt||!b.appendChild)&&(b=bt.body),x=b._gsap,x&&v&&x.width&&p&&x.time===Re.time?le(l/x.width*_):((v||h==="%")&&(c.position=rt(e,"position")),b===e&&(c.position="static"),b.appendChild(Ht),w=Ht[f],b.removeChild(Ht),c.position="absolute",p&&v&&(x=jt(b),x.time=Re.time,x.width=b[f]),le(g?w*l/_:w&&l?_/w*l:0))))},Ft=function(e,t,n,s){var l;return Gs||xs(),t in xt&&t!=="transform"&&(t=xt[t],~t.indexOf(",")&&(t=t.split(",")[0])),Et[t]&&t!=="transform"?(l=cn(e,s),l=t!=="transformOrigin"?l[t]:l.svg?l.origin:Zn(rt(e,St))+" "+l.zOrigin+"px"):(l=e.style[t],(!l||l==="auto"||s||~(l+"").indexOf("calc("))&&(l=Xn[t]&&Xn[t](e,t,n)||rt(e,t)||vl(e,t)||(t==="opacity"?1:0))),n&&!~(l+"").trim().indexOf(" ")?Pt(e,t,l,n)+n:l},bf=function(e,t,n,s){if(!n||n==="none"){var l=Ei(t,e,1),h=l&&rt(e,l,1);h&&h!==n?(t=l,n=h):t==="borderColor"&&(n=rt(e,"borderTopColor"))}var c=new Me(this._pt,e.style,t,0,1,Gl),p=0,d=0,f,_,g,v,w,b,x,S,C,P,M,T;if(c.b=n,c.e=s,n+="",s+="",s==="auto"&&(e.style[t]=s,s=rt(e,t)||s,e.style[t]=n),f=[n,s],Ll(f),n=f[0],s=f[1],g=n.match(ci)||[],T=s.match(ci)||[],T.length){for(;_=ci.exec(s);)x=_[0],C=s.substring(p,_.index),w?w=(w+1)%5:(C.substr(-5)==="rgba("||C.substr(-5)==="hsla(")&&(w=1),x!==(b=g[d++]||"")&&(v=parseFloat(b)||0,M=b.substr((v+"").length),x.charAt(1)==="="&&(x=fi(v,x)+M),S=parseFloat(x),P=x.substr((S+"").length),p=ci.lastIndex-P.length,P||(P=P||De.units[t]||M,p===s.length&&(s+=P,c.e+=P)),M!==P&&(v=Pt(e,t,b,P)||0),c._pt={_next:c._pt,p:C||d===1?C:",",s:v,c:S-v,m:w&&w<4||t==="zIndex"?Math.round:0});c.c=p<s.length?s.substring(p,s.length):""}else c.r=t==="display"&&s==="none"?Yl:ql;return cl.test(s)&&(c.e=0),this._pt=c,c},ma={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},xf=function(e){var t=e.split(" "),n=t[0],s=t[1]||"50%";return(n==="top"||n==="bottom"||s==="left"||s==="right")&&(e=n,n=s,s=e),t[0]=ma[n]||n,t[1]=ma[s]||s,t.join(" ")},wf=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var n=t.t,s=n.style,l=t.u,h=n._gsap,c,p,d;if(l==="all"||l===!0)s.cssText="",p=1;else for(l=l.split(","),d=l.length;--d>-1;)c=l[d],Et[c]&&(p=1,c=c==="transformOrigin"?St:me),hn(n,c);p&&(hn(n,me),h&&(h.svg&&n.removeAttribute("transform"),cn(n,1),h.uncache=1))}},Xn={clearProps:function(e,t,n,s,l){if(l.data!=="isFromStart"){var h=e._pt=new Me(e._pt,t,n,0,0,wf);return h.u=s,h.pr=-10,h.tween=l,e._props.push(n),1}}},un=[1,0,0,1,0,0],Jl={},eh=function(e){return e==="matrix(1, 0, 0, 1, 0, 0)"||e==="none"||!e},_a=function(e){var t=rt(e,me);return eh(t)?un:t.substr(7).match(ul).map(le)},Ks=function(e,t){var n=e._gsap||jt(e),s=e.style,l=_a(e),h,c,p,d;return n.svg&&e.getAttribute("transform")?(p=e.transform.baseVal.consolidate().matrix,l=[p.a,p.b,p.c,p.d,p.e,p.f],l.join(",")==="1,0,0,1,0,0"?un:l):(l===un&&!e.offsetParent&&e!==mi&&!n.svg&&(p=s.display,s.display="block",h=e.parentNode,(!h||!e.offsetParent)&&(d=1,c=e.nextSibling,mi.appendChild(e)),l=_a(e),p?s.display=p:hn(e,"display"),d&&(c?h.insertBefore(e,c):h?h.appendChild(e):mi.removeChild(e))),t&&l.length>6?[l[0],l[1],l[4],l[5],l[12],l[13]]:l)},ws=function(e,t,n,s,l,h){var c=e._gsap,p=l||Ks(e,!0),d=c.xOrigin||0,f=c.yOrigin||0,_=c.xOffset||0,g=c.yOffset||0,v=p[0],w=p[1],b=p[2],x=p[3],S=p[4],C=p[5],P=t.split(" "),M=parseFloat(P[0])||0,T=parseFloat(P[1])||0,A,R,k,O;n?p!==un&&(R=v*x-w*b)&&(k=M*(x/R)+T*(-b/R)+(b*C-x*S)/R,O=M*(-w/R)+T*(v/R)-(v*C-w*S)/R,M=k,T=O):(A=Zl(e),M=A.x+(~P[0].indexOf("%")?M/100*A.width:M),T=A.y+(~(P[1]||P[0]).indexOf("%")?T/100*A.height:T)),s||s!==!1&&c.smooth?(S=M-d,C=T-f,c.xOffset=_+(S*v+C*b)-S,c.yOffset=g+(S*w+C*x)-C):c.xOffset=c.yOffset=0,c.xOrigin=M,c.yOrigin=T,c.smooth=!!s,c.origin=t,c.originIsAbsolute=!!n,e.style[St]="0px 0px",h&&(wt(h,c,"xOrigin",d,M),wt(h,c,"yOrigin",f,T),wt(h,c,"xOffset",_,c.xOffset),wt(h,c,"yOffset",g,c.yOffset)),e.setAttribute("data-svg-origin",M+" "+T)},cn=function(e,t){var n=e._gsap||new Nl(e);if("x"in n&&!t&&!n.uncache)return n;var s=e.style,l=n.scaleX<0,h="px",c="deg",p=rt(e,St)||"0",d,f,_,g,v,w,b,x,S,C,P,M,T,A,R,k,O,I,V,G,Z,K,F,L,ae,we,ye,he,xe,$,W,Je;return d=f=_=w=b=x=S=C=P=0,g=v=1,n.svg=!!(e.getCTM&&Ql(e)),A=Ks(e,n.svg),n.svg&&(L=(!n.uncache||p==="0px 0px")&&!t&&e.getAttribute("data-svg-origin"),ws(e,L||p,!!L||n.originIsAbsolute,n.smooth!==!1,A)),M=n.xOrigin||0,T=n.yOrigin||0,A!==un&&(I=A[0],V=A[1],G=A[2],Z=A[3],d=K=A[4],f=F=A[5],A.length===6?(g=Math.sqrt(I*I+V*V),v=Math.sqrt(Z*Z+G*G),w=I||V?li(V,I)*Vt:0,S=G||Z?li(G,Z)*Vt+w:0,S&&(v*=Math.abs(Math.cos(S*_i))),n.svg&&(d-=M-(M*I+T*G),f-=T-(M*V+T*Z))):(Je=A[6],$=A[7],ye=A[8],he=A[9],xe=A[10],W=A[11],d=A[12],f=A[13],_=A[14],R=li(Je,xe),b=R*Vt,R&&(k=Math.cos(-R),O=Math.sin(-R),L=K*k+ye*O,ae=F*k+he*O,we=Je*k+xe*O,ye=K*-O+ye*k,he=F*-O+he*k,xe=Je*-O+xe*k,W=$*-O+W*k,K=L,F=ae,Je=we),R=li(-G,xe),x=R*Vt,R&&(k=Math.cos(-R),O=Math.sin(-R),L=I*k-ye*O,ae=V*k-he*O,we=G*k-xe*O,W=Z*O+W*k,I=L,V=ae,G=we),R=li(V,I),w=R*Vt,R&&(k=Math.cos(R),O=Math.sin(R),L=I*k+V*O,ae=K*k+F*O,V=V*k-I*O,F=F*k-K*O,I=L,K=ae),b&&Math.abs(b)+Math.abs(w)>359.9&&(b=w=0,x=180-x),g=le(Math.sqrt(I*I+V*V+G*G)),v=le(Math.sqrt(F*F+Je*Je)),R=li(K,F),S=Math.abs(R)>2e-4?R*Vt:0,P=W?1/(W<0?-W:W):0),n.svg&&(L=e.getAttribute("transform"),n.forceCSS=e.setAttribute("transform","")||!eh(rt(e,me)),L&&e.setAttribute("transform",L))),Math.abs(S)>90&&Math.abs(S)<270&&(l?(g*=-1,S+=w<=0?180:-180,w+=w<=0?180:-180):(v*=-1,S+=S<=0?180:-180)),t=t||n.uncache,n.x=d-((n.xPercent=d&&(!t&&n.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-d)?-50:0)))?e.offsetWidth*n.xPercent/100:0)+h,n.y=f-((n.yPercent=f&&(!t&&n.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-f)?-50:0)))?e.offsetHeight*n.yPercent/100:0)+h,n.z=_+h,n.scaleX=le(g),n.scaleY=le(v),n.rotation=le(w)+c,n.rotationX=le(b)+c,n.rotationY=le(x)+c,n.skewX=S+c,n.skewY=C+c,n.transformPerspective=P+h,(n.zOrigin=parseFloat(p.split(" ")[2])||0)&&(s[St]=Zn(p)),n.xOffset=n.yOffset=0,n.force3D=De.force3D,n.renderTransform=n.svg?Cf:Xl?th:yf,n.uncache=0,n},Zn=function(e){return(e=e.split(" "))[0]+" "+e[1]},Zr=function(e,t,n){var s=ge(t);return le(parseFloat(t)+parseFloat(Pt(e,"x",n+"px",s)))+s},yf=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,th(e,t)},Ut="0deg",$i="0px",Bt=") ",th=function(e,t){var n=t||this,s=n.xPercent,l=n.yPercent,h=n.x,c=n.y,p=n.z,d=n.rotation,f=n.rotationY,_=n.rotationX,g=n.skewX,v=n.skewY,w=n.scaleX,b=n.scaleY,x=n.transformPerspective,S=n.force3D,C=n.target,P=n.zOrigin,M="",T=S==="auto"&&e&&e!==1||S===!0;if(P&&(_!==Ut||f!==Ut)){var A=parseFloat(f)*_i,R=Math.sin(A),k=Math.cos(A),O;A=parseFloat(_)*_i,O=Math.cos(A),h=Zr(C,h,R*O*-P),c=Zr(C,c,-Math.sin(A)*-P),p=Zr(C,p,k*O*-P+P)}x!==$i&&(M+="perspective("+x+Bt),(s||l)&&(M+="translate("+s+"%, "+l+"%) "),(T||h!==$i||c!==$i||p!==$i)&&(M+=p!==$i||T?"translate3d("+h+", "+c+", "+p+") ":"translate("+h+", "+c+Bt),d!==Ut&&(M+="rotate("+d+Bt),f!==Ut&&(M+="rotateY("+f+Bt),_!==Ut&&(M+="rotateX("+_+Bt),(g!==Ut||v!==Ut)&&(M+="skew("+g+", "+v+Bt),(w!==1||b!==1)&&(M+="scale("+w+", "+b+Bt),C.style[me]=M||"translate(0, 0)"},Cf=function(e,t){var n=t||this,s=n.xPercent,l=n.yPercent,h=n.x,c=n.y,p=n.rotation,d=n.skewX,f=n.skewY,_=n.scaleX,g=n.scaleY,v=n.target,w=n.xOrigin,b=n.yOrigin,x=n.xOffset,S=n.yOffset,C=n.forceCSS,P=parseFloat(h),M=parseFloat(c),T,A,R,k,O;p=parseFloat(p),d=parseFloat(d),f=parseFloat(f),f&&(f=parseFloat(f),d+=f,p+=f),p||d?(p*=_i,d*=_i,T=Math.cos(p)*_,A=Math.sin(p)*_,R=Math.sin(p-d)*-g,k=Math.cos(p-d)*g,d&&(f*=_i,O=Math.tan(d-f),O=Math.sqrt(1+O*O),R*=O,k*=O,f&&(O=Math.tan(f),O=Math.sqrt(1+O*O),T*=O,A*=O)),T=le(T),A=le(A),R=le(R),k=le(k)):(T=_,k=g,A=R=0),(P&&!~(h+"").indexOf("px")||M&&!~(c+"").indexOf("px"))&&(P=Pt(v,"x",h,"px"),M=Pt(v,"y",c,"px")),(w||b||x||S)&&(P=le(P+w-(w*T+b*R)+x),M=le(M+b-(w*A+b*k)+S)),(s||l)&&(O=v.getBBox(),P=le(P+s/100*O.width),M=le(M+l/100*O.height)),O="matrix("+T+","+A+","+R+","+k+","+P+","+M+")",v.setAttribute("transform",O),C&&(v.style[me]=O)},Ef=function(e,t,n,s,l){var h=360,c=fe(l),p=parseFloat(l)*(c&&~l.indexOf("rad")?Vt:1),d=p-s,f=s+d+"deg",_,g;return c&&(_=l.split("_")[1],_==="short"&&(d%=h,d!==d%(h/2)&&(d+=d<0?h:-h)),_==="cw"&&d<0?d=(d+h*ca)%h-~~(d/h)*h:_==="ccw"&&d>0&&(d=(d-h*ca)%h-~~(d/h)*h)),e._pt=g=new Me(e._pt,t,n,s,d,uf),g.e=f,g.u="deg",e._props.push(n),g},va=function(e,t){for(var n in t)e[n]=t[n];return e},Sf=function(e,t,n){var s=va({},n._gsap),l="perspective,force3D,transformOrigin,svgOrigin",h=n.style,c,p,d,f,_,g,v,w;s.svg?(d=n.getAttribute("transform"),n.setAttribute("transform",""),h[me]=t,c=cn(n,1),hn(n,me),n.setAttribute("transform",d)):(d=getComputedStyle(n)[me],h[me]=t,c=cn(n,1),h[me]=d);for(p in Et)d=s[p],f=c[p],d!==f&&l.indexOf(p)<0&&(v=ge(d),w=ge(f),_=v!==w?Pt(n,p,d,w):parseFloat(d),g=parseFloat(f),e._pt=new Me(e._pt,c,p,_,g-_,Wl),e._pt.u=w||0,e._props.push(p));va(c,s)};Ae("padding,margin,Width,Radius",function(r,e){var t="Top",n="Right",s="Bottom",l="Left",h=(e<3?[t,n,s,l]:[t+l,t+n,s+n,s+l]).map(function(c){return e<2?r+c:"border"+c+r});Xn[e>1?"border"+r:r]=function(c,p,d,f,_){var g,v;if(arguments.length<4)return g=h.map(function(w){return Ft(c,w,d)}),v=g.join(" "),v.split(g[0]).length===5?g[0]:v;g=(f+"").split(" "),v={},h.forEach(function(w,b){return v[w]=g[b]=g[b]||g[(b-1)/2|0]}),c.init(p,v,_)}});var ih={name:"css",register:xs,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,n,s,l){var h=this._props,c=e.style,p=n.vars.startAt,d,f,_,g,v,w,b,x,S,C,P,M,T,A,R;Gs||xs();for(b in t)if(b!=="autoRound"&&(f=t[b],!(Oe[b]&&Vl(b,t,n,s,e,l)))){if(v=typeof f,w=Xn[b],v==="function"&&(f=f.call(n,s,e,l),v=typeof f),v==="string"&&~f.indexOf("random(")&&(f=on(f)),w)w(this,e,b,f,n)&&(R=1);else if(b.substr(0,2)==="--")d=(getComputedStyle(e).getPropertyValue(b)+"").trim(),f+="",Ct.lastIndex=0,Ct.test(d)||(x=ge(d),S=ge(f)),S?x!==S&&(d=Pt(e,b,d,S)+S):x&&(f+=x),this.add(c,"setProperty",d,f,s,l,0,0,b),h.push(b);else if(v!=="undefined"){if(p&&b in p?(d=typeof p[b]=="function"?p[b].call(n,s,e,l):p[b],fe(d)&&~d.indexOf("random(")&&(d=on(d)),ge(d+"")||(d+=De.units[b]||ge(Ft(e,b))||""),(d+"").charAt(1)==="="&&(d=Ft(e,b))):d=Ft(e,b),g=parseFloat(d),C=v==="string"&&f.charAt(1)==="="&&f.substr(0,2),C&&(f=f.substr(2)),_=parseFloat(f),b in xt&&(b==="autoAlpha"&&(g===1&&Ft(e,"visibility")==="hidden"&&_&&(g=0),wt(this,c,"visibility",g?"inherit":"hidden",_?"inherit":"hidden",!_)),b!=="scale"&&b!=="transform"&&(b=xt[b],~b.indexOf(",")&&(b=b.split(",")[0]))),P=b in Et,P){if(M||(T=e._gsap,T.renderTransform&&!t.parseTransform||cn(e,t.parseTransform),A=t.smoothOrigin!==!1&&T.smooth,M=this._pt=new Me(this._pt,c,me,0,1,T.renderTransform,T,0,-1),M.dep=1),b==="scale")this._pt=new Me(this._pt,T,"scaleY",T.scaleY,(C?fi(T.scaleY,C+_):_)-T.scaleY||0),h.push("scaleY",b),b+="X";else if(b==="transformOrigin"){f=xf(f),T.svg?ws(e,f,0,A,0,this):(S=parseFloat(f.split(" ")[2])||0,S!==T.zOrigin&&wt(this,T,"zOrigin",T.zOrigin,S),wt(this,c,b,Zn(d),Zn(f)));continue}else if(b==="svgOrigin"){ws(e,f,1,A,0,this);continue}else if(b in Jl){Ef(this,T,b,g,C?fi(g,C+f):f);continue}else if(b==="smoothOrigin"){wt(this,T,"smooth",T.smooth,f);continue}else if(b==="force3D"){T[b]=f;continue}else if(b==="transform"){Sf(this,f,e);continue}}else b in c||(b=Ei(b)||b);if(P||(_||_===0)&&(g||g===0)&&!hf.test(f)&&b in c)x=(d+"").substr((g+"").length),_||(_=0),S=ge(f)||(b in De.units?De.units[b]:x),x!==S&&(g=Pt(e,b,d,S)),this._pt=new Me(this._pt,P?T:c,b,g,(C?fi(g,C+_):_)-g,!P&&(S==="px"||b==="zIndex")&&t.autoRound!==!1?df:Wl),this._pt.u=S||0,x!==S&&S!=="%"&&(this._pt.b=d,this._pt.r=cf);else if(b in c)bf.call(this,e,b,d,C?C+f:f);else if(b in e)this.add(e,b,d||e[b],C?C+f:f,s,l);else{Ls(b,f);continue}h.push(b)}}R&&Kl(this)},get:Ft,aliases:xt,getSetter:function(e,t,n){var s=xt[t];return s&&s.indexOf(",")<0&&(t=s),t in Et&&t!==St&&(e._gsap.x||Ft(e,"x"))?n&&ua===n?t==="scale"?_f:mf:(ua=n||{})&&(t==="scale"?vf:gf):e.style&&!Rs(e.style[t])?pf:~t.indexOf("-")?ff:Hs(e,t)},core:{_removeProperty:hn,_getMatrix:Ks}};Ke.utils.checkPrefix=Ei;(function(r,e,t,n){var s=Ae(r+","+e+","+t,function(l){Et[l]=1});Ae(e,function(l){De.units[l]="deg",Jl[l]=1}),xt[s[13]]=r+","+e,Ae(n,function(l){var h=l.split(":");xt[h[1]]=s[h[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");Ae("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(r){De.units[r]="px"});Ke.registerPlugin(ih);var ys=Ke.registerPlugin(ih)||Ke;ys.core.Tween;var Fn={exports:{}},Pf=Fn.exports,ga;function Tf(){return ga||(ga=1,(function(r,e){(function(t,n){r.exports=n()})(Pf,function(){var t=function(){function n(v){return h.appendChild(v.dom),v}function s(v){for(var w=0;w<h.children.length;w++)h.children[w].style.display=w===v?"block":"none";l=v}var l=0,h=document.createElement("div");h.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",h.addEventListener("click",function(v){v.preventDefault(),s(++l%h.children.length)},!1);var c=(performance||Date).now(),p=c,d=0,f=n(new t.Panel("FPS","#0ff","#002")),_=n(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var g=n(new t.Panel("MB","#f08","#201"));return s(0),{REVISION:16,dom:h,addPanel:n,showPanel:s,begin:function(){c=(performance||Date).now()},end:function(){d++;var v=(performance||Date).now();if(_.update(v-c,200),v>p+1e3&&(f.update(1e3*d/(v-p),100),p=v,d=0,g)){var w=performance.memory;g.update(w.usedJSHeapSize/1048576,w.jsHeapSizeLimit/1048576)}return v},update:function(){c=this.end()},domElement:h,setMode:s}};return t.Panel=function(n,s,l){var h=1/0,c=0,p=Math.round,d=p(window.devicePixelRatio||1),f=80*d,_=48*d,g=3*d,v=2*d,w=3*d,b=15*d,x=74*d,S=30*d,C=document.createElement("canvas");C.width=f,C.height=_,C.style.cssText="width:80px;height:48px";var P=C.getContext("2d");return P.font="bold "+9*d+"px Helvetica,Arial,sans-serif",P.textBaseline="top",P.fillStyle=l,P.fillRect(0,0,f,_),P.fillStyle=s,P.fillText(n,g,v),P.fillRect(w,b,x,S),P.fillStyle=l,P.globalAlpha=.9,P.fillRect(w,b,x,S),{dom:C,update:function(M,T){h=Math.min(h,M),c=Math.max(c,M),P.fillStyle=l,P.globalAlpha=1,P.fillRect(0,0,f,b),P.fillStyle=s,P.fillText(p(M)+" "+n+" ("+p(h)+"-"+p(c)+")",g,v),P.drawImage(C,w+d,b,x-d,S,w,b,x-d,S),P.fillRect(w+x-d,b,d,S),P.fillStyle=l,P.globalAlpha=.9,P.fillRect(w+x-d,b,d,p((1-M/T)*S))}}},t})})(Fn)),Fn.exports}var Af=Tf();const Mf=Ya(Af);var Qi={exports:{}};var kf=Qi.exports,ba;function Of(){return ba||(ba=1,(function(r,e){(function(t,n){n(e)})(kf,(function(t){class n{constructor(i){const[o,u]=i.split("-"),m=o.split(".");this.major=parseInt(m[0],10),this.minor=parseInt(m[1],10),this.patch=parseInt(m[2],10),this.prerelease=u??null}toString(){const i=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[i,this.prerelease].join("-"):i}}class s{constructor(i){this.controller_=i}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(i){this.controller_.viewProps.set("disabled",i)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(i){this.controller_.viewProps.set("hidden",i)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class l{constructor(i){this.target=i}}class h extends l{constructor(i,o,u,m){super(i),this.value=o,this.presetKey=u,this.last=m??!0}}class c extends l{constructor(i,o,u){super(i),this.value=o,this.presetKey=u}}class p extends l{constructor(i,o){super(i),this.expanded=o}}function d(a){return a}function f(a){return a==null}function _(a,i){if(a.length!==i.length)return!1;for(let o=0;o<a.length;o++)if(a[o]!==i[o])return!1;return!0}const g={alreadydisposed:()=>"View has been already disposed",invalidparams:a=>`Invalid parameters for '${a.name}'`,nomatchingcontroller:a=>`No matching controller for '${a.key}'`,nomatchingview:a=>`No matching view for '${JSON.stringify(a.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:a=>`Property '${a.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class v{constructor(i){var o;this.message=(o=g[i.type](i.context))!==null&&o!==void 0?o:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=i.type}static alreadyDisposed(){return new v({type:"alreadydisposed"})}static notBindable(){return new v({type:"notbindable"})}static propertyNotFound(i){return new v({type:"propertynotfound",context:{name:i}})}static shouldNeverHappen(){return new v({type:"shouldneverhappen"})}}class w{constructor(i,o,u){this.obj_=i,this.key_=o,this.presetKey_=u??o}static isBindable(i){return!(i===null||typeof i!="object")}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(i){this.obj_[this.key_]=i}writeProperty(i,o){const u=this.read();if(!w.isBindable(u))throw v.notBindable();if(!(i in u))throw v.propertyNotFound(i);u[i]=o}}class b extends s{get label(){return this.controller_.props.get("label")}set label(i){this.controller_.props.set("label",i)}get title(){var i;return(i=this.controller_.valueController.props.get("title"))!==null&&i!==void 0?i:""}set title(i){this.controller_.valueController.props.set("title",i)}on(i,o){const u=o.bind(this);return this.controller_.valueController.emitter.on(i,()=>{u(new l(this))}),this}}class x{constructor(){this.observers_={}}on(i,o){let u=this.observers_[i];return u||(u=this.observers_[i]=[]),u.push({handler:o}),this}off(i,o){const u=this.observers_[i];return u&&(this.observers_[i]=u.filter(m=>m.handler!==o)),this}emit(i,o){const u=this.observers_[i];u&&u.forEach(m=>{m.handler(o)})}}const S="tp";function C(a){return(o,u)=>[S,"-",a,"v",o?`_${o}`:"",u?`-${u}`:""].join("")}function P(a,i){return o=>i(a(o))}function M(a){return a.rawValue}function T(a,i){a.emitter.on("change",P(M,i)),i(a.rawValue)}function A(a,i,o){T(a.value(i),o)}function R(a,i,o){o?a.classList.add(i):a.classList.remove(i)}function k(a,i){return o=>{R(a,i,o)}}function O(a,i){T(a,o=>{i.textContent=o??""})}const I=C("btn");class V{constructor(i,o){this.element=i.createElement("div"),this.element.classList.add(I()),o.viewProps.bindClassModifiers(this.element);const u=i.createElement("button");u.classList.add(I("b")),o.viewProps.bindDisabled(u),this.element.appendChild(u),this.buttonElement=u;const m=i.createElement("div");m.classList.add(I("t")),O(o.props.value("title"),m),this.buttonElement.appendChild(m)}}class G{constructor(i,o){this.emitter=new x,this.onClick_=this.onClick_.bind(this),this.props=o.props,this.viewProps=o.viewProps,this.view=new V(i,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Z{constructor(i,o){var u;this.constraint_=o?.constraint,this.equals_=(u=o?.equals)!==null&&u!==void 0?u:((m,y)=>m===y),this.emitter=new x,this.rawValue_=i}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(i){this.setRawValue(i,{forceEmit:!1,last:!0})}setRawValue(i,o){const u=o??{forceEmit:!1,last:!0},m=this.constraint_?this.constraint_.constrain(i):i;this.equals_(this.rawValue_,m)&&!u.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=m,this.emitter.emit("change",{options:u,rawValue:m,sender:this}))}}class K{constructor(i){this.emitter=new x,this.value_=i}get rawValue(){return this.value_}set rawValue(i){this.setRawValue(i,{forceEmit:!1,last:!0})}setRawValue(i,o){const u=o??{forceEmit:!1,last:!0};this.value_===i&&!u.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=i,this.emitter.emit("change",{options:u,rawValue:this.value_,sender:this}))}}function F(a,i){const o=i?.constraint,u=i?.equals;return!o&&!u?new K(a):new Z(a,i)}class L{constructor(i){this.emitter=new x,this.valMap_=i;for(const o in this.valMap_)this.valMap_[o].emitter.on("change",()=>{this.emitter.emit("change",{key:o,sender:this})})}static createCore(i){return Object.keys(i).reduce((u,m)=>Object.assign(u,{[m]:F(i[m])}),{})}static fromObject(i){const o=this.createCore(i);return new L(o)}get(i){return this.valMap_[i].rawValue}set(i,o){this.valMap_[i].rawValue=o}value(i){return this.valMap_[i]}}function ae(a,i){const u=Object.keys(i).reduce((m,y)=>{if(m===void 0)return;const E=i[y],D=E(a[y]);return D.succeeded?Object.assign(Object.assign({},m),{[y]:D.value}):void 0},{});return u}function we(a,i){return a.reduce((o,u)=>{if(o===void 0)return;const m=i(u);if(!(!m.succeeded||m.value===void 0))return[...o,m.value]},[])}function ye(a){return a===null?!1:typeof a=="object"}function he(a){return i=>o=>{if(!i&&o===void 0)return{succeeded:!1,value:void 0};if(i&&o===void 0)return{succeeded:!0,value:void 0};const u=a(o);return u!==void 0?{succeeded:!0,value:u}:{succeeded:!1,value:void 0}}}function xe(a){return{custom:i=>he(i)(a),boolean:he(i=>typeof i=="boolean"?i:void 0)(a),number:he(i=>typeof i=="number"?i:void 0)(a),string:he(i=>typeof i=="string"?i:void 0)(a),function:he(i=>typeof i=="function"?i:void 0)(a),constant:i=>he(o=>o===i?i:void 0)(a),raw:he(i=>i)(a),object:i=>he(o=>{if(ye(o))return ae(o,i)})(a),array:i=>he(o=>{if(Array.isArray(o))return we(o,i)})(a)}}const $={optional:xe(!0),required:xe(!1)};function W(a,i){const o=$.required.object(i)(a);return o.succeeded?o.value:void 0}function Je(a){return a&&a.parentElement&&a.parentElement.removeChild(a),null}function dh(){return["veryfirst","first","last","verylast"]}const Xs=C(""),Zs={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class Ti{constructor(i){this.parent_=null,this.blade=i.blade,this.view=i.view,this.viewProps=i.viewProps;const o=this.view.element;this.blade.value("positions").emitter.on("change",()=>{dh().forEach(u=>{o.classList.remove(Xs(void 0,Zs[u]))}),this.blade.get("positions").forEach(u=>{o.classList.add(Xs(void 0,Zs[u]))})}),this.viewProps.handleDispose(()=>{Je(o)})}get parent(){return this.parent_}}const We="http://www.w3.org/2000/svg";function mn(a){a.offsetHeight}function ph(a,i){const o=a.style.transition;a.style.transition="none",i(),a.style.transition=o}function lr(a){return a.ontouchstart!==void 0}function fh(){return new Function("return this")()}function mh(){return fh().document}function _h(a){const i=a.ownerDocument.defaultView;return i&&"document"in i?a.getContext("2d"):null}const vh={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function _n(a,i){const o=a.createElementNS(We,"svg");return o.innerHTML=vh[i],o}function Qs(a,i,o){a.insertBefore(i,a.children[o])}function Js(a){a.parentElement&&a.parentElement.removeChild(a)}function eo(a){for(;a.children.length>0;)a.removeChild(a.children[0])}function gh(a){for(;a.childNodes.length>0;)a.removeChild(a.childNodes[0])}function to(a){return a.relatedTarget?a.relatedTarget:"explicitOriginalTarget"in a?a.explicitOriginalTarget:null}const Ai=C("lbl");function bh(a,i){const o=a.createDocumentFragment();return i.split(`
`).map(m=>a.createTextNode(m)).forEach((m,y)=>{y>0&&o.appendChild(a.createElement("br")),o.appendChild(m)}),o}class io{constructor(i,o){this.element=i.createElement("div"),this.element.classList.add(Ai()),o.viewProps.bindClassModifiers(this.element);const u=i.createElement("div");u.classList.add(Ai("l")),A(o.props,"label",y=>{f(y)?this.element.classList.add(Ai(void 0,"nol")):(this.element.classList.remove(Ai(void 0,"nol")),gh(u),u.appendChild(bh(i,y)))}),this.element.appendChild(u),this.labelElement=u;const m=i.createElement("div");m.classList.add(Ai("v")),this.element.appendChild(m),this.valueElement=m}}class vn extends Ti{constructor(i,o){const u=o.valueController.viewProps;super(Object.assign(Object.assign({},o),{view:new io(i,{props:o.props,viewProps:u}),viewProps:u})),this.props=o.props,this.valueController=o.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const xh={id:"button",type:"blade",accept(a){const i=$,o=W(a,{title:i.required.string,view:i.required.constant("button"),label:i.optional.string});return o?{params:o}:null},controller(a){return new vn(a.document,{blade:a.blade,props:L.fromObject({label:a.params.label}),valueController:new G(a.document,{props:L.fromObject({title:a.params.title}),viewProps:a.viewProps})})},api(a){return!(a.controller instanceof vn)||!(a.controller.valueController instanceof G)?null:new b(a.controller)}};class Qt extends Ti{constructor(i){super(i),this.value=i.value}}function Mi(){return new L({positions:F([],{equals:_})})}class ki extends L{constructor(i){super(i)}static create(i){const o={completed:!0,expanded:i,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},u=L.createCore(o);return new ki(u)}get styleExpanded(){var i;return(i=this.get("temporaryExpanded"))!==null&&i!==void 0?i:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const i=this.get("expandedHeight");return this.get("shouldFixHeight")&&!f(i)?`${i}px`:"auto"}bindExpandedClass(i,o){const u=()=>{this.styleExpanded?i.classList.add(o):i.classList.remove(o)};A(this,"expanded",u),A(this,"temporaryExpanded",u)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function wh(a,i){let o=0;return ph(i,()=>{a.set("expandedHeight",null),a.set("temporaryExpanded",!0),mn(i),o=i.clientHeight,a.set("temporaryExpanded",null),mn(i)}),o}function no(a,i){i.style.height=a.styleHeight}function hr(a,i){a.value("expanded").emitter.on("beforechange",()=>{a.set("completed",!1),f(a.get("expandedHeight"))&&a.set("expandedHeight",wh(a,i)),a.set("shouldFixHeight",!0),mn(i)}),a.emitter.on("change",()=>{no(a,i)}),no(a,i),i.addEventListener("transitionend",o=>{o.propertyName==="height"&&a.cleanUpTransition()})}class ur extends s{constructor(i,o){super(i),this.rackApi_=o}}function yh(a,i){return a.addBlade(Object.assign(Object.assign({},i),{view:"button"}))}function Ch(a,i){return a.addBlade(Object.assign(Object.assign({},i),{view:"folder"}))}function Eh(a,i){const o=i||{};return a.addBlade(Object.assign(Object.assign({},o),{view:"separator"}))}function Sh(a,i){return a.addBlade(Object.assign(Object.assign({},i),{view:"tab"}))}class cr{constructor(i){this.emitter=new x,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=i}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(i){for(const o of this.allItems())if(i(o))return o;return null}includes(i){return this.cache_.has(i)}add(i,o){if(this.includes(i))throw v.shouldNeverHappen();const u=o!==void 0?o:this.items_.length;this.items_.splice(u,0,i),this.cache_.add(i);const m=this.extract_(i);m&&(m.emitter.on("add",this.onSubListAdd_),m.emitter.on("remove",this.onSubListRemove_),m.allItems().forEach(y=>{this.cache_.add(y)})),this.emitter.emit("add",{index:u,item:i,root:this,target:this})}remove(i){const o=this.items_.indexOf(i);if(o<0)return;this.items_.splice(o,1),this.cache_.delete(i);const u=this.extract_(i);u&&(u.emitter.off("add",this.onSubListAdd_),u.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:o,item:i,root:this,target:this})}onSubListAdd_(i){this.cache_.add(i.item),this.emitter.emit("add",{index:i.index,item:i.item,root:this,target:i.target})}onSubListRemove_(i){this.cache_.delete(i.item),this.emitter.emit("remove",{index:i.index,item:i.item,root:this,target:i.target})}}class dr extends s{constructor(i){super(i),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new x,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(i){this.controller_.props.set("label",i)}on(i,o){const u=o.bind(this);return this.emitter_.on(i,m=>{u(m.event)}),this}refresh(){this.controller_.binding.read()}onBindingChange_(i){const o=i.sender.target.read();this.emitter_.emit("change",{event:new h(this,o,this.controller_.binding.target.presetKey,i.options.last)})}}class qe extends vn{constructor(i,o){super(i,o),this.binding=o.binding}}class pr extends s{constructor(i){super(i),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new x,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(i){this.controller_.props.set("label",i)}on(i,o){const u=o.bind(this);return this.emitter_.on(i,m=>{u(m.event)}),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(i){const o=i.sender.target.read();this.emitter_.emit("update",{event:new c(this,o,this.controller_.binding.target.presetKey)})}}class at extends vn{constructor(i,o){super(i,o),this.binding=o.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function Ph(a){return a instanceof gn?a.apiSet_:a instanceof ur?a.rackApi_.apiSet_:null}function Oi(a,i){const o=a.find(u=>u.controller_===i);if(!o)throw v.shouldNeverHappen();return o}function ro(a,i,o){if(!w.isBindable(a))throw v.notBindable();return new w(a,i,o)}class gn extends s{constructor(i,o){super(i),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new x,this.apiSet_=new cr(Ph),this.pool_=o;const u=this.controller_.rack;u.emitter.on("add",this.onRackAdd_),u.emitter.on("remove",this.onRackRemove_),u.emitter.on("inputchange",this.onRackInputChange_),u.emitter.on("monitorupdate",this.onRackMonitorUpdate_),u.children.forEach(m=>{this.setUpApi_(m)})}get children(){return this.controller_.rack.children.map(i=>Oi(this.apiSet_,i))}addInput(i,o,u){const m=u||{},y=this.controller_.view.element.ownerDocument,E=this.pool_.createInput(y,ro(i,o,m.presetKey),m),D=new dr(E);return this.add(D,m.index)}addMonitor(i,o,u){const m=u||{},y=this.controller_.view.element.ownerDocument,E=this.pool_.createMonitor(y,ro(i,o),m),D=new pr(E);return this.add(D,m.index)}addFolder(i){return Ch(this,i)}addButton(i){return yh(this,i)}addSeparator(i){return Eh(this,i)}addTab(i){return Sh(this,i)}add(i,o){this.controller_.rack.add(i.controller_,o);const u=this.apiSet_.find(m=>m.controller_===i.controller_);return u&&this.apiSet_.remove(u),this.apiSet_.add(i),i}remove(i){this.controller_.rack.remove(i.controller_)}addBlade(i){const o=this.controller_.view.element.ownerDocument,u=this.pool_.createBlade(o,i),m=this.pool_.createBladeApi(u);return this.add(m,i.index)}on(i,o){const u=o.bind(this);return this.emitter_.on(i,m=>{u(m.event)}),this}setUpApi_(i){this.apiSet_.find(u=>u.controller_===i)||this.apiSet_.add(this.pool_.createBladeApi(i))}onRackAdd_(i){this.setUpApi_(i.bladeController)}onRackRemove_(i){if(i.isRoot){const o=Oi(this.apiSet_,i.bladeController);this.apiSet_.remove(o)}}onRackInputChange_(i){const o=i.bladeController;if(o instanceof qe){const u=Oi(this.apiSet_,o),m=o.binding;this.emitter_.emit("change",{event:new h(u,m.target.read(),m.target.presetKey,i.options.last)})}else if(o instanceof Qt){const u=Oi(this.apiSet_,o);this.emitter_.emit("change",{event:new h(u,o.value.rawValue,void 0,i.options.last)})}}onRackMonitorUpdate_(i){if(!(i.bladeController instanceof at))throw v.shouldNeverHappen();const o=Oi(this.apiSet_,i.bladeController),u=i.bladeController.binding;this.emitter_.emit("update",{event:new c(o,u.target.read(),u.target.presetKey)})}}class fr extends ur{constructor(i,o){super(i,new gn(i.rackController,o)),this.emitter_=new x,this.controller_.foldable.value("expanded").emitter.on("change",u=>{this.emitter_.emit("fold",{event:new p(this,u.sender.rawValue)})}),this.rackApi_.on("change",u=>{this.emitter_.emit("change",{event:u})}),this.rackApi_.on("update",u=>{this.emitter_.emit("update",{event:u})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(i){this.controller_.foldable.set("expanded",i)}get title(){return this.controller_.props.get("title")}set title(i){this.controller_.props.set("title",i)}get children(){return this.rackApi_.children}addInput(i,o,u){return this.rackApi_.addInput(i,o,u)}addMonitor(i,o,u){return this.rackApi_.addMonitor(i,o,u)}addFolder(i){return this.rackApi_.addFolder(i)}addButton(i){return this.rackApi_.addButton(i)}addSeparator(i){return this.rackApi_.addSeparator(i)}addTab(i){return this.rackApi_.addTab(i)}add(i,o){return this.rackApi_.add(i,o)}remove(i){this.rackApi_.remove(i)}addBlade(i){return this.rackApi_.addBlade(i)}on(i,o){const u=o.bind(this);return this.emitter_.on(i,m=>{u(m.event)}),this}}class mr extends Ti{constructor(i){super({blade:i.blade,view:i.view,viewProps:i.rackController.viewProps}),this.rackController=i.rackController}}class Th{constructor(i,o){const u=C(o.viewName);this.element=i.createElement("div"),this.element.classList.add(u()),o.viewProps.bindClassModifiers(this.element)}}function Ah(a,i){for(let o=0;o<a.length;o++){const u=a[o];if(u instanceof qe&&u.binding===i)return u}return null}function Mh(a,i){for(let o=0;o<a.length;o++){const u=a[o];if(u instanceof at&&u.binding===i)return u}return null}function kh(a,i){for(let o=0;o<a.length;o++){const u=a[o];if(u instanceof Qt&&u.value===i)return u}return null}function _r(a){return a instanceof Ri?a.rack:a instanceof mr?a.rackController.rack:null}function Oh(a){const i=_r(a);return i?i.bcSet_:null}class Rh{constructor(i){var o;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new x,this.blade_=i??null,(o=this.blade_)===null||o===void 0||o.value("positions").emitter.on("change",this.onBladePositionsChange_),this.bcSet_=new cr(Oh),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(i,o){i.parent&&i.parent.remove(i),i.parent_=this,this.bcSet_.add(i,o)}remove(i){i.parent_=null,this.bcSet_.remove(i)}find(i){return this.bcSet_.allItems().filter(o=>o instanceof i)}onSetAdd_(i){this.updatePositions_();const o=i.target===i.root;if(this.emitter.emit("add",{bladeController:i.item,index:i.index,isRoot:o,sender:this}),!o)return;const u=i.item;if(u.viewProps.emitter.on("change",this.onChildViewPropsChange_),u.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),u.viewProps.handleDispose(this.onChildDispose_),u instanceof qe)u.binding.emitter.on("change",this.onChildInputChange_);else if(u instanceof at)u.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(u instanceof Qt)u.value.emitter.on("change",this.onChildValueChange_);else{const m=_r(u);if(m){const y=m.emitter;y.on("layout",this.onDescendantLayout_),y.on("inputchange",this.onDescendantInputChange_),y.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(i){this.updatePositions_();const o=i.target===i.root;if(this.emitter.emit("remove",{bladeController:i.item,isRoot:o,sender:this}),!o)return;const u=i.item;if(u instanceof qe)u.binding.emitter.off("change",this.onChildInputChange_);else if(u instanceof at)u.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(u instanceof Qt)u.value.emitter.off("change",this.onChildValueChange_);else{const m=_r(u);if(m){const y=m.emitter;y.off("layout",this.onDescendantLayout_),y.off("inputchange",this.onDescendantInputChange_),y.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const i=this.bcSet_.items.filter(m=>!m.viewProps.get("hidden")),o=i[0],u=i[i.length-1];this.bcSet_.items.forEach(m=>{const y=[];m===o&&(y.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&y.push("veryfirst")),m===u&&(y.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&y.push("verylast")),m.blade.set("positions",y)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(i){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(o=>o.viewProps.get("disposed")).forEach(o=>{this.bcSet_.remove(o)})}onChildInputChange_(i){const o=Ah(this.find(qe),i.sender);if(!o)throw v.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:o,options:i.options,sender:this})}onChildMonitorUpdate_(i){const o=Mh(this.find(at),i.sender);if(!o)throw v.shouldNeverHappen();this.emitter.emit("monitorupdate",{bladeController:o,sender:this})}onChildValueChange_(i){const o=kh(this.find(Qt),i.sender);if(!o)throw v.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:o,options:i.options,sender:this})}onDescendantLayout_(i){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(i){this.emitter.emit("inputchange",{bladeController:i.bladeController,options:i.options,sender:this})}onDescendantMonitorUpdate_(i){this.emitter.emit("monitorupdate",{bladeController:i.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class Ri extends Ti{constructor(i,o){super(Object.assign(Object.assign({},o),{view:new Th(i,{viewName:"brk",viewProps:o.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const u=new Rh(o.root?void 0:o.blade);u.emitter.on("add",this.onRackAdd_),u.emitter.on("remove",this.onRackRemove_),this.rack=u,this.viewProps.handleDispose(()=>{for(let m=this.rack.children.length-1;m>=0;m--)this.rack.children[m].viewProps.set("disposed",!0)})}onRackAdd_(i){i.isRoot&&Qs(this.view.element,i.bladeController.view.element,i.index)}onRackRemove_(i){i.isRoot&&Js(i.bladeController.view.element)}}const so=C("cnt");class Dh{constructor(i,o){this.className_=C(o.viewName||"fld"),this.element=i.createElement("div"),this.element.classList.add(this.className_(),so()),o.viewProps.bindClassModifiers(this.element),this.foldable_=o.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),A(this.foldable_,"completed",k(this.element,this.className_(void 0,"cpl")));const u=i.createElement("button");u.classList.add(this.className_("b")),A(o.props,"title",D=>{f(D)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),o.viewProps.bindDisabled(u),this.element.appendChild(u),this.buttonElement=u;const m=i.createElement("div");m.classList.add(this.className_("t")),O(o.props.value("title"),m),this.buttonElement.appendChild(m),this.titleElement=m;const y=i.createElement("div");y.classList.add(this.className_("m")),this.buttonElement.appendChild(y);const E=o.containerElement;E.classList.add(this.className_("c")),this.element.appendChild(E),this.containerElement=E}}class vr extends mr{constructor(i,o){var u;const m=ki.create((u=o.expanded)!==null&&u!==void 0?u:!0),y=new Ri(i,{blade:o.blade,root:o.root,viewProps:o.viewProps});super(Object.assign(Object.assign({},o),{rackController:y,view:new Dh(i,{containerElement:y.view.element,foldable:m,props:o.props,viewName:o.root?"rot":void 0,viewProps:o.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=o.props,this.foldable=m,hr(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const Lh={id:"folder",type:"blade",accept(a){const i=$,o=W(a,{title:i.required.string,view:i.required.constant("folder"),expanded:i.optional.boolean});return o?{params:o}:null},controller(a){return new vr(a.document,{blade:a.blade,expanded:a.params.expanded,props:L.fromObject({title:a.params.title}),viewProps:a.viewProps})},api(a){return a.controller instanceof vr?new fr(a.controller,a.pool):null}};class Jt extends Qt{constructor(i,o){const u=o.valueController.viewProps;super(Object.assign(Object.assign({},o),{value:o.valueController.value,view:new io(i,{props:o.props,viewProps:u}),viewProps:u})),this.props=o.props,this.valueController=o.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class oo extends s{}const ao=C("spr");class Ih{constructor(i,o){this.element=i.createElement("div"),this.element.classList.add(ao()),o.viewProps.bindClassModifiers(this.element);const u=i.createElement("hr");u.classList.add(ao("r")),this.element.appendChild(u)}}class lo extends Ti{constructor(i,o){super(Object.assign(Object.assign({},o),{view:new Ih(i,{viewProps:o.viewProps})}))}}const Uh={id:"separator",type:"blade",accept(a){const o=W(a,{view:$.required.constant("separator")});return o?{params:o}:null},controller(a){return new lo(a.document,{blade:a.blade,viewProps:a.viewProps})},api(a){return a.controller instanceof lo?new oo(a.controller):null}},Bh=C("");function ho(a,i){return k(a,Bh(void 0,i))}class lt extends L{constructor(i){super(i)}static create(i){var o,u;const m=i??{},y={disabled:(o=m.disabled)!==null&&o!==void 0?o:!1,disposed:!1,hidden:(u=m.hidden)!==null&&u!==void 0?u:!1},E=L.createCore(y);return new lt(E)}bindClassModifiers(i){A(this,"disabled",ho(i,"disabled")),A(this,"hidden",ho(i,"hidden"))}bindDisabled(i){A(this,"disabled",o=>{i.disabled=o})}bindTabIndex(i){A(this,"disabled",o=>{i.tabIndex=o?-1:0})}handleDispose(i){this.value("disposed").emitter.on("change",o=>{o&&i()})}}const Di=C("tbi");class Nh{constructor(i,o){this.element=i.createElement("div"),this.element.classList.add(Di()),o.viewProps.bindClassModifiers(this.element),A(o.props,"selected",y=>{y?this.element.classList.add(Di(void 0,"sel")):this.element.classList.remove(Di(void 0,"sel"))});const u=i.createElement("button");u.classList.add(Di("b")),o.viewProps.bindDisabled(u),this.element.appendChild(u),this.buttonElement=u;const m=i.createElement("div");m.classList.add(Di("t")),O(o.props.value("title"),m),this.buttonElement.appendChild(m),this.titleElement=m}}class Vh{constructor(i,o){this.emitter=new x,this.onClick_=this.onClick_.bind(this),this.props=o.props,this.viewProps=o.viewProps,this.view=new Nh(i,{props:o.props,viewProps:o.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class uo{constructor(i,o){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new Vh(i,{props:o.itemProps,viewProps:lt.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new Ri(i,{blade:Mi(),viewProps:lt.create()}),this.props=o.props,A(this.props,"selected",u=>{this.itemController.props.set("selected",u),this.contentController.viewProps.set("hidden",!u)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class co{constructor(i,o){this.controller_=i,this.rackApi_=o}get title(){var i;return(i=this.controller_.itemController.props.get("title"))!==null&&i!==void 0?i:""}set title(i){this.controller_.itemController.props.set("title",i)}get selected(){return this.controller_.props.get("selected")}set selected(i){this.controller_.props.set("selected",i)}get children(){return this.rackApi_.children}addButton(i){return this.rackApi_.addButton(i)}addFolder(i){return this.rackApi_.addFolder(i)}addSeparator(i){return this.rackApi_.addSeparator(i)}addTab(i){return this.rackApi_.addTab(i)}add(i,o){this.rackApi_.add(i,o)}remove(i){this.rackApi_.remove(i)}addInput(i,o,u){return this.rackApi_.addInput(i,o,u)}addMonitor(i,o,u){return this.rackApi_.addMonitor(i,o,u)}addBlade(i){return this.rackApi_.addBlade(i)}}class po extends ur{constructor(i,o){super(i,new gn(i.rackController,o)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.emitter_=new x,this.pageApiMap_=new Map,this.rackApi_.on("change",u=>{this.emitter_.emit("change",{event:u})}),this.rackApi_.on("update",u=>{this.emitter_.emit("update",{event:u})}),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach(u=>{this.setUpPageApi_(u)})}get pages(){return this.controller_.pageSet.items.map(i=>{const o=this.pageApiMap_.get(i);if(!o)throw v.shouldNeverHappen();return o})}addPage(i){const o=this.controller_.view.element.ownerDocument,u=new uo(o,{itemProps:L.fromObject({selected:!1,title:i.title}),props:L.fromObject({selected:!1})});this.controller_.add(u,i.index);const m=this.pageApiMap_.get(u);if(!m)throw v.shouldNeverHappen();return m}removePage(i){this.controller_.remove(i)}on(i,o){const u=o.bind(this);return this.emitter_.on(i,m=>{u(m.event)}),this}setUpPageApi_(i){const o=this.rackApi_.apiSet_.find(m=>m.controller_===i.contentController);if(!o)throw v.shouldNeverHappen();const u=new co(i,o);this.pageApiMap_.set(i,u)}onPageAdd_(i){this.setUpPageApi_(i.item)}onPageRemove_(i){if(!this.pageApiMap_.get(i.item))throw v.shouldNeverHappen();this.pageApiMap_.delete(i.item)}}const bn=C("tab");class Fh{constructor(i,o){this.element=i.createElement("div"),this.element.classList.add(bn(),so()),o.viewProps.bindClassModifiers(this.element),T(o.empty,k(this.element,bn(void 0,"nop")));const u=i.createElement("div");u.classList.add(bn("i")),this.element.appendChild(u),this.itemsElement=u;const m=o.contentsElement;m.classList.add(bn("c")),this.element.appendChild(m),this.contentsElement=m}}class fo extends mr{constructor(i,o){const u=new Ri(i,{blade:o.blade,viewProps:o.viewProps}),m=F(!0);super({blade:o.blade,rackController:u,view:new Fh(i,{contentsElement:u.view.element,empty:m,viewProps:o.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onPageSelectedChange_=this.onPageSelectedChange_.bind(this),this.pageSet_=new cr(()=>null),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.empty_=m,this.applyPages_()}get pageSet(){return this.pageSet_}add(i,o){this.pageSet_.add(i,o??this.pageSet_.items.length)}remove(i){this.pageSet_.remove(this.pageSet_.items[i])}applyPages_(){this.keepSelection_(),this.empty_.rawValue=this.pageSet_.items.length===0}onPageAdd_(i){const o=i.item;Qs(this.view.itemsElement,o.itemController.view.element,i.index),this.rackController.rack.add(o.contentController,i.index),o.props.value("selected").emitter.on("change",this.onPageSelectedChange_),this.applyPages_()}onPageRemove_(i){const o=i.item;Js(o.itemController.view.element),this.rackController.rack.remove(o.contentController),o.props.value("selected").emitter.off("change",this.onPageSelectedChange_),this.applyPages_()}keepSelection_(){if(this.pageSet_.items.length===0)return;const i=this.pageSet_.items.findIndex(o=>o.props.get("selected"));i<0?this.pageSet_.items.forEach((o,u)=>{o.props.set("selected",u===0)}):this.pageSet_.items.forEach((o,u)=>{o.props.set("selected",u===i)})}onPageSelectedChange_(i){if(i.rawValue){const o=this.pageSet_.items.findIndex(u=>u.props.value("selected")===i.sender);this.pageSet_.items.forEach((u,m)=>{u.props.set("selected",m===o)})}else this.keepSelection_()}}const mo={id:"tab",type:"blade",accept(a){const i=$,o=W(a,{pages:i.required.array(i.required.object({title:i.required.string})),view:i.required.constant("tab")});return!o||o.pages.length===0?null:{params:o}},controller(a){const i=new fo(a.document,{blade:a.blade,viewProps:a.viewProps});return a.params.pages.forEach(o=>{const u=new uo(a.document,{itemProps:L.fromObject({selected:!1,title:o.title}),props:L.fromObject({selected:!1})});i.add(u)}),i},api(a){return a.controller instanceof fo?new po(a.controller,a.pool):null}};function zh(a,i){const o=a.accept(i.params);if(!o)return null;const u=$.optional.boolean(i.params.disabled).value,m=$.optional.boolean(i.params.hidden).value;return a.controller({blade:Mi(),document:i.document,params:Object.assign(Object.assign({},o.params),{disabled:u,hidden:m}),viewProps:lt.create({disabled:u,hidden:m})})}class Hh{constructor(){this.disabled=!1,this.emitter=new x}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class jh{constructor(i,o){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=i,this.emitter=new x,this.interval_=o,this.setTimer_()}get disabled(){return this.disabled_}set disabled(i){this.disabled_=i,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const i=this.doc_.defaultView;i&&i.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const i=this.doc_.defaultView;i&&(this.timerId_=i.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class kt{constructor(i){this.constraints=i}constrain(i){return this.constraints.reduce((o,u)=>u.constrain(o),i)}}function Ye(a,i){if(a instanceof i)return a;if(a instanceof kt){const o=a.constraints.reduce((u,m)=>u||(m instanceof i?m:null),null);if(o)return o}return null}class Li{constructor(i){this.options=i}constrain(i){const o=this.options;return o.length===0||o.filter(m=>m.value===i).length>0?i:o[0].value}}class ke{constructor(i){this.maxValue=i.max,this.minValue=i.min}constrain(i){let o=i;return f(this.minValue)||(o=Math.max(o,this.minValue)),f(this.maxValue)||(o=Math.min(o,this.maxValue)),o}}class Ot{constructor(i){this.step=i}constrain(i){return(i<0?-Math.round(-i/this.step):Math.round(i/this.step))*this.step}}const gr=C("lst");class Gh{constructor(i,o){this.onValueChange_=this.onValueChange_.bind(this),this.props_=o.props,this.element=i.createElement("div"),this.element.classList.add(gr()),o.viewProps.bindClassModifiers(this.element);const u=i.createElement("select");u.classList.add(gr("s")),A(this.props_,"options",y=>{eo(u),y.forEach((E,D)=>{const B=i.createElement("option");B.dataset.index=String(D),B.textContent=E.text,B.value=String(E.value),u.appendChild(B)})}),o.viewProps.bindDisabled(u),this.element.appendChild(u),this.selectElement=u;const m=i.createElement("div");m.classList.add(gr("m")),m.appendChild(_n(i,"dropdown")),this.element.appendChild(m),o.value.emitter.on("change",this.onValueChange_),this.value_=o.value,this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class Ii{constructor(i,o){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=o.props,this.value=o.value,this.viewProps=o.viewProps,this.view=new Gh(i,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(i){const u=i.currentTarget.selectedOptions.item(0);if(!u)return;const m=Number(u.dataset.index);this.value.rawValue=this.props.get("options")[m].value}}const _o=C("pop");class Kh{constructor(i,o){this.element=i.createElement("div"),this.element.classList.add(_o()),o.viewProps.bindClassModifiers(this.element),T(o.shows,k(this.element,_o(void 0,"v")))}}class vo{constructor(i,o){this.shows=F(!1),this.viewProps=o.viewProps,this.view=new Kh(i,{shows:this.shows,viewProps:this.viewProps})}}const go=C("txt");class $h{constructor(i,o){this.onChange_=this.onChange_.bind(this),this.element=i.createElement("div"),this.element.classList.add(go()),o.viewProps.bindClassModifiers(this.element),this.props_=o.props,this.props_.emitter.on("change",this.onChange_);const u=i.createElement("input");u.classList.add(go("i")),u.type="text",o.viewProps.bindDisabled(u),this.element.appendChild(u),this.inputElement=u,o.value.emitter.on("change",this.onChange_),this.value_=o.value,this.refresh()}refresh(){const i=this.props_.get("formatter");this.inputElement.value=i(this.value_.rawValue)}onChange_(){this.refresh()}}class xn{constructor(i,o){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=o.parser,this.props=o.props,this.value=o.value,this.viewProps=o.viewProps,this.view=new $h(i,{props:o.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(i){const u=i.currentTarget.value,m=this.parser_(u);f(m)||(this.value.rawValue=m),this.view.refresh()}}function Wh(a){return String(a)}function bo(a){return a==="false"?!1:!!a}function xo(a){return Wh(a)}class qh{constructor(i){this.text=i}evaluate(){return Number(this.text)}toString(){return this.text}}const Yh={"**":(a,i)=>Math.pow(a,i),"*":(a,i)=>a*i,"/":(a,i)=>a/i,"%":(a,i)=>a%i,"+":(a,i)=>a+i,"-":(a,i)=>a-i,"<<":(a,i)=>a<<i,">>":(a,i)=>a>>i,">>>":(a,i)=>a>>>i,"&":(a,i)=>a&i,"^":(a,i)=>a^i,"|":(a,i)=>a|i};class Xh{constructor(i,o,u){this.left=o,this.operator=i,this.right=u}evaluate(){const i=Yh[this.operator];if(!i)throw new Error(`unexpected binary operator: '${this.operator}`);return i(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const Zh={"+":a=>a,"-":a=>-a,"~":a=>~a};class Qh{constructor(i,o){this.operator=i,this.expression=o}evaluate(){const i=Zh[this.operator];if(!i)throw new Error(`unexpected unary operator: '${this.operator}`);return i(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function br(a){return(i,o)=>{for(let u=0;u<a.length;u++){const m=a[u](i,o);if(m!=="")return m}return""}}function Ui(a,i){var o;const u=a.substr(i).match(/^\s+/);return(o=u&&u[0])!==null&&o!==void 0?o:""}function Jh(a,i){const o=a.substr(i,1);return o.match(/^[1-9]$/)?o:""}function Bi(a,i){var o;const u=a.substr(i).match(/^[0-9]+/);return(o=u&&u[0])!==null&&o!==void 0?o:""}function eu(a,i){const o=Bi(a,i);if(o!=="")return o;const u=a.substr(i,1);if(i+=1,u!=="-"&&u!=="+")return"";const m=Bi(a,i);return m===""?"":u+m}function xr(a,i){const o=a.substr(i,1);if(i+=1,o.toLowerCase()!=="e")return"";const u=eu(a,i);return u===""?"":o+u}function wo(a,i){const o=a.substr(i,1);if(o==="0")return o;const u=Jh(a,i);return i+=u.length,u===""?"":u+Bi(a,i)}function tu(a,i){const o=wo(a,i);if(i+=o.length,o==="")return"";const u=a.substr(i,1);if(i+=u.length,u!==".")return"";const m=Bi(a,i);return i+=m.length,o+u+m+xr(a,i)}function iu(a,i){const o=a.substr(i,1);if(i+=o.length,o!==".")return"";const u=Bi(a,i);return i+=u.length,u===""?"":o+u+xr(a,i)}function nu(a,i){const o=wo(a,i);return i+=o.length,o===""?"":o+xr(a,i)}const ru=br([tu,iu,nu]);function su(a,i){var o;const u=a.substr(i).match(/^[01]+/);return(o=u&&u[0])!==null&&o!==void 0?o:""}function ou(a,i){const o=a.substr(i,2);if(i+=o.length,o.toLowerCase()!=="0b")return"";const u=su(a,i);return u===""?"":o+u}function au(a,i){var o;const u=a.substr(i).match(/^[0-7]+/);return(o=u&&u[0])!==null&&o!==void 0?o:""}function lu(a,i){const o=a.substr(i,2);if(i+=o.length,o.toLowerCase()!=="0o")return"";const u=au(a,i);return u===""?"":o+u}function hu(a,i){var o;const u=a.substr(i).match(/^[0-9a-f]+/i);return(o=u&&u[0])!==null&&o!==void 0?o:""}function uu(a,i){const o=a.substr(i,2);if(i+=o.length,o.toLowerCase()!=="0x")return"";const u=hu(a,i);return u===""?"":o+u}const cu=br([ou,lu,uu]),du=br([cu,ru]);function pu(a,i){const o=du(a,i);return i+=o.length,o===""?null:{evaluable:new qh(o),cursor:i}}function fu(a,i){const o=a.substr(i,1);if(i+=o.length,o!=="(")return null;const u=Co(a,i);if(!u)return null;i=u.cursor,i+=Ui(a,i).length;const m=a.substr(i,1);return i+=m.length,m!==")"?null:{evaluable:u.evaluable,cursor:i}}function mu(a,i){return pu(a,i)||fu(a,i)}function yo(a,i){const o=mu(a,i);if(o)return o;const u=a.substr(i,1);if(i+=u.length,u!=="+"&&u!=="-"&&u!=="~")return null;const m=yo(a,i);return m?(i=m.cursor,{cursor:i,evaluable:new Qh(u,m.evaluable)}):null}function _u(a,i,o){o+=Ui(i,o).length;const u=a.filter(m=>i.startsWith(m,o))[0];return u?(o+=u.length,o+=Ui(i,o).length,{cursor:o,operator:u}):null}function vu(a,i){return(o,u)=>{const m=a(o,u);if(!m)return null;u=m.cursor;let y=m.evaluable;for(;;){const E=_u(i,o,u);if(!E)break;u=E.cursor;const D=a(o,u);if(!D)return null;u=D.cursor,y=new Xh(E.operator,y,D.evaluable)}return y?{cursor:u,evaluable:y}:null}}const gu=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((a,i)=>vu(a,i),yo);function Co(a,i){return i+=Ui(a,i).length,gu(a,i)}function bu(a){const i=Co(a,0);return!i||i.cursor+Ui(a,i.cursor).length!==a.length?null:i.evaluable}function et(a){var i;const o=bu(a);return(i=o?.evaluate())!==null&&i!==void 0?i:null}function Eo(a){if(typeof a=="number")return a;if(typeof a=="string"){const i=et(a);if(!f(i))return i}return 0}function xu(a){return String(a)}function Ce(a){return i=>i.toFixed(Math.max(Math.min(a,20),0))}const wu=Ce(0);function wn(a){return wu(a)+"%"}function So(a){return String(a)}function wr(a){return a}function Po(a,i){for(;a.length<i;)a.push(void 0)}function yu(a){const i=[];return Po(i,a),F(i)}function Cu(a){const i=a.indexOf(void 0);return i<0?a:a.slice(0,i)}function Eu(a,i){const o=[...Cu(a),i];return o.length>a.length?o.splice(0,o.length-a.length):Po(o,a.length),o}function Ni({primary:a,secondary:i,forward:o,backward:u}){let m=!1;function y(E){m||(m=!0,E(),m=!1)}a.emitter.on("change",E=>{y(()=>{i.setRawValue(o(a,i),E.options)})}),i.emitter.on("change",E=>{y(()=>{a.setRawValue(u(a,i),E.options)}),y(()=>{i.setRawValue(o(a,i),E.options)})}),y(()=>{i.setRawValue(o(a,i),{forceEmit:!1,last:!0})})}function Ee(a,i){const o=a*(i.altKey?.1:1)*(i.shiftKey?10:1);return i.upKey?+o:i.downKey?-o:0}function Vi(a){return{altKey:a.altKey,downKey:a.key==="ArrowDown",shiftKey:a.shiftKey,upKey:a.key==="ArrowUp"}}function tt(a){return{altKey:a.altKey,downKey:a.key==="ArrowLeft",shiftKey:a.shiftKey,upKey:a.key==="ArrowRight"}}function Su(a){return a==="ArrowUp"||a==="ArrowDown"}function To(a){return Su(a)||a==="ArrowLeft"||a==="ArrowRight"}function yr(a,i){const o=i.ownerDocument.defaultView,u=i.getBoundingClientRect();return{x:a.pageX-((o&&o.scrollX||0)+u.left),y:a.pageY-((o&&o.scrollY||0)+u.top)}}class Rt{constructor(i){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=i,this.emitter=new x,i.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),i.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),i.addEventListener("touchend",this.onTouchEnd_),i.addEventListener("mousedown",this.onMouseDown_)}computePosition_(i){const o=this.elem_.getBoundingClientRect();return{bounds:{width:o.width,height:o.height},point:i?{x:i.x,y:i.y}:null}}onMouseDown_(i){var o;i.preventDefault(),(o=i.currentTarget)===null||o===void 0||o.focus();const u=this.elem_.ownerDocument;u.addEventListener("mousemove",this.onDocumentMouseMove_),u.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:i.altKey,data:this.computePosition_(yr(i,this.elem_)),sender:this,shiftKey:i.shiftKey})}onDocumentMouseMove_(i){this.emitter.emit("move",{altKey:i.altKey,data:this.computePosition_(yr(i,this.elem_)),sender:this,shiftKey:i.shiftKey})}onDocumentMouseUp_(i){const o=this.elem_.ownerDocument;o.removeEventListener("mousemove",this.onDocumentMouseMove_),o.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:i.altKey,data:this.computePosition_(yr(i,this.elem_)),sender:this,shiftKey:i.shiftKey})}onTouchStart_(i){i.preventDefault();const o=i.targetTouches.item(0),u=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:i.altKey,data:this.computePosition_(o?{x:o.clientX-u.left,y:o.clientY-u.top}:void 0),sender:this,shiftKey:i.shiftKey}),this.lastTouch_=o}onTouchMove_(i){const o=i.targetTouches.item(0),u=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:i.altKey,data:this.computePosition_(o?{x:o.clientX-u.left,y:o.clientY-u.top}:void 0),sender:this,shiftKey:i.shiftKey}),this.lastTouch_=o}onTouchEnd_(i){var o;const u=(o=i.targetTouches.item(0))!==null&&o!==void 0?o:this.lastTouch_,m=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:i.altKey,data:this.computePosition_(u?{x:u.clientX-m.left,y:u.clientY-m.top}:void 0),sender:this,shiftKey:i.shiftKey})}}function re(a,i,o,u,m){const y=(a-i)/(o-i);return u+y*(m-u)}function Ao(a){return String(a.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function ie(a,i,o){return Math.min(Math.max(a,i),o)}function Cr(a,i){return(a%i+i)%i}const Ie=C("txt");class Pu{constructor(i,o){this.onChange_=this.onChange_.bind(this),this.props_=o.props,this.props_.emitter.on("change",this.onChange_),this.element=i.createElement("div"),this.element.classList.add(Ie(),Ie(void 0,"num")),o.arrayPosition&&this.element.classList.add(Ie(void 0,o.arrayPosition)),o.viewProps.bindClassModifiers(this.element);const u=i.createElement("input");u.classList.add(Ie("i")),u.type="text",o.viewProps.bindDisabled(u),this.element.appendChild(u),this.inputElement=u,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=o.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Ie()),this.inputElement.classList.add(Ie("i"));const m=i.createElement("div");m.classList.add(Ie("k")),this.element.appendChild(m),this.knobElement=m;const y=i.createElementNS(We,"svg");y.classList.add(Ie("g")),this.knobElement.appendChild(y);const E=i.createElementNS(We,"path");E.classList.add(Ie("gb")),y.appendChild(E),this.guideBodyElem_=E;const D=i.createElementNS(We,"path");D.classList.add(Ie("gh")),y.appendChild(D),this.guideHeadElem_=D;const B=i.createElement("div");B.classList.add(C("tt")()),this.knobElement.appendChild(B),this.tooltipElem_=B,o.value.emitter.on("change",this.onChange_),this.value=o.value,this.refresh()}onDraggingChange_(i){if(i.rawValue===null){this.element.classList.remove(Ie(void 0,"drg"));return}this.element.classList.add(Ie(void 0,"drg"));const o=i.rawValue/this.props_.get("draggingScale"),u=o+(o>0?-1:o<0?1:0),m=ie(-u,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${u+m},0 L${u},4 L${u+m},8`,`M ${o},-1 L${o},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${o},4`);const y=this.props_.get("formatter");this.tooltipElem_.textContent=y(this.value.rawValue),this.tooltipElem_.style.left=`${o}px`}refresh(){const i=this.props_.get("formatter");this.inputElement.value=i(this.value.rawValue)}onChange_(){this.refresh()}}class Fi{constructor(i,o){this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=o.baseStep,this.parser_=o.parser,this.props=o.props,this.value=o.value,this.viewProps=o.viewProps,this.dragging_=F(null),this.view=new Pu(i,{arrayPosition:o.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const u=new Rt(this.view.knobElement);u.emitter.on("down",this.onPointerDown_),u.emitter.on("move",this.onPointerMove_),u.emitter.on("up",this.onPointerUp_)}onInputChange_(i){const u=i.currentTarget.value,m=this.parser_(u);f(m)||(this.value.rawValue=m),this.view.refresh()}onInputKeyDown_(i){const o=Ee(this.baseStep_,Vi(i));o!==0&&this.value.setRawValue(this.value.rawValue+o,{forceEmit:!1,last:!1})}onInputKeyUp_(i){Ee(this.baseStep_,Vi(i))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(i){if(!i.point)return null;const o=i.point.x-i.bounds.width/2;return this.originRawValue_+o*this.props.get("draggingScale")}onPointerMove_(i){const o=this.computeDraggingValue_(i.data);o!==null&&(this.value.setRawValue(o,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(i){const o=this.computeDraggingValue_(i.data);o!==null&&(this.value.setRawValue(o,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const Er=C("sld");class Tu{constructor(i,o){this.onChange_=this.onChange_.bind(this),this.props_=o.props,this.props_.emitter.on("change",this.onChange_),this.element=i.createElement("div"),this.element.classList.add(Er()),o.viewProps.bindClassModifiers(this.element);const u=i.createElement("div");u.classList.add(Er("t")),o.viewProps.bindTabIndex(u),this.element.appendChild(u),this.trackElement=u;const m=i.createElement("div");m.classList.add(Er("k")),this.trackElement.appendChild(m),this.knobElement=m,o.value.emitter.on("change",this.onChange_),this.value=o.value,this.update_()}update_(){const i=ie(re(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${i}%`}onChange_(){this.update_()}}class Au{constructor(i,o){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=o.baseStep,this.value=o.value,this.viewProps=o.viewProps,this.props=o.props,this.view=new Tu(i,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Rt(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(i,o){i.point&&this.value.setRawValue(re(ie(i.point.x,0,i.bounds.width),0,i.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),o)}onPointerDownOrMove_(i){this.handlePointerEvent_(i.data,{forceEmit:!1,last:!1})}onPointerUp_(i){this.handlePointerEvent_(i.data,{forceEmit:!0,last:!0})}onKeyDown_(i){const o=Ee(this.baseStep_,tt(i));o!==0&&this.value.setRawValue(this.value.rawValue+o,{forceEmit:!1,last:!1})}onKeyUp_(i){Ee(this.baseStep_,tt(i))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Sr=C("sldtxt");class Mu{constructor(i,o){this.element=i.createElement("div"),this.element.classList.add(Sr());const u=i.createElement("div");u.classList.add(Sr("s")),this.sliderView_=o.sliderView,u.appendChild(this.sliderView_.element),this.element.appendChild(u);const m=i.createElement("div");m.classList.add(Sr("t")),this.textView_=o.textView,m.appendChild(this.textView_.element),this.element.appendChild(m)}}class Pr{constructor(i,o){this.value=o.value,this.viewProps=o.viewProps,this.sliderC_=new Au(i,{baseStep:o.baseStep,props:o.sliderProps,value:o.value,viewProps:this.viewProps}),this.textC_=new Fi(i,{baseStep:o.baseStep,parser:o.parser,props:o.textProps,value:o.value,viewProps:o.viewProps}),this.view=new Mu(i,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function zi(a,i){a.write(i)}function yn(a){const i=$;if(Array.isArray(a))return i.required.array(i.required.object({text:i.required.string,value:i.required.raw}))(a).value;if(typeof a=="object")return i.required.raw(a).value}function Mo(a){if(a==="inline"||a==="popup")return a}function ht(a){const i=$;return i.required.object({max:i.optional.number,min:i.optional.number,step:i.optional.number})(a).value}function ko(a){if(Array.isArray(a))return a;const i=[];return Object.keys(a).forEach(o=>{i.push({text:o,value:a[o]})}),i}function Tr(a){return f(a)?null:new Li(ko(a))}function Ar(a){const i=a?Ye(a,Li):null;return i?i.options:null}function ku(a){const i=a?Ye(a,Ot):null;return i?i.step:null}function Cn(a,i){const o=a&&Ye(a,Ot);return o?Ao(o.step):Math.max(Ao(i),2)}function ei(a){const i=ku(a);return i??1}function ti(a,i){var o;const u=a&&Ye(a,Ot),m=Math.abs((o=u?.step)!==null&&o!==void 0?o:i);return m===0?.1:Math.pow(10,Math.floor(Math.log10(m))-1)}const En=C("ckb");class Ou{constructor(i,o){this.onValueChange_=this.onValueChange_.bind(this),this.element=i.createElement("div"),this.element.classList.add(En()),o.viewProps.bindClassModifiers(this.element);const u=i.createElement("label");u.classList.add(En("l")),this.element.appendChild(u);const m=i.createElement("input");m.classList.add(En("i")),m.type="checkbox",u.appendChild(m),this.inputElement=m,o.viewProps.bindDisabled(this.inputElement);const y=i.createElement("div");y.classList.add(En("w")),u.appendChild(y);const E=_n(i,"check");y.appendChild(E),o.value.emitter.on("change",this.onValueChange_),this.value=o.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class Ru{constructor(i,o){this.onInputChange_=this.onInputChange_.bind(this),this.value=o.value,this.viewProps=o.viewProps,this.view=new Ou(i,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(i){const o=i.currentTarget;this.value.rawValue=o.checked}}function Du(a){const i=[],o=Tr(a.options);return o&&i.push(o),new kt(i)}const Lu={id:"input-bool",type:"input",accept:(a,i)=>{if(typeof a!="boolean")return null;const u=W(i,{options:$.optional.custom(yn)});return u?{initialValue:a,params:u}:null},binding:{reader:a=>bo,constraint:a=>Du(a.params),writer:a=>zi},controller:a=>{var i;const o=a.document,u=a.value,m=a.constraint;return m&&Ye(m,Li)?new Ii(o,{props:L.fromObject({options:(i=Ar(m))!==null&&i!==void 0?i:[]}),value:u,viewProps:a.viewProps}):new Ru(o,{value:u,viewProps:a.viewProps})}},Dt=C("col");class Iu{constructor(i,o){this.element=i.createElement("div"),this.element.classList.add(Dt()),o.foldable.bindExpandedClass(this.element,Dt(void 0,"expanded")),A(o.foldable,"completed",k(this.element,Dt(void 0,"cpl")));const u=i.createElement("div");u.classList.add(Dt("h")),this.element.appendChild(u);const m=i.createElement("div");m.classList.add(Dt("s")),u.appendChild(m),this.swatchElement=m;const y=i.createElement("div");if(y.classList.add(Dt("t")),u.appendChild(y),this.textElement=y,o.pickerLayout==="inline"){const E=i.createElement("div");E.classList.add(Dt("p")),this.element.appendChild(E),this.pickerElement=E}else this.pickerElement=null}}function Uu(a,i,o){const u=ie(a/255,0,1),m=ie(i/255,0,1),y=ie(o/255,0,1),E=Math.max(u,m,y),D=Math.min(u,m,y),B=E-D;let N=0,q=0;const X=(D+E)/2;return B!==0&&(q=B/(1-Math.abs(E+D-1)),u===E?N=(m-y)/B:m===E?N=2+(y-u)/B:N=4+(u-m)/B,N=N/6+(N<0?1:0)),[N*360,q*100,X*100]}function Bu(a,i,o){const u=(a%360+360)%360,m=ie(i/100,0,1),y=ie(o/100,0,1),E=(1-Math.abs(2*y-1))*m,D=E*(1-Math.abs(u/60%2-1)),B=y-E/2;let N,q,X;return u>=0&&u<60?[N,q,X]=[E,D,0]:u>=60&&u<120?[N,q,X]=[D,E,0]:u>=120&&u<180?[N,q,X]=[0,E,D]:u>=180&&u<240?[N,q,X]=[0,D,E]:u>=240&&u<300?[N,q,X]=[D,0,E]:[N,q,X]=[E,0,D],[(N+B)*255,(q+B)*255,(X+B)*255]}function Nu(a,i,o){const u=ie(a/255,0,1),m=ie(i/255,0,1),y=ie(o/255,0,1),E=Math.max(u,m,y),D=Math.min(u,m,y),B=E-D;let N;B===0?N=0:E===u?N=60*(((m-y)/B%6+6)%6):E===m?N=60*((y-u)/B+2):N=60*((u-m)/B+4);const q=E===0?0:B/E,X=E;return[N,q*100,X*100]}function Oo(a,i,o){const u=Cr(a,360),m=ie(i/100,0,1),y=ie(o/100,0,1),E=y*m,D=E*(1-Math.abs(u/60%2-1)),B=y-E;let N,q,X;return u>=0&&u<60?[N,q,X]=[E,D,0]:u>=60&&u<120?[N,q,X]=[D,E,0]:u>=120&&u<180?[N,q,X]=[0,E,D]:u>=180&&u<240?[N,q,X]=[0,D,E]:u>=240&&u<300?[N,q,X]=[D,0,E]:[N,q,X]=[E,0,D],[(N+B)*255,(q+B)*255,(X+B)*255]}function Vu(a,i,o){const u=o+i*(100-Math.abs(2*o-100))/200;return[a,u!==0?i*(100-Math.abs(2*o-100))/u:0,o+i*(100-Math.abs(2*o-100))/200]}function Fu(a,i,o){const u=100-Math.abs(o*(200-i)/100-100);return[a,u!==0?i*o/u:0,o*(200-i)/200]}function ii(a){return[a[0],a[1],a[2]]}function Ro(a,i){return[a[0],a[1],a[2],i]}const zu={hsl:{hsl:(a,i,o)=>[a,i,o],hsv:Vu,rgb:Bu},hsv:{hsl:Fu,hsv:(a,i,o)=>[a,i,o],rgb:Oo},rgb:{hsl:Uu,hsv:Nu,rgb:(a,i,o)=>[a,i,o]}};function Hu(a,i,o){return zu[i][o](...a)}const ju={hsl:a=>{var i;return[Cr(a[0],360),ie(a[1],0,100),ie(a[2],0,100),ie((i=a[3])!==null&&i!==void 0?i:1,0,1)]},hsv:a=>{var i;return[Cr(a[0],360),ie(a[1],0,100),ie(a[2],0,100),ie((i=a[3])!==null&&i!==void 0?i:1,0,1)]},rgb:a=>{var i;return[ie(a[0],0,255),ie(a[1],0,255),ie(a[2],0,255),ie((i=a[3])!==null&&i!==void 0?i:1,0,1)]}};function Sn(a,i){return typeof a!="object"||f(a)?!1:i in a&&typeof a[i]=="number"}class z{constructor(i,o){this.mode_=o,this.comps_=ju[o](i)}static black(){return new z([0,0,0],"rgb")}static fromObject(i){const o="a"in i?[i.r,i.g,i.b,i.a]:[i.r,i.g,i.b];return new z(o,"rgb")}static toRgbaObject(i){return i.toRgbaObject()}static isRgbColorObject(i){return Sn(i,"r")&&Sn(i,"g")&&Sn(i,"b")}static isRgbaColorObject(i){return this.isRgbColorObject(i)&&Sn(i,"a")}static isColorObject(i){return this.isRgbColorObject(i)}static equals(i,o){if(i.mode_!==o.mode_)return!1;const u=i.comps_,m=o.comps_;for(let y=0;y<u.length;y++)if(u[y]!==m[y])return!1;return!0}get mode(){return this.mode_}getComponents(i){return Ro(Hu(ii(this.comps_),this.mode_,i||this.mode_),this.comps_[3])}toRgbaObject(){const i=this.getComponents("rgb");return{r:i[0],g:i[1],b:i[2],a:i[3]}}}const ut=C("colp");class Gu{constructor(i,o){this.alphaViews_=null,this.element=i.createElement("div"),this.element.classList.add(ut());const u=i.createElement("div");u.classList.add(ut("hsv"));const m=i.createElement("div");m.classList.add(ut("sv")),this.svPaletteView_=o.svPaletteView,m.appendChild(this.svPaletteView_.element),u.appendChild(m);const y=i.createElement("div");y.classList.add(ut("h")),this.hPaletteView_=o.hPaletteView,y.appendChild(this.hPaletteView_.element),u.appendChild(y),this.element.appendChild(u);const E=i.createElement("div");if(E.classList.add(ut("rgb")),this.textView_=o.textView,E.appendChild(this.textView_.element),this.element.appendChild(E),o.alphaViews){this.alphaViews_={palette:o.alphaViews.palette,text:o.alphaViews.text};const D=i.createElement("div");D.classList.add(ut("a"));const B=i.createElement("div");B.classList.add(ut("ap")),B.appendChild(this.alphaViews_.palette.element),D.appendChild(B);const N=i.createElement("div");N.classList.add(ut("at")),N.appendChild(this.alphaViews_.text.element),D.appendChild(N),this.element.appendChild(D)}}get allFocusableElements(){const i=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(o=>o.inputElement)];return this.alphaViews_&&i.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),i}}function Mr(a){const i=$;return W(a,{alpha:i.optional.boolean,expanded:i.optional.boolean,picker:i.optional.custom(Mo)})}function Lt(a){return a?.1:1}function Ue(a,i){const o=a.match(/^(.+)%$/);return Math.min(o?parseFloat(o[1])*.01*i:parseFloat(a),i)}const Ku={deg:a=>a,grad:a=>a*360/400,rad:a=>a*360/(2*Math.PI),turn:a=>a*360};function Do(a){const i=a.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!i)return parseFloat(a);const o=parseFloat(i[1]),u=i[2];return Ku[u](o)}const kr={"func.rgb":a=>{const i=a.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!i)return null;const o=[Ue(i[1],255),Ue(i[2],255),Ue(i[3],255)];return isNaN(o[0])||isNaN(o[1])||isNaN(o[2])?null:new z(o,"rgb")},"func.rgba":a=>{const i=a.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!i)return null;const o=[Ue(i[1],255),Ue(i[2],255),Ue(i[3],255),Ue(i[4],1)];return isNaN(o[0])||isNaN(o[1])||isNaN(o[2])||isNaN(o[3])?null:new z(o,"rgb")},"func.hsl":a=>{const i=a.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!i)return null;const o=[Do(i[1]),Ue(i[2],100),Ue(i[3],100)];return isNaN(o[0])||isNaN(o[1])||isNaN(o[2])?null:new z(o,"hsl")},"func.hsla":a=>{const i=a.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!i)return null;const o=[Do(i[1]),Ue(i[2],100),Ue(i[3],100),Ue(i[4],1)];return isNaN(o[0])||isNaN(o[1])||isNaN(o[2])||isNaN(o[3])?null:new z(o,"hsl")},"hex.rgb":a=>{const i=a.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(i)return new z([parseInt(i[1]+i[1],16),parseInt(i[2]+i[2],16),parseInt(i[3]+i[3],16)],"rgb");const o=a.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return o?new z([parseInt(o[1],16),parseInt(o[2],16),parseInt(o[3],16)],"rgb"):null},"hex.rgba":a=>{const i=a.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(i)return new z([parseInt(i[1]+i[1],16),parseInt(i[2]+i[2],16),parseInt(i[3]+i[3],16),re(parseInt(i[4]+i[4],16),0,255,0,1)],"rgb");const o=a.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return o?new z([parseInt(o[1],16),parseInt(o[2],16),parseInt(o[3],16),re(parseInt(o[4],16),0,255,0,1)],"rgb"):null}};function Pn(a){return Object.keys(kr).reduce((o,u)=>{if(o)return o;const m=kr[u];return m(a)?u:null},null)}const Tn=a=>{const i=Pn(a);return i?kr[i](a):null};function $u(a){return a==="func.hsla"||a==="func.rgba"||a==="hex.rgba"}function Wu(a){if(typeof a=="string"){const i=Tn(a);if(i)return i}return z.black()}function Lo(a){const i=ie(Math.floor(a),0,255).toString(16);return i.length===1?`0${i}`:i}function Or(a,i="#"){const o=ii(a.getComponents("rgb")).map(Lo).join("");return`${i}${o}`}function An(a,i="#"){const o=a.getComponents("rgb"),u=[o[0],o[1],o[2],o[3]*255].map(Lo).join("");return`${i}${u}`}function Io(a){const i=Ce(0);return`rgb(${ii(a.getComponents("rgb")).map(u=>i(u)).join(", ")})`}function Mn(a){const i=Ce(2),o=Ce(0);return`rgba(${a.getComponents("rgb").map((m,y)=>(y===3?i:o)(m)).join(", ")})`}function qu(a){const i=[Ce(0),wn,wn];return`hsl(${ii(a.getComponents("hsl")).map((u,m)=>i[m](u)).join(", ")})`}function Yu(a){const i=[Ce(0),wn,wn,Ce(2)];return`hsla(${a.getComponents("hsl").map((u,m)=>i[m](u)).join(", ")})`}const Xu={"func.hsl":qu,"func.hsla":Yu,"func.rgb":Io,"func.rgba":Mn,"hex.rgb":Or,"hex.rgba":An};function Uo(a){return Xu[a]}const Hi=C("apl");class Zu{constructor(i,o){this.onValueChange_=this.onValueChange_.bind(this),this.value=o.value,this.value.emitter.on("change",this.onValueChange_),this.element=i.createElement("div"),this.element.classList.add(Hi()),o.viewProps.bindTabIndex(this.element);const u=i.createElement("div");u.classList.add(Hi("b")),this.element.appendChild(u);const m=i.createElement("div");m.classList.add(Hi("c")),u.appendChild(m),this.colorElem_=m;const y=i.createElement("div");y.classList.add(Hi("m")),this.element.appendChild(y),this.markerElem_=y;const E=i.createElement("div");E.classList.add(Hi("p")),this.markerElem_.appendChild(E),this.previewElem_=E,this.update_()}update_(){const i=this.value.rawValue,o=i.getComponents("rgb"),u=new z([o[0],o[1],o[2],0],"rgb"),m=new z([o[0],o[1],o[2],255],"rgb"),y=["to right",Mn(u),Mn(m)];this.colorElem_.style.background=`linear-gradient(${y.join(",")})`,this.previewElem_.style.backgroundColor=Mn(i);const E=re(o[3],0,1,0,100);this.markerElem_.style.left=`${E}%`}onValueChange_(){this.update_()}}class Qu{constructor(i,o){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=o.value,this.viewProps=o.viewProps,this.view=new Zu(i,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Rt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(i,o){if(!i.point)return;const u=i.point.x/i.bounds.width,m=this.value.rawValue,[y,E,D]=m.getComponents("hsv");this.value.setRawValue(new z([y,E,D,u],"hsv"),o)}onPointerDown_(i){this.handlePointerEvent_(i.data,{forceEmit:!1,last:!1})}onPointerMove_(i){this.handlePointerEvent_(i.data,{forceEmit:!1,last:!1})}onPointerUp_(i){this.handlePointerEvent_(i.data,{forceEmit:!0,last:!0})}onKeyDown_(i){const o=Ee(Lt(!0),tt(i));if(o===0)return;const u=this.value.rawValue,[m,y,E,D]=u.getComponents("hsv");this.value.setRawValue(new z([m,y,E,D+o],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(i){Ee(Lt(!0),tt(i))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const ni=C("coltxt");function Ju(a){const i=a.createElement("select"),o=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}];return i.appendChild(o.reduce((u,m)=>{const y=a.createElement("option");return y.textContent=m.text,y.value=m.value,u.appendChild(y),u},a.createDocumentFragment())),i}class ec{constructor(i,o){this.element=i.createElement("div"),this.element.classList.add(ni());const u=i.createElement("div");u.classList.add(ni("m")),this.modeElem_=Ju(i),this.modeElem_.classList.add(ni("ms")),u.appendChild(this.modeSelectElement);const m=i.createElement("div");m.classList.add(ni("mm")),m.appendChild(_n(i,"dropdown")),u.appendChild(m),this.element.appendChild(u);const y=i.createElement("div");y.classList.add(ni("w")),this.element.appendChild(y),this.textsElem_=y,this.textViews_=o.textViews,this.applyTextViews_(),T(o.colorMode,E=>{this.modeElem_.value=E})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(i){this.textViews_=i,this.applyTextViews_()}applyTextViews_(){eo(this.textsElem_);const i=this.element.ownerDocument;this.textViews_.forEach(o=>{const u=i.createElement("div");u.classList.add(ni("c")),u.appendChild(o.element),this.textsElem_.appendChild(u)})}}const tc=Ce(0),ic={rgb:()=>new ke({min:0,max:255}),hsl:a=>a===0?new ke({min:0,max:360}):new ke({min:0,max:100}),hsv:a=>a===0?new ke({min:0,max:360}):new ke({min:0,max:100})};function Rr(a,i,o){return new Fi(a,{arrayPosition:o===0?"fst":o===2?"lst":"mid",baseStep:Lt(!1),parser:i.parser,props:L.fromObject({draggingScale:1,formatter:tc}),value:F(0,{constraint:ic[i.colorMode](o)}),viewProps:i.viewProps})}class nc{constructor(i,o){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.parser_=o.parser,this.value=o.value,this.viewProps=o.viewProps,this.colorMode=F(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(i),this.view=new ec(i,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(i){const o={colorMode:this.colorMode.rawValue,parser:this.parser_,viewProps:this.viewProps},u=[Rr(i,o,0),Rr(i,o,1),Rr(i,o,2)];return u.forEach((m,y)=>{Ni({primary:this.value,secondary:m.value,forward:E=>E.rawValue.getComponents(this.colorMode.rawValue)[y],backward:(E,D)=>{const B=this.colorMode.rawValue,N=E.rawValue.getComponents(B);return N[y]=D.rawValue,new z(Ro(ii(N),N[3]),B)}})}),u}onModeSelectChange_(i){const o=i.currentTarget;this.colorMode.rawValue=o.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const Dr=C("hpl");class rc{constructor(i,o){this.onValueChange_=this.onValueChange_.bind(this),this.value=o.value,this.value.emitter.on("change",this.onValueChange_),this.element=i.createElement("div"),this.element.classList.add(Dr()),o.viewProps.bindTabIndex(this.element);const u=i.createElement("div");u.classList.add(Dr("c")),this.element.appendChild(u);const m=i.createElement("div");m.classList.add(Dr("m")),this.element.appendChild(m),this.markerElem_=m,this.update_()}update_(){const i=this.value.rawValue,[o]=i.getComponents("hsv");this.markerElem_.style.backgroundColor=Io(new z([o,100,100],"hsv"));const u=re(o,0,360,0,100);this.markerElem_.style.left=`${u}%`}onValueChange_(){this.update_()}}class sc{constructor(i,o){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=o.value,this.viewProps=o.viewProps,this.view=new rc(i,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Rt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(i,o){if(!i.point)return;const u=re(ie(i.point.x,0,i.bounds.width),0,i.bounds.width,0,359),m=this.value.rawValue,[,y,E,D]=m.getComponents("hsv");this.value.setRawValue(new z([u,y,E,D],"hsv"),o)}onPointerDown_(i){this.handlePointerEvent_(i.data,{forceEmit:!1,last:!1})}onPointerMove_(i){this.handlePointerEvent_(i.data,{forceEmit:!1,last:!1})}onPointerUp_(i){this.handlePointerEvent_(i.data,{forceEmit:!0,last:!0})}onKeyDown_(i){const o=Ee(Lt(!1),tt(i));if(o===0)return;const u=this.value.rawValue,[m,y,E,D]=u.getComponents("hsv");this.value.setRawValue(new z([m+o,y,E,D],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(i){Ee(Lt(!1),tt(i))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Lr=C("svp"),Bo=64;class oc{constructor(i,o){this.onValueChange_=this.onValueChange_.bind(this),this.value=o.value,this.value.emitter.on("change",this.onValueChange_),this.element=i.createElement("div"),this.element.classList.add(Lr()),o.viewProps.bindTabIndex(this.element);const u=i.createElement("canvas");u.height=Bo,u.width=Bo,u.classList.add(Lr("c")),this.element.appendChild(u),this.canvasElement=u;const m=i.createElement("div");m.classList.add(Lr("m")),this.element.appendChild(m),this.markerElem_=m,this.update_()}update_(){const i=_h(this.canvasElement);if(!i)return;const u=this.value.rawValue.getComponents("hsv"),m=this.canvasElement.width,y=this.canvasElement.height,E=i.getImageData(0,0,m,y),D=E.data;for(let q=0;q<y;q++)for(let X=0;X<m;X++){const It=re(X,0,m,0,100),Gi=re(q,0,y,100,0),Ki=Oo(u[0],It,Gi),ai=(q*m+X)*4;D[ai]=Ki[0],D[ai+1]=Ki[1],D[ai+2]=Ki[2],D[ai+3]=255}i.putImageData(E,0,0);const B=re(u[1],0,100,0,100);this.markerElem_.style.left=`${B}%`;const N=re(u[2],0,100,100,0);this.markerElem_.style.top=`${N}%`}onValueChange_(){this.update_()}}class ac{constructor(i,o){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=o.value,this.viewProps=o.viewProps,this.view=new oc(i,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Rt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(i,o){if(!i.point)return;const u=re(i.point.x,0,i.bounds.width,0,100),m=re(i.point.y,0,i.bounds.height,100,0),[y,,,E]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new z([y,u,m,E],"hsv"),o)}onPointerDown_(i){this.handlePointerEvent_(i.data,{forceEmit:!1,last:!1})}onPointerMove_(i){this.handlePointerEvent_(i.data,{forceEmit:!1,last:!1})}onPointerUp_(i){this.handlePointerEvent_(i.data,{forceEmit:!0,last:!0})}onKeyDown_(i){To(i.key)&&i.preventDefault();const[o,u,m,y]=this.value.rawValue.getComponents("hsv"),E=Lt(!1),D=Ee(E,tt(i)),B=Ee(E,Vi(i));D===0&&B===0||this.value.setRawValue(new z([o,u+D,m+B,y],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(i){const o=Lt(!1),u=Ee(o,tt(i)),m=Ee(o,Vi(i));u===0&&m===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class lc{constructor(i,o){this.value=o.value,this.viewProps=o.viewProps,this.hPaletteC_=new sc(i,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new ac(i,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=o.supportsAlpha?{palette:new Qu(i,{value:this.value,viewProps:this.viewProps}),text:new Fi(i,{parser:et,baseStep:.1,props:L.fromObject({draggingScale:.01,formatter:Ce(2)}),value:F(0,{constraint:new ke({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Ni({primary:this.value,secondary:this.alphaIcs_.text.value,forward:u=>u.rawValue.getComponents()[3],backward:(u,m)=>{const y=u.rawValue.getComponents();return y[3]=m.rawValue,new z(y,u.rawValue.mode)}}),this.textC_=new nc(i,{parser:et,value:this.value,viewProps:this.viewProps}),this.view=new Gu(i,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:o.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view})}get textController(){return this.textC_}}const Ir=C("colsw");class hc{constructor(i,o){this.onValueChange_=this.onValueChange_.bind(this),o.value.emitter.on("change",this.onValueChange_),this.value=o.value,this.element=i.createElement("div"),this.element.classList.add(Ir()),o.viewProps.bindClassModifiers(this.element);const u=i.createElement("div");u.classList.add(Ir("sw")),this.element.appendChild(u),this.swatchElem_=u;const m=i.createElement("button");m.classList.add(Ir("b")),o.viewProps.bindDisabled(m),this.element.appendChild(m),this.buttonElement=m,this.update_()}update_(){const i=this.value.rawValue;this.swatchElem_.style.backgroundColor=An(i)}onValueChange_(){this.update_()}}class uc{constructor(i,o){this.value=o.value,this.viewProps=o.viewProps,this.view=new hc(i,{value:this.value,viewProps:this.viewProps})}}class Ur{constructor(i,o){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=o.value,this.viewProps=o.viewProps,this.foldable_=ki.create(o.expanded),this.swatchC_=new uc(i,{value:this.value,viewProps:this.viewProps});const u=this.swatchC_.view.buttonElement;u.addEventListener("blur",this.onButtonBlur_),u.addEventListener("click",this.onButtonClick_),this.textC_=new xn(i,{parser:o.parser,props:L.fromObject({formatter:o.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new Iu(i,{foldable:this.foldable_,pickerLayout:o.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=o.pickerLayout==="popup"?new vo(i,{viewProps:this.viewProps}):null;const m=new lc(i,{supportsAlpha:o.supportsAlpha,value:this.value,viewProps:this.viewProps});m.view.allFocusableElements.forEach(y=>{y.addEventListener("blur",this.onPopupChildBlur_),y.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=m,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(m.view.element),Ni({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:y=>y.rawValue,backward:(y,E)=>E.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),hr(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(i){if(!this.popC_)return;const o=this.view.element,u=i.relatedTarget;(!u||!o.contains(u))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(i){if(!this.popC_)return;const o=this.popC_.view.element,u=to(i);u&&o.contains(u)||u&&u===this.swatchC_.view.buttonElement&&!lr(o.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(i){this.popC_?i.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&i.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function cc(a){return z.isColorObject(a)?z.fromObject(a):z.black()}function dc(a){return ii(a.getComponents("rgb")).reduce((i,o)=>i<<8|Math.floor(o)&255,0)}function pc(a){return a.getComponents("rgb").reduce((i,o,u)=>{const m=Math.floor(u===3?o*255:o)&255;return i<<8|m},0)>>>0}function fc(a){return new z([a>>16&255,a>>8&255,a&255],"rgb")}function mc(a){return new z([a>>24&255,a>>16&255,a>>8&255,re(a&255,0,255,0,1)],"rgb")}function _c(a){return typeof a!="number"?z.black():fc(a)}function vc(a){return typeof a!="number"?z.black():mc(a)}function gc(a){const i=Uo(a);return(o,u)=>{zi(o,i(u))}}function bc(a){const i=a?pc:dc;return(o,u)=>{zi(o,i(u))}}function xc(a,i){const o=i.toRgbaObject();a.writeProperty("r",o.r),a.writeProperty("g",o.g),a.writeProperty("b",o.b),a.writeProperty("a",o.a)}function wc(a,i){const o=i.toRgbaObject();a.writeProperty("r",o.r),a.writeProperty("g",o.g),a.writeProperty("b",o.b)}function yc(a){return a?xc:wc}function Br(a){return"alpha"in a&&a.alpha===!0}function Cc(a){return a?i=>An(i,"0x"):i=>Or(i,"0x")}const Ec={id:"input-color-number",type:"input",accept:(a,i)=>{if(typeof a!="number"||!("view"in i)||i.view!=="color")return null;const o=Mr(i);return o?{initialValue:a,params:o}:null},binding:{reader:a=>Br(a.params)?vc:_c,equals:z.equals,writer:a=>bc(Br(a.params))},controller:a=>{const i=Br(a.params),o="expanded"in a.params?a.params.expanded:void 0,u="picker"in a.params?a.params.picker:void 0;return new Ur(a.document,{expanded:o??!1,formatter:Cc(i),parser:Tn,pickerLayout:u??"popup",supportsAlpha:i,value:a.value,viewProps:a.viewProps})}};function Sc(a){return z.isRgbaColorObject(a)}const Pc={id:"input-color-object",type:"input",accept:(a,i)=>{if(!z.isColorObject(a))return null;const o=Mr(i);return o?{initialValue:a,params:o}:null},binding:{reader:a=>cc,equals:z.equals,writer:a=>yc(Sc(a.initialValue))},controller:a=>{const i=z.isRgbaColorObject(a.initialValue),o="expanded"in a.params?a.params.expanded:void 0,u="picker"in a.params?a.params.picker:void 0,m=i?An:Or;return new Ur(a.document,{expanded:o??!1,formatter:m,parser:Tn,pickerLayout:u??"popup",supportsAlpha:i,value:a.value,viewProps:a.viewProps})}},Tc={id:"input-color-string",type:"input",accept:(a,i)=>{if(typeof a!="string"||"view"in i&&i.view==="text"||!Pn(a))return null;const u=Mr(i);return u?{initialValue:a,params:u}:null},binding:{reader:a=>Wu,equals:z.equals,writer:a=>{const i=Pn(a.initialValue);if(!i)throw v.shouldNeverHappen();return gc(i)}},controller:a=>{const i=Pn(a.initialValue);if(!i)throw v.shouldNeverHappen();const o=Uo(i),u="expanded"in a.params?a.params.expanded:void 0,m="picker"in a.params?a.params.picker:void 0;return new Ur(a.document,{expanded:u??!1,formatter:o,parser:Tn,pickerLayout:m??"popup",supportsAlpha:$u(i),value:a.value,viewProps:a.viewProps})}};class ct{constructor(i){this.components=i.components,this.asm_=i.assembly}constrain(i){const o=this.asm_.toComponents(i).map((u,m)=>{var y,E;return(E=(y=this.components[m])===null||y===void 0?void 0:y.constrain(u))!==null&&E!==void 0?E:u});return this.asm_.fromComponents(o)}}const No=C("pndtxt");class Ac{constructor(i,o){this.textViews=o.textViews,this.element=i.createElement("div"),this.element.classList.add(No()),this.textViews.forEach(u=>{const m=i.createElement("div");m.classList.add(No("a")),m.appendChild(u.element),this.element.appendChild(m)})}}function Mc(a,i,o){return new Fi(a,{arrayPosition:o===0?"fst":o===i.axes.length-1?"lst":"mid",baseStep:i.axes[o].baseStep,parser:i.parser,props:i.axes[o].textProps,value:F(0,{constraint:i.axes[o].constraint}),viewProps:i.viewProps})}class Nr{constructor(i,o){this.value=o.value,this.viewProps=o.viewProps,this.acs_=o.axes.map((u,m)=>Mc(i,o,m)),this.acs_.forEach((u,m)=>{Ni({primary:this.value,secondary:u.value,forward:y=>o.assembly.toComponents(y.rawValue)[m],backward:(y,E)=>{const D=o.assembly.toComponents(y.rawValue);return D[m]=E.rawValue,o.assembly.fromComponents(D)}})}),this.view=new Ac(i,{textViews:this.acs_.map(u=>u.view)})}}function kc(a){return"step"in a&&!f(a.step)?new Ot(a.step):null}function Oc(a){return"max"in a&&!f(a.max)||"min"in a&&!f(a.min)?new ke({max:a.max,min:a.min}):null}function Rc(a){const i=[],o=kc(a);o&&i.push(o);const u=Oc(a);u&&i.push(u);const m=Tr(a.options);return m&&i.push(m),new kt(i)}function Dc(a){const i=a?Ye(a,ke):null;return i?[i.minValue,i.maxValue]:[void 0,void 0]}function Lc(a){const[i,o]=Dc(a);return[i??0,o??100]}const Ic={id:"input-number",type:"input",accept:(a,i)=>{if(typeof a!="number")return null;const o=$,u=W(i,{format:o.optional.function,max:o.optional.number,min:o.optional.number,options:o.optional.custom(yn),step:o.optional.number});return u?{initialValue:a,params:u}:null},binding:{reader:a=>Eo,constraint:a=>Rc(a.params),writer:a=>zi},controller:a=>{var i,o;const u=a.value,m=a.constraint;if(m&&Ye(m,Li))return new Ii(a.document,{props:L.fromObject({options:(i=Ar(m))!==null&&i!==void 0?i:[]}),value:u,viewProps:a.viewProps});const y=(o="format"in a.params?a.params.format:void 0)!==null&&o!==void 0?o:Ce(Cn(m,u.rawValue));if(m&&Ye(m,ke)){const[E,D]=Lc(m);return new Pr(a.document,{baseStep:ei(m),parser:et,sliderProps:L.fromObject({maxValue:D,minValue:E}),textProps:L.fromObject({draggingScale:ti(m,u.rawValue),formatter:y}),value:u,viewProps:a.viewProps})}return new Fi(a.document,{baseStep:ei(m),parser:et,props:L.fromObject({draggingScale:ti(m,u.rawValue),formatter:y}),value:u,viewProps:a.viewProps})}};class dt{constructor(i=0,o=0){this.x=i,this.y=o}getComponents(){return[this.x,this.y]}static isObject(i){if(f(i))return!1;const o=i.x,u=i.y;return!(typeof o!="number"||typeof u!="number")}static equals(i,o){return i.x===o.x&&i.y===o.y}toObject(){return{x:this.x,y:this.y}}}const Vo={toComponents:a=>a.getComponents(),fromComponents:a=>new dt(...a)},ri=C("p2d");class Uc{constructor(i,o){this.element=i.createElement("div"),this.element.classList.add(ri()),o.viewProps.bindClassModifiers(this.element),T(o.expanded,k(this.element,ri(void 0,"expanded")));const u=i.createElement("div");u.classList.add(ri("h")),this.element.appendChild(u);const m=i.createElement("button");m.classList.add(ri("b")),m.appendChild(_n(i,"p2dpad")),o.viewProps.bindDisabled(m),u.appendChild(m),this.buttonElement=m;const y=i.createElement("div");if(y.classList.add(ri("t")),u.appendChild(y),this.textElement=y,o.pickerLayout==="inline"){const E=i.createElement("div");E.classList.add(ri("p")),this.element.appendChild(E),this.pickerElement=E}else this.pickerElement=null}}const pt=C("p2dp");class Bc{constructor(i,o){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=o.invertsY,this.maxValue_=o.maxValue,this.element=i.createElement("div"),this.element.classList.add(pt()),o.layout==="popup"&&this.element.classList.add(pt(void 0,"p"));const u=i.createElement("div");u.classList.add(pt("p")),o.viewProps.bindTabIndex(u),this.element.appendChild(u),this.padElement=u;const m=i.createElementNS(We,"svg");m.classList.add(pt("g")),this.padElement.appendChild(m),this.svgElem_=m;const y=i.createElementNS(We,"line");y.classList.add(pt("ax")),y.setAttributeNS(null,"x1","0"),y.setAttributeNS(null,"y1","50%"),y.setAttributeNS(null,"x2","100%"),y.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(y);const E=i.createElementNS(We,"line");E.classList.add(pt("ax")),E.setAttributeNS(null,"x1","50%"),E.setAttributeNS(null,"y1","0"),E.setAttributeNS(null,"x2","50%"),E.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(E);const D=i.createElementNS(We,"line");D.classList.add(pt("l")),D.setAttributeNS(null,"x1","50%"),D.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(D),this.lineElem_=D;const B=i.createElement("div");B.classList.add(pt("m")),this.padElement.appendChild(B),this.markerElem_=B,o.value.emitter.on("change",this.onValueChange_),this.value=o.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[i,o]=this.value.rawValue.getComponents(),u=this.maxValue_,m=re(i,-u,+u,0,100),y=re(o,-u,+u,0,100),E=this.invertsY_?100-y:y;this.lineElem_.setAttributeNS(null,"x2",`${m}%`),this.lineElem_.setAttributeNS(null,"y2",`${E}%`),this.markerElem_.style.left=`${m}%`,this.markerElem_.style.top=`${E}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function Fo(a,i,o){return[Ee(i[0],tt(a)),Ee(i[1],Vi(a))*(o?1:-1)]}class Nc{constructor(i,o){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=o.value,this.viewProps=o.viewProps,this.baseSteps_=o.baseSteps,this.maxValue_=o.maxValue,this.invertsY_=o.invertsY,this.view=new Bc(i,{invertsY:this.invertsY_,layout:o.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Rt(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(i,o){if(!i.point)return;const u=this.maxValue_,m=re(i.point.x,0,i.bounds.width,-u,+u),y=re(this.invertsY_?i.bounds.height-i.point.y:i.point.y,0,i.bounds.height,-u,+u);this.value.setRawValue(new dt(m,y),o)}onPointerDown_(i){this.handlePointerEvent_(i.data,{forceEmit:!1,last:!1})}onPointerMove_(i){this.handlePointerEvent_(i.data,{forceEmit:!1,last:!1})}onPointerUp_(i){this.handlePointerEvent_(i.data,{forceEmit:!0,last:!0})}onPadKeyDown_(i){To(i.key)&&i.preventDefault();const[o,u]=Fo(i,this.baseSteps_,this.invertsY_);o===0&&u===0||this.value.setRawValue(new dt(this.value.rawValue.x+o,this.value.rawValue.y+u),{forceEmit:!1,last:!1})}onPadKeyUp_(i){const[o,u]=Fo(i,this.baseSteps_,this.invertsY_);o===0&&u===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Vc{constructor(i,o){var u,m;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=o.value,this.viewProps=o.viewProps,this.foldable_=ki.create(o.expanded),this.popC_=o.pickerLayout==="popup"?new vo(i,{viewProps:this.viewProps}):null;const y=new Nc(i,{baseSteps:[o.axes[0].baseStep,o.axes[1].baseStep],invertsY:o.invertsY,layout:o.pickerLayout,maxValue:o.maxValue,value:this.value,viewProps:this.viewProps});y.view.allFocusableElements.forEach(E=>{E.addEventListener("blur",this.onPopupChildBlur_),E.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=y,this.textC_=new Nr(i,{assembly:Vo,axes:o.axes,parser:o.parser,value:this.value,viewProps:this.viewProps}),this.view=new Uc(i,{expanded:this.foldable_.value("expanded"),pickerLayout:o.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(u=this.view.buttonElement)===null||u===void 0||u.addEventListener("blur",this.onPadButtonBlur_),(m=this.view.buttonElement)===null||m===void 0||m.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Ni({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:E=>E.rawValue,backward:(E,D)=>D.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),hr(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(i){if(!this.popC_)return;const o=this.view.element,u=i.relatedTarget;(!u||!o.contains(u))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(i){if(!this.popC_)return;const o=this.popC_.view.element,u=to(i);u&&o.contains(u)||u&&u===this.view.buttonElement&&!lr(o.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(i){this.popC_?i.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&i.key==="Escape"&&this.view.buttonElement.focus()}}function Fc(a){return dt.isObject(a)?new dt(a.x,a.y):new dt}function zc(a,i){a.writeProperty("x",i.x),a.writeProperty("y",i.y)}function zo(a){if(!a)return;const i=[];return f(a.step)||i.push(new Ot(a.step)),(!f(a.max)||!f(a.min))&&i.push(new ke({max:a.max,min:a.min})),new kt(i)}function Hc(a){return new ct({assembly:Vo,components:[zo("x"in a?a.x:void 0),zo("y"in a?a.y:void 0)]})}function Ho(a,i){const o=a&&Ye(a,ke);if(o)return Math.max(Math.abs(o.minValue||0),Math.abs(o.maxValue||0));const u=ei(a);return Math.max(Math.abs(u)*10,Math.abs(i)*10)}function jc(a,i){const o=i instanceof ct?i.components[0]:void 0,u=i instanceof ct?i.components[1]:void 0,m=Ho(o,a.x),y=Ho(u,a.y);return Math.max(m,y)}function jo(a,i){return{baseStep:ei(i),constraint:i,textProps:L.fromObject({draggingScale:ti(i,a),formatter:Ce(Cn(i,a))})}}function Gc(a){if(!("y"in a))return!1;const i=a.y;return i&&"inverted"in i?!!i.inverted:!1}const Kc={id:"input-point2d",type:"input",accept:(a,i)=>{if(!dt.isObject(a))return null;const o=$,u=W(i,{expanded:o.optional.boolean,picker:o.optional.custom(Mo),x:o.optional.custom(ht),y:o.optional.object({inverted:o.optional.boolean,max:o.optional.number,min:o.optional.number,step:o.optional.number})});return u?{initialValue:a,params:u}:null},binding:{reader:a=>Fc,constraint:a=>Hc(a.params),equals:dt.equals,writer:a=>zc},controller:a=>{const i=a.document,o=a.value,u=a.constraint;if(!(u instanceof ct))throw v.shouldNeverHappen();const m="expanded"in a.params?a.params.expanded:void 0,y="picker"in a.params?a.params.picker:void 0;return new Vc(i,{axes:[jo(o.rawValue.x,u.components[0]),jo(o.rawValue.y,u.components[1])],expanded:m??!1,invertsY:Gc(a.params),maxValue:jc(o.rawValue,u),parser:et,pickerLayout:y??"popup",value:o,viewProps:a.viewProps})}};class si{constructor(i=0,o=0,u=0){this.x=i,this.y=o,this.z=u}getComponents(){return[this.x,this.y,this.z]}static isObject(i){if(f(i))return!1;const o=i.x,u=i.y,m=i.z;return!(typeof o!="number"||typeof u!="number"||typeof m!="number")}static equals(i,o){return i.x===o.x&&i.y===o.y&&i.z===o.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const Go={toComponents:a=>a.getComponents(),fromComponents:a=>new si(...a)};function $c(a){return si.isObject(a)?new si(a.x,a.y,a.z):new si}function Wc(a,i){a.writeProperty("x",i.x),a.writeProperty("y",i.y),a.writeProperty("z",i.z)}function Vr(a){if(!a)return;const i=[];return f(a.step)||i.push(new Ot(a.step)),(!f(a.max)||!f(a.min))&&i.push(new ke({max:a.max,min:a.min})),new kt(i)}function qc(a){return new ct({assembly:Go,components:[Vr("x"in a?a.x:void 0),Vr("y"in a?a.y:void 0),Vr("z"in a?a.z:void 0)]})}function Fr(a,i){return{baseStep:ei(i),constraint:i,textProps:L.fromObject({draggingScale:ti(i,a),formatter:Ce(Cn(i,a))})}}const Yc={id:"input-point3d",type:"input",accept:(a,i)=>{if(!si.isObject(a))return null;const o=$,u=W(i,{x:o.optional.custom(ht),y:o.optional.custom(ht),z:o.optional.custom(ht)});return u?{initialValue:a,params:u}:null},binding:{reader:a=>$c,constraint:a=>qc(a.params),equals:si.equals,writer:a=>Wc},controller:a=>{const i=a.value,o=a.constraint;if(!(o instanceof ct))throw v.shouldNeverHappen();return new Nr(a.document,{assembly:Go,axes:[Fr(i.rawValue.x,o.components[0]),Fr(i.rawValue.y,o.components[1]),Fr(i.rawValue.z,o.components[2])],parser:et,value:i,viewProps:a.viewProps})}};class oi{constructor(i=0,o=0,u=0,m=0){this.x=i,this.y=o,this.z=u,this.w=m}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(i){if(f(i))return!1;const o=i.x,u=i.y,m=i.z,y=i.w;return!(typeof o!="number"||typeof u!="number"||typeof m!="number"||typeof y!="number")}static equals(i,o){return i.x===o.x&&i.y===o.y&&i.z===o.z&&i.w===o.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const Ko={toComponents:a=>a.getComponents(),fromComponents:a=>new oi(...a)};function Xc(a){return oi.isObject(a)?new oi(a.x,a.y,a.z,a.w):new oi}function Zc(a,i){a.writeProperty("x",i.x),a.writeProperty("y",i.y),a.writeProperty("z",i.z),a.writeProperty("w",i.w)}function kn(a){if(!a)return;const i=[];return f(a.step)||i.push(new Ot(a.step)),(!f(a.max)||!f(a.min))&&i.push(new ke({max:a.max,min:a.min})),new kt(i)}function Qc(a){return new ct({assembly:Ko,components:[kn("x"in a?a.x:void 0),kn("y"in a?a.y:void 0),kn("z"in a?a.z:void 0),kn("w"in a?a.w:void 0)]})}function Jc(a,i){return{baseStep:ei(i),constraint:i,textProps:L.fromObject({draggingScale:ti(i,a),formatter:Ce(Cn(i,a))})}}const ed={id:"input-point4d",type:"input",accept:(a,i)=>{if(!oi.isObject(a))return null;const o=$,u=W(i,{x:o.optional.custom(ht),y:o.optional.custom(ht),z:o.optional.custom(ht),w:o.optional.custom(ht)});return u?{initialValue:a,params:u}:null},binding:{reader:a=>Xc,constraint:a=>Qc(a.params),equals:oi.equals,writer:a=>Zc},controller:a=>{const i=a.value,o=a.constraint;if(!(o instanceof ct))throw v.shouldNeverHappen();return new Nr(a.document,{assembly:Ko,axes:i.rawValue.getComponents().map((u,m)=>Jc(u,o.components[m])),parser:et,value:i,viewProps:a.viewProps})}};function td(a){const i=[],o=Tr(a.options);return o&&i.push(o),new kt(i)}const id={id:"input-string",type:"input",accept:(a,i)=>{if(typeof a!="string")return null;const u=W(i,{options:$.optional.custom(yn)});return u?{initialValue:a,params:u}:null},binding:{reader:a=>So,constraint:a=>td(a.params),writer:a=>zi},controller:a=>{var i;const o=a.document,u=a.value,m=a.constraint;return m&&Ye(m,Li)?new Ii(o,{props:L.fromObject({options:(i=Ar(m))!==null&&i!==void 0?i:[]}),value:u,viewProps:a.viewProps}):new xn(o,{parser:y=>y,props:L.fromObject({formatter:wr}),value:u,viewProps:a.viewProps})}},ji={monitor:{defaultInterval:200,defaultLineCount:3}},$o=C("mll");class nd{constructor(i,o){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=o.formatter,this.element=i.createElement("div"),this.element.classList.add($o()),o.viewProps.bindClassModifiers(this.element);const u=i.createElement("textarea");u.classList.add($o("i")),u.style.height=`calc(var(--bld-us) * ${o.lineCount})`,u.readOnly=!0,o.viewProps.bindDisabled(u),this.element.appendChild(u),this.textareaElem_=u,o.value.emitter.on("change",this.onValueUpdate_),this.value=o.value,this.update_()}update_(){const i=this.textareaElem_,o=i.scrollTop===i.scrollHeight-i.clientHeight,u=[];this.value.rawValue.forEach(m=>{m!==void 0&&u.push(this.formatter_(m))}),i.textContent=u.join(`
`),o&&(i.scrollTop=i.scrollHeight)}onValueUpdate_(){this.update_()}}class zr{constructor(i,o){this.value=o.value,this.viewProps=o.viewProps,this.view=new nd(i,{formatter:o.formatter,lineCount:o.lineCount,value:this.value,viewProps:this.viewProps})}}const Wo=C("sgl");class rd{constructor(i,o){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=o.formatter,this.element=i.createElement("div"),this.element.classList.add(Wo()),o.viewProps.bindClassModifiers(this.element);const u=i.createElement("input");u.classList.add(Wo("i")),u.readOnly=!0,u.type="text",o.viewProps.bindDisabled(u),this.element.appendChild(u),this.inputElement=u,o.value.emitter.on("change",this.onValueUpdate_),this.value=o.value,this.update_()}update_(){const i=this.value.rawValue,o=i[i.length-1];this.inputElement.value=o!==void 0?this.formatter_(o):""}onValueUpdate_(){this.update_()}}class Hr{constructor(i,o){this.value=o.value,this.viewProps=o.viewProps,this.view=new rd(i,{formatter:o.formatter,value:this.value,viewProps:this.viewProps})}}const sd={id:"monitor-bool",type:"monitor",accept:(a,i)=>{if(typeof a!="boolean")return null;const u=W(i,{lineCount:$.optional.number});return u?{initialValue:a,params:u}:null},binding:{reader:a=>bo},controller:a=>{var i;return a.value.rawValue.length===1?new Hr(a.document,{formatter:xo,value:a.value,viewProps:a.viewProps}):new zr(a.document,{formatter:xo,lineCount:(i=a.params.lineCount)!==null&&i!==void 0?i:ji.monitor.defaultLineCount,value:a.value,viewProps:a.viewProps})}};class od{constructor(){this.emitter=new x,this.index_=-1}get index(){return this.index_}set index(i){this.index_!==i&&(this.index_=i,this.emitter.emit("change",{index:i,sender:this}))}}const ft=C("grl");class ad{constructor(i,o){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=i.createElement("div"),this.element.classList.add(ft()),o.viewProps.bindClassModifiers(this.element),this.formatter_=o.formatter,this.minValue_=o.minValue,this.maxValue_=o.maxValue,this.cursor_=o.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const u=i.createElementNS(We,"svg");u.classList.add(ft("g")),u.style.height=`calc(var(--bld-us) * ${o.lineCount})`,this.element.appendChild(u),this.svgElem_=u;const m=i.createElementNS(We,"polyline");this.svgElem_.appendChild(m),this.lineElem_=m;const y=i.createElement("div");y.classList.add(ft("t"),C("tt")()),this.element.appendChild(y),this.tooltipElem_=y,o.value.emitter.on("change",this.onValueUpdate_),this.value=o.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const i=this.svgElem_.getBoundingClientRect(),o=this.value.rawValue.length-1,u=this.minValue_,m=this.maxValue_,y=[];this.value.rawValue.forEach((q,X)=>{if(q===void 0)return;const It=re(X,0,o,0,i.width),Gi=re(q,u,m,i.height,0);y.push([It,Gi].join(","))}),this.lineElem_.setAttributeNS(null,"points",y.join(" "));const E=this.tooltipElem_,D=this.value.rawValue[this.cursor_.index];if(D===void 0){E.classList.remove(ft("t","a"));return}const B=re(this.cursor_.index,0,o,0,i.width),N=re(D,u,m,i.height,0);E.style.left=`${B}px`,E.style.top=`${N}px`,E.textContent=`${this.formatter_(D)}`,E.classList.contains(ft("t","a"))||(E.classList.add(ft("t","a"),ft("t","in")),mn(E),E.classList.remove(ft("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class ld{constructor(i,o){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.value=o.value,this.viewProps=o.viewProps,this.cursor_=new od,this.view=new ad(i,{cursor:this.cursor_,formatter:o.formatter,lineCount:o.lineCount,maxValue:o.maxValue,minValue:o.minValue,value:this.value,viewProps:this.viewProps}),!lr(i))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const u=new Rt(this.view.element);u.emitter.on("down",this.onGraphPointerDown_),u.emitter.on("move",this.onGraphPointerMove_),u.emitter.on("up",this.onGraphPointerUp_)}}onGraphMouseLeave_(){this.cursor_.index=-1}onGraphMouseMove_(i){const o=this.view.element.getBoundingClientRect();this.cursor_.index=Math.floor(re(i.offsetX,0,o.width,0,this.value.rawValue.length))}onGraphPointerDown_(i){this.onGraphPointerMove_(i)}onGraphPointerMove_(i){if(!i.data.point){this.cursor_.index=-1;return}this.cursor_.index=Math.floor(re(i.data.point.x,0,i.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.index=-1}}function jr(a){return"format"in a&&!f(a.format)?a.format:Ce(2)}function hd(a){var i;return a.value.rawValue.length===1?new Hr(a.document,{formatter:jr(a.params),value:a.value,viewProps:a.viewProps}):new zr(a.document,{formatter:jr(a.params),lineCount:(i=a.params.lineCount)!==null&&i!==void 0?i:ji.monitor.defaultLineCount,value:a.value,viewProps:a.viewProps})}function ud(a){var i,o,u;return new ld(a.document,{formatter:jr(a.params),lineCount:(i=a.params.lineCount)!==null&&i!==void 0?i:ji.monitor.defaultLineCount,maxValue:(o="max"in a.params?a.params.max:null)!==null&&o!==void 0?o:100,minValue:(u="min"in a.params?a.params.min:null)!==null&&u!==void 0?u:0,value:a.value,viewProps:a.viewProps})}function qo(a){return"view"in a&&a.view==="graph"}const cd={id:"monitor-number",type:"monitor",accept:(a,i)=>{if(typeof a!="number")return null;const o=$,u=W(i,{format:o.optional.function,lineCount:o.optional.number,max:o.optional.number,min:o.optional.number,view:o.optional.string});return u?{initialValue:a,params:u}:null},binding:{defaultBufferSize:a=>qo(a)?64:1,reader:a=>Eo},controller:a=>qo(a.params)?ud(a):hd(a)},dd={id:"monitor-string",type:"monitor",accept:(a,i)=>{if(typeof a!="string")return null;const o=$,u=W(i,{lineCount:o.optional.number,multiline:o.optional.boolean});return u?{initialValue:a,params:u}:null},binding:{reader:a=>So},controller:a=>{var i;const o=a.value;return o.rawValue.length>1||"multiline"in a.params&&a.params.multiline?new zr(a.document,{formatter:wr,lineCount:(i=a.params.lineCount)!==null&&i!==void 0?i:ji.monitor.defaultLineCount,value:o,viewProps:a.viewProps}):new Hr(a.document,{formatter:wr,value:o,viewProps:a.viewProps})}};class pd{constructor(i){this.onValueChange_=this.onValueChange_.bind(this),this.reader=i.reader,this.writer=i.writer,this.emitter=new x,this.value=i.value,this.value.emitter.on("change",this.onValueChange_),this.target=i.target,this.read()}read(){const i=this.target.read();i!==void 0&&(this.value.rawValue=this.reader(i))}write_(i){this.writer(this.target,i)}onValueChange_(i){this.write_(i.rawValue),this.emitter.emit("change",{options:i.options,rawValue:i.rawValue,sender:this})}}function fd(a,i){const o=a.accept(i.target.read(),i.params);if(f(o))return null;const u=$,m={target:i.target,initialValue:o.initialValue,params:o.params},y=a.binding.reader(m),E=a.binding.constraint?a.binding.constraint(m):void 0,D=F(y(o.initialValue),{constraint:E,equals:a.binding.equals}),B=new pd({reader:y,target:i.target,value:D,writer:a.binding.writer(m)}),N=u.optional.boolean(i.params.disabled).value,q=u.optional.boolean(i.params.hidden).value,X=a.controller({constraint:E,document:i.document,initialValue:o.initialValue,params:o.params,value:B.value,viewProps:lt.create({disabled:N,hidden:q})}),It=u.optional.string(i.params.label).value;return new qe(i.document,{binding:B,blade:Mi(),props:L.fromObject({label:It||i.target.key}),valueController:X})}class md{constructor(i){this.onTick_=this.onTick_.bind(this),this.reader_=i.reader,this.target=i.target,this.emitter=new x,this.value=i.value,this.ticker=i.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const i=this.target.read();if(i===void 0)return;const o=this.value.rawValue,u=this.reader_(i);this.value.rawValue=Eu(o,u),this.emitter.emit("update",{rawValue:u,sender:this})}onTick_(i){this.read()}}function _d(a,i){return i===0?new Hh:new jh(a,i??ji.monitor.defaultInterval)}function vd(a,i){var o,u,m;const y=$,E=a.accept(i.target.read(),i.params);if(f(E))return null;const D={target:i.target,initialValue:E.initialValue,params:E.params},B=a.binding.reader(D),N=(u=(o=y.optional.number(i.params.bufferSize).value)!==null&&o!==void 0?o:a.binding.defaultBufferSize&&a.binding.defaultBufferSize(E.params))!==null&&u!==void 0?u:1,q=y.optional.number(i.params.interval).value,X=new md({reader:B,target:i.target,ticker:_d(i.document,q),value:yu(N)}),It=y.optional.boolean(i.params.disabled).value,Gi=y.optional.boolean(i.params.hidden).value,Ki=a.controller({document:i.document,params:E.params,value:X.value,viewProps:lt.create({disabled:It,hidden:Gi})}),ai=(m=y.optional.string(i.params.label).value)!==null&&m!==void 0?m:i.target.key;return new at(i.document,{binding:X,blade:Mi(),props:L.fromObject({label:ai}),valueController:Ki})}class gd{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(i){i.type==="blade"?this.pluginsMap_.blades.unshift(i):i.type==="input"?this.pluginsMap_.inputs.unshift(i):i.type==="monitor"&&this.pluginsMap_.monitors.unshift(i)}createInput(i,o,u){const m=o.read();if(f(m))throw new v({context:{key:o.key},type:"nomatchingcontroller"});const y=this.pluginsMap_.inputs.reduce((E,D)=>E||fd(D,{document:i,target:o,params:u}),null);if(y)return y;throw new v({context:{key:o.key},type:"nomatchingcontroller"})}createMonitor(i,o,u){const m=this.pluginsMap_.monitors.reduce((y,E)=>y||vd(E,{document:i,params:u,target:o}),null);if(m)return m;throw new v({context:{key:o.key},type:"nomatchingcontroller"})}createBlade(i,o){const u=this.pluginsMap_.blades.reduce((m,y)=>m||zh(y,{document:i,params:o}),null);if(!u)throw new v({type:"nomatchingview",context:{params:o}});return u}createBladeApi(i){if(i instanceof qe)return new dr(i);if(i instanceof at)return new pr(i);if(i instanceof Ri)return new gn(i,this);const o=this.pluginsMap_.blades.reduce((u,m)=>u||m.api({controller:i,pool:this}),null);if(!o)throw v.shouldNeverHappen();return o}}function bd(){const a=new gd;return[Kc,Yc,ed,id,Ic,Tc,Pc,Ec,Lu,sd,dd,cd,xh,Lh,Uh,mo].forEach(i=>{a.register(i)}),a}class Yo extends s{constructor(i){super(i),this.emitter_=new x,this.controller_.valueController.value.emitter.on("change",o=>{this.emitter_.emit("change",{event:new h(this,o.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(i){this.controller_.props.set("label",i)}get options(){return this.controller_.valueController.props.get("options")}set options(i){this.controller_.valueController.props.set("options",i)}get value(){return this.controller_.valueController.value.rawValue}set value(i){this.controller_.valueController.value.rawValue=i}on(i,o){const u=o.bind(this);return this.emitter_.on(i,m=>{u(m.event)}),this}}class Xo extends s{constructor(i){super(i),this.emitter_=new x,this.controller_.valueController.value.emitter.on("change",o=>{this.emitter_.emit("change",{event:new h(this,o.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(i){this.controller_.props.set("label",i)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(i){this.controller_.valueController.sliderController.props.set("maxValue",i)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(i){this.controller_.valueController.sliderController.props.set("minValue",i)}get value(){return this.controller_.valueController.value.rawValue}set value(i){this.controller_.valueController.value.rawValue=i}on(i,o){const u=o.bind(this);return this.emitter_.on(i,m=>{u(m.event)}),this}}class Zo extends s{constructor(i){super(i),this.emitter_=new x,this.controller_.valueController.value.emitter.on("change",o=>{this.emitter_.emit("change",{event:new h(this,o.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(i){this.controller_.props.set("label",i)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(i){this.controller_.valueController.props.set("formatter",i)}get value(){return this.controller_.valueController.value.rawValue}set value(i){this.controller_.valueController.value.rawValue=i}on(i,o){const u=o.bind(this);return this.emitter_.on(i,m=>{u(m.event)}),this}}const xd=(function(){return{id:"list",type:"blade",accept(a){const i=$,o=W(a,{options:i.required.custom(yn),value:i.required.raw,view:i.required.constant("list"),label:i.optional.string});return o?{params:o}:null},controller(a){const i=new Ii(a.document,{props:L.fromObject({options:ko(a.params.options)}),value:F(a.params.value),viewProps:a.viewProps});return new Jt(a.document,{blade:a.blade,props:L.fromObject({label:a.params.label}),valueController:i})},api(a){return!(a.controller instanceof Jt)||!(a.controller.valueController instanceof Ii)?null:new Yo(a.controller)}}})();function wd(a){return a.reduce((i,o)=>Object.assign(i,{[o.presetKey]:o.read()}),{})}function yd(a,i){a.forEach(o=>{const u=i[o.presetKey];u!==void 0&&o.write(u)})}class Cd extends fr{constructor(i,o){super(i,o)}get element(){return this.controller_.view.element}importPreset(i){const o=this.controller_.rackController.rack.find(qe).map(u=>u.binding.target);yd(o,i),this.refresh()}exportPreset(){const i=this.controller_.rackController.rack.find(qe).map(o=>o.binding.target);return wd(i)}refresh(){this.controller_.rackController.rack.find(qe).forEach(i=>{i.binding.read()}),this.controller_.rackController.rack.find(at).forEach(i=>{i.binding.read()})}}class Ed extends vr{constructor(i,o){super(i,{expanded:o.expanded,blade:o.blade,props:o.props,root:!0,viewProps:o.viewProps})}}const Sd={id:"slider",type:"blade",accept(a){const i=$,o=W(a,{max:i.required.number,min:i.required.number,view:i.required.constant("slider"),format:i.optional.function,label:i.optional.string,value:i.optional.number});return o?{params:o}:null},controller(a){var i,o;const u=(i=a.params.value)!==null&&i!==void 0?i:0,m=new Pr(a.document,{baseStep:1,parser:et,sliderProps:L.fromObject({maxValue:a.params.max,minValue:a.params.min}),textProps:L.fromObject({draggingScale:ti(void 0,u),formatter:(o=a.params.format)!==null&&o!==void 0?o:xu}),value:F(u),viewProps:a.viewProps});return new Jt(a.document,{blade:a.blade,props:L.fromObject({label:a.params.label}),valueController:m})},api(a){return!(a.controller instanceof Jt)||!(a.controller.valueController instanceof Pr)?null:new Xo(a.controller)}},Pd=(function(){return{id:"text",type:"blade",accept(a){const i=$,o=W(a,{parse:i.required.function,value:i.required.raw,view:i.required.constant("text"),format:i.optional.function,label:i.optional.string});return o?{params:o}:null},controller(a){var i;const o=new xn(a.document,{parser:a.params.parse,props:L.fromObject({formatter:(i=a.params.format)!==null&&i!==void 0?i:(u=>String(u))}),value:F(a.params.value),viewProps:a.viewProps});return new Jt(a.document,{blade:a.blade,props:L.fromObject({label:a.params.label}),valueController:o})},api(a){return!(a.controller instanceof Jt)||!(a.controller.valueController instanceof xn)?null:new Zo(a.controller)}}})();function Td(a){const i=a.createElement("div");return i.classList.add(C("dfw")()),a.body&&a.body.appendChild(i),i}function Qo(a,i,o){if(a.querySelector(`style[data-tp-style=${i}]`))return;const u=a.createElement("style");u.dataset.tpStyle=i,u.textContent=o,a.head.appendChild(u)}class Ad extends Cd{constructor(i){var o;const u=i||{},m=(o=u.document)!==null&&o!==void 0?o:mh(),y=bd(),E=new Ed(m,{expanded:u.expanded,blade:Mi(),props:L.fromObject({title:u.title}),viewProps:lt.create()});super(E,y),this.pool_=y,this.containerElem_=u.container||Td(m),this.containerElem_.appendChild(this.element),this.doc_=m,this.usesDefaultWrapper_=!u.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw v.alreadyDisposed();return this.doc_}dispose(){const i=this.containerElem_;if(!i)throw v.alreadyDisposed();if(this.usesDefaultWrapper_){const o=i.parentElement;o&&o.removeChild(i)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(i){("plugin"in i?[i.plugin]:"plugins"in i?i.plugins:[]).forEach(u=>{this.pool_.register(u),this.embedPluginStyle_(u)})}embedPluginStyle_(i){i.css&&Qo(this.document,`plugin-${i.id}`,i.css)}setUpDefaultPlugins_(){Qo(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor transparent;scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:transparent}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:transparent solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, #28292e);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, #adafb8);--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, #28292e);--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, #bbbcc4);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, #bbbcc4);--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_i,.tp-fldv_c>.tp-tabv>.tp-tabv_i{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a:before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_c{border-left:var(--cnt-bg) solid 4px}.tp-fldv_b:hover+.tp-fldv_c{border-left-color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_c{border-left-color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_c{border-left-color:var(--cnt-bg-a)}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv.tp-v-disabled{opacity:.5}.tp-tabv_i{align-items:flex-end;display:flex;overflow:hidden}.tp-tabv.tp-tabv-nop .tp-tabv_i{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_i::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{border-left:var(--cnt-bg) solid 4px;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p)}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:-2px;position:absolute;width:2px}.tp-tbiv_b{background-color:var(--cnt-bg);display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);width:100%}.tp-tbiv_b:hover{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active{background-color:var(--cnt-bg-a)}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) transparent transparent transparent;border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c,.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_i{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach(i=>{this.embedPluginStyle_(i)}),this.registerPlugin({plugins:[Sd,xd,mo,Pd]})}}const Md=new n("3.0.8");t.BladeApi=s,t.ButtonApi=b,t.FolderApi=fr,t.InputBindingApi=dr,t.ListApi=Yo,t.MonitorBindingApi=pr,t.Pane=Ad,t.SeparatorApi=oo,t.SliderApi=Xo,t.TabApi=po,t.TabPageApi=co,t.TextApi=Zo,t.TpChangeEvent=h,t.VERSION=Md,Object.defineProperty(t,"__esModule",{value:!0})}))})(Qi,Qi.exports)),Qi.exports}var Rf=Of();function Qr(r,e,t){t[0]=r[0]>e[0]?e[0]:r[0],t[1]=r[1]<e[1]?e[1]:r[1],t[2]=r[2]>e[2]?e[2]:r[2],t[3]=r[3]<e[3]?e[3]:r[3],t[4]=r[4]>e[4]?e[4]:r[4],t[5]=r[5]<e[5]?e[5]:r[5]}function Df(r,e,t){let n=!1;const s=r[0]>e[0]?e[0]:r[0],l=r[1]<e[1]?e[1]:r[1],h=r[2]>e[2]?e[2]:r[2],c=r[3]<e[3]?e[3]:r[3],p=r[4]>e[4]?e[4]:r[4],d=r[5]<e[5]?e[5]:r[5];return t[0]>s&&(t[0]=s,n=!0),t[1]<l&&(t[1]=l,n=!0),t[2]>h&&(t[2]=h,n=!0),t[3]<c&&(t[3]=c,n=!0),t[4]>p&&(t[4]=p,n=!0),t[5]<d&&(t[5]=d,n=!0),n}function Lf(r,e){return!(e[0]>r[0]||e[1]<r[1]||e[2]>r[2]||e[3]<r[3]||e[4]>r[4]||e[5]<r[5])}function If(r,e){let t=!1;return e[0]>r[0]&&(e[0]=r[0],t=!0),e[1]<r[1]&&(e[1]=r[1],t=!0),e[2]>r[2]&&(e[2]=r[2],t=!0),e[3]<r[3]&&(e[3]=r[3],t=!0),e[4]>r[4]&&(e[4]=r[4],t=!0),e[5]<r[5]&&(e[5]=r[5],t=!0),t}function Dn(r,e){r[0]-=e,r[1]+=e,r[2]-=e,r[3]+=e,r[4]-=e,r[5]+=e}function hi(r){const e=r[1]-r[0],t=r[3]-r[2],n=r[5]-r[4];return 2*(e*t+t*n+n*e)}function Nt(r,e){const t=r[0]>e[0]?e[0]:r[0],n=r[1]<e[1]?e[1]:r[1],s=r[2]>e[2]?e[2]:r[2],l=r[3]<e[3]?e[3]:r[3],h=r[4]>e[4]?e[4]:r[4],c=r[5]<e[5]?e[5]:r[5],p=n-t,d=l-s,f=c-h;return 2*(p*d+d*f+f*p)}function Uf(r){const e=r[1]-r[0],t=r[3]-r[2],n=r[5]-r[4];return e>t?e>n?0:2:t>n?1:2}function Ji(r,e){const t=r[0]-e[0],n=e[0]-r[1];let s=t>n?t:n;s<0&&(s=0);const l=r[2]-e[1],h=e[1]-r[3];let c=l>h?l:h;c<0&&(c=0);const p=r[4]-e[2],d=e[2]-r[5];let f=p>d?p:d;return f<0&&(f=0),s*s+c*c+f*f}function Bf(r,e){let t,n,s,l,h,c;const p=r[0]-e[0],d=e[0]-r[1];p>d?(t=p,n=d):(t=d,n=p),t<0&&(t=0);const f=r[2]-e[1],_=e[1]-r[3];f>_?(s=f,l=_):(s=_,l=f),s<0&&(s=0);const g=r[4]-e[2],v=e[2]-r[5];return g>v?(h=g,c=v):(h=v,c=g),h<0&&(h=0),{min:t*t+s*s+h*h,max:n*n+l*l+c*c}}class Nf{constructor(){this.array=[]}clear(){this.array=[]}push(e){const t=this.array,n=e.inheritedCost,s=t.length>6?t.length-6:0;let l;for(l=t.length-1;l>=s&&!(n<=t[l].inheritedCost);l--);l>t.length-7&&t.splice(l+1,0,e)}pop(){return this.array.pop()}}class Vf{constructor(e=!1){this.root=null,this._sortedList=new Nf,this.count=0,this.highPrecision=e,this._typeArray=e?Float64Array:Float32Array}createFromArray(e,t,n,s=0){const l=t.length,h=this._typeArray;h!==(t[0].BYTES_PER_ELEMENT===4?Float32Array:Float64Array)&&console.warn("Different precision.");const c=new h(6);let p,d;this.root=f(0,l,null);function f(w,b,x){if(b===1){const M=t[w];s>0&&Dn(M,s);const T={box:M,object:e[w],parent:x};return n&&n(T),T}const S=_(w,b);g();let C=v(w,b);(C===w||C===w+b)&&(C=w+(b>>1));const P={box:S,parent:x};return P.left=f(w,C-w,P),P.right=f(C,b-C+w,P),P}function _(w,b){const x=new h(6),S=w+b;x[0]=1/0,x[1]=-1/0,x[2]=1/0,x[3]=-1/0,x[4]=1/0,x[5]=-1/0,c[0]=1/0,c[1]=-1/0,c[2]=1/0,c[3]=-1/0,c[4]=1/0,c[5]=-1/0;for(let C=w;C<S;C++){const P=t[C],M=P[0],T=P[1],A=P[2],R=P[3],k=P[4],O=P[5];x[0]>M&&(x[0]=M),x[1]<T&&(x[1]=T),x[2]>A&&(x[2]=A),x[3]<R&&(x[3]=R),x[4]>k&&(x[4]=k),x[5]<O&&(x[5]=O);const I=(T+M)*.5,V=(R+A)*.5,G=(O+k)*.5;c[0]>I&&(c[0]=I),c[1]<I&&(c[1]=I),c[2]>V&&(c[2]=V),c[3]<V&&(c[3]=V),c[4]>G&&(c[4]=G),c[5]<G&&(c[5]=G)}return x[0]-=s,x[1]+=s,x[2]-=s,x[3]+=s,x[4]-=s,x[5]+=s,x}function g(){p=Uf(c)*2,d=(c[p]+c[p+1])*.5}function v(w,b){let x=w,S=w+b-1;for(;x<=S;){const C=t[x];if((C[p+1]+C[p])*.5>=d)for(;;){const P=t[S];if((P[p+1]+P[p])*.5<d){const M=e[x];e[x]=e[S],e[S]=M;const T=t[x];t[x]=t[S],t[S]=T,S--;break}if(S--,S<=x)return x}x++}return x}}insert(e,t,n){n>0&&Dn(t,n);const s=this.createLeafNode(e,t);return this.root===null?this.root=s:this.insertLeaf(s),this.count++,s}insertRange(e,t,n,s){console.warn("Method not optimized yet. It just calls 'insert' N times.");const l=e.length,h=n>0?n:n?null:0;for(let c=0;c<l;c++){const p=this.insert(e[c],t[c],h??n[c]);s&&s(p)}}move(e,t){if(!e.parent||Lf(e.box,e.parent.box)){t>0&&Dn(e.box,t);return}t>0&&Dn(e.box,t);const n=this.delete(e);this.insertLeaf(e,n),this.count++}delete(e){const t=e.parent;if(t===null)return this.root=null,null;const n=t.parent,s=t.left===e?t.right:t.left;return s.parent=n,e.parent=null,n===null?(this.root=s,t):(n.left===t?n.left=s:n.right=s,this.refit(n),this.count--,t)}clear(){this.root=null}insertLeaf(e,t){const n=this.findBestSibling(e.box),s=n.parent;t===void 0?t=this.createInternalNode(s,n,e):(t.parent=s,t.left=n,t.right=e),n.parent=t,e.parent=t,s===null?this.root=t:s.left===n?s.left=t:s.right=t,this.refitAndRotate(e,n)}createLeafNode(e,t){return{box:t,object:e,parent:null}}createInternalNode(e,t,n){return{parent:e,left:t,right:n,box:new this._typeArray(6)}}findBestSibling(e){const t=this.root;let n=t,s=Nt(e,t.box);const l=hi(e);if(t.object!==void 0)return t;const h=this._sortedList;h.clear();let c={node:t,inheritedCost:s-hi(t.box)};do{const{node:p,inheritedCost:d}=c;if(l+d>=s)break;const f=p.left,_=p.right,g=Nt(e,f.box)+d,v=g-hi(f.box),w=Nt(e,_.box)+d,b=w-hi(_.box);if(g>w?s>w&&(n=_,s=w):s>g&&(n=f,s=g),b>v){if(l+v>=s||(f.object===void 0&&h.push({node:f,inheritedCost:v}),l+b>=s))continue;_.object===void 0&&h.push({node:_,inheritedCost:b})}else{if(l+b>=s||(_.object===void 0&&h.push({node:_,inheritedCost:b}),l+v>=s))continue;f.object===void 0&&h.push({node:f,inheritedCost:v})}}while(c=h.pop());return n}refit(e){for(Qr(e.left.box,e.right.box,e.box);e=e.parent;)if(!Df(e.left.box,e.right.box,e.box))return}refitAndRotate(e,t){const n=e.box;e=e.parent;const s=e.box;for(Qr(n,t.box,s);e=e.parent;){const l=e.box;if(!If(n,l))return;const h=e.left,c=e.right,p=h.box,d=c.box;let f=null,_=null,g=0;if(c.object===void 0){const v=c.left,w=c.right,b=hi(c.box),x=b-Nt(p,v.box),S=b-Nt(p,w.box);x>S?x>0&&(f=h,_=w,g=x):S>0&&(f=h,_=v,g=S)}if(h.object===void 0){const v=h.left,w=h.right,b=hi(h.box),x=b-Nt(d,v.box),S=b-Nt(d,w.box);x>S?x>g&&(f=c,_=w):S>g&&(f=c,_=v)}f!==null&&this.swap(f,_)}}swap(e,t){const n=e.parent,s=t.parent,l=s.box;n.left===e?n.left=t:n.right=t,s.left===t?s.left=e:s.right=e,e.parent=s,t.parent=n,Qr(s.left.box,s.right.box,l)}}const $s=0,Ff=1;class zf{constructor(e,t){this.coordinateSystem=t,this.array=e?new Float64Array(24):new Float32Array(24)}setFromProjectionMatrix(e){if(this.updatePlane(0,e[3]+e[0],e[7]+e[4],e[11]+e[8],e[15]+e[12]),this.updatePlane(1,e[3]-e[0],e[7]-e[4],e[11]-e[8],e[15]-e[12]),this.updatePlane(2,e[3]-e[1],e[7]-e[5],e[11]-e[9],e[15]-e[13]),this.updatePlane(3,e[3]+e[1],e[7]+e[5],e[11]+e[9],e[15]+e[13]),this.updatePlane(4,e[3]-e[2],e[7]-e[6],e[11]-e[10],e[15]-e[14]),this.coordinateSystem===$s)this.updatePlane(5,e[3]+e[2],e[7]+e[6],e[11]+e[10],e[15]+e[14]);else if(this.coordinateSystem===Ff)this.updatePlane(5,e[2],e[6],e[10],e[14]);else throw new Error("Invalid coordinate system: "+this.coordinateSystem);return this}updatePlane(e,t,n,s,l){const h=this.array,c=e*4,p=Math.sqrt(t*t+n*n+s*s);h[c+0]=t/p,h[c+1]=n/p,h[c+2]=s/p,h[c+3]=l/p}intersectsBoxMask(e,t){const n=this.array;let s,l,h,c,p,d;for(let f=0;f<6;f++){if(!(t&32>>f))continue;const _=f*4,g=n[_+0],v=n[_+1],w=n[_+2],b=n[_+3];if(g>0?(s=e[1],c=e[0]):(s=e[0],c=e[1]),v>0?(l=e[3],p=e[2]):(l=e[2],p=e[3]),w>0?(h=e[5],d=e[4]):(h=e[4],d=e[5]),g*s+v*l+w*h<-b)return-1;g*c+v*p+w*d>-b&&(t^=32>>f)}return t}isIntersected(e,t){const n=this.array;for(let s=0;s<6;s++){if(!(t&32>>s))continue;const l=s*4,h=n[l+0],c=n[l+1],p=n[l+2],d=n[l+3],f=h>0?e[1]:e[0],_=c>0?e[3]:e[2],g=p>0?e[5]:e[4];if(h*f+c*_+p*g<-d)return!1}return!0}isIntersectedMargin(e,t,n){if(t===0)return!0;const s=this.array;for(let l=0;l<6;l++){if(!(t&32>>l))continue;const h=l*4,c=s[h+0],p=s[h+1],d=s[h+2],f=s[h+3],_=c>0?e[1]-n:e[0]+n,g=p>0?e[3]-n:e[2]+n,v=d>0?e[5]-n:e[4]+n;if(c*_+p*g+d*v<-f)return!1}return!0}}function xa(r,e,t,n,s,l){let h=n[0],c=e[0],p=t[0],d=(r[h]-c)*p,f=(r[h^1]-c)*p,_=d>0?d:0,g=f<1/0?f:1/0;return h=n[1],c=e[1],p=t[1],d=(r[h+2]-c)*p,d>g||(f=(r[h^3]-c)*p,_>f)||(_=d>_?d:_,g=f<g?f:g,h=n[2],c=e[2],p=t[2],d=(r[h+4]-c)*p,d>g)||(f=(r[h^5]-c)*p,_>f)?!1:(_=d>_?d:_,g=f<g?f:g,_<=l&&g>=s)}function wa(r,e){return r[1]>=e[0]&&e[1]>=r[0]&&r[3]>=e[2]&&e[3]>=r[2]&&r[5]>=e[4]&&e[5]>=r[4]}function Hf(r,e,t){return Ji(t,r)<=e*e}class jf{constructor(e,t=$s){this._sign=new Uint8Array(3),this.builder=e;const n=e.highPrecision;this.frustum=new zf(n,t),this._dirInv=n?new Float64Array(3):new Float32Array(3)}get root(){return this.builder.root}createFromArray(e,t,n,s){e?.length>0&&this.builder.createFromArray(e,t,n,s)}insert(e,t,n){return this.builder.insert(e,t,n)}insertRange(e,t,n,s){e?.length>0&&this.builder.insertRange(e,t,n,s)}move(e,t){this.builder.move(e,t)}delete(e){return this.builder.delete(e)}clear(){this.builder.clear()}traverse(e){if(this.root===null)return;t(this.root,0);function t(n,s){if(n.object!==void 0){e(n,s);return}e(n,s)||(t(n.left,s+1),t(n.right,s+1))}}intersectsRay(e,t,n,s=0,l=1/0){if(this.root===null)return!1;const h=this._dirInv,c=this._sign;return h[0]=1/e[0],h[1]=1/e[1],h[2]=1/e[2],c[0]=h[0]<0?1:0,c[1]=h[1]<0?1:0,c[2]=h[2]<0?1:0,p(this.root);function p(d){return xa(d.box,t,h,c,s,l)?d.object!==void 0?n(d.object):p(d.left)||p(d.right):!1}}intersectsBox(e,t){if(this.root===null)return!1;return n(this.root);function n(s){return wa(e,s.box)?s.object!==void 0?t(s.object):n(s.left)||n(s.right):!1}}intersectsSphere(e,t,n){if(this.root===null)return!1;return s(this.root);function s(l){return Hf(e,t,l.box)?l.object!==void 0?n(l.object):s(l.left)||s(l.right):!1}}isNodeIntersected(e,t){const n=e.box;let s;for(;s=e.parent;){const h=s.left===e?s.right:s.left;if(l(h))return!0;e=s}return!1;function l(h){return wa(n,h.box)?h.object!==void 0?t(h.object):l(h.left)||l(h.right):!1}}rayIntersections(e,t,n,s=0,l=1/0){if(this.root===null)return;const h=this._dirInv,c=this._sign;h[0]=1/e[0],h[1]=1/e[1],h[2]=1/e[2],c[0]=h[0]<0?1:0,c[1]=h[1]<0?1:0,c[2]=h[2]<0?1:0,p(this.root);function p(d){if(xa(d.box,t,h,c,s,l)){if(d.object!==void 0){n(d.object);return}p(d.left),p(d.right)}}}frustumCulling(e,t){if(this.root===null)return;const n=this.frustum.setFromProjectionMatrix(e);s(this.root,63);function s(h,c){if(h.object!==void 0){n.isIntersected(h.box,c)&&t(h,n,c);return}if(c=n.intersectsBoxMask(h.box,c),!(c<0)){if(c===0){l(h.left),l(h.right);return}s(h.left,c),s(h.right,c)}}function l(h){if(h.object!==void 0){t(h,n,0);return}l(h.left),l(h.right)}}frustumCullingLOD(e,t,n,s){if(this.root===null)return;const l=this.frustum.setFromProjectionMatrix(e);h(this.root,63,null);function h(d,f,_){const g=d.box;if(_===null&&(_=p(g)),d.object!==void 0){l.isIntersected(g,f)&&s(d,_,l,f);return}if(f=l.intersectsBoxMask(g,f),!(f<0)){if(f===0){c(d.left,_),c(d.right,_);return}h(d.left,f,_),h(d.right,f,_)}}function c(d,f){if(f===null&&(f=p(d.box)),d.object!==void 0){s(d,f,l,0);return}c(d.left,f),c(d.right,f)}function p(d){const{min:f,max:_}=Bf(d,t);for(let g=n.length-1;g>0;g--)if(_>=n[g])return f>=n[g]?g:null;return 0}}closestPointToPoint(e,t){if(this.root===null)return;let n=1/0;return s(this.root),Math.sqrt(n);function s(l){if(l.object!==void 0){if(t){const p=t(l.object)??Ji(l.box,e);p<n&&(n=p)}else n=Ji(l.box,e);return}const h=Ji(l.left.box,e),c=Ji(l.right.box,e);h<c?h<n&&(s(l.left),c<n&&s(l.right)):c<n&&(s(l.right),h<n&&s(l.left))}}}function ya(r,e){return e[0]=r.x,e[1]=r.y,e[2]=r.z,e}function Ca(r,e){const t=r.min,n=r.max;return e[0]=t.x,e[1]=n.x,e[2]=t.y,e[3]=n.y,e[4]=t.z,e[5]=n.z,e}class nh{constructor(e,t,n){if(this.isInstanceEntity=!0,this.position=new se,this.scale=new se(1,1,1),this.quaternion=new Hn,this.id=t,this.owner=e,n){const s=this.quaternion,l=this.rotation=new Dd;l._onChange(()=>s.setFromEuler(l,!1)),s._onChange(()=>l.setFromQuaternion(s,void 0,!1))}}get visible(){return this.owner.getVisibilityAt(this.id)}set visible(e){this.owner.setVisibilityAt(this.id,e)}get active(){return this.owner.getActiveAt(this.id)}set active(e){this.owner.setActiveAt(this.id,e)}get color(){return this.owner.getColorAt(this.id)}set color(e){this.owner.setColorAt(this.id,e)}get opacity(){return this.owner.getOpacityAt(this.id)}set opacity(e){this.owner.setOpacityAt(this.id,e)}get morph(){return this.owner.getMorphAt(this.id)}set morph(e){this.owner.setMorphAt(this.id,e)}get matrix(){return this.owner.getMatrixAt(this.id)}get matrixWorld(){return this.matrix.premultiply(this.owner.matrixWorld)}setMatrixIdentity(){const e=this.owner,t=e.matricesTexture._data,n=this.id,s=n*16;t[s+0]=1,t[s+1]=0,t[s+2]=0,t[s+3]=0,t[s+4]=0,t[s+5]=1,t[s+6]=0,t[s+7]=0,t[s+8]=0,t[s+9]=0,t[s+10]=1,t[s+11]=0,t[s+12]=0,t[s+13]=0,t[s+14]=0,t[s+15]=1,e.matricesTexture.enqueueUpdate(n)}updateMatrix(){const e=this.owner,t=this.position,n=this.quaternion,s=this.scale,l=e.matricesTexture._data,h=this.id,c=h*16,p=n._x,d=n._y,f=n._z,_=n._w,g=p+p,v=d+d,w=f+f,b=p*g,x=p*v,S=p*w,C=d*v,P=d*w,M=f*w,T=_*g,A=_*v,R=_*w,k=s.x,O=s.y,I=s.z;l[c+0]=(1-(C+M))*k,l[c+1]=(x+R)*k,l[c+2]=(S-A)*k,l[c+3]=0,l[c+4]=(x-R)*O,l[c+5]=(1-(b+M))*O,l[c+6]=(P+T)*O,l[c+7]=0,l[c+8]=(S+A)*I,l[c+9]=(P-T)*I,l[c+10]=(1-(b+C))*I,l[c+11]=0,l[c+12]=t.x,l[c+13]=t.y,l[c+14]=t.z,l[c+15]=1,e.matricesTexture.enqueueUpdate(h),e.bvh&&e.autoUpdateBVH&&e.bvh.move(h)}updateMatrixPosition(){const e=this.owner,t=this.position,n=e.matricesTexture._data,s=this.id,l=s*16;n[l+12]=t.x,n[l+13]=t.y,n[l+14]=t.z,e.matricesTexture.enqueueUpdate(s),e.bvh&&e.autoUpdateBVH&&e.bvh.move(s)}getUniform(e,t){return this.owner.getUniformAt(this.id,e,t)}updateBones(e=!0,t){this.owner.setBonesAt(this.id,e,t)}setUniform(e,t){this.owner.setUniformAt(this.id,e,t)}copyTo(e){e.position.copy(this.position),e.scale.copy(this.scale),e.quaternion.copy(this.quaternion),this.rotation&&e.rotation.copy(this.rotation)}applyMatrix4(e){return this.matrix.premultiply(e).decompose(this.position,this.quaternion,this.scale),this}applyQuaternion(e){return this.quaternion.premultiply(e),this}rotateOnAxis(e,t){return Ln.setFromAxisAngle(e,t),this.quaternion.multiply(Ln),this}rotateOnWorldAxis(e,t){return Ln.setFromAxisAngle(e,t),this.quaternion.premultiply(Ln),this}rotateX(e){return this.rotateOnAxis(Sa,e)}rotateY(e){return this.rotateOnAxis(Pa,e)}rotateZ(e){return this.rotateOnAxis(Ta,e)}translateOnAxis(e,t){return Ea.copy(e).applyQuaternion(this.quaternion),this.position.add(Ea.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Sa,e)}translateY(e){return this.translateOnAxis(Pa,e)}translateZ(e){return this.translateOnAxis(Ta,e)}remove(){return this.owner.removeInstances(this.id),this}}const Ln=new Hn,Ea=new se,Sa=new se(1,0,0),Pa=new se(0,1,0),Ta=new se(0,0,1);class Gf{constructor(e,t=0,n=!1,s=!0){this.nodesMap=new Map,this.LODsMap=new Map,this._geoBoundingSphere=null,this._sphereTarget=null,this.target=e,this.accurateCulling=s,this._margin=t;const l=e._geometry;if(l.boundingBox||l.computeBoundingBox(),this.geoBoundingBox=l.boundingBox,n){l.boundingSphere||l.computeBoundingSphere();const h=l.boundingSphere.center;h.x===0&&h.y===0&&h.z===0?(this._geoBoundingSphere=l.boundingSphere,this._sphereTarget={centerX:0,centerY:0,centerZ:0,maxScale:0}):(console.warn('"getBoxFromSphere" is ignored because geometry is not centered.'),n=!1)}this.bvh=new jf(new Vf,$s),this._origin=new Float32Array(3),this._dir=new Float32Array(3),this._cameraPos=new Float32Array(3),this._getBoxFromSphere=n}create(){const e=this.target._instancesCount,t=this.target._instancesArrayCount,n=new Array(e),s=new Uint32Array(e);let l=0;this.clear();for(let h=0;h<t;h++)this.target.getActiveAt(h)&&(n[l]=this.getBox(h,new Float32Array(6)),s[l]=h,l++);this.bvh.createFromArray(s,n,h=>{this.nodesMap.set(h.object,h)},this._margin)}insert(e){const t=this.bvh.insert(e,this.getBox(e,new Float32Array(6)),this._margin);this.nodesMap.set(e,t)}insertRange(e){const t=e.length,n=new Array(t);for(let s=0;s<t;s++)n[s]=this.getBox(e[s],new Float32Array(6));this.bvh.insertRange(e,n,this._margin,s=>{this.nodesMap.set(s.object,s)})}move(e){const t=this.nodesMap.get(e);t&&(this.getBox(e,t.box),this.bvh.move(t,this._margin))}delete(e){const t=this.nodesMap.get(e);t&&(this.bvh.delete(t),this.nodesMap.delete(e))}clear(){this.bvh.clear(),this.nodesMap.clear()}frustumCulling(e,t){this._margin>0&&this.accurateCulling?this.bvh.frustumCulling(e.elements,(n,s,l)=>{s.isIntersectedMargin(n.box,l,this._margin)&&t(n)}):this.bvh.frustumCulling(e.elements,t)}frustumCullingLOD(e,t,n,s){this.LODsMap.has(n)||this.LODsMap.set(n,new Float32Array(n.length));const l=this.LODsMap.get(n);for(let c=0;c<n.length;c++)l[c]=n[c].distance;const h=this._cameraPos;h[0]=t.x,h[1]=t.y,h[2]=t.z,this._margin>0&&this.accurateCulling?this.bvh.frustumCullingLOD(e.elements,h,l,(c,p,d,f)=>{d.isIntersectedMargin(c.box,f,this._margin)&&s(c,p)}):this.bvh.frustumCullingLOD(e.elements,h,l,s)}raycast(e,t){const n=e.ray,s=this._origin,l=this._dir;ya(n.origin,s),ya(n.direction,l),this.bvh.rayIntersections(l,s,t,e.near,e.far)}intersectBox(e,t){this._boxArray||(this._boxArray=new Float32Array(6));const n=this._boxArray;return Ca(e,n),this.bvh.intersectsBox(n,t)}getBox(e,t){if(this._getBoxFromSphere){const n=this.target.matricesTexture._data,{centerX:s,centerY:l,centerZ:h,maxScale:c}=this.getSphereFromMatrix_centeredGeometry(e,n,this._sphereTarget),p=this._geoBoundingSphere.radius*c;t[0]=s-p,t[1]=s+p,t[2]=l-p,t[3]=l+p,t[4]=h-p,t[5]=h+p}else Aa.copy(this.geoBoundingBox).applyMatrix4(this.target.getMatrixAt(e)),Ca(Aa,t);return t}getSphereFromMatrix_centeredGeometry(e,t,n){const s=e*16,l=t[s+0],h=t[s+1],c=t[s+2],p=t[s+4],d=t[s+5],f=t[s+6],_=t[s+8],g=t[s+9],v=t[s+10],w=l*l+h*h+c*c,b=p*p+d*d+f*f,x=_*_+g*g+v*v;return n.maxScale=Math.sqrt(Math.max(w,b,x)),n.centerX=t[s+12],n.centerY=t[s+13],n.centerZ=t[s+14],n}}const Aa=new Ms;class Kf extends Ld{constructor(e,t,n,s,l,h=1){const c=e.createBuffer();super(c,t,n,s,l.length/n),this.isGLInstancedBufferAttribute=!0,this._needsUpdate=!1,this.isInstancedBufferAttribute=!0,this.meshPerAttribute=h,this.array=l,this._cacheArray=l,e.bindBuffer(e.ARRAY_BUFFER,c),e.bufferData(e.ARRAY_BUFFER,l,e.DYNAMIC_DRAW)}update(e,t){if(!this._needsUpdate||t===0)return;const n=e.getContext();n.bindBuffer(n.ARRAY_BUFFER,this.buffer),this.array===this._cacheArray?n.bufferSubData(n.ARRAY_BUFFER,0,this.array,0,t):(n.bufferData(n.ARRAY_BUFFER,this.array,n.DYNAMIC_DRAW),this._cacheArray=this.array),this._needsUpdate=!1}clone(){return this}}let or=null,Qn=null;const Jr={};function $f(r){var e;return((e=Qn.get(r))==null?void 0:e())??or(r)}function Wf(r){if(Qn.has(r))return;const e={};Qn.set(r,()=>{if(r.isMeshDistanceMaterial){const t=or(r);e.light=t.light}return e})}function qf(r,e,t){const n=e.properties;or=n.get;const s=`${!!r.colorsTexture}_${r._useOpacity}_${!!r.boneTexture}_${!!r.uniformsTexture}`;Jr[s]??(Jr[s]=new WeakMap),Qn=Jr[s],n.get=$f,Wf(t)}function Yf(r){r.properties.get=or}function rh(r,e){return Math.max(e,Math.ceil(Math.sqrt(r/e))*e)}function Xf(r,e,t,n){e===3&&(console.warn('"channels" cannot be 3. Set to 4. More info: https://github.com/mrdoob/three.js/pull/23228'),e=4);const s=rh(n,t),l=new r(s*s*e),h=r.name.includes("Float"),c=r.name.includes("Uint"),p=h?As:c?Za:Id;let d;switch(e){case 1:d=h?Ts:Fd;break;case 2:d=h?Nd:Vd;break;case 4:d=h?Ud:Bd;break}return{array:l,size:s,type:p,format:d}}class Jn extends Ps{constructor(e,t,n,s,l,h){t===3&&(t=4);const{array:c,format:p,size:d,type:f}=Xf(e,t,n,s);super(c,d,d,p,f),this.partialUpdate=!0,this.maxUpdateCalls=1/0,this._utils=null,this._needsUpdate=!0,this._lastWidth=-1,this._data=c,this._channels=t,this._pixelsPerInstance=n,this._stride=n*t,this._rowToUpdate=new Array(d),this._uniformMap=l,this._fetchUniformsInFragmentShader=h,this.needsUpdate=!0}resize(e){const t=rh(e,this._pixelsPerInstance);if(t===this.image.width)return;const n=this._data,s=this._channels;this._rowToUpdate.length=t;const l=n.constructor,h=new l(t*t*s),c=Math.min(n.length,h.length);h.set(new l(n.buffer,0,c)),this.dispose(),this.image={data:h,height:t,width:t},this._data=h}enqueueUpdate(e){if(this._needsUpdate=!0,!this.partialUpdate)return;const t=this.image.width/this._pixelsPerInstance,n=Math.floor(e/t);this._rowToUpdate[n]=!0}bindToProgram(e,t,n,s,l){if(!s[l])return;s[l].value=this;const h=this.getSlot(n,l);if(h===void 0)return;const c=e.properties.get(this);e.state.bindTexture(t.TEXTURE_2D,c.__webglTexture,t.TEXTURE0+h)}update(e,t,n){const s=e.properties.get(this),l=s.__version!==this.version;if(!this._needsUpdate&&!l)return;const h=this._lastWidth!==this.image.width;if(!s.__webglTexture||h)e.initTexture(this);else{const c=this.getSlot(t,n)??e.capabilities.maxTextures-1;this.partialUpdate?this.updatePartial(s,e,c):this.updateFull(s,e,c),s.__version=this.version}this._lastWidth=this.image.width,this._needsUpdate=!1}getSlot(e,t){var n;return(n=e[t])==null?void 0:n.cache[0]}updateFull(e,t,n){this.updateRows(e,t,[{row:0,count:this.image.height}],n)}updatePartial(e,t,n){const s=this.getUpdateRowsInfo();s.length!==0&&(s.length>this.maxUpdateCalls?this.updateFull(e,t,n):this.updateRows(e,t,s,n),this._rowToUpdate.fill(!1))}getUpdateRowsInfo(){const e=this._rowToUpdate,t=[];for(let n=0,s=e.length;n<s;n++)if(e[n]){const l=n;for(;n<s&&e[n];n++);t.push({row:l,count:n-l})}return t}updateRows(e,t,n,s){var l;const h=t.getContext();this._utils??(this._utils=new Rd(h,t.extensions,t.capabilities));const c=this._utils.convert(this.format),p=this._utils.convert(this.type),{data:d,width:f}=this.image,_=this._channels;t.state.activeTexture(h.TEXTURE0+s),t.state.bindTexture(h.TEXTURE_2D,e.__webglTexture,h.TEXTURE0+s);const g=Nn.getPrimaries(Nn.workingColorSpace),v=this.colorSpace===zn?null:Nn.getPrimaries(this.colorSpace),w=this.colorSpace===zn||g===v?h.NONE:h.BROWSER_DEFAULT_WEBGL;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,this.flipY),h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),h.pixelStorei(h.UNPACK_ALIGNMENT,this.unpackAlignment),h.pixelStorei(h.UNPACK_COLORSPACE_CONVERSION_WEBGL,w);for(const{count:b,row:x}of n)h.texSubImage2D(h.TEXTURE_2D,0,0,x,f,b,c,p,d,x*f*_);(l=this.onUpdate)==null||l.call(this,this)}setUniformAt(e,t,n){const{offset:s,size:l}=this._uniformMap.get(t),h=this._stride;l===1?this._data[e*h+s]=n:n.toArray(this._data,e*h+s)}getUniformAt(e,t,n){const{offset:s,size:l}=this._uniformMap.get(t),h=this._stride;return l===1?this._data[e*h+s]:n.fromArray(this._data,e*h+s)}getUniformsGLSL(e,t,n){const s=this.getUniformsVertexGLSL(e,t,n),l=this.getUniformsFragmentGLSL(e,t,n);return{vertex:s,fragment:l}}getUniformsVertexGLSL(e,t,n){if(this._fetchUniformsInFragmentShader)return`
        flat varying ${n} ez_v${t}; 
        void main() {
          ez_v${t} = ${t};`;const s=this.texelsFetchGLSL(e,t),l=this.getFromTexelsGLSL(),{assignVarying:h,declareVarying:c}=this.getVarying();return`
      uniform highp sampler2D ${e};  
      ${c}
      void main() {
        ${s}
        ${l}
        ${h}`}getUniformsFragmentGLSL(e,t,n){if(!this._fetchUniformsInFragmentShader){const{declareVarying:h,getVarying:c}=this.getVarying();return`
      ${h}
      void main() {
        ${c}`}const s=this.texelsFetchGLSL(e,`ez_v${t}`),l=this.getFromTexelsGLSL();return`
      uniform highp sampler2D ${e};  
      flat varying ${n} ez_v${t};
      void main() {
        ${s}
        ${l}`}texelsFetchGLSL(e,t){const n=this._pixelsPerInstance;let s=`
      int size = textureSize(${e}, 0).x;
      int j = int(${t}) * ${n};
      int x = j % size;
      int y = j / size;
    `;for(let l=0;l<n;l++)s+=`vec4 ez_texel${l} = texelFetch(${e}, ivec2(x + ${l}, y), 0);
`;return s}getFromTexelsGLSL(){const e=this._uniformMap;let t="";for(const[n,{type:s,offset:l,size:h}]of e){const c=Math.floor(l/this._channels);if(s==="mat3")t+=`mat3 ${n} = mat3(ez_texel${c}.rgb, vec3(ez_texel${c}.a, ez_texel${c+1}.rg), vec3(ez_texel${c+1}.ba, ez_texel${c+2}.r));
`;else if(s==="mat4")t+=`mat4 ${n} = mat4(ez_texel${c}, ez_texel${c+1}, ez_texel${c+2}, ez_texel${c+3});
`;else{const p=this.getUniformComponents(l,h);t+=`${s} ${n} = ez_texel${c}.${p};
`}}return t}getVarying(){const e=this._uniformMap;let t="",n="",s="";for(const[l,{type:h}]of e)t+=`flat varying ${h} ez_v${l};
`,n+=`ez_v${l} = ${l};
`,s+=`${h} ${l} = ez_v${l};
`;return{declareVarying:t,assignVarying:n,getVarying:s}}getUniformComponents(e,t){const n=e%this._channels;let s="";for(let l=0;l<t;l++)s+=Zf[n+l];return s}copy(e){return super.copy(e),this.partialUpdate=e.partialUpdate,this.maxUpdateCalls=e.maxUpdateCalls,this._channels=e._channels,this._pixelsPerInstance=e._pixelsPerInstance,this._stride=e._stride,this._rowToUpdate=e._rowToUpdate,this._uniformMap=e._uniformMap,this._fetchUniformsInFragmentShader=e._fetchUniformsInFragmentShader,this}}const Zf=["r","g","b","a"];class U extends dn{constructor(e,t,n={},s){if(!e)throw new Error('"geometry" is mandatory.');if(!t)throw new Error('"material" is mandatory.');const{allowsEuler:l,renderer:h,createEntities:c}=n;super(e,null),this.type="InstancedMesh2",this.isInstancedMesh2=!0,this.instances=null,this.instanceIndex=null,this.colorsTexture=null,this.morphTexture=null,this.boneTexture=null,this.uniformsTexture=null,this.boundingBox=null,this.boundingSphere=null,this.bvh=null,this.customSort=null,this.raycastOnlyFrustum=!1,this.LODinfo=null,this.autoUpdate=!0,this.bindMode=Jo,this.bindMatrix=null,this.bindMatrixInverse=null,this.skeleton=null,this.autoUpdateBVH=!0,this.onFrustumEnter=null,this._renderer=null,this._instancesCount=0,this._instancesArrayCount=0,this._perObjectFrustumCulled=!0,this._sortObjects=!1,this._indexArrayNeedsUpdate=!1,this._useOpacity=!1,this._currentMaterial=null,this._customProgramCacheKeyBase=null,this._onBeforeCompileBase=null,this._freeIds=[],this.isInstancedMesh=!0,this.instanceMatrix=new kd(new Float32Array(0),16),this.instanceColor=null,this._customProgramCacheKey=()=>`ez_${!!this.colorsTexture}_${this._useOpacity}_${!!this.boneTexture}_${!!this.uniformsTexture}_${this._customProgramCacheKeyBase.call(this._currentMaterial)}`,this._onBeforeCompile=(d,f)=>{if(this._onBeforeCompileBase&&this._onBeforeCompileBase.call(this._currentMaterial,d,f),d.defines??(d.defines={}),d.defines.USE_INSTANCING_INDIRECT="",d.uniforms.matricesTexture={value:this.matricesTexture},this.uniformsTexture){d.uniforms.uniformsTexture={value:this.uniformsTexture};const{vertex:_,fragment:g}=this.uniformsTexture.getUniformsGLSL("uniformsTexture","instanceIndex","uint");d.vertexShader=d.vertexShader.replace("void main() {",_),d.fragmentShader=d.fragmentShader.replace("void main() {",g)}this.colorsTexture&&d.fragmentShader.includes("#include <color_pars_fragment>")&&(d.defines.USE_INSTANCING_COLOR_INDIRECT="",d.uniforms.colorsTexture={value:this.colorsTexture},d.vertexShader=d.vertexShader.replace("<color_vertex>","<instanced_color_vertex>"),d.vertexColors&&(d.defines.USE_VERTEX_COLOR=""),this._useOpacity?d.defines.USE_COLOR_ALPHA="":d.defines.USE_COLOR=""),this.boneTexture&&(d.defines.USE_SKINNING="",d.defines.USE_INSTANCING_SKINNING="",d.uniforms.bindMatrix={value:this.bindMatrix},d.uniforms.bindMatrixInverse={value:this.bindMatrixInverse},d.uniforms.bonesPerInstance={value:this.skeleton.bones.length},d.uniforms.boneTexture={value:this.boneTexture})};const p=n.capacity>0?n.capacity:Qf;this._renderer=h,this._capacity=p,this._parentLOD=s,this._geometry=e,this.material=t,this._allowsEuler=l??!1,this._tempInstance=new nh(this,-1,l),this.availabilityArray=s?.availabilityArray??new Array(p*2),this._createEntities=c,this.initLastRenderInfo(),this.initIndexAttribute(),this.initMatricesTexture()}get capacity(){return this._capacity}get instancesCount(){return this._instancesCount}get perObjectFrustumCulled(){return this._perObjectFrustumCulled}set perObjectFrustumCulled(e){this._perObjectFrustumCulled=e,this._indexArrayNeedsUpdate=!0}get sortObjects(){return this._sortObjects}set sortObjects(e){this._sortObjects=e,this._indexArrayNeedsUpdate=!0}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.patchGeometry(e)}onBeforeShadow(e,t,n,s,l,h,c){this.patchMaterial(e,h),this.updateTextures(e,h);const p=e.info.render.frame;this.instanceIndex&&this.autoUpdate&&!this.frustumCullingAlreadyPerformed(p,n,s)&&this.performFrustumCulling(s,n),this.count!==0&&(this.instanceIndex.update(this._renderer,this.count),this.bindTextures(e,h))}onBeforeRender(e,t,n,s,l,h){if(this.patchMaterial(e,l),this.updateTextures(e,l),!this.instanceIndex){this._renderer=e;return}const c=e.info.render.frame;this.autoUpdate&&!this.frustumCullingAlreadyPerformed(c,n,null)&&this.performFrustumCulling(n),this.count!==0&&(this.instanceIndex.update(this._renderer,this.count),this.bindTextures(e,l))}onAfterShadow(e,t,n,s,l,h,c){this.unpatchMaterial(e,h)}onAfterRender(e,t,n,s,l,h){this.unpatchMaterial(e,l),!(this.instanceIndex||h&&!this.isLastGroup(h.materialIndex))&&this.initIndexAttribute()}updateTextures(e,t){var n,s,l;const h=e.properties.get(t);this.matricesTexture.update(e,h,"matricesTexture"),(n=this.colorsTexture)==null||n.update(e,h,"colorsTexture"),(s=this.uniformsTexture)==null||s.update(e,h,"uniformsTexture"),(l=this.boneTexture)==null||l.update(e,h,"boneTexture")}bindTextures(e,t){var n,s,l;const h=e.properties.get(t),c=h.uniforms;if(!c)return;const p=h.currentProgram,d=p?.program;if(!d)return;const f=e.getContext(),_=p.getUniforms().map,g=f.getParameter(f.CURRENT_PROGRAM);e.state.useProgram(d),this.matricesTexture.bindToProgram(e,f,_,c,"matricesTexture"),(n=this.colorsTexture)==null||n.bindToProgram(e,f,_,c,"colorsTexture"),(s=this.uniformsTexture)==null||s.bindToProgram(e,f,_,c,"uniformsTexture"),(l=this.boneTexture)==null||l.bindToProgram(e,f,_,c,"boneTexture"),e.state.useProgram(g)}isLastGroup(e){const t=this.material;for(let n=t.length-1;n>=e;n--)if(t[n].visible)return n===e}initIndexAttribute(){if(!this._renderer){this.count=0;return}const e=this._renderer.getContext(),t=this._capacity,n=new Uint32Array(t);for(let s=0;s<t;s++)n[s]=s;this.instanceIndex=new Kf(e,e.UNSIGNED_INT,1,4,n),this._geometry.setAttribute("instanceIndex",this.instanceIndex)}initLastRenderInfo(){this._parentLOD||(this._lastRenderInfo={frame:-1,camera:null,shadowCamera:null})}initMatricesTexture(){this._parentLOD||(this.matricesTexture=new Jn(Float32Array,4,4,this._capacity))}initColorsTexture(){this._parentLOD||(this.colorsTexture=new Jn(Float32Array,4,1,this._capacity),this.colorsTexture.colorSpace=Nn.workingColorSpace,this.colorsTexture._data.fill(1),this.materialsNeedsUpdate())}materialsNeedsUpdate(){if(this.material.isMaterial){this.material.needsUpdate=!0;return}for(const e of this.material)e.needsUpdate=!0}patchGeometry(e){const t=e.getAttribute("instanceIndex");if(t){if(t===this.instanceIndex)return;console.warn("The geometry has been cloned because it was already used."),e=e.clone(),e.deleteAttribute("instanceIndex")}this.instanceIndex&&e.setAttribute("instanceIndex",this.instanceIndex)}patchMaterial(e,t){this._currentMaterial=t,this._customProgramCacheKeyBase=t.customProgramCacheKey,this._onBeforeCompileBase=t.onBeforeCompile,t.customProgramCacheKey=this._customProgramCacheKey,t.onBeforeCompile=this._onBeforeCompile,qf(this,e,t)}unpatchMaterial(e,t){this._currentMaterial=null,Yf(e),t.onBeforeCompile=this._onBeforeCompileBase,t.customProgramCacheKey=this._customProgramCacheKeyBase,this._onBeforeCompileBase=null,this._customProgramCacheKeyBase=null}computeBVH(e={}){this.bvh||(this.bvh=new Gf(this,e.margin,e.getBBoxFromBSphere,e.accurateCulling)),this.bvh.clear(),this.bvh.create()}disposeBVH(){this.bvh=null}setMatrixAt(e,t){if(t.toArray(this.matricesTexture._data,e*16),this.instances){const n=this.instances[e];t.decompose(n.position,n.quaternion,n.scale)}this.matricesTexture.enqueueUpdate(e),this.bvh&&this.autoUpdateBVH&&this.bvh.move(e)}getMatrixAt(e,t=Jf){return t.fromArray(this.matricesTexture._data,e*16)}getPositionAt(e,t=em){const n=e*16,s=this.matricesTexture._data;return t.x=s[n+12],t.y=s[n+13],t.z=s[n+14],t}getPositionAndMaxScaleOnAxisAt(e,t){const n=e*16,s=this.matricesTexture._data,l=s[n+0],h=s[n+1],c=s[n+2],p=l*l+h*h+c*c,d=s[n+4],f=s[n+5],_=s[n+6],g=d*d+f*f+_*_,v=s[n+8],w=s[n+9],b=s[n+10],x=v*v+w*w+b*b;return t.x=s[n+12],t.y=s[n+13],t.z=s[n+14],Math.sqrt(Math.max(p,g,x))}applyMatrixAtToSphere(e,t,n,s){const l=e*16,h=this.matricesTexture._data,c=h[l+0],p=h[l+1],d=h[l+2],f=h[l+3],_=h[l+4],g=h[l+5],v=h[l+6],w=h[l+7],b=h[l+8],x=h[l+9],S=h[l+10],C=h[l+11],P=h[l+12],M=h[l+13],T=h[l+14],A=h[l+15],R=t.center,k=n.x,O=n.y,I=n.z,V=1/(f*k+w*O+C*I+A);R.x=(c*k+_*O+b*I+P)*V,R.y=(p*k+g*O+x*I+M)*V,R.z=(d*k+v*O+S*I+T)*V;const G=c*c+p*p+d*d,Z=_*_+g*g+v*v,K=b*b+x*x+S*S;t.radius=s*Math.sqrt(Math.max(G,Z,K))}setVisibilityAt(e,t){this.availabilityArray[e*2]=t,this._indexArrayNeedsUpdate=!0}getVisibilityAt(e){return this.availabilityArray[e*2]}setActiveAt(e,t){this.availabilityArray[e*2+1]=t,this._indexArrayNeedsUpdate=!0}getActiveAt(e){return this.availabilityArray[e*2+1]}getActiveAndVisibilityAt(e){const t=e*2,n=this.availabilityArray;return n[t]&&n[t+1]}setActiveAndVisibilityAt(e,t){const n=e*2,s=this.availabilityArray;s[n]=t,s[n+1]=t,this._indexArrayNeedsUpdate=!0}setColorAt(e,t){this.colorsTexture===null&&this.initColorsTexture(),t.isColor?t.toArray(this.colorsTexture._data,e*4):Oa.set(t).toArray(this.colorsTexture._data,e*4),this.colorsTexture.enqueueUpdate(e)}getColorAt(e,t=Oa){return t.fromArray(this.colorsTexture._data,e*4)}setOpacityAt(e,t){this._useOpacity||(this.colorsTexture===null?this.initColorsTexture():this.materialsNeedsUpdate(),this._useOpacity=!0),this.colorsTexture._data[e*4+3]=t,this.colorsTexture.enqueueUpdate(e)}getOpacityAt(e){return this._useOpacity?this.colorsTexture._data[e*4+3]:1}copyTo(e,t){this.getMatrixAt(e,t.matrix).decompose(t.position,t.quaternion,t.scale)}computeBoundingBox(){const e=this._geometry,t=this._instancesArrayCount;this.boundingBox??(this.boundingBox=new Ms),e.boundingBox===null&&e.computeBoundingBox();const n=e.boundingBox,s=this.boundingBox;s.makeEmpty();for(let l=0;l<t;l++)this.getActiveAt(l)&&(Ma.copy(n).applyMatrix4(this.getMatrixAt(l)),s.union(Ma))}computeBoundingSphere(){const e=this._geometry,t=this._instancesArrayCount;this.boundingSphere??(this.boundingSphere=new ir),e.boundingSphere===null&&e.computeBoundingSphere();const n=e.boundingSphere,s=this.boundingSphere;s.makeEmpty();for(let l=0;l<t;l++)this.getActiveAt(l)&&(ka.copy(n).applyMatrix4(this.getMatrixAt(l)),s.union(ka))}clone(e){const t={capacity:this._capacity,renderer:this._renderer,allowsEuler:this._allowsEuler,createEntities:this._createEntities};return new this.constructor(this.geometry,this.material,t).copy(this,e)}copy(e,t){return super.copy(e,t),this.count=e._capacity,this._instancesCount=e._instancesCount,this._instancesArrayCount=e._instancesArrayCount,this._capacity=e._capacity,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this.matricesTexture=e.matricesTexture.clone(),this.matricesTexture.image.data=this.matricesTexture.image.data.slice(),e.colorsTexture!==null&&(this.colorsTexture=e.colorsTexture.clone(),this.colorsTexture.image.data=this.colorsTexture.image.data.slice()),e.uniformsTexture!==null&&(this.uniformsTexture=e.uniformsTexture.clone(),this.uniformsTexture.image.data=this.uniformsTexture.image.data.slice()),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone(),this.morphTexture.image.data=this.morphTexture.image.data.slice()),e.boneTexture!==null&&(this.boneTexture=e.boneTexture.clone(),this.boneTexture.image.data=this.boneTexture.image.data.slice()),this}dispose(){var e,t,n,s;this.dispatchEvent({type:"dispose"}),this.matricesTexture.dispose(),(e=this.colorsTexture)==null||e.dispose(),(t=this.morphTexture)==null||t.dispose(),(n=this.boneTexture)==null||n.dispose(),(s=this.uniformsTexture)==null||s.dispose()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMatrixInverse&&(this.bindMode===Jo?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===Od?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("Unrecognized bindMode: "+this.bindMode))}}const Qf=1e3,Ma=new Ms,ka=new ir,Jf=new bi,Oa=new Ss,em=new se;U.prototype.resizeBuffers=function(r){var e;const t=this._capacity;this._capacity=r;const n=Math.min(r,t);if(this.instanceIndex){const s=new Uint32Array(r);s.set(new Uint32Array(this.instanceIndex.array.buffer,0,n)),this.instanceIndex.array=s}if(this.LODinfo){for(const s of this.LODinfo.objects)if(s._capacity=r,s.instanceIndex){const l=new Uint32Array(r);l.set(new Uint32Array(s.instanceIndex.array.buffer,0,n)),s.instanceIndex.array=l}}if(this.availabilityArray.length=r*2,this.matricesTexture.resize(r),this.colorsTexture&&(this.colorsTexture.resize(r),r>t&&this.colorsTexture._data.fill(1,t*4)),this.morphTexture){const s=this.morphTexture.image.data,l=s.length/t;this.morphTexture.dispose(),this.morphTexture=new Ps(new Float32Array(l*r),l,r,Ts,As),this.morphTexture.image.data.set(s)}return(e=this.uniformsTexture)==null||e.resize(r),this};U.prototype.setInstancesArrayCount=function(r){if(r<this._instancesArrayCount){const t=this.bvh;if(t)for(let n=this._instancesArrayCount-1;n>=r;n--)this.getActiveAt(n)&&t.delete(n);this._instancesArrayCount=r;return}if(r>this._capacity){let t=this._capacity+(this._capacity>>1)+512;for(;t<r;)t+=(t>>1)+512;this.resizeBuffers(t)}const e=this._instancesArrayCount;this._instancesArrayCount=r,this._createEntities&&this.createEntities(e)};function sh(r,e){return r.depth-e.depth}function oh(r,e){return e.depth-r.depth}class tm{constructor(){this.array=[],this.pool=[]}push(e,t){const n=this.pool,s=this.array,l=s.length;l>=n.length&&n.push({depth:null,index:null,depthSort:null});const h=n[l];h.depth=e,h.index=t,s.push(h)}reset(){this.array.length=0}}const er=new zd,Ge=new tm,Xt=new bi,vi=new bi,ar=new se,fn=new se,gi=new se,im=new se,je=new ir;U.prototype.performFrustumCulling=function(r,e=r){const t=this._parentLOD??this,n=t.LODinfo;let s;if(n){s=r!==e?n.shadowRender??n.render:n.render;for(const l of n.objects)l.count=0}else t.count=0;t._instancesArrayCount!==0&&(s?.levels.length>0?t.frustumCullingLOD(s,r,e):t.frustumCulling(r))};U.prototype.frustumCullingAlreadyPerformed=function(r,e,t){const n=this._lastRenderInfo;return n.frame===r&&n.camera===e&&n.shadowCamera===t?!0:(n.frame=r,n.camera=e,n.shadowCamera=t,!1)};U.prototype.frustumCulling=function(r){var e;const t=this._sortObjects,n=this._perObjectFrustumCulled,s=this.instanceIndex.array;if(this.instanceIndex._needsUpdate=!0,!n&&!t){this.updateIndexArray();return}if(t&&(vi.copy(this.matrixWorld).invert(),fn.setFromMatrixPosition(r.matrixWorld).applyMatrix4(vi),ar.set(0,0,-1).transformDirection(r.matrixWorld).transformDirection(vi)),n?(Xt.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse).multiply(this.matrixWorld),this.bvh?this.BVHCulling(r):this.linearCulling(r)):this.updateRenderList(),t){const l=this.customSort;l===null?Ge.array.sort((e=this.material)!=null&&e.transparent?oh:sh):l(Ge.array);const h=Ge.array,c=h.length;for(let p=0;p<c;p++)s[p]=h[p].index;this.count=c,Ge.reset()}};U.prototype.updateIndexArray=function(){if(!this._indexArrayNeedsUpdate)return;const r=this.instanceIndex.array,e=this._instancesArrayCount;let t=0;for(let n=0;n<e;n++)this.getActiveAndVisibilityAt(n)&&(r[t++]=n);this.count=t,this._indexArrayNeedsUpdate=!1};U.prototype.updateRenderList=function(){const r=this._instancesArrayCount;for(let e=0;e<r;e++)if(this.getActiveAndVisibilityAt(e)){const t=this.getPositionAt(e).sub(fn).dot(ar);Ge.push(t,e)}};U.prototype.BVHCulling=function(r){const e=this.instanceIndex.array,t=this._instancesArrayCount,n=this._sortObjects,s=this.onFrustumEnter;let l=0;this.bvh.frustumCulling(Xt,h=>{const c=h.object;if(c<t&&this.getVisibilityAt(c)&&(!s||s(c,r)))if(n){const p=this.getPositionAt(c).sub(fn).dot(ar);Ge.push(p,c)}else e[l++]=c}),this.count=l};U.prototype.linearCulling=function(r){const e=this.instanceIndex.array;this.geometry.boundingSphere||this.geometry.computeBoundingSphere();const t=this._geometry.boundingSphere,n=t.radius,s=t.center,l=this._instancesArrayCount,h=s.x===0&&s.y===0&&s.z===0,c=this._sortObjects,p=this.onFrustumEnter;let d=0;er.setFromProjectionMatrix(Xt);for(let f=0;f<l;f++)if(this.getActiveAndVisibilityAt(f)){if(h){const _=this.getPositionAndMaxScaleOnAxisAt(f,je.center);je.radius=n*_}else this.applyMatrixAtToSphere(f,je,s,n);if(er.intersectsSphere(je)&&(!p||p(f,r)))if(c){const _=im.subVectors(je.center,fn).dot(ar);Ge.push(_,f)}else e[d++]=f}this.count=d};U.prototype.frustumCullingLOD=function(r,e,t){var n,s;const{count:l,levels:h}=r,c=e===t&&this._sortObjects;for(let d=0;d<h.length;d++)l[d]=0,h[d].object.instanceIndex&&(h[d].object.instanceIndex._needsUpdate=!0);Xt.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse).multiply(this.matrixWorld),vi.copy(this.matrixWorld).invert(),fn.setFromMatrixPosition(e.matrixWorld).applyMatrix4(vi),gi.setFromMatrixPosition(t.matrixWorld).applyMatrix4(vi);const p=r.levels.map(d=>d.object.instanceIndex.array);if(this.bvh?this.BVHCullingLOD(r,p,c,e,t):this.linearCullingLOD(r,p,c,e,t),c){const d=this.customSort,f=Ge.array;let _=0,g=h[1].distance;d===null?f.sort((n=h[0].object.material)!=null&&n.transparent?oh:sh):d(f);for(let v=0,w=f.length;v<w;v++){const b=f[v];b.depth>g&&(_++,g=((s=h[_+1])==null?void 0:s.distance)??1/0),p[_][l[_]++]=b.index}Ge.reset()}for(let d=0;d<h.length;d++){const f=h[d].object;f.count=l[d]}};U.prototype.BVHCullingLOD=function(r,e,t,n,s){const{count:l,levels:h}=r,c=this._instancesArrayCount,p=this.onFrustumEnter;t?this.bvh.frustumCulling(Xt,d=>{const f=d.object;if(f<c&&this.getVisibilityAt(f)&&(!p||p(f,n,s))){const _=this.getPositionAt(f).distanceToSquared(gi);Ge.push(_,f)}}):this.bvh.frustumCullingLOD(Xt,gi,h,(d,f)=>{const _=d.object;if(_<c&&this.getVisibilityAt(_)){if(f===null){const g=this.getPositionAt(_).distanceToSquared(gi);f=this.getObjectLODIndexForDistance(h,g)}(!p||p(_,n,s,f))&&(e[f][l[f]++]=_)}})};U.prototype.linearCullingLOD=function(r,e,t,n,s){const{count:l,levels:h}=r;this.geometry.boundingSphere||this.geometry.computeBoundingSphere();const c=this._geometry.boundingSphere,p=c.radius,d=c.center,f=this._instancesArrayCount,_=d.x===0&&d.y===0&&d.z===0,g=this.onFrustumEnter;er.setFromProjectionMatrix(Xt);for(let v=0;v<f;v++)if(this.getActiveAndVisibilityAt(v)){if(_){const w=this.getPositionAndMaxScaleOnAxisAt(v,je.center);je.radius=p*w}else this.applyMatrixAtToSphere(v,je,d,p);if(er.intersectsSphere(je))if(t){if(!g||g(v,n,s))continue;const w=je.center.distanceToSquared(gi);Ge.push(w,v)}else{const w=je.center.distanceToSquared(gi),b=this.getObjectLODIndexForDistance(h,w);(!g||g(v,n,s,b))&&(e[b][l[b]++]=v)}}};U.prototype.clearTempInstance=function(r){const e=this._tempInstance;return e.id=r,this.clearInstance(e)};U.prototype.clearTempInstancePosition=function(r){const e=this._tempInstance;return e.id=r,e.position.set(0,0,0),e};U.prototype.clearInstance=function(r){return r.position.set(0,0,0),r.scale.set(1,1,1),r.quaternion.identity(),r};U.prototype.updateInstances=function(r){const e=this._instancesArrayCount,t=this.instances;for(let n=0;n<e;n++){if(!this.getActiveAt(n))continue;const s=t?t[n]:this.clearTempInstance(n);r(s,n),s.updateMatrix()}return this};U.prototype.updateInstancesPosition=function(r){const e=this._instancesArrayCount,t=this.instances;for(let n=0;n<e;n++){if(!this.getActiveAt(n))continue;const s=t?t[n]:this.clearTempInstancePosition(n);r(s,n),s.updateMatrixPosition()}return this};U.prototype.createEntities=function(r){const e=this._instancesArrayCount;if(!this.instances)this.instances=new Array(e);else if(this.instances.length<e)this.instances.length=e;else return this;const t=this.instances;for(let n=r;n<e;n++)t[n]||(t[n]=new nh(this,n,this._allowsEuler));return this};U.prototype.addInstances=function(r,e){!e&&this.bvh&&console.warn("InstancedMesh2: if `computeBVH()` has already been called, it is better to valorize the instances in the `onCreation` callback for better performance.");const t=this._freeIds;if(t.length>0){let l=-1;const h=Math.min(t.length,r),c=t.length-h;for(let p=t.length-1;p>=c;p--){const d=t[p];d>l&&(l=d),this.addInstance(d,e)}t.length-=h,r-=h,this._instancesArrayCount=Math.max(l+1,this._instancesArrayCount)}const n=this._instancesArrayCount,s=n+r;this.setInstancesArrayCount(s);for(let l=n;l<s;l++)this.addInstance(l,e);return this};U.prototype.addInstance=function(r,e){var t;this._instancesCount++,this.setActiveAndVisibilityAt(r,!0);const n=this.instances?this.clearInstance(this.instances[r]):this.clearTempInstance(r);e?(e(n,r),n.updateMatrix()):n.setMatrixIdentity(),(t=this.bvh)==null||t.insert(r)};U.prototype.removeInstances=function(...r){const e=this._freeIds,t=this.bvh;for(const n of r)n<this._instancesArrayCount&&this.getActiveAt(n)&&(this.setActiveAt(n,!1),e.push(n),t?.delete(n),this._instancesCount--);for(let n=this._instancesArrayCount-1;n>=0&&!this.getActiveAt(n);n--)this._instancesArrayCount--;return this};U.prototype.clearInstances=function(){var r;if(this._instancesCount=0,this._instancesArrayCount=0,this._freeIds.length=0,(r=this.bvh)==null||r.clear(),this.LODinfo)for(const e of this.LODinfo.objects)e.count=0;return this};U.prototype.getObjectLODIndexForDistance=function(r,e){for(let t=r.length-1;t>0;t--){const n=r[t],s=n.distance-n.distance*n.hysteresis;if(e>=s)return t}return 0};U.prototype.setFirstLODDistance=function(r){if(this._parentLOD)throw new Error("Cannot create LOD for this InstancedMesh2.");return this.LODinfo||(this.LODinfo={render:null,shadowRender:null,objects:[this]}),this.LODinfo.render||(this.LODinfo.render={levels:[{distance:r,hysteresis:0,object:this}],count:[0]}),this};U.prototype.addLOD=function(r,e,t=0,n=0){var s;if(this._parentLOD)throw new Error("Cannot create LOD for this InstancedMesh2.");if(!((s=this.LODinfo)!=null&&s.render)&&t===0)throw new Error('Cannot set distance to 0 for the first LOD. Call "setFirstLODDistance" method before use "addLOD".');return this.setFirstLODDistance(0),this.addLevel(this.LODinfo.render,r,e,t,n),this};U.prototype.addShadowLOD=function(r,e=0,t=0){if(this._parentLOD)throw new Error("Cannot create LOD for this InstancedMesh2.");this.LODinfo||(this.LODinfo={render:null,shadowRender:null,objects:[this]}),this.LODinfo.shadowRender||(this.LODinfo.shadowRender={levels:[],count:[]});const n=this.addLevel(this.LODinfo.shadowRender,r,null,e,t);return n.castShadow=!0,this.castShadow=!0,this};U.prototype.addLevel=function(r,e,t,n,s){const l=this.LODinfo.objects,h=r.levels;let c,p;n=n**2;const d=l.findIndex(f=>f.geometry===e);if(d===-1){const f={capacity:this._capacity,renderer:this._renderer};p=new U(e,t??new Tt,f,this),p.frustumCulled=!1,this.patchLevel(p),l.push(p),this.add(p)}else p=l[d],t&&(p.material=t);for(c=0;c<h.length&&!(n<h[c].distance);c++);return h.splice(c,0,{distance:n,hysteresis:s,object:p}),r.count.push(0),p};U.prototype.updateLevel=function(r,e,t,n){if(!r)throw new Error("Render list is invalid.");const s=r.levels[e];if(!s)throw new Error("Cannot update an empty LOD.");if(t!=null&&!Number.isNaN(t)){const l=t**2;s.distance=l}return n!=null&&!Number.isNaN(n)&&(s.hysteresis=n),this};U.prototype.updateLOD=function(r,e,t){var n;const s=(n=this==null?void 0:this.LODinfo)==null?void 0:n.render;if(r===0)throw new Error("Cannot change distance for LOD0. It is the main mesh and must stay at 0.");return this.updateLevel(s,r,e,t)};U.prototype.updateShadowLOD=function(r,e,t){var n;return this.updateLevel((n=this.LODinfo)==null?void 0:n.shadowRender,r,e,t)};U.prototype.updateAllLevels=function(r,e,t){var n;if(!(r!=null&&r.levels))throw new Error("Invalid LOD list.");const s=r.levels,l=((n=this.LODinfo)==null?void 0:n.render)===r,h=l?1:0;l&&(s[0].distance=0);const c=e?.length>0;let p=[];c&&(p=l&&e[0]===0?e.slice(1,Math.min(s.length,e.length)):e.slice(0,Math.min(s.length-h,e.length)),p.every((f,_)=>{if(_>0&&f<=p[_-1])throw new Error(`LOD distances must be strictly increasing: d[${_-1}]=${p[_-1]} < d[${_}]=${f}`);return!0}));const d=c?p.length:s.length-h;for(let f=0;f<d;f++){const _=c?p[f]:void 0,g=Array.isArray(t)?t[f]:t;this.updateLevel(r,h+f,_,g)}return this};U.prototype.updateAllLOD=function(r,e){var t;return this.updateAllLevels((t=this.LODinfo)==null?void 0:t.render,r,e)};U.prototype.updateAllShadowLOD=function(r,e){var t;return this.updateAllLevels((t=this.LODinfo)==null?void 0:t.shadowRender,r,e)};U.prototype.disposeLOD=function(r){r.geometry.dispose();const e=r.material;if(Array.isArray(e))for(const t of e)t.dispose();else e.dispose()};U.prototype.removeLOD=function(r,e=!0){var t,n,s,l,h,c;const p=this.LODinfo,d=p?.render;if(!(d!=null&&d.levels))throw new Error("Invalid LOD list.");const f=d.levels.length;if(r<0||r>=f)throw new Error("Level index OOB");if(f>1&&r===0)throw new Error("Cannot remove LOD0 while others exist");const[_]=d.levels.splice(r,1);(n=(t=d.count)==null?void 0:t.splice)==null||n.call(t,r,1),d.levels.length<=1&&(p.render=null);const g=_.object,v=(s=this.LODinfo)==null?void 0:s.shadowRender;if(v!=null&&v.levels&&r<v.levels.length&&(v.levels.splice(r,1),(h=(l=v.count)==null?void 0:l.splice)==null||h.call(l,r,1),v.levels.length===0&&(this.LODinfo.shadowRender=null)),e&&g!==this)try{this.remove(g);const w=((c=p.objects)==null?void 0:c.indexOf(g))??-1;w!==-1&&p.objects.splice(w,1),this.disposeLOD(g)}catch(w){console.error(w)}return this};U.prototype.patchLevel=function(r){Object.defineProperty(r,"renderOrder",{get(){return this._parentLOD.renderOrder}}),Object.defineProperty(r,"_lastRenderInfo",{get(){return this._parentLOD._lastRenderInfo}}),Object.defineProperty(r,"matricesTexture",{get(){return this._parentLOD.matricesTexture}}),Object.defineProperty(r,"colorsTexture",{get(){return this._parentLOD.colorsTexture}}),Object.defineProperty(r,"uniformsTexture",{get(){return this._parentLOD.uniformsTexture}}),Object.defineProperty(r,"morphTexture",{get(){return this._parentLOD.morphTexture}}),Object.defineProperty(r,"boneTexture",{get(){return this._parentLOD.boneTexture}}),Object.defineProperty(r,"skeleton",{get(){return this._parentLOD.skeleton}}),Object.defineProperty(r,"bindMatrixInverse",{get(){return this._parentLOD.bindMatrixInverse}}),Object.defineProperty(r,"bindMatrix",{get(){return this._parentLOD.bindMatrix}})};const nm=new dn;U.prototype.getMorphAt=function(r,e=nm){const t=e.morphTargetInfluences,n=this.morphTexture.source.data.data,s=t.length+1,l=r*s+1;for(let h=0;h<t.length;h++)t[h]=n[l+h];return e};U.prototype.setMorphAt=function(r,e){const t=e.morphTargetInfluences,n=t.length+1;this.morphTexture===null&&!this._parentLOD&&(this.morphTexture=new Ps(new Float32Array(n*this._capacity),n,this._capacity,Ts,As));const s=this.morphTexture.source.data.data;let l=0;for(const p of t)l+=p;const h=this._geometry.morphTargetsRelative?1:1-l,c=n*r;s[c]=h,s.set(t,c+1),this.morphTexture.needsUpdate=!0};const es=[],tr=new dn,rm=new Xa,Ra=new se,Da=new se,La=new bi,Ia=new ir;U.prototype.raycast=function(r,e){if(this._parentLOD||!this.material||this._instancesArrayCount===0||!this.instanceIndex)return;tr.geometry=this._geometry,tr.material=this.material;const t=r.ray,n=r.near,s=r.far;La.copy(this.matrixWorld).invert(),Da.setFromMatrixScale(this.matrixWorld),Ra.copy(r.ray.direction).multiply(Da);const l=Ra.length();r.ray=rm.copy(r.ray).applyMatrix4(La),r.near/=l,r.far/=l,this.raycastInstances(r,e),r.ray=t,r.near=n,r.far=s};U.prototype.raycastInstances=function(r,e){if(this.bvh)this.bvh.raycast(r,t=>this.checkObjectIntersection(r,t,e));else{if(this.boundingSphere===null&&this.computeBoundingSphere(),Ia.copy(this.boundingSphere),!r.ray.intersectsSphere(Ia))return;const t=this.instanceIndex.array,n=this.raycastOnlyFrustum&&this._perObjectFrustumCulled?this.count:this._instancesArrayCount;for(let s=0;s<n;s++)this.checkObjectIntersection(r,t[s],e)}};U.prototype.checkObjectIntersection=function(r,e,t){if(!(e>this._instancesArrayCount||!this.getActiveAndVisibilityAt(e))){this.getMatrixAt(e,tr.matrixWorld),tr.raycast(r,es);for(const n of es)n.instanceId=e,n.object=this,t.push(n);es.length=0}};U.prototype.initSkeleton=function(r,e=!0){if(r&&this.skeleton!==r&&!this._parentLOD){const t=r.bones;if(this.skeleton=r,this.bindMatrix=new bi,this.bindMatrixInverse=new bi,this.boneTexture=new Jn(Float32Array,4,4*t.length,this._capacity),e)for(const n of t)n.matrixAutoUpdate=!1,n.matrixWorldAutoUpdate=!1;this.materialsNeedsUpdate()}};U.prototype.setBonesAt=function(r,e=!0,t){const n=this.skeleton;if(!n)throw new Error('"setBonesAt" cannot be called before "initSkeleton"');const s=n.bones,l=n.boneInverses;for(let h=0,c=s.length;h<c;h++){const p=s[h];e&&(t!=null&&t.has(p.name)||p.updateMatrix(),p.matrixWorld.multiplyMatrices(p.parent.matrixWorld,p.matrix)),this.multiplyBoneMatricesAt(r,h,p.matrixWorld,l[h])}this.boneTexture.enqueueUpdate(r)};U.prototype.multiplyBoneMatricesAt=function(r,e,t,n){const s=(r*this.skeleton.bones.length+e)*16,l=t.elements,h=n.elements,c=this.boneTexture._data,p=l[0],d=l[4],f=l[8],_=l[12],g=l[1],v=l[5],w=l[9],b=l[13],x=l[2],S=l[6],C=l[10],P=l[14],M=l[3],T=l[7],A=l[11],R=l[15],k=h[0],O=h[4],I=h[8],V=h[12],G=h[1],Z=h[5],K=h[9],F=h[13],L=h[2],ae=h[6],we=h[10],ye=h[14],he=h[3],xe=h[7],$=h[11],W=h[15];c[s+0]=p*k+d*G+f*L+_*he,c[s+4]=p*O+d*Z+f*ae+_*xe,c[s+8]=p*I+d*K+f*we+_*$,c[s+12]=p*V+d*F+f*ye+_*W,c[s+1]=g*k+v*G+w*L+b*he,c[s+5]=g*O+v*Z+w*ae+b*xe,c[s+9]=g*I+v*K+w*we+b*$,c[s+13]=g*V+v*F+w*ye+b*W,c[s+2]=x*k+S*G+C*L+P*he,c[s+6]=x*O+S*Z+C*ae+P*xe,c[s+10]=x*I+S*K+C*we+P*$,c[s+14]=x*V+S*F+C*ye+P*W,c[s+3]=M*k+T*G+A*L+R*he,c[s+7]=M*O+T*Z+A*ae+R*xe,c[s+11]=M*I+T*K+A*we+R*$,c[s+15]=M*V+T*F+A*ye+R*W};U.prototype.getUniformAt=function(r,e,t){if(!this.uniformsTexture)throw new Error(`Before get/set uniform, it's necessary to use "initUniformsPerInstance".`);return this.uniformsTexture.getUniformAt(r,e,t)};U.prototype.setUniformAt=function(r,e,t){if(!this.uniformsTexture)throw new Error(`Before get/set uniform, it's necessary to use "initUniformsPerInstance".`);this.uniformsTexture.setUniformAt(r,e,t),this.uniformsTexture.enqueueUpdate(r)};U.prototype.initUniformsPerInstance=function(r){if(!this._parentLOD){const{channels:e,pixelsPerInstance:t,uniformMap:n,fetchInFragmentShader:s}=this.getUniformSchemaResult(r);this.uniformsTexture=new Jn(Float32Array,e,t,this._capacity,n,s),this.materialsNeedsUpdate()}};U.prototype.getUniformSchemaResult=function(r){let e=0;const t=new Map,n=[],s=r.vertex??{},l=r.fragment??{};let h=!0;for(const d in s){const f=s[d],_=this.getUniformSize(f);e+=_,n.push({name:d,type:f,size:_}),h=!1}for(const d in l)if(!s[d]){const f=l[d],_=this.getUniformSize(f);e+=_,n.push({name:d,type:f,size:_})}n.sort((d,f)=>f.size-d.size);const c=[];for(const{name:d,size:f,type:_}of n){const g=this.getUniformOffset(f,c);t.set(d,{offset:g,size:f,type:_})}const p=Math.ceil(e/4);return{channels:Math.min(e,4),pixelsPerInstance:p,uniformMap:t,fetchInFragmentShader:h}};U.prototype.getUniformOffset=function(r,e){if(r<4){for(let n=0;n<e.length;n++)if(e[n]+r<=4){const s=n*4+e[n];return e[n]+=r,s}}const t=e.length*4;for(;r>0;r-=4)e.push(r);return t};U.prototype.getUniformSize=function(r){switch(r){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;case"mat3":return 9;case"mat4":return 16;default:throw new Error(`Invalid uniform type: ${r}`)}};var sm=`#ifdef USE_INSTANCING_INDIRECT\r
  attribute uint instanceIndex;\r
  uniform highp sampler2D matricesTexture;  

  mat4 getInstancedMatrix() {\r
    int size = textureSize( matricesTexture, 0 ).x;\r
    int j = int( instanceIndex ) * 4;\r
    int x = j % size;\r
    int y = j / size;\r
    vec4 v1 = texelFetch( matricesTexture, ivec2( x, y ), 0 );\r
    vec4 v2 = texelFetch( matricesTexture, ivec2( x + 1, y ), 0 );\r
    vec4 v3 = texelFetch( matricesTexture, ivec2( x + 2, y ), 0 );\r
    vec4 v4 = texelFetch( matricesTexture, ivec2( x + 3, y ), 0 );\r
    return mat4( v1, v2, v3, v4 );\r
  }\r
#endif`,om=`#ifdef USE_INSTANCING_COLOR_INDIRECT\r
  uniform highp sampler2D colorsTexture;

  #ifdef USE_COLOR_ALPHA\r
    vec4 getColorTexture() {\r
      int size = textureSize( colorsTexture, 0 ).x;\r
      int j = int( instanceIndex );\r
      int x = j % size;\r
      int y = j / size;\r
      return texelFetch( colorsTexture, ivec2( x, y ), 0 );\r
    }\r
  #else\r
    vec3 getColorTexture() {\r
      int size = textureSize( colorsTexture, 0 ).x;\r
      int j = int( instanceIndex );\r
      int x = j % size;\r
      int y = j / size;\r
      return texelFetch( colorsTexture, ivec2( x, y ), 0 ).rgb;\r
    }\r
  #endif\r
#endif`,am=`#ifdef USE_INSTANCING_INDIRECT\r
  mat4 instanceMatrix = getInstancedMatrix();

  #ifdef USE_INSTANCING_COLOR_INDIRECT\r
    vColor *= getColorTexture();\r
  #endif\r
#endif`,lm=`#ifdef USE_INSTANCING_COLOR_INDIRECT\r
  #ifdef USE_VERTEX_COLOR\r
    vColor = color;\r
  #else\r
    #ifdef USE_COLOR_ALPHA\r
      vColor = vec4( 1.0 );\r
    #else\r
      vColor = vec3( 1.0 );\r
    #endif\r
  #endif\r
#endif`,hm=`#ifdef USE_SKINNING\r
  uniform mat4 bindMatrix;\r
  uniform mat4 bindMatrixInverse;\r
  uniform highp sampler2D boneTexture;

  #ifdef USE_INSTANCING_SKINNING\r
    uniform int bonesPerInstance;\r
  #endif

  mat4 getBoneMatrix( const in float i ) {\r
    int size = textureSize( boneTexture, 0 ).x;

    #ifdef USE_INSTANCING_SKINNING\r
      int j = ( bonesPerInstance * int( instanceIndex ) + int( i ) ) * 4;\r
    #else\r
      int j = int( i ) * 4;\r
    #endif

    int x = j % size;\r
    int y = j / size;\r
    vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\r
    vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\r
    vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\r
    vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\r
    return mat4( v1, v2, v3, v4 );\r
  }\r
#endif`;ue.instanced_pars_vertex=sm;ue.instanced_color_pars_vertex=om;ue.instanced_vertex=am;ue.instanced_color_vertex=lm;function Ws(r){return r.replace("#ifdef USE_INSTANCING","#if defined USE_INSTANCING || defined USE_INSTANCING_INDIRECT")}ue.project_vertex=Ws(ue.project_vertex);ue.worldpos_vertex=Ws(ue.worldpos_vertex);ue.defaultnormal_vertex=Ws(ue.defaultnormal_vertex);ue.batching_pars_vertex=ue.batching_pars_vertex.concat(`
#include <instanced_pars_vertex>`);ue.color_pars_vertex=ue.color_pars_vertex.concat(`
#include <instanced_color_pars_vertex>`);ue.batching_vertex=ue.batching_vertex.concat(`
#include <instanced_vertex>`);ue.skinning_pars_vertex=hm;ue.morphinstance_vertex&&(ue.morphinstance_vertex=ue.morphinstance_vertex.replaceAll("gl_InstanceID","instanceIndex"));var ts=1/1e3,um=1e3,cm=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(r){typeof document<"u"&&document.hidden!==void 0&&(r?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=r)}get delta(){return this._delta*ts}get fixedDelta(){return this._fixedDelta*ts}set fixedDelta(r){this._fixedDelta=r*um}get elapsed(){return this._elapsed*ts}update(r){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(r!==void 0?r:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}getDelta(){return this.delta}getElapsed(){return this.elapsed}handleEvent(r){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},dm=(()=>{const r=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),e=new Float32Array([0,0,2,0,0,2]),t=new nl;return t.setAttribute("position",new us(r,3)),t.setAttribute("uv",new us(e,2)),t})(),$e=class Cs{static get fullscreenGeometry(){return dm}constructor(e="Pass",t=new hs,n=new Kd){this.name=e,this.renderer=null,this.scene=t,this.camera=n,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){const t=this.fullscreenMaterial;t!==null&&(t.needsUpdate=!0),this.rtt=!e}}set mainScene(e){}set mainCamera(e){}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;t!==null?t.material=e:(t=new dn(Cs.fullscreenGeometry,e),t.frustumCulled=!1,this.scene===null&&(this.scene=new hs),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,t=nr){}render(e,t,n,s,l){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,n){}dispose(){for(const e of Object.keys(this)){const t=this[e];(t instanceof At||t instanceof tl||t instanceof il||t instanceof Cs)&&this[e].dispose()}this.fullscreenMaterial!==null&&this.fullscreenMaterial.dispose()}},pm=class extends $e{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(r,e,t,n,s){const l=r.state.buffers.stencil;l.setLocked(!1),l.setTest(!1)}},fm=`#ifdef COLOR_WRITE
#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#endif
#ifdef DEPTH_WRITE
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}
#endif
#ifdef USE_WEIGHTS
uniform vec4 channelWeights;
#endif
uniform float opacity;varying vec2 vUv;void main(){
#ifdef COLOR_WRITE
vec4 texel=texture2D(inputBuffer,vUv);
#ifdef USE_WEIGHTS
texel*=channelWeights;
#endif
gl_FragColor=opacity*texel;
#ifdef COLOR_SPACE_CONVERSION
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
#else
gl_FragColor=vec4(0.0);
#endif
#ifdef DEPTH_WRITE
gl_FragDepth=readDepth(vUv);
#endif
}`,ah="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",lh=class extends Tt{constructor(){super({name:"CopyMaterial",defines:{DEPTH_PACKING:"0",COLOR_WRITE:"1"},uniforms:{inputBuffer:new Q(null),depthBuffer:new Q(null),channelWeights:new Q(null),opacity:new Q(1)},blending:Si,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:fm,vertexShader:ah}),this.depthFunc=Wd}get inputBuffer(){return this.uniforms.inputBuffer.value}set inputBuffer(r){const e=r!==null;this.colorWrite!==e&&(e?this.defines.COLOR_WRITE=!0:delete this.defines.COLOR_WRITE,this.colorWrite=e,this.needsUpdate=!0),this.uniforms.inputBuffer.value=r}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(r){const e=r!==null;this.depthWrite!==e&&(e?this.defines.DEPTH_WRITE=!0:delete this.defines.DEPTH_WRITE,this.depthTest=e,this.depthWrite=e,this.needsUpdate=!0),this.uniforms.depthBuffer.value=r}set depthPacking(r){this.defines.DEPTH_PACKING=r.toFixed(0),this.needsUpdate=!0}get channelWeights(){return this.uniforms.channelWeights.value}set channelWeights(r){r!==null?(this.defines.USE_WEIGHTS="1",this.uniforms.channelWeights.value=r):delete this.defines.USE_WEIGHTS,this.needsUpdate=!0}setInputBuffer(r){this.uniforms.inputBuffer.value=r}getOpacity(r){return this.uniforms.opacity.value}setOpacity(r){this.uniforms.opacity.value=r}},mm=class extends $e{constructor(r,e=!0){super("CopyPass"),this.fullscreenMaterial=new lh,this.needsSwap=!1,this.renderTarget=r,r===void 0&&(this.renderTarget=new At(1,1,{minFilter:jn,magFilter:jn,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=e}get resize(){return this.autoResize}set resize(r){this.autoResize=r}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(r){this.autoResize=r}render(r,e,t,n,s){this.fullscreenMaterial.inputBuffer=e.texture,r.setRenderTarget(this.renderToScreen?null:this.renderTarget),r.render(this.scene,this.camera)}setSize(r,e){this.autoResize&&this.renderTarget.setSize(r,e)}initialize(r,e,t){t!==void 0&&(this.renderTarget.texture.type=t,t!==qt?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":r!==null&&r.outputColorSpace===ve&&(this.renderTarget.texture.colorSpace=ve))}},Ua=new Ss,hh=class extends $e{constructor(r=!0,e=!0,t=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=r,this.depth=e,this.stencil=t,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(r,e,t){this.color=r,this.depth=e,this.stencil=t}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(r){this.overrideClearColor=r}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(r){this.overrideClearAlpha=r}render(r,e,t,n,s){const l=this.overrideClearColor,h=this.overrideClearAlpha,c=r.getClearAlpha(),p=l!==null,d=h>=0;p?(r.getClearColor(Ua),r.setClearColor(l,d?h:c)):d&&r.setClearAlpha(h),r.setRenderTarget(this.renderToScreen?null:e),r.clear(this.color,this.depth,this.stencil),p?r.setClearColor(Ua,c):d&&r.setClearAlpha(c)}},_m=class extends $e{constructor(r,e){super("MaskPass",r,e),this.needsSwap=!1,this.clearPass=new hh(!1,!1,!0),this.inverse=!1}set mainScene(r){this.scene=r}set mainCamera(r){this.camera=r}get inverted(){return this.inverse}set inverted(r){this.inverse=r}get clear(){return this.clearPass.enabled}set clear(r){this.clearPass.enabled=r}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(r){this.inverted=r}render(r,e,t,n,s){const l=r.getContext(),h=r.state.buffers,c=this.scene,p=this.camera,d=this.clearPass,f=this.inverted?0:1,_=1-f;h.color.setMask(!1),h.depth.setMask(!1),h.color.setLocked(!0),h.depth.setLocked(!0),h.stencil.setTest(!0),h.stencil.setOp(l.REPLACE,l.REPLACE,l.REPLACE),h.stencil.setFunc(l.ALWAYS,f,4294967295),h.stencil.setClear(_),h.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?d.render(r,null):(d.render(r,e),d.render(r,t))),this.renderToScreen?(r.setRenderTarget(null),r.render(c,p)):(r.setRenderTarget(e),r.render(c,p),r.setRenderTarget(t),r.render(c,p)),h.color.setLocked(!1),h.depth.setLocked(!1),h.stencil.setLocked(!1),h.stencil.setFunc(l.EQUAL,1,4294967295),h.stencil.setOp(l.KEEP,l.KEEP,l.KEEP),h.stencil.setLocked(!0)}},vm=class{constructor(r=null,{depthBuffer:e=!0,stencilBuffer:t=!1,multisampling:n=0,frameBufferType:s}={}){this.renderer=null,this.inputBuffer=this.createBuffer(e,t,s,n),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new mm,this.depthTexture=null,this.passes=[],this.timer=new cm,this.autoRenderToScreen=!0,this.setRenderer(r)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(r){const e=this.inputBuffer,t=this.multisampling;t>0&&r>0?(this.inputBuffer.samples=r,this.outputBuffer.samples=r,this.inputBuffer.dispose(),this.outputBuffer.dispose()):t!==r&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(e.depthBuffer,e.stencilBuffer,e.texture.type,r),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(r){if(this.renderer=r,r!==null){const e=r.getSize(new ne),t=r.getContext().getContextAttributes().alpha,n=this.inputBuffer.texture.type;n===qt&&r.outputColorSpace===ve&&(this.inputBuffer.texture.colorSpace=ve,this.outputBuffer.texture.colorSpace=ve,this.inputBuffer.dispose(),this.outputBuffer.dispose()),r.autoClear=!1,this.setSize(e.width,e.height);for(const s of this.passes)s.initialize(r,t,n)}}replaceRenderer(r,e=!0){const t=this.renderer,n=t.domElement.parentNode;return this.setRenderer(r),e&&n!==null&&(n.removeChild(t.domElement),n.appendChild(r.domElement)),t}createDepthTexture(){const r=this.depthTexture=new Hd;return this.inputBuffer.depthTexture=r,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(r.format=jd,r.type=Gd):r.type=Za,r}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const r of this.passes)r.setDepthTexture(null)}}createBuffer(r,e,t,n){const s=this.renderer,l=s===null?new ne:s.getDrawingBufferSize(new ne),h={minFilter:jn,magFilter:jn,stencilBuffer:e,depthBuffer:r,type:t},c=new At(l.width,l.height,h);return n>0&&(c.samples=n),t===qt&&s!==null&&s.outputColorSpace===ve&&(c.texture.colorSpace=ve),c.texture.name="EffectComposer.Buffer",c.texture.generateMipmaps=!1,c}setMainScene(r){for(const e of this.passes)e.mainScene=r}setMainCamera(r){for(const e of this.passes)e.mainCamera=r}addPass(r,e){const t=this.passes,n=this.renderer,s=n.getDrawingBufferSize(new ne),l=n.getContext().getContextAttributes().alpha,h=this.inputBuffer.texture.type;if(r.setRenderer(n),r.setSize(s.width,s.height),r.initialize(n,l,h),this.autoRenderToScreen&&(t.length>0&&(t[t.length-1].renderToScreen=!1),r.renderToScreen&&(this.autoRenderToScreen=!1)),e!==void 0?t.splice(e,0,r):t.push(r),this.autoRenderToScreen&&(t[t.length-1].renderToScreen=!0),r.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const c=this.createDepthTexture();for(r of t)r.setDepthTexture(c)}else r.setDepthTexture(this.depthTexture)}removePass(r){const e=this.passes,t=e.indexOf(r);if(t!==-1&&e.splice(t,1).length>0){if(this.depthTexture!==null){const l=(c,p)=>c||p.needsDepthTexture;e.reduce(l,!1)||(r.getDepthTexture()===this.depthTexture&&r.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&t===e.length&&(r.renderToScreen=!1,e.length>0&&(e[e.length-1].renderToScreen=!0))}}removeAllPasses(){const r=this.passes;this.deleteDepthTexture(),r.length>0&&(this.autoRenderToScreen&&(r[r.length-1].renderToScreen=!1),this.passes=[])}render(r){const e=this.renderer,t=this.copyPass;let n=this.inputBuffer,s=this.outputBuffer,l=!1,h,c,p;r===void 0&&(this.timer.update(),r=this.timer.getDelta());for(const d of this.passes)d.enabled&&(d.render(e,n,s,r,l),d.needsSwap&&(l&&(t.renderToScreen=d.renderToScreen,h=e.getContext(),c=e.state.buffers.stencil,c.setFunc(h.NOTEQUAL,1,4294967295),t.render(e,n,s,r,l),c.setFunc(h.EQUAL,1,4294967295)),p=n,n=s,s=p),d instanceof _m?l=!0:d instanceof pm&&(l=!1))}setSize(r,e,t){const n=this.renderer,s=n.getSize(new ne);(r===void 0||e===void 0)&&(r=s.width,e=s.height),(s.width!==r||s.height!==e)&&n.setSize(r,e,t);const l=n.getDrawingBufferSize(new ne);this.inputBuffer.setSize(l.width,l.height),this.outputBuffer.setSize(l.width,l.height);for(const h of this.passes)h.setSize(l.width,l.height)}reset(){this.dispose(),this.autoRenderToScreen=!0}dispose(){for(const r of this.passes)r.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose(),$e.fullscreenGeometry.dispose()}},$t={NONE:0,DEPTH:1,CONVOLUTION:2},Y={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},gm=class{constructor(){this.shaderParts=new Map([[Y.FRAGMENT_HEAD,null],[Y.FRAGMENT_MAIN_UV,null],[Y.FRAGMENT_MAIN_IMAGE,null],[Y.VERTEX_HEAD,null],[Y.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=$t.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=Qa}},is=!1,Ba=class{constructor(r=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(r),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let t;if(e.material.flatShading)switch(e.material.side){case Yi:t=this.materialsFlatShadedDoubleSide;break;case On:t=this.materialsFlatShadedBackSide;break;default:t=this.materialsFlatShaded;break}else switch(e.material.side){case Yi:t=this.materialsDoubleSide;break;case On:t=this.materialsBackSide;break;default:t=this.materials;break}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=t[2]:e.isInstancedMesh?e.material=t[1]:e.material=t[0],++this.meshCount}}}cloneMaterial(r){if(!(r instanceof Tt))return r.clone();const e=r.uniforms,t=new Map;for(const s in e){const l=e[s].value;l.isRenderTargetTexture&&(e[s].value=null,t.set(s,l))}const n=r.clone();for(const s of t)e[s[0]].value=s[1],n.uniforms[s[0]].value=s[1];return n}setMaterial(r){if(this.disposeMaterials(),this.material=r,r!==null){const e=this.materials=[this.cloneMaterial(r),this.cloneMaterial(r),this.cloneMaterial(r)];for(const t of e)t.uniforms=Object.assign({},r.uniforms),t.side=$d;e[2].skinning=!0,this.materialsBackSide=e.map(t=>{const n=this.cloneMaterial(t);return n.uniforms=Object.assign({},r.uniforms),n.side=On,n}),this.materialsDoubleSide=e.map(t=>{const n=this.cloneMaterial(t);return n.uniforms=Object.assign({},r.uniforms),n.side=Yi,n}),this.materialsFlatShaded=e.map(t=>{const n=this.cloneMaterial(t);return n.uniforms=Object.assign({},r.uniforms),n.flatShading=!0,n}),this.materialsFlatShadedBackSide=e.map(t=>{const n=this.cloneMaterial(t);return n.uniforms=Object.assign({},r.uniforms),n.flatShading=!0,n.side=On,n}),this.materialsFlatShadedDoubleSide=e.map(t=>{const n=this.cloneMaterial(t);return n.uniforms=Object.assign({},r.uniforms),n.flatShading=!0,n.side=Yi,n})}}render(r,e,t){const n=r.shadowMap.enabled;if(r.shadowMap.enabled=!1,is){const s=this.originalMaterials;this.meshCount=0,e.traverse(this.replaceMaterial),r.render(e,t);for(const l of s)l[0].material=l[1];this.meshCount!==s.size&&s.clear()}else{const s=e.overrideMaterial;e.overrideMaterial=this.material,r.render(e,t),e.overrideMaterial=s}r.shadowMap.enabled=n}disposeMaterials(){if(this.material!==null){const r=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const e of r)e.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return is}static set workaroundEnabled(r){is=r}},mt=-1,Qe=class extends ks{constructor(r,e=mt,t=mt,n=1){super(),this.resizable=r,this.baseSize=new ne(1,1),this.preferredSize=new ne(e,t),this.target=this.preferredSize,this.s=n,this.effectiveSize=new ne,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const r=this.baseSize,e=this.preferredSize,t=this.effectiveSize,n=this.scale;e.width!==mt?t.width=e.width:e.height!==mt?t.width=Math.round(e.height*(r.width/Math.max(r.height,1))):t.width=Math.round(r.width*n),e.height!==mt?t.height=e.height:e.width!==mt?t.height=Math.round(e.width/Math.max(r.width/Math.max(r.height,1),1)):t.height=Math.round(r.height*n)}get width(){return this.effectiveSize.width}set width(r){this.preferredWidth=r}get height(){return this.effectiveSize.height}set height(r){this.preferredHeight=r}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(r){this.s!==r&&(this.s=r,this.preferredSize.setScalar(mt),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(r){this.scale=r}get baseWidth(){return this.baseSize.width}set baseWidth(r){this.baseSize.width!==r&&(this.baseSize.width=r,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(r){this.baseWidth=r}get baseHeight(){return this.baseSize.height}set baseHeight(r){this.baseSize.height!==r&&(this.baseSize.height=r,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(r){this.baseHeight=r}setBaseSize(r,e){(this.baseSize.width!==r||this.baseSize.height!==e)&&(this.baseSize.set(r,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(r){this.preferredSize.width!==r&&(this.preferredSize.width=r,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(r){this.preferredWidth=r}get preferredHeight(){return this.preferredSize.height}set preferredHeight(r){this.preferredSize.height!==r&&(this.preferredSize.height=r,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(r){this.preferredHeight=r}setPreferredSize(r,e){(this.preferredSize.width!==r||this.preferredSize.height!==e)&&(this.preferredSize.set(r,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(r){this.s=r.scale,this.baseSize.set(r.baseWidth,r.baseHeight),this.preferredSize.set(r.preferredWidth,r.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return mt}},H={ADD:0,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},bm="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb+y.rgb,y.a),y.a*opacity);}",xm="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4((x.rgb+y.rgb)*0.5,y.a),y.a*opacity);}",wm="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.xy,xHSL.z));return mix(x,vec4(z,y.a),y.a*opacity);}",ym="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=x.rgb,b=y.rgb;vec3 z=mix(step(0.0,b)*(1.0-min(vec3(1.0),(1.0-a)/b)),vec3(1.0),step(1.0,a));return mix(x,vec4(z,y.a),y.a*opacity);}",Cm="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=x.rgb,b=y.rgb;vec3 z=step(0.0,a)*mix(min(vec3(1.0),a/max(1.0-b,1e-9)),vec3(1.0),step(1.0,b));return mix(x,vec4(z,y.a),y.a*opacity);}",Em="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(min(x.rgb,y.rgb),y.a),y.a*opacity);}",Sm="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(abs(x.rgb-y.rgb),y.a),y.a*opacity);}",Pm="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb/max(y.rgb,1e-12),y.a),y.a*opacity);}",Tm="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4((x.rgb+y.rgb-2.0*x.rgb*y.rgb),y.a),y.a*opacity);}",Am="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=min(x.rgb,1.0);vec3 b=min(y.rgb,1.0);vec3 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,b));return mix(x,vec4(z,y.a),y.a*opacity);}",Mm="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(step(1.0,x.rgb+y.rgb),y.a),y.a*opacity);}",km="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.x,xHSL.yz));return mix(x,vec4(z,y.a),y.a*opacity);}",Om="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(1.0-y.rgb,y.a),y.a*opacity);}",Rm="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(y.rgb*(1.0-x.rgb),y.a),y.a*opacity);}",Dm="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(max(x.rgb,y.rgb),y.a),y.a*opacity);}",Lm="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(clamp(y.rgb+x.rgb-1.0,0.0,1.0),y.a),y.a*opacity);}",Im="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(min(x.rgb+y.rgb,1.0),y.a),y.a*opacity);}",Um="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(clamp(2.0*y.rgb+x.rgb-1.0,0.0,1.0),y.a),y.a*opacity);}",Bm="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.xy,yHSL.z));return mix(x,vec4(z,y.a),y.a*opacity);}",Nm="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb*y.rgb,y.a),y.a*opacity);}",Vm="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(1.0-abs(1.0-x.rgb-y.rgb),y.a),y.a*opacity);}",Fm="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,y.a*opacity);}",zm="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 z=mix(2.0*y.rgb*x.rgb,1.0-2.0*(1.0-y.rgb)*(1.0-x.rgb),step(0.5,x.rgb));return mix(x,vec4(z,y.a),y.a*opacity);}",Hm="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 y2=2.0*y.rgb;vec3 z=mix(mix(y2,x.rgb,step(0.5*x.rgb,y.rgb)),max(y2-1.0,vec3(0.0)),step(x.rgb,y2-1.0));return mix(x,vec4(z,y.a),y.a*opacity);}",jm="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 z=mix(min(x.rgb*x.rgb/max(1.0-y.rgb,1e-12),1.0),y.rgb,step(1.0,y.rgb));return mix(x,vec4(z,y.a),y.a*opacity);}",Gm="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.x,yHSL.y,xHSL.z));return mix(x,vec4(z,y.a),y.a*opacity);}",Km="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb+y.rgb-min(x.rgb*y.rgb,1.0),y.a),y.a*opacity);}",$m="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=x.rgb;vec3 b=y.rgb;vec3 y2=2.0*b;vec3 w=step(0.5,b);vec3 c=a-(1.0-y2)*a*(1.0-a);vec3 d=mix(a+(y2-1.0)*(sqrt(a)-a),a+(y2-1.0)*a*((16.0*a-12.0)*a+3.0),w*(1.0-step(0.25,a)));vec3 z=mix(c,d,w);return mix(x,vec4(z,y.a),y.a*opacity);}",Wm="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}",qm="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(max(x.rgb+y.rgb-1.0,0.0),y.a),y.a*opacity);}",Ym="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 z=mix(max(1.0-min((1.0-x.rgb)/(2.0*y.rgb),1.0),0.0),min(x.rgb/(2.0*(1.0-y.rgb)),1.0),step(0.5,y.rgb));return mix(x,vec4(z,y.a),y.a*opacity);}",Xm=new Map([[H.ADD,bm],[H.AVERAGE,xm],[H.COLOR,wm],[H.COLOR_BURN,ym],[H.COLOR_DODGE,Cm],[H.DARKEN,Em],[H.DIFFERENCE,Sm],[H.DIVIDE,Pm],[H.DST,null],[H.EXCLUSION,Tm],[H.HARD_LIGHT,Am],[H.HARD_MIX,Mm],[H.HUE,km],[H.INVERT,Om],[H.INVERT_RGB,Rm],[H.LIGHTEN,Dm],[H.LINEAR_BURN,Lm],[H.LINEAR_DODGE,Im],[H.LINEAR_LIGHT,Um],[H.LUMINOSITY,Bm],[H.MULTIPLY,Nm],[H.NEGATION,Vm],[H.NORMAL,Fm],[H.OVERLAY,zm],[H.PIN_LIGHT,Hm],[H.REFLECT,jm],[H.SATURATION,Gm],[H.SCREEN,Km],[H.SOFT_LIGHT,$m],[H.SRC,Wm],[H.SUBTRACT,qm],[H.VIVID_LIGHT,Ym]]),Zm=class extends ks{constructor(r,e=1){super(),this._blendFunction=r,this.opacity=new Q(e)}getOpacity(){return this.opacity.value}setOpacity(r){this.opacity.value=r}get blendFunction(){return this._blendFunction}set blendFunction(r){this._blendFunction=r,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(r){this.blendFunction=r}getShaderCode(){return Xm.get(this.blendFunction)}},Qm=class extends ks{constructor(r,e,{attributes:t=$t.NONE,blendFunction:n=H.NORMAL,defines:s=new Map,uniforms:l=new Map,extensions:h=null,vertexShader:c=null}={}){super(),this.name=r,this.renderer=null,this.attributes=t,this.fragmentShader=e,this.vertexShader=c,this.defines=s,this.uniforms=l,this.extensions=h,this.blendMode=new Zm(n),this.blendMode.addEventListener("change",p=>this.setChanged()),this._inputColorSpace=Qa,this._outputColorSpace=zn}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(r){this._inputColorSpace=r,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(r){this._outputColorSpace=r,this.setChanged()}set mainScene(r){}set mainCamera(r){}getName(){return this.name}setRenderer(r){this.renderer=r}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(r){this.attributes=r,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(r){this.fragmentShader=r,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(r){this.vertexShader=r,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(r,e=nr){}update(r,e,t){}setSize(r,e){}initialize(r,e,t){}dispose(){for(const r of Object.keys(this)){const e=this[r];(e instanceof At||e instanceof tl||e instanceof il||e instanceof $e)&&this[r].dispose()}}},qs={MEDIUM:2,LARGE:3},Jm=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,e_="uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",t_=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],i_=class extends Tt{constructor(r=new ea){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new Q(null),texelSize:new Q(new ea),scale:new Q(1),kernel:new Q(0)},blending:Si,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Jm,vertexShader:e_}),this.setTexelSize(r.x,r.y),this.kernelSize=qs.MEDIUM}set inputBuffer(r){this.uniforms.inputBuffer.value=r}setInputBuffer(r){this.inputBuffer=r}get kernelSequence(){return t_[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(r){this.uniforms.scale.value=r}getScale(){return this.uniforms.scale.value}setScale(r){this.uniforms.scale.value=r}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(r){this.uniforms.kernel.value=r}setKernel(r){this.kernel=r}setTexelSize(r,e){this.uniforms.texelSize.value.set(r,e,r*.5,e*.5)}setSize(r,e){const t=1/r,n=1/e;this.uniforms.texelSize.value.set(t,n,t*.5,n*.5)}},n_=class extends $e{constructor({kernelSize:r=qs.MEDIUM,resolutionScale:e=.5,width:t=Qe.AUTO_SIZE,height:n=Qe.AUTO_SIZE,resolutionX:s=t,resolutionY:l=n}={}){super("KawaseBlurPass"),this.renderTargetA=new At(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const h=this.resolution=new Qe(this,s,l,e);h.addEventListener("change",c=>this.setSize(h.baseWidth,h.baseHeight)),this._blurMaterial=new i_,this._blurMaterial.kernelSize=r,this.copyMaterial=new lh}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(r){this._blurMaterial=r}get dithering(){return this.copyMaterial.dithering}set dithering(r){this.copyMaterial.dithering=r}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(r){this.blurMaterial.kernelSize=r}get width(){return this.resolution.width}set width(r){this.resolution.preferredWidth=r}get height(){return this.resolution.height}set height(r){this.resolution.preferredHeight=r}get scale(){return this.blurMaterial.scale}set scale(r){this.blurMaterial.scale=r}getScale(){return this.blurMaterial.scale}setScale(r){this.blurMaterial.scale=r}getKernelSize(){return this.kernelSize}setKernelSize(r){this.kernelSize=r}getResolutionScale(){return this.resolution.scale}setResolutionScale(r){this.resolution.scale=r}render(r,e,t,n,s){const l=this.scene,h=this.camera,c=this.renderTargetA,p=this.renderTargetB,d=this.blurMaterial,f=d.kernelSequence;let _=e;this.fullscreenMaterial=d;for(let g=0,v=f.length;g<v;++g){const w=(g&1)===0?c:p;d.kernel=f[g],d.inputBuffer=_.texture,r.setRenderTarget(w),r.render(l,h),_=w}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=_.texture,r.setRenderTarget(this.renderToScreen?null:t),r.render(l,h)}setSize(r,e){const t=this.resolution;t.setBaseSize(r,e);const n=t.width,s=t.height;this.renderTargetA.setSize(n,s),this.renderTargetB.setSize(n,s),this.blurMaterial.setSize(r,e)}initialize(r,e,t){t!==void 0&&(this.renderTargetA.texture.type=t,this.renderTargetB.texture.type=t,t!==qt?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):r!==null&&r.outputColorSpace===ve&&(this.renderTargetA.texture.colorSpace=ve,this.renderTargetB.texture.colorSpace=ve))}static get AUTO_SIZE(){return Qe.AUTO_SIZE}},r_=`#include <common>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);float mask=1.0;
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);mask=low*high;
#elif defined(THRESHOLD)
mask=smoothstep(threshold,threshold+smoothing,l);
#endif
#ifdef COLOR
gl_FragColor=texel*mask;
#else
gl_FragColor=vec4(l*mask);
#endif
}`,s_=class extends Tt{constructor(r=!1,e=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:Ja.replace(/\D+/g,"")},uniforms:{inputBuffer:new Q(null),threshold:new Q(0),smoothing:new Q(1),range:new Q(null)},blending:Si,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:r_,vertexShader:ah}),this.colorOutput=r,this.luminanceRange=e}set inputBuffer(r){this.uniforms.inputBuffer.value=r}setInputBuffer(r){this.uniforms.inputBuffer.value=r}get threshold(){return this.uniforms.threshold.value}set threshold(r){this.smoothing>0||r>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=r}getThreshold(){return this.threshold}setThreshold(r){this.threshold=r}get smoothing(){return this.uniforms.smoothing.value}set smoothing(r){this.threshold>0||r>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=r}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(r){this.smoothing=r}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(r){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(r){r?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(r){return this.colorOutput}setColorOutputEnabled(r){this.colorOutput=r}get useRange(){return this.luminanceRange!==null}set useRange(r){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(r){r!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=r,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(r){this.luminanceRange=r}},o_=class extends $e{constructor({renderTarget:r,luminanceRange:e,colorOutput:t,resolutionScale:n=1,width:s=Qe.AUTO_SIZE,height:l=Qe.AUTO_SIZE,resolutionX:h=s,resolutionY:c=l}={}){super("LuminancePass"),this.fullscreenMaterial=new s_(t,e),this.needsSwap=!1,this.renderTarget=r,this.renderTarget===void 0&&(this.renderTarget=new At(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target");const p=this.resolution=new Qe(this,h,c,n);p.addEventListener("change",d=>this.setSize(p.baseWidth,p.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(r,e,t,n,s){const l=this.fullscreenMaterial;l.inputBuffer=e.texture,r.setRenderTarget(this.renderToScreen?null:this.renderTarget),r.render(this.scene,this.camera)}setSize(r,e){const t=this.resolution;t.setBaseSize(r,e),this.renderTarget.setSize(t.width,t.height)}initialize(r,e,t){t!==void 0&&t!==qt&&(this.renderTarget.texture.type=t,this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},a_=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#define WEIGHT_INNER 0.125
#define WEIGHT_OUTER 0.0555555
varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;float clampToBorder(const in vec2 uv){return float(uv.s>=0.0&&uv.s<=1.0&&uv.t>=0.0&&uv.t<=1.0);}void main(){vec4 c=vec4(0.0);vec4 w=WEIGHT_INNER*vec4(clampToBorder(vUv00),clampToBorder(vUv01),clampToBorder(vUv02),clampToBorder(vUv03));c+=w.x*texture2D(inputBuffer,vUv00);c+=w.y*texture2D(inputBuffer,vUv01);c+=w.z*texture2D(inputBuffer,vUv02);c+=w.w*texture2D(inputBuffer,vUv03);w=WEIGHT_OUTER*vec4(clampToBorder(vUv04),clampToBorder(vUv05),clampToBorder(vUv06),clampToBorder(vUv07));c+=w.x*texture2D(inputBuffer,vUv04);c+=w.y*texture2D(inputBuffer,vUv05);c+=w.z*texture2D(inputBuffer,vUv06);c+=w.w*texture2D(inputBuffer,vUv07);w=WEIGHT_OUTER*vec4(clampToBorder(vUv08),clampToBorder(vUv09),clampToBorder(vUv10),clampToBorder(vUv11));c+=w.x*texture2D(inputBuffer,vUv08);c+=w.y*texture2D(inputBuffer,vUv09);c+=w.z*texture2D(inputBuffer,vUv10);c+=w.w*texture2D(inputBuffer,vUv11);c+=WEIGHT_OUTER*texture2D(inputBuffer,vUv);gl_FragColor=c;
#include <colorspace_fragment>
}`,l_="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;void main(){vUv=position.xy*0.5+0.5;vUv00=vUv+texelSize*vec2(-1.0,1.0);vUv01=vUv+texelSize*vec2(1.0,1.0);vUv02=vUv+texelSize*vec2(-1.0,-1.0);vUv03=vUv+texelSize*vec2(1.0,-1.0);vUv04=vUv+texelSize*vec2(-2.0,2.0);vUv05=vUv+texelSize*vec2(0.0,2.0);vUv06=vUv+texelSize*vec2(2.0,2.0);vUv07=vUv+texelSize*vec2(-2.0,0.0);vUv08=vUv+texelSize*vec2(2.0,0.0);vUv09=vUv+texelSize*vec2(-2.0,-2.0);vUv10=vUv+texelSize*vec2(0.0,-2.0);vUv11=vUv+texelSize*vec2(2.0,-2.0);gl_Position=vec4(position.xy,1.0,1.0);}",h_=class extends Tt{constructor(){super({name:"DownsamplingMaterial",uniforms:{inputBuffer:new Q(null),texelSize:new Q(new ne)},blending:Si,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:a_,vertexShader:l_})}set inputBuffer(r){this.uniforms.inputBuffer.value=r}setSize(r,e){this.uniforms.texelSize.value.set(1/r,1/e)}},u_=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;uniform mediump sampler2D supportBuffer;
#else
uniform lowp sampler2D inputBuffer;uniform lowp sampler2D supportBuffer;
#endif
uniform float radius;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vec4 c=vec4(0.0);c+=texture2D(inputBuffer,vUv0)*0.0625;c+=texture2D(inputBuffer,vUv1)*0.125;c+=texture2D(inputBuffer,vUv2)*0.0625;c+=texture2D(inputBuffer,vUv3)*0.125;c+=texture2D(inputBuffer,vUv)*0.25;c+=texture2D(inputBuffer,vUv4)*0.125;c+=texture2D(inputBuffer,vUv5)*0.0625;c+=texture2D(inputBuffer,vUv6)*0.125;c+=texture2D(inputBuffer,vUv7)*0.0625;vec4 baseColor=texture2D(supportBuffer,vUv);gl_FragColor=mix(baseColor,c,radius);
#include <colorspace_fragment>
}`,c_="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,1.0);vUv1=vUv+texelSize*vec2(0.0,1.0);vUv2=vUv+texelSize*vec2(1.0,1.0);vUv3=vUv+texelSize*vec2(-1.0,0.0);vUv4=vUv+texelSize*vec2(1.0,0.0);vUv5=vUv+texelSize*vec2(-1.0,-1.0);vUv6=vUv+texelSize*vec2(0.0,-1.0);vUv7=vUv+texelSize*vec2(1.0,-1.0);gl_Position=vec4(position.xy,1.0,1.0);}",d_=class extends Tt{constructor(){super({name:"UpsamplingMaterial",uniforms:{inputBuffer:new Q(null),supportBuffer:new Q(null),texelSize:new Q(new ne),radius:new Q(.85)},blending:Si,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:u_,vertexShader:c_})}set inputBuffer(r){this.uniforms.inputBuffer.value=r}set supportBuffer(r){this.uniforms.supportBuffer.value=r}get radius(){return this.uniforms.radius.value}set radius(r){this.uniforms.radius.value=r}setSize(r,e){this.uniforms.texelSize.value.set(1/r,1/e)}},p_=class extends $e{constructor(){super("MipmapBlurPass"),this.needsSwap=!1,this.renderTarget=new At(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Upsampling.Mipmap0",this.downsamplingMipmaps=[],this.upsamplingMipmaps=[],this.downsamplingMaterial=new h_,this.upsamplingMaterial=new d_,this.resolution=new ne}get texture(){return this.renderTarget.texture}get levels(){return this.downsamplingMipmaps.length}set levels(r){if(this.levels!==r){const e=this.renderTarget;this.dispose(),this.downsamplingMipmaps=[],this.upsamplingMipmaps=[];for(let t=0;t<r;++t){const n=e.clone();n.texture.name="Downsampling.Mipmap"+t,this.downsamplingMipmaps.push(n)}this.upsamplingMipmaps.push(e);for(let t=1,n=r-1;t<n;++t){const s=e.clone();s.texture.name="Upsampling.Mipmap"+t,this.upsamplingMipmaps.push(s)}this.setSize(this.resolution.x,this.resolution.y)}}get radius(){return this.upsamplingMaterial.radius}set radius(r){this.upsamplingMaterial.radius=r}render(r,e,t,n,s){const{scene:l,camera:h}=this,{downsamplingMaterial:c,upsamplingMaterial:p}=this,{downsamplingMipmaps:d,upsamplingMipmaps:f}=this;let _=e;this.fullscreenMaterial=c;for(let g=0,v=d.length;g<v;++g){const w=d[g];c.setSize(_.width,_.height),c.inputBuffer=_.texture,r.setRenderTarget(w),r.render(l,h),_=w}this.fullscreenMaterial=p;for(let g=f.length-1;g>=0;--g){const v=f[g];p.setSize(_.width,_.height),p.inputBuffer=_.texture,p.supportBuffer=d[g].texture,r.setRenderTarget(v),r.render(l,h),_=v}}setSize(r,e){const t=this.resolution;t.set(r,e);let n=t.width,s=t.height;for(let l=0,h=this.downsamplingMipmaps.length;l<h;++l)n=Math.round(n*.5),s=Math.round(s*.5),this.downsamplingMipmaps[l].setSize(n,s),l<this.upsamplingMipmaps.length&&this.upsamplingMipmaps[l].setSize(n,s)}initialize(r,e,t){if(t!==void 0){const n=this.downsamplingMipmaps.concat(this.upsamplingMipmaps);for(const s of n)s.texture.type=t;if(t!==qt)this.downsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.upsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1";else if(r!==null&&r.outputColorSpace===ve)for(const s of n)s.texture.colorSpace=ve}}dispose(){super.dispose();for(const r of this.downsamplingMipmaps.concat(this.upsamplingMipmaps))r.dispose()}},f_=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 texel=texture2D(map,uv);outputColor=vec4(texel.rgb*intensity,max(inputColor.a,texel.a));}`,m_=class extends Qm{constructor({blendFunction:r=H.SCREEN,luminanceThreshold:e=1,luminanceSmoothing:t=.03,mipmapBlur:n=!0,intensity:s=1,radius:l=.85,levels:h=8,kernelSize:c=qs.LARGE,resolutionScale:p=.5,width:d=Qe.AUTO_SIZE,height:f=Qe.AUTO_SIZE,resolutionX:_=d,resolutionY:g=f}={}){super("BloomEffect",f_,{blendFunction:r,uniforms:new Map([["map",new Q(null)],["intensity",new Q(s)]])}),this.renderTarget=new At(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.blurPass=new n_({kernelSize:c}),this.luminancePass=new o_({colorOutput:!0}),this.luminanceMaterial.threshold=e,this.luminanceMaterial.smoothing=t,this.mipmapBlurPass=new p_,this.mipmapBlurPass.enabled=n,this.mipmapBlurPass.radius=l,this.mipmapBlurPass.levels=h,this.uniforms.get("map").value=n?this.mipmapBlurPass.texture:this.renderTarget.texture;const v=this.resolution=new Qe(this,_,g,p);v.addEventListener("change",w=>this.setSize(v.baseWidth,v.baseHeight))}get texture(){return this.mipmapBlurPass.enabled?this.mipmapBlurPass.texture:this.renderTarget.texture}getTexture(){return this.texture}getResolution(){return this.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(r){this.resolution.preferredWidth=r}get height(){return this.resolution.height}set height(r){this.resolution.preferredHeight=r}get dithering(){return this.blurPass.dithering}set dithering(r){this.blurPass.dithering=r}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(r){this.blurPass.kernelSize=r}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(r){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(r){this.uniforms.get("intensity").value=r}getIntensity(){return this.intensity}setIntensity(r){this.intensity=r}getResolutionScale(){return this.resolution.scale}setResolutionScale(r){this.resolution.scale=r}update(r,e,t){const n=this.renderTarget,s=this.luminancePass;s.enabled?(s.render(r,e),this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(r,s.renderTarget):this.blurPass.render(r,s.renderTarget,n)):this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(r,e):this.blurPass.render(r,e,n)}setSize(r,e){const t=this.resolution;t.setBaseSize(r,e),this.renderTarget.setSize(t.width,t.height),this.blurPass.resolution.copy(t),this.luminancePass.setSize(r,e),this.mipmapBlurPass.setSize(r,e)}initialize(r,e,t){this.blurPass.initialize(r,e,t),this.luminancePass.initialize(r,e,t),this.mipmapBlurPass.initialize(r,e,t),t!==void 0&&(this.renderTarget.texture.type=t,r!==null&&r.outputColorSpace===ve&&(this.renderTarget.texture.colorSpace=ve))}},__=class extends $e{constructor(r,e,t=null){super("RenderPass",r,e),this.needsSwap=!1,this.clearPass=new hh,this.overrideMaterialManager=t===null?null:new Ba(t),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(r){this.scene=r}set mainCamera(r){this.camera=r}get renderToScreen(){return super.renderToScreen}set renderToScreen(r){super.renderToScreen=r,this.clearPass.renderToScreen=r}get overrideMaterial(){const r=this.overrideMaterialManager;return r!==null?r.material:null}set overrideMaterial(r){const e=this.overrideMaterialManager;r!==null?e!==null?e.setMaterial(r):this.overrideMaterialManager=new Ba(r):e!==null&&(e.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(r){this.overrideMaterial=r}get clear(){return this.clearPass.enabled}set clear(r){this.clearPass.enabled=r}getSelection(){return this.selection}setSelection(r){this.selection=r}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(r){this.ignoreBackground=r}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(r){this.skipShadowMapUpdate=r}getClearPass(){return this.clearPass}render(r,e,t,n,s){const l=this.scene,h=this.camera,c=this.selection,p=h.layers.mask,d=l.background,f=r.shadowMap.autoUpdate,_=this.renderToScreen?null:e;c!==null&&h.layers.set(c.getLayer()),this.skipShadowMapUpdate&&(r.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(l.background=null),this.clearPass.enabled&&this.clearPass.render(r,e),r.setRenderTarget(_),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(r,l,h):r.render(l,h),h.layers.mask=p,l.background=d,r.shadowMap.autoUpdate=f}},v_=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
float depth=unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
float depth=texture2D(depthBuffer,uv).r;
#endif
#if defined(USE_LOGARITHMIC_DEPTH_BUFFER) || defined(LOG_DEPTH)
float d=pow(2.0,depth*log2(cameraFar+1.0))-1.0;float a=cameraFar/(cameraFar-cameraNear);float b=cameraFar*cameraNear/(cameraNear-cameraFar);depth=a+b/d;
#elif defined(USE_REVERSED_DEPTH_BUFFER)
depth=1.0-depth;
#endif
return depth;}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,g_="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",b_=class extends Tt{constructor(r,e,t,n,s=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:Ja.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new Q(null),depthBuffer:new Q(null),resolution:new Q(new ne),texelSize:new Q(new ne),cameraNear:new Q(.3),cameraFar:new Q(1e3),aspect:new Q(1),time:new Q(0)},blending:Si,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:s}),r&&this.setShaderParts(r),e&&this.setDefines(e),t&&this.setUniforms(t),this.copyCameraSettings(n)}set inputBuffer(r){this.uniforms.inputBuffer.value=r}setInputBuffer(r){this.uniforms.inputBuffer.value=r}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(r){this.uniforms.depthBuffer.value=r}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(r){this.defines.DEPTH_PACKING=r.toFixed(0),this.needsUpdate=!0}setDepthBuffer(r,e=nr){this.depthBuffer=r,this.depthPacking=e}setShaderData(r){this.setShaderParts(r.shaderParts),this.setDefines(r.defines),this.setUniforms(r.uniforms),this.setExtensions(r.extensions)}setShaderParts(r){return this.fragmentShader=v_.replace(Y.FRAGMENT_HEAD,r.get(Y.FRAGMENT_HEAD)||"").replace(Y.FRAGMENT_MAIN_UV,r.get(Y.FRAGMENT_MAIN_UV)||"").replace(Y.FRAGMENT_MAIN_IMAGE,r.get(Y.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=g_.replace(Y.VERTEX_HEAD,r.get(Y.VERTEX_HEAD)||"").replace(Y.VERTEX_MAIN_SUPPORT,r.get(Y.VERTEX_MAIN_SUPPORT)||""),this.needsUpdate=!0,this}setDefines(r){for(const e of r.entries())this.defines[e[0]]=e[1];return this.needsUpdate=!0,this}setUniforms(r){for(const e of r.entries())this.uniforms[e[0]]=e[1];return this}setExtensions(r){this.extensions={};for(const e of r)this.extensions[e]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(r){this.encodeOutput!==r&&(r?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(r){return this.encodeOutput}setOutputEncodingEnabled(r){this.encodeOutput=r}get time(){return this.uniforms.time.value}set time(r){this.uniforms.time.value=r}setDeltaTime(r){this.uniforms.time.value+=r}adoptCameraSettings(r){this.copyCameraSettings(r)}copyCameraSettings(r){r&&(this.uniforms.cameraNear.value=r.near,this.uniforms.cameraFar.value=r.far,r instanceof el?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(r,e){const t=this.uniforms;t.resolution.value.set(r,e),t.texelSize.value.set(1/r,1/e),t.aspect.value=r/e}static get Section(){return Y}};function Na(r,e,t){for(const n of e){const s="$1"+r+n.charAt(0).toUpperCase()+n.slice(1),l=new RegExp("([^\\.])(\\b"+n+"\\b)","g");for(const h of t.entries())h[1]!==null&&t.set(h[0],h[1].replace(l,s))}}function x_(r,e,t){let n=e.getFragmentShader(),s=e.getVertexShader();const l=n!==void 0&&/mainImage/.test(n),h=n!==void 0&&/mainUv/.test(n);if(t.attributes|=e.getAttributes(),n===void 0)throw new Error(`Missing fragment shader (${e.name})`);if(h&&(t.attributes&$t.CONVOLUTION)!==0)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${e.name})`);if(!l&&!h)throw new Error(`Could not find mainImage or mainUv function (${e.name})`);{const c=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,p=t.shaderParts;let d=p.get(Y.FRAGMENT_HEAD)||"",f=p.get(Y.FRAGMENT_MAIN_UV)||"",_=p.get(Y.FRAGMENT_MAIN_IMAGE)||"",g=p.get(Y.VERTEX_HEAD)||"",v=p.get(Y.VERTEX_MAIN_SUPPORT)||"";const w=new Set,b=new Set;if(h&&(f+=`	${r}MainUv(UV);
`,t.uvTransformation=!0),s!==null&&/mainSupport/.test(s)){const C=/mainSupport *\([\w\s]*?uv\s*?\)/.test(s);v+=`	${r}MainSupport(`,v+=C?`vUv);
`:`);
`;for(const P of s.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const M of P[1].split(/\s*,\s*/))t.varyings.add(M),w.add(M),b.add(M);for(const P of s.matchAll(c))b.add(P[1])}for(const C of n.matchAll(c))b.add(C[1]);for(const C of e.defines.keys())b.add(C.replace(/\([\w\s,]*\)/g,""));for(const C of e.uniforms.keys())b.add(C);b.delete("while"),b.delete("for"),b.delete("if"),e.uniforms.forEach((C,P)=>t.uniforms.set(r+P.charAt(0).toUpperCase()+P.slice(1),C)),e.defines.forEach((C,P)=>t.defines.set(r+P.charAt(0).toUpperCase()+P.slice(1),C));const x=new Map([["fragment",n],["vertex",s]]);Na(r,b,t.defines),Na(r,b,x),n=x.get("fragment"),s=x.get("vertex");const S=e.blendMode;if(t.blendModes.set(S.blendFunction,S),l){e.inputColorSpace!==null&&e.inputColorSpace!==t.colorSpace&&(_+=e.inputColorSpace===ve?`color0 = sRGBTransferOETF(color0);
	`:`color0 = sRGBToLinear(color0);
	`),e.outputColorSpace!==zn?t.colorSpace=e.outputColorSpace:e.inputColorSpace!==null&&(t.colorSpace=e.inputColorSpace);const C=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;_+=`${r}MainImage(color0, UV, `,(t.attributes&$t.DEPTH)!==0&&C.test(n)&&(_+="depth, ",t.readDepth=!0),_+=`color1);
	`;const P=r+"BlendOpacity";t.uniforms.set(P,S.opacity),_+=`color0 = blend${S.blendFunction}(color0, color1, ${P});

	`,d+=`uniform float ${P};

`}if(d+=n+`
`,s!==null&&(g+=s+`
`),p.set(Y.FRAGMENT_HEAD,d),p.set(Y.FRAGMENT_MAIN_UV,f),p.set(Y.FRAGMENT_MAIN_IMAGE,_),p.set(Y.VERTEX_HEAD,g),p.set(Y.VERTEX_MAIN_SUPPORT,v),e.extensions!==null)for(const C of e.extensions)t.extensions.add(C)}}var w_=class extends $e{constructor(r,...e){super("EffectPass"),this.fullscreenMaterial=new b_(null,null,null,r),this.listener=t=>this.handleEvent(t),this.effects=[],this.setEffects(e),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(r){for(const e of this.effects)e.mainScene=r}set mainCamera(r){this.fullscreenMaterial.copyCameraSettings(r);for(const e of this.effects)e.mainCamera=r}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(r){this.fullscreenMaterial.encodeOutput=r}get dithering(){return this.fullscreenMaterial.dithering}set dithering(r){const e=this.fullscreenMaterial;e.dithering=r,e.needsUpdate=!0}setEffects(r){for(const e of this.effects)e.removeEventListener("change",this.listener);this.effects=r.sort((e,t)=>t.attributes-e.attributes);for(const e of this.effects)e.addEventListener("change",this.listener)}updateMaterial(){const r=new gm;let e=0;for(const h of this.effects)if(h.blendMode.blendFunction===H.DST)r.attributes|=h.getAttributes()&$t.DEPTH;else{if((r.attributes&h.getAttributes()&$t.CONVOLUTION)!==0)throw new Error(`Convolution effects cannot be merged (${h.name})`);x_("e"+e++,h,r)}let t=r.shaderParts.get(Y.FRAGMENT_HEAD),n=r.shaderParts.get(Y.FRAGMENT_MAIN_IMAGE),s=r.shaderParts.get(Y.FRAGMENT_MAIN_UV);const l=/\bblend\b/g;for(const h of r.blendModes.values())t+=h.getShaderCode().replace(l,`blend${h.blendFunction}`)+`
`;(r.attributes&$t.DEPTH)!==0?(r.readDepth&&(n=`float depth = readDepth(UV);

	`+n),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,r.colorSpace===ve&&(n+=`color0 = sRGBToLinear(color0);
	`),r.uvTransformation?(s=`vec2 transformedUv = vUv;
`+s,r.defines.set("UV","transformedUv")):r.defines.set("UV","vUv"),r.shaderParts.set(Y.FRAGMENT_HEAD,t),r.shaderParts.set(Y.FRAGMENT_MAIN_IMAGE,n),r.shaderParts.set(Y.FRAGMENT_MAIN_UV,s);for(const[h,c]of r.shaderParts)c!==null&&r.shaderParts.set(h,c.trim().replace(/^#/,`
#`));this.skipRendering=e===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(r)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(r,e=nr){this.fullscreenMaterial.depthBuffer=r,this.fullscreenMaterial.depthPacking=e;for(const t of this.effects)t.setDepthTexture(r,e)}render(r,e,t,n,s){for(const l of this.effects)l.update(r,e,n);if(!this.skipRendering||this.renderToScreen){const l=this.fullscreenMaterial;l.inputBuffer=e.texture,l.time+=n*this.timeScale,r.setRenderTarget(this.renderToScreen?null:t),r.render(this.scene,this.camera)}}setSize(r,e){this.fullscreenMaterial.setSize(r,e);for(const t of this.effects)t.setSize(r,e)}initialize(r,e,t){this.renderer=r;for(const n of this.effects)n.initialize(r,e,t);this.updateMaterial(),t!==void 0&&t!==qt&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const r of this.effects)r.removeEventListener("change",this.listener),r.dispose()}handleEvent(r){switch(r.type){case"change":this.recompile();break}}},ns,Va;function y_(){return Va||(Va=1,ns={jet:[{index:0,rgb:[0,0,131]},{index:.125,rgb:[0,60,170]},{index:.375,rgb:[5,255,255]},{index:.625,rgb:[255,255,0]},{index:.875,rgb:[250,0,0]},{index:1,rgb:[128,0,0]}],hsv:[{index:0,rgb:[255,0,0]},{index:.169,rgb:[253,255,2]},{index:.173,rgb:[247,255,2]},{index:.337,rgb:[0,252,4]},{index:.341,rgb:[0,252,10]},{index:.506,rgb:[1,249,255]},{index:.671,rgb:[2,0,253]},{index:.675,rgb:[8,0,253]},{index:.839,rgb:[255,0,251]},{index:.843,rgb:[255,0,245]},{index:1,rgb:[255,0,6]}],hot:[{index:0,rgb:[0,0,0]},{index:.3,rgb:[230,0,0]},{index:.6,rgb:[255,210,0]},{index:1,rgb:[255,255,255]}],spring:[{index:0,rgb:[255,0,255]},{index:1,rgb:[255,255,0]}],summer:[{index:0,rgb:[0,128,102]},{index:1,rgb:[255,255,102]}],autumn:[{index:0,rgb:[255,0,0]},{index:1,rgb:[255,255,0]}],winter:[{index:0,rgb:[0,0,255]},{index:1,rgb:[0,255,128]}],bone:[{index:0,rgb:[0,0,0]},{index:.376,rgb:[84,84,116]},{index:.753,rgb:[169,200,200]},{index:1,rgb:[255,255,255]}],copper:[{index:0,rgb:[0,0,0]},{index:.804,rgb:[255,160,102]},{index:1,rgb:[255,199,127]}],greys:[{index:0,rgb:[0,0,0]},{index:1,rgb:[255,255,255]}],yignbu:[{index:0,rgb:[8,29,88]},{index:.125,rgb:[37,52,148]},{index:.25,rgb:[34,94,168]},{index:.375,rgb:[29,145,192]},{index:.5,rgb:[65,182,196]},{index:.625,rgb:[127,205,187]},{index:.75,rgb:[199,233,180]},{index:.875,rgb:[237,248,217]},{index:1,rgb:[255,255,217]}],greens:[{index:0,rgb:[0,68,27]},{index:.125,rgb:[0,109,44]},{index:.25,rgb:[35,139,69]},{index:.375,rgb:[65,171,93]},{index:.5,rgb:[116,196,118]},{index:.625,rgb:[161,217,155]},{index:.75,rgb:[199,233,192]},{index:.875,rgb:[229,245,224]},{index:1,rgb:[247,252,245]}],yiorrd:[{index:0,rgb:[128,0,38]},{index:.125,rgb:[189,0,38]},{index:.25,rgb:[227,26,28]},{index:.375,rgb:[252,78,42]},{index:.5,rgb:[253,141,60]},{index:.625,rgb:[254,178,76]},{index:.75,rgb:[254,217,118]},{index:.875,rgb:[255,237,160]},{index:1,rgb:[255,255,204]}],bluered:[{index:0,rgb:[0,0,255]},{index:1,rgb:[255,0,0]}],rdbu:[{index:0,rgb:[5,10,172]},{index:.35,rgb:[106,137,247]},{index:.5,rgb:[190,190,190]},{index:.6,rgb:[220,170,132]},{index:.7,rgb:[230,145,90]},{index:1,rgb:[178,10,28]}],picnic:[{index:0,rgb:[0,0,255]},{index:.1,rgb:[51,153,255]},{index:.2,rgb:[102,204,255]},{index:.3,rgb:[153,204,255]},{index:.4,rgb:[204,204,255]},{index:.5,rgb:[255,255,255]},{index:.6,rgb:[255,204,255]},{index:.7,rgb:[255,153,255]},{index:.8,rgb:[255,102,204]},{index:.9,rgb:[255,102,102]},{index:1,rgb:[255,0,0]}],rainbow:[{index:0,rgb:[150,0,90]},{index:.125,rgb:[0,0,200]},{index:.25,rgb:[0,25,255]},{index:.375,rgb:[0,152,255]},{index:.5,rgb:[44,255,150]},{index:.625,rgb:[151,255,0]},{index:.75,rgb:[255,234,0]},{index:.875,rgb:[255,111,0]},{index:1,rgb:[255,0,0]}],portland:[{index:0,rgb:[12,51,131]},{index:.25,rgb:[10,136,186]},{index:.5,rgb:[242,211,56]},{index:.75,rgb:[242,143,56]},{index:1,rgb:[217,30,30]}],blackbody:[{index:0,rgb:[0,0,0]},{index:.2,rgb:[230,0,0]},{index:.4,rgb:[230,210,0]},{index:.7,rgb:[255,255,255]},{index:1,rgb:[160,200,255]}],earth:[{index:0,rgb:[0,0,130]},{index:.1,rgb:[0,180,180]},{index:.2,rgb:[40,210,40]},{index:.4,rgb:[230,230,50]},{index:.6,rgb:[120,70,20]},{index:1,rgb:[255,255,255]}],electric:[{index:0,rgb:[0,0,0]},{index:.15,rgb:[30,0,100]},{index:.4,rgb:[120,0,100]},{index:.6,rgb:[160,90,0]},{index:.8,rgb:[230,200,0]},{index:1,rgb:[255,250,220]}],alpha:[{index:0,rgb:[255,255,255,0]},{index:1,rgb:[255,255,255,1]}],viridis:[{index:0,rgb:[68,1,84]},{index:.13,rgb:[71,44,122]},{index:.25,rgb:[59,81,139]},{index:.38,rgb:[44,113,142]},{index:.5,rgb:[33,144,141]},{index:.63,rgb:[39,173,129]},{index:.75,rgb:[92,200,99]},{index:.88,rgb:[170,220,50]},{index:1,rgb:[253,231,37]}],inferno:[{index:0,rgb:[0,0,4]},{index:.13,rgb:[31,12,72]},{index:.25,rgb:[85,15,109]},{index:.38,rgb:[136,34,106]},{index:.5,rgb:[186,54,85]},{index:.63,rgb:[227,89,51]},{index:.75,rgb:[249,140,10]},{index:.88,rgb:[249,201,50]},{index:1,rgb:[252,255,164]}],magma:[{index:0,rgb:[0,0,4]},{index:.13,rgb:[28,16,68]},{index:.25,rgb:[79,18,123]},{index:.38,rgb:[129,37,129]},{index:.5,rgb:[181,54,122]},{index:.63,rgb:[229,80,100]},{index:.75,rgb:[251,135,97]},{index:.88,rgb:[254,194,135]},{index:1,rgb:[252,253,191]}],plasma:[{index:0,rgb:[13,8,135]},{index:.13,rgb:[75,3,161]},{index:.25,rgb:[125,3,168]},{index:.38,rgb:[168,34,150]},{index:.5,rgb:[203,70,121]},{index:.63,rgb:[229,107,93]},{index:.75,rgb:[248,148,65]},{index:.88,rgb:[253,195,40]},{index:1,rgb:[240,249,33]}],warm:[{index:0,rgb:[125,0,179]},{index:.13,rgb:[172,0,187]},{index:.25,rgb:[219,0,170]},{index:.38,rgb:[255,0,130]},{index:.5,rgb:[255,63,74]},{index:.63,rgb:[255,123,0]},{index:.75,rgb:[234,176,0]},{index:.88,rgb:[190,228,0]},{index:1,rgb:[147,255,0]}],cool:[{index:0,rgb:[125,0,179]},{index:.13,rgb:[116,0,218]},{index:.25,rgb:[98,74,237]},{index:.38,rgb:[68,146,231]},{index:.5,rgb:[0,204,197]},{index:.63,rgb:[0,247,146]},{index:.75,rgb:[0,255,88]},{index:.88,rgb:[40,255,8]},{index:1,rgb:[147,255,0]}],"rainbow-soft":[{index:0,rgb:[125,0,179]},{index:.1,rgb:[199,0,180]},{index:.2,rgb:[255,0,121]},{index:.3,rgb:[255,108,0]},{index:.4,rgb:[222,194,0]},{index:.5,rgb:[150,255,0]},{index:.6,rgb:[0,255,55]},{index:.7,rgb:[0,246,150]},{index:.8,rgb:[50,167,222]},{index:.9,rgb:[103,51,235]},{index:1,rgb:[124,0,186]}],bathymetry:[{index:0,rgb:[40,26,44]},{index:.13,rgb:[59,49,90]},{index:.25,rgb:[64,76,139]},{index:.38,rgb:[63,110,151]},{index:.5,rgb:[72,142,158]},{index:.63,rgb:[85,174,163]},{index:.75,rgb:[120,206,163]},{index:.88,rgb:[187,230,172]},{index:1,rgb:[253,254,204]}],cdom:[{index:0,rgb:[47,15,62]},{index:.13,rgb:[87,23,86]},{index:.25,rgb:[130,28,99]},{index:.38,rgb:[171,41,96]},{index:.5,rgb:[206,67,86]},{index:.63,rgb:[230,106,84]},{index:.75,rgb:[242,149,103]},{index:.88,rgb:[249,193,135]},{index:1,rgb:[254,237,176]}],chlorophyll:[{index:0,rgb:[18,36,20]},{index:.13,rgb:[25,63,41]},{index:.25,rgb:[24,91,59]},{index:.38,rgb:[13,119,72]},{index:.5,rgb:[18,148,80]},{index:.63,rgb:[80,173,89]},{index:.75,rgb:[132,196,122]},{index:.88,rgb:[175,221,162]},{index:1,rgb:[215,249,208]}],density:[{index:0,rgb:[54,14,36]},{index:.13,rgb:[89,23,80]},{index:.25,rgb:[110,45,132]},{index:.38,rgb:[120,77,178]},{index:.5,rgb:[120,113,213]},{index:.63,rgb:[115,151,228]},{index:.75,rgb:[134,185,227]},{index:.88,rgb:[177,214,227]},{index:1,rgb:[230,241,241]}],"freesurface-blue":[{index:0,rgb:[30,4,110]},{index:.13,rgb:[47,14,176]},{index:.25,rgb:[41,45,236]},{index:.38,rgb:[25,99,212]},{index:.5,rgb:[68,131,200]},{index:.63,rgb:[114,156,197]},{index:.75,rgb:[157,181,203]},{index:.88,rgb:[200,208,216]},{index:1,rgb:[241,237,236]}],"freesurface-red":[{index:0,rgb:[60,9,18]},{index:.13,rgb:[100,17,27]},{index:.25,rgb:[142,20,29]},{index:.38,rgb:[177,43,27]},{index:.5,rgb:[192,87,63]},{index:.63,rgb:[205,125,105]},{index:.75,rgb:[216,162,148]},{index:.88,rgb:[227,199,193]},{index:1,rgb:[241,237,236]}],oxygen:[{index:0,rgb:[64,5,5]},{index:.13,rgb:[106,6,15]},{index:.25,rgb:[144,26,7]},{index:.38,rgb:[168,64,3]},{index:.5,rgb:[188,100,4]},{index:.63,rgb:[206,136,11]},{index:.75,rgb:[220,174,25]},{index:.88,rgb:[231,215,44]},{index:1,rgb:[248,254,105]}],par:[{index:0,rgb:[51,20,24]},{index:.13,rgb:[90,32,35]},{index:.25,rgb:[129,44,34]},{index:.38,rgb:[159,68,25]},{index:.5,rgb:[182,99,19]},{index:.63,rgb:[199,134,22]},{index:.75,rgb:[212,171,35]},{index:.88,rgb:[221,210,54]},{index:1,rgb:[225,253,75]}],phase:[{index:0,rgb:[145,105,18]},{index:.13,rgb:[184,71,38]},{index:.25,rgb:[186,58,115]},{index:.38,rgb:[160,71,185]},{index:.5,rgb:[110,97,218]},{index:.63,rgb:[50,123,164]},{index:.75,rgb:[31,131,110]},{index:.88,rgb:[77,129,34]},{index:1,rgb:[145,105,18]}],salinity:[{index:0,rgb:[42,24,108]},{index:.13,rgb:[33,50,162]},{index:.25,rgb:[15,90,145]},{index:.38,rgb:[40,118,137]},{index:.5,rgb:[59,146,135]},{index:.63,rgb:[79,175,126]},{index:.75,rgb:[120,203,104]},{index:.88,rgb:[193,221,100]},{index:1,rgb:[253,239,154]}],temperature:[{index:0,rgb:[4,35,51]},{index:.13,rgb:[23,51,122]},{index:.25,rgb:[85,59,157]},{index:.38,rgb:[129,79,143]},{index:.5,rgb:[175,95,130]},{index:.63,rgb:[222,112,101]},{index:.75,rgb:[249,146,66]},{index:.88,rgb:[249,196,65]},{index:1,rgb:[232,250,91]}],turbidity:[{index:0,rgb:[34,31,27]},{index:.13,rgb:[65,50,41]},{index:.25,rgb:[98,69,52]},{index:.38,rgb:[131,89,57]},{index:.5,rgb:[161,112,59]},{index:.63,rgb:[185,140,66]},{index:.75,rgb:[202,174,88]},{index:.88,rgb:[216,209,126]},{index:1,rgb:[233,246,171]}],"velocity-blue":[{index:0,rgb:[17,32,64]},{index:.13,rgb:[35,52,116]},{index:.25,rgb:[29,81,156]},{index:.38,rgb:[31,113,162]},{index:.5,rgb:[50,144,169]},{index:.63,rgb:[87,173,176]},{index:.75,rgb:[149,196,189]},{index:.88,rgb:[203,221,211]},{index:1,rgb:[254,251,230]}],"velocity-green":[{index:0,rgb:[23,35,19]},{index:.13,rgb:[24,64,38]},{index:.25,rgb:[11,95,45]},{index:.38,rgb:[39,123,35]},{index:.5,rgb:[95,146,12]},{index:.63,rgb:[152,165,18]},{index:.75,rgb:[201,186,69]},{index:.88,rgb:[233,216,137]},{index:1,rgb:[255,253,205]}],cubehelix:[{index:0,rgb:[0,0,0]},{index:.07,rgb:[22,5,59]},{index:.13,rgb:[60,4,105]},{index:.2,rgb:[109,1,135]},{index:.27,rgb:[161,0,147]},{index:.33,rgb:[210,2,142]},{index:.4,rgb:[251,11,123]},{index:.47,rgb:[255,29,97]},{index:.53,rgb:[255,54,69]},{index:.6,rgb:[255,85,46]},{index:.67,rgb:[255,120,34]},{index:.73,rgb:[255,157,37]},{index:.8,rgb:[241,191,57]},{index:.87,rgb:[224,220,93]},{index:.93,rgb:[218,241,142]},{index:1,rgb:[227,253,198]}]}),ns}var rs,Fa;function C_(){if(Fa)return rs;Fa=1;function r(e,t,n){return e*(1-n)+t*n}return rs=r,rs}var ss,za;function E_(){if(za)return ss;za=1;var r=y_(),e=C_();ss=t;function t(h){var c,p,d,f,_,g,v,w,C,b,x;if(h||(h={}),w=(h.nshades||72)-1,v=h.format||"hex",g=h.colormap,g||(g="jet"),typeof g=="string"){if(g=g.toLowerCase(),!r[g])throw Error(g+" not a supported colorscale");_=r[g]}else if(Array.isArray(g))_=g.slice();else throw Error("unsupported colormap option",g);if(_.length>w+1)throw new Error(g+" map requires nshades to be at least size "+_.length);Array.isArray(h.alpha)?h.alpha.length!==2?b=[1,1]:b=h.alpha.slice():typeof h.alpha=="number"?b=[h.alpha,h.alpha]:b=[1,1],c=_.map(function(T){return Math.round(T.index*w)}),b[0]=Math.min(Math.max(b[0],0),1),b[1]=Math.min(Math.max(b[1],0),1);var S=_.map(function(T,A){var R=_[A].index,k=_[A].rgb.slice();return k.length===4&&k[3]>=0&&k[3]<=1||(k[3]=b[0]+(b[1]-b[0])*R),k}),C=[];for(x=0;x<c.length-1;++x){f=c[x+1]-c[x],p=S[x],d=S[x+1];for(var P=0;P<f;P++){var M=P/f;C.push([Math.round(e(p[0],d[0],M)),Math.round(e(p[1],d[1],M)),Math.round(e(p[2],d[2],M)),e(p[3],d[3],M)])}}return C.push(_[_.length-1].rgb.concat(b[1])),v==="hex"?C=C.map(s):v==="rgbaString"?C=C.map(l):v==="float"&&(C=C.map(n)),C}function n(h){return[h[0]/255,h[1]/255,h[2]/255,h[3]]}function s(h){for(var c,p="#",d=0;d<3;++d)c=h[d],c=c.toString(16),p+=("00"+c).substr(c.length);return p}function l(h){return"rgba("+h.join(",")+")"}return ss}var S_=E_();const P_=Ya(S_),Ha=(r,e)=>P_({colormap:r,nshades:e,format:"float",alpha:1}),ja=(r,e,t)=>r*(1-t)+e*t,T_=(r,e,t)=>A_((t-r)/(e-r)),A_=(r,e=0,t=1)=>Math.min(t,Math.max(e,r));var M_=qd();const zt=1024,k_=50,O_=-15,R_=15,D_=5,L_=3,I_=50,U_=(r,e)=>{let t=[];for(let n=0;n<r;n++)t.push(Array(e).fill(0));return t},B_=r=>{const{perceptualSpread:e,perceptualSharpness:t,spectralFlatness:n,loudness:s}=r;return{loudness:T_(L_,I_,s.total),perceptualSharpness:t,perceptualSpread:e,spectralFlatness:n}},N_={audio:{channelCount:{ideal:2,min:1},echoCancellation:!0,autoGainControl:!0,noiseSuppression:!0}};class V_{meydaPromise({constrains:e=N_,bufferSize:t=zt}){return!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia?Promise.reject(new Error("getUserMedia is not supported in this browser. Please use a modern browser with Web Audio API support.")):navigator.mediaDevices.getUserMedia(e).then(n=>this.successStream({stream:n,bufferSize:t})).catch(n=>this.errorStream(n))}successStream({stream:e,bufferSize:t}){this.audioContext=new AudioContext;const n=e.getAudioTracks()[0];return n&&(this.streamAudioSettings=n.getSettings()),this.source=this.audioContext.createMediaStreamSource(e),this.meyda=M_.createMeydaAnalyzer({audioContext:this.audioContext,source:this.source,bufferSize:t}),this.meyda.start(),e}errorStream(e){e.name==="NotAllowedError"?console.error("AudioFeaturesExtractor: Microphone access denied by user"):e.name==="NotFoundError"?console.error("AudioFeaturesExtractor: No microphone device found"):e.name==="NotSupportedError"?console.error("AudioFeaturesExtractor: getUserMedia not supported in this browser"):console.error("AudioFeaturesExtractor:",e.message||e)}features(e=["amplitudeSpectrum","spectralCentroid","spectralRolloff","perceptualSharpness","loudness","rms","chroma","mfcc"]){return!this.meyda||!this.audioContext?null:this.meyda.get(e)}signal(){return this.meyda?this.meyda._m.signal:null}}function F_(r){return sl(document,"keydown").pipe(rl(e=>e.keyCode===r),Zd(!1),Qd(e=>!e))}function z_(r){return sl(r,"click").pipe(Jd(250),ep())}function H_(r){return Yd().pipe(Xd(r),rl(e=>!e[1]))}const j_=`
    precision highp float;
    precision highp int;
  
    uniform mat4 viewMatrix;
    uniform mat4 projectionMatrix;
    uniform mat4 modelMatrix;
   
    attribute vec3 position;
  
    uniform vec4 uColor;
  
    varying vec4 vColor;
  
    void main(){
      
      gl_Position = projectionMatrix * viewMatrix * // THREE.Camera
        modelMatrix * // THREE.Mesh
        vec4( position, 1.0 ); // from THREE.BufferGeometry
  
      vColor = uColor;
    }
  `,G_=`
    precision highp float;
  
    varying vec4 vColor;
  
    void main(){
      gl_FragColor =vColor;
    }
  `,Es=Math.min(1.2,window.devicePixelRatio);function K_({renderer:r,composer:e}){const t=r.domElement,n=t.clientWidth*Es|0,s=t.clientHeight*Es|0,l=t.width!==n||t.height!==s;return l&&(r.setSize(n,s,!1),e.setSize(n,s)),l}const Ga={type:"change"},Ys={type:"start"},uh={type:"end"},In=new Xa,Ka=new ip,$_=Math.cos(70*np.DEG2RAD),ce=new se,Se=2*Math.PI,J={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},os=1e-6;class W_ extends tp{constructor(e,t=null){super(e,t),this.state=J.NONE,this.target=new se,this.cursor=new se,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:pi.ROTATE,MIDDLE:pi.DOLLY,RIGHT:pi.PAN},this.touches={ONE:ui.ROTATE,TWO:ui.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new se,this._lastQuaternion=new Hn,this._lastTargetPosition=new se,this._quat=new Hn().setFromUnitVectors(e.up,new se(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new ta,this._sphericalDelta=new ta,this._scale=1,this._panOffset=new se,this._rotateStart=new ne,this._rotateEnd=new ne,this._rotateDelta=new ne,this._panStart=new ne,this._panEnd=new ne,this._panDelta=new ne,this._dollyStart=new ne,this._dollyEnd=new ne,this._dollyDelta=new ne,this._dollyDirection=new se,this._mouse=new ne,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=Y_.bind(this),this._onPointerDown=q_.bind(this),this._onPointerUp=X_.bind(this),this._onContextMenu=nv.bind(this),this._onMouseWheel=J_.bind(this),this._onKeyDown=ev.bind(this),this._onTouchStart=tv.bind(this),this._onTouchMove=iv.bind(this),this._onMouseDown=Z_.bind(this),this._onMouseMove=Q_.bind(this),this._interceptControlDown=rv.bind(this),this._interceptControlUp=sv.bind(this),this.domElement!==null&&this.connect(this.domElement),this.update()}connect(e){super.connect(e),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(Ga),this.update(),this.state=J.NONE}update(e=null){const t=this.object.position;ce.copy(t).sub(this.target),ce.applyQuaternion(this._quat),this._spherical.setFromVector3(ce),this.autoRotate&&this.state===J.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let n=this.minAzimuthAngle,s=this.maxAzimuthAngle;isFinite(n)&&isFinite(s)&&(n<-Math.PI?n+=Se:n>Math.PI&&(n-=Se),s<-Math.PI?s+=Se:s>Math.PI&&(s-=Se),n<=s?this._spherical.theta=Math.max(n,Math.min(s,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(n+s)/2?Math.max(n,this._spherical.theta):Math.min(s,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let l=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const h=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),l=h!=this._spherical.radius}if(ce.setFromSpherical(this._spherical),ce.applyQuaternion(this._quatInverse),t.copy(this.target).add(ce),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let h=null;if(this.object.isPerspectiveCamera){const c=ce.length();h=this._clampDistance(c*this._scale);const p=c-h;this.object.position.addScaledVector(this._dollyDirection,p),this.object.updateMatrixWorld(),l=!!p}else if(this.object.isOrthographicCamera){const c=new se(this._mouse.x,this._mouse.y,0);c.unproject(this.object);const p=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),l=p!==this.object.zoom;const d=new se(this._mouse.x,this._mouse.y,0);d.unproject(this.object),this.object.position.sub(d).add(c),this.object.updateMatrixWorld(),h=ce.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;h!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(h).add(this.object.position):(In.origin.copy(this.object.position),In.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(In.direction))<$_?this.object.lookAt(this.target):(Ka.setFromNormalAndCoplanarPoint(this.object.up,this.target),In.intersectPlane(Ka,this.target))))}else if(this.object.isOrthographicCamera){const h=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),h!==this.object.zoom&&(this.object.updateProjectionMatrix(),l=!0)}return this._scale=1,this._performCursorZoom=!1,l||this._lastPosition.distanceToSquared(this.object.position)>os||8*(1-this._lastQuaternion.dot(this.object.quaternion))>os||this._lastTargetPosition.distanceToSquared(this.target)>os?(this.dispatchEvent(Ga),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?Se/60*this.autoRotateSpeed*e:Se/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){ce.setFromMatrixColumn(t,0),ce.multiplyScalar(-e),this._panOffset.add(ce)}_panUp(e,t){this.screenSpacePanning===!0?ce.setFromMatrixColumn(t,1):(ce.setFromMatrixColumn(t,0),ce.crossVectors(this.object.up,ce)),ce.multiplyScalar(e),this._panOffset.add(ce)}_pan(e,t){const n=this.domElement;if(this.object.isPerspectiveCamera){const s=this.object.position;ce.copy(s).sub(this.target);let l=ce.length();l*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*l/n.clientHeight,this.object.matrix),this._panUp(2*t*l/n.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/n.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/n.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const n=this.domElement.getBoundingClientRect(),s=e-n.left,l=t-n.top,h=n.width,c=n.height;this._mouse.x=s/h*2-1,this._mouse.y=-(l/c)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(Se*this._rotateDelta.x/t.clientHeight),this._rotateUp(Se*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(Se*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-Se*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(Se*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-Se*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),s=.5*(e.pageY+t.y);this._rotateStart.set(n,s)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),s=.5*(e.pageY+t.y);this._panStart.set(n,s)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),n=e.pageX-t.x,s=e.pageY-t.y,l=Math.sqrt(n*n+s*s);this._dollyStart.set(0,l)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const n=this._getSecondPointerPosition(e),s=.5*(e.pageX+n.x),l=.5*(e.pageY+n.y);this._rotateEnd.set(s,l)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(Se*this._rotateDelta.x/t.clientHeight),this._rotateUp(Se*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),s=.5*(e.pageY+t.y);this._panEnd.set(n,s)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),n=e.pageX-t.x,s=e.pageY-t.y,l=Math.sqrt(n*n+s*s);this._dollyEnd.set(0,l),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const h=(e.pageX+t.x)*.5,c=(e.pageY+t.y)*.5;this._updateZoomParameters(h,c)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId){this._pointers.splice(t,1);return}}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new ne,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,n={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:n.deltaY*=16;break;case 2:n.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(n.deltaY*=10),n}}function q_(r){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(r.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(r)&&(this._addPointer(r),r.pointerType==="touch"?this._onTouchStart(r):this._onMouseDown(r)))}function Y_(r){this.enabled!==!1&&(r.pointerType==="touch"?this._onTouchMove(r):this._onMouseMove(r))}function X_(r){switch(this._removePointer(r),this._pointers.length){case 0:this.domElement.releasePointerCapture(r.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(uh),this.state=J.NONE;break;case 1:const e=this._pointers[0],t=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:t.x,pageY:t.y});break}}function Z_(r){let e;switch(r.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case pi.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(r),this.state=J.DOLLY;break;case pi.ROTATE:if(r.ctrlKey||r.metaKey||r.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(r),this.state=J.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(r),this.state=J.ROTATE}break;case pi.PAN:if(r.ctrlKey||r.metaKey||r.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(r),this.state=J.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(r),this.state=J.PAN}break;default:this.state=J.NONE}this.state!==J.NONE&&this.dispatchEvent(Ys)}function Q_(r){switch(this.state){case J.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(r);break;case J.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(r);break;case J.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(r);break}}function J_(r){this.enabled===!1||this.enableZoom===!1||this.state!==J.NONE||(r.preventDefault(),this.dispatchEvent(Ys),this._handleMouseWheel(this._customWheelEvent(r)),this.dispatchEvent(uh))}function ev(r){this.enabled!==!1&&this._handleKeyDown(r)}function tv(r){switch(this._trackPointer(r),this._pointers.length){case 1:switch(this.touches.ONE){case ui.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(r),this.state=J.TOUCH_ROTATE;break;case ui.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(r),this.state=J.TOUCH_PAN;break;default:this.state=J.NONE}break;case 2:switch(this.touches.TWO){case ui.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(r),this.state=J.TOUCH_DOLLY_PAN;break;case ui.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(r),this.state=J.TOUCH_DOLLY_ROTATE;break;default:this.state=J.NONE}break;default:this.state=J.NONE}this.state!==J.NONE&&this.dispatchEvent(Ys)}function iv(r){switch(this._trackPointer(r),this.state){case J.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(r),this.update();break;case J.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(r),this.update();break;case J.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(r),this.update();break;case J.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(r),this.update();break;default:this.state=J.NONE}}function nv(r){this.enabled!==!1&&r.preventDefault()}function rv(r){r.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function sv(r){r.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}const ov=75,av=4/3,lv=5,hv=1e4,uv=25,cv=7,dv=.05,pv=1,fv=Math.PI/2;function mv(){return new el(ov,av,lv,hv)}function _v(r,e){const t=new W_(r,e);return t.enableDamping=!0,t.enablePan=!1,t.maxDistance=uv,t.minDistance=cv,t.dampingFactor=dv,t.minAzimuthAngle=-Math.PI,t.maxAzimuthAngle=Math.PI,t.minPolarAngle=pv,t.maxPolarAngle=fv,t}function vv(r){return new rp({uniforms:{uColor:{value:r}},vertexShader:j_,fragmentShader:G_,transparent:!0,side:Yi})}const gv=32,bv=-5,xv=10,$a=16777215,wv=.75,yv=1,Cv=1,Ev=0,Sv=1,Pv=1,Tv=1.25,Av=1.2,Mv=1,kv=3,Ov=30,Rv=15,Dv=.001,Lv=-8,as=new V_,Iv=document.querySelector("#cover"),Wa=document.querySelector("#canvas"),ch=new Mf;document.querySelector("#stats").appendChild(ch.dom);let He,qa,Wi,_t,qi,Un,ls,vt,Bn;const rn={amount:4,xscale:50},Wt={loudness:0,perceptualSharpness:0,perceptualSpread:0,spectralFlatness:0},Pi=new Rf.Pane({title:"controls",expanded:!0});Pi.addInput(rn,"amount",{min:1,max:6});Pi.addInput(rn,"xscale",{min:20,max:100});Pi.addMonitor(Wt,"loudness",{view:"graph",min:0,max:1});Pi.addMonitor(Wt,"perceptualSpread",{view:"graph",min:0,max:1});Pi.addMonitor(Wt,"perceptualSharpness",{view:"graph",min:0,max:1});Pi.addMonitor(Wt,"spectralFlatness",{view:"graph",min:0,max:1});class Uv{init(){this.scene=new hs,_t=mv(),_t.position.set(0,bv,xv),_t.lookAt(0,0,0),Wi=new sp({canvas:Wa,antialias:!0,alpha:!0,powerPreference:"high-performance"}),Wi.setPixelRatio(Es),ls=_v(_t,Wa),ls.update();const e=new op(16777215,0,1),t=new ap($a,wv);t.position.set(0,yv,Cv),this.scene.add(e),this.scene.add(t);const n=new __(this.scene,_t);Un=new m_({intensity:Sv,luminanceThreshold:Ev,radius:Av});const s=new w_(_t,Un);qi=new vm(Wi),qi.addPass(n),qi.addPass(s),He=U_(k_,zt);let l=Ha("picnic",He.length);qa=Ha("inferno",zt).map(h=>new Ss().fromArray(h)),vt=new U(new lp(.25,.25,.25),new hp({color:$a}),{capacity:zt,createEntities:!0,allowsEuler:!0}),vt.position.set(Lv,0,0),vt.scale.set(1,.5,1),vt.addInstances(zt,(h,c)=>{vt.setColorAt(h.id,qa[c])}),this.scene.add(vt),Bn=new up;for(let h=0;h<He.length;h++)if(He[h]){const c=new nl;c.setAttribute("position",new us(new Float32Array(He[h].length*3),3)),c.computeBoundingSphere();const p=vv(l[He.length-h-1]),d=new dn(c,p);d.frustumCulled=!1,Bn.add(d)}this.scene.add(Bn)}intro(){ys.timeline().to("#cover",{duration:1,autoAlpha:0,ease:"power2.out"}).to("#cover",{duration:1,delay:1,autoAlpha:0,ease:"power2.out"})}render([{timestamp:e}]){if(K_({renderer:Wi,composer:qi})){const{clientWidth:p,clientHeight:d}=Wi.domElement;_t.aspect=p/d,_t.updateProjectionMatrix()}const t=as.features(["perceptualSharpness","perceptualSpread","spectralFlatness","amplitudeSpectrum","loudness"]);if(!t)return;const{amplitudeSpectrum:n}=t;He.pop(),He.unshift(n),Object.assign(Wt,B_(t));const{loudness:s,perceptualSharpness:l,perceptualSpread:h}=Wt;Un.intensity=ja(Pv,Tv,s),Un.radius=ja(Mv,kv,l);for(let p=0;p<He.length;p++){const d=Bn.children[p].geometry.getAttribute("position");for(let f=0;f<d.count*3;f++){const _=f*3;d.array[_+0]=rn.xscale+rn.xscale*Math.log10(f/He[p].length),d.array[_+1]=O_+Wt.perceptualSharpness+He[p][f]*(rn.amount*s),d.array[_+2]=R_-p*(D_*h)}d.needsUpdate=!0}const c=as.signal();c&&vt&&vt.updateInstancesPosition((p,d)=>{p.position.set(Rv*d/zt,c[d]*Ov,0),p.rotation.set((e+s)*Dv,l,e++)}),ls.update(),qi.render(),ch.update()}run$(){return ys.timeline().to("#cover",{duration:2,autoAlpha:1,ease:"expo.inOut"}),cp(dp([z_(Iv),pp(as.meydaPromise({fftSize:zt}))]).pipe(fp({count:2,delay:1e3}),ia(()=>{this.init(),this.intro()})),H_(F_(gv)).pipe(ia(this.render))).pipe(mp(e=>(console.error("Error:",e),_p))).subscribe()}}document.addEventListener("DOMContentLoaded",()=>{new Uv().run$()});
