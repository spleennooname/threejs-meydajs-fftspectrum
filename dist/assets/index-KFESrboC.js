import{g as Al,C as as,M as Es,D as Xr,R as Qr,F as Jr,a as Ui,V as ze,b as cp,S as Cs,c as fe,A as Ea,I as up,d as ss,B as eo,e as dp,W as pp,N as ls,Q as Ml,E as fp,G as mp,U as Rl,f as _p,h as vp,i as gp,j as bp,k as xp,l as yp,m as wp,n as Nt,o as xe,p as Ts,q as ai,r as Ce,s as Ep,t as Cp,u as Tp,v as Ft,L as hs,w as cs,O as Dl,x as Wn,y as Zn,z as Sp,H as zi,J as ie,K as kl,P as Ll,T as Ul,X as Il,Y as Bl,Z as Pp,_ as Ca,$ as to,a0 as Op,a1 as Ta,a2 as Ap,a3 as Nl,a4 as Mp,a5 as Rp,a6 as Dp,a7 as kp,a8 as Lp,a9 as Up,aa as Ip,ab as Bp,ac as Np,ad as Sa,ae as Pa,af as Oa,ag as Fp,ah as Vp,ai as zp,aj as Hp,ak as Gp,al as jp,am as Kp,an as Yp}from"./vendor-D-4EqDkh.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const h of l.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&n(h)}).observe(document,{childList:!0,subtree:!0});function t(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(s){if(s.ep)return;s.ep=!0;const l=t(s);fetch(s.href,l)}})();function dt(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function Fl(r,e){r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.__proto__=e}var Ve={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},Ii={duration:.5,overwrite:!1,delay:0},io,Ye=1e8,re=1/Ye,Ur=Math.PI*2,$p=Ur/4,qp=0,Vl=Math.sqrt,Wp=Math.cos,Zp=Math.sin,ve=function(e){return typeof e=="string"},_e=function(e){return typeof e=="function"},mt=function(e){return typeof e=="number"},no=function(e){return typeof e>"u"},_t=function(e){return typeof e=="object"},ke=function(e){return e!==!1},zl=function(){return typeof window<"u"},Xn=function(e){return _e(e)||ve(e)},Hl=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},we=Array.isArray,Ir=/(?:-?\.?\d|\.)+/gi,Gl=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,Oi=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,dr=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,jl=/[+-]=-?[.\d]+/,Kl=/[^,'"\[\]\s]+/gi,Xp=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,ce,ot,Br,so,He={},us={},Yl,$l=function(e){return(us=li(e,He))&&Je},ro=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},ds=function(e,t){return!t&&console.warn(e)},ql=function(e,t){return e&&(He[e]=t)&&us&&(us[e]=t)||He},En=function(){return 0},oo={},kt=[],Nr={},Wl,Ne={},pr={},Aa=30,rs=[],ao="",lo=function(e){var t=e[0],n,s;if(_t(t)||_e(t)||(e=[e]),!(n=(t._gsap||{}).harness)){for(s=rs.length;s--&&!rs[s].targetTest(t););n=rs[s]}for(s=e.length;s--;)e[s]&&(e[s]._gsap||(e[s]._gsap=new vh(e[s],n)))||e.splice(s,1);return e},ni=function(e){return e._gsap||lo($e(e))[0]._gsap},Zl=function(e,t,n){return(n=e[t])&&_e(n)?e[t]():no(n)&&e.getAttribute&&e.getAttribute(t)||n},Le=function(e,t){return(e=e.split(",")).forEach(t)||e},de=function(e){return Math.round(e*1e5)/1e5||0},be=function(e){return Math.round(e*1e7)/1e7||0},Mi=function(e,t){var n=t.charAt(0),s=parseFloat(t.substr(2));return e=parseFloat(e),n==="+"?e+s:n==="-"?e-s:n==="*"?e*s:e/s},Qp=function(e,t){for(var n=t.length,s=0;e.indexOf(t[s])<0&&++s<n;);return s<n},ps=function(){var e=kt.length,t=kt.slice(0),n,s;for(Nr={},kt.length=0,n=0;n<e;n++)s=t[n],s&&s._lazy&&(s.render(s._lazy[0],s._lazy[1],!0)._lazy=0)},Xl=function(e,t,n,s){kt.length&&ps(),e.render(t,n,s),kt.length&&ps()},Ql=function(e){var t=parseFloat(e);return(t||t===0)&&(e+"").match(Kl).length<2?t:ve(e)?e.trim():e},Jl=function(e){return e},We=function(e,t){for(var n in t)n in e||(e[n]=t[n]);return e},Jp=function(e){return function(t,n){for(var s in n)s in t||s==="duration"&&e||s==="ease"||(t[s]=n[s])}},li=function(e,t){for(var n in t)e[n]=t[n];return e},Ma=function r(e,t){for(var n in t)n!=="__proto__"&&n!=="constructor"&&n!=="prototype"&&(e[n]=_t(t[n])?r(e[n]||(e[n]={}),t[n]):t[n]);return e},fs=function(e,t){var n={},s;for(s in e)s in t||(n[s]=e[s]);return n},xn=function(e){var t=e.parent||ce,n=e.keyframes?Jp(we(e.keyframes)):We;if(ke(e.inherit))for(;t;)n(e,t.vars.defaults),t=t.parent||t._dp;return e},ef=function(e,t){for(var n=e.length,s=n===t.length;s&&n--&&e[n]===t[n];);return n<0},eh=function(e,t,n,s,l){var h=e[s],c;if(l)for(c=t[l];h&&h[l]>c;)h=h._prev;return h?(t._next=h._next,h._next=t):(t._next=e[n],e[n]=t),t._next?t._next._prev=t:e[s]=t,t._prev=h,t.parent=t._dp=e,t},Ss=function(e,t,n,s){n===void 0&&(n="_first"),s===void 0&&(s="_last");var l=t._prev,h=t._next;l?l._next=h:e[n]===t&&(e[n]=h),h?h._prev=l:e[s]===t&&(e[s]=l),t._next=t._prev=t.parent=null},pt=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove(e),e._act=0},si=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var n=e;n;)n._dirty=1,n=n.parent;return e},tf=function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e},nf=function r(e){return!e||e._ts&&r(e.parent)},Ra=function(e){return e._repeat?Bi(e._tTime,e=e.duration()+e._rDelay)*e:0},Bi=function(e,t){var n=Math.floor(e/=t);return e&&n===e?n-1:n},ms=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},Ps=function(e){return e._end=be(e._start+(e._tDur/Math.abs(e._ts||e._rts||re)||0))},ho=function(e,t){var n=e._dp;return n&&n.smoothChildTiming&&e._ts&&(e._start=be(n._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),Ps(e),n._dirty||si(n,e)),e},th=function(e,t){var n;if((t._time||t._initted&&!t._dur)&&(n=ms(e.rawTime(),t),(!t._dur||Rn(0,t.totalDuration(),n)-t._tTime>re)&&t.render(n,!0)),si(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(n=e;n._dp;)n.rawTime()>=0&&n.totalTime(n._tTime),n=n._dp;e._zTime=-re}},at=function(e,t,n,s){return t.parent&&pt(t),t._start=be((mt(n)?n:n||e!==ce?Ke(e,n,t):e._time)+t._delay),t._end=be(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),eh(e,t,"_first","_last",e._sort?"_start":0),Fr(t)||(e._recent=t),s||th(e,t),e},ih=function(e,t){return(He.ScrollTrigger||ro("scrollTrigger",t))&&He.ScrollTrigger.create(t,e)},nh=function(e,t,n,s){if(uo(e,t),!e._initted)return 1;if(!n&&e._pt&&(e._dur&&e.vars.lazy!==!1||!e._dur&&e.vars.lazy)&&Wl!==Fe.frame)return kt.push(e),e._lazy=[t,s],1},sf=function r(e){var t=e.parent;return t&&t._ts&&t._initted&&!t._lock&&(t.rawTime()<0||r(t))},Fr=function(e){var t=e.data;return t==="isFromStart"||t==="isStart"},rf=function(e,t,n,s){var l=e.ratio,h=t<0||!t&&(!e._start&&sf(e)&&!(!e._initted&&Fr(e))||(e._ts<0||e._dp._ts<0)&&!Fr(e))?0:1,c=e._rDelay,p=0,d,f,_;if(c&&e._repeat&&(p=Rn(0,e._tDur,t),f=Bi(p,c),e._yoyo&&f&1&&(h=1-h),f!==Bi(e._tTime,c)&&(l=1-h,e.vars.repeatRefresh&&e._initted&&e.invalidate())),h!==l||s||e._zTime===re||!t&&e._zTime){if(!e._initted&&nh(e,t,s,n))return;for(_=e._zTime,e._zTime=t||(n?re:0),n||(n=t&&!_),e.ratio=h,e._from&&(h=1-h),e._time=0,e._tTime=p,d=e._pt;d;)d.r(h,d.d),d=d._next;e._startAt&&t<0&&e._startAt.render(t,!0,!0),e._onUpdate&&!n&&qe(e,"onUpdate"),p&&e._repeat&&!n&&e.parent&&qe(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===h&&(h&&pt(e,1),n||(qe(e,h?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)},of=function(e,t,n){var s;if(n>t)for(s=e._first;s&&s._start<=n;){if(s.data==="isPause"&&s._start>t)return s;s=s._next}else for(s=e._last;s&&s._start>=n;){if(s.data==="isPause"&&s._start<t)return s;s=s._prev}},Ni=function(e,t,n,s){var l=e._repeat,h=be(t)||0,c=e._tTime/e._tDur;return c&&!s&&(e._time*=h/e._dur),e._dur=h,e._tDur=l?l<0?1e10:be(h*(l+1)+e._rDelay*l):h,c>0&&!s?ho(e,e._tTime=e._tDur*c):e.parent&&Ps(e),n||si(e.parent,e),e},Da=function(e){return e instanceof De?si(e):Ni(e,e._dur)},af={_start:0,endTime:En,totalDuration:En},Ke=function r(e,t,n){var s=e.labels,l=e._recent||af,h=e.duration()>=Ye?l.endTime(!1):e._dur,c,p,d;return ve(t)&&(isNaN(t)||t in s)?(p=t.charAt(0),d=t.substr(-1)==="%",c=t.indexOf("="),p==="<"||p===">"?(c>=0&&(t=t.replace(/=/,"")),(p==="<"?l._start:l.endTime(l._repeat>=0))+(parseFloat(t.substr(1))||0)*(d?(c<0?l:n).totalDuration()/100:1)):c<0?(t in s||(s[t]=h),s[t]):(p=parseFloat(t.charAt(c-1)+t.substr(c+1)),d&&n&&(p=p/100*(we(n)?n[0]:n).totalDuration()),c>1?r(e,t.substr(0,c-1),n)+p:h+p)):t==null?h:+t},yn=function(e,t,n){var s=mt(t[1]),l=(s?2:1)+(e<2?0:1),h=t[l],c,p;if(s&&(h.duration=t[1]),h.parent=n,e){for(c=h,p=n;p&&!("immediateRender"in c);)c=p.vars.defaults||{},p=ke(p.vars.inherit)&&p.parent;h.immediateRender=ke(c.immediateRender),e<2?h.runBackwards=1:h.startAt=t[l-1]}return new me(t[0],h,t[l+1])},Vt=function(e,t){return e||e===0?t(e):t},Rn=function(e,t,n){return n<e?e:n>t?t:n},ye=function(e,t){return!ve(e)||!(t=Xp.exec(e))?"":t[1]},lf=function(e,t,n){return Vt(n,function(s){return Rn(e,t,s)})},Vr=[].slice,sh=function(e,t){return e&&_t(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&_t(e[0]))&&!e.nodeType&&e!==ot},hf=function(e,t,n){return n===void 0&&(n=[]),e.forEach(function(s){var l;return ve(s)&&!t||sh(s,1)?(l=n).push.apply(l,$e(s)):n.push(s)})||n},$e=function(e,t,n){return ve(e)&&!n&&(Br||!Fi())?Vr.call((t||so).querySelectorAll(e),0):we(e)?hf(e,n):sh(e)?Vr.call(e,0):e?[e]:[]},cf=function(e){return e=$e(e)[0]||ds("Invalid scope")||{},function(t){var n=e.current||e.nativeElement||e;return $e(t,n.querySelectorAll?n:n===e?ds("Invalid scope")||so.createElement("div"):e)}},rh=function(e){return e.sort(function(){return .5-Math.random()})},oh=function(e){if(_e(e))return e;var t=_t(e)?e:{each:e},n=ri(t.ease),s=t.from||0,l=parseFloat(t.base)||0,h={},c=s>0&&s<1,p=isNaN(s)||c,d=t.axis,f=s,_=s;return ve(s)?f=_={center:.5,edges:.5,end:1}[s]||0:!c&&p&&(f=s[0],_=s[1]),function(g,v,y){var b=(y||t).length,x=h[b],w,E,T,O,A,M,R,D,k;if(!x){if(k=t.grid==="auto"?0:(t.grid||[1,Ye])[1],!k){for(R=-Ye;R<(R=y[k++].getBoundingClientRect().left)&&k<b;);k--}for(x=h[b]=[],w=p?Math.min(k,b)*f-.5:s%k,E=k===Ye?0:p?b*_/k-.5:s/k|0,R=0,D=Ye,M=0;M<b;M++)T=M%k-w,O=E-(M/k|0),x[M]=A=d?Math.abs(d==="y"?O:T):Vl(T*T+O*O),A>R&&(R=A),A<D&&(D=A);s==="random"&&rh(x),x.max=R-D,x.min=D,x.v=b=(parseFloat(t.amount)||parseFloat(t.each)*(k>b?b-1:d?d==="y"?b/k:k:Math.max(k,b/k))||0)*(s==="edges"?-1:1),x.b=b<0?l-b:l,x.u=ye(t.amount||t.each)||0,n=n&&b<0?fh(n):n}return b=(x[g]-x.min)/x.max||0,be(x.b+(n?n(b):b)*x.v)+x.u}},zr=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(n){var s=Math.round(parseFloat(n)/e)*e*t;return(s-s%1)/t+(mt(n)?0:ye(n))}},ah=function(e,t){var n=we(e),s,l;return!n&&_t(e)&&(s=n=e.radius||Ye,e.values?(e=$e(e.values),(l=!mt(e[0]))&&(s*=s)):e=zr(e.increment)),Vt(t,n?_e(e)?function(h){return l=e(h),Math.abs(l-h)<=s?l:h}:function(h){for(var c=parseFloat(l?h.x:h),p=parseFloat(l?h.y:0),d=Ye,f=0,_=e.length,g,v;_--;)l?(g=e[_].x-c,v=e[_].y-p,g=g*g+v*v):g=Math.abs(e[_]-c),g<d&&(d=g,f=_);return f=!s||d<=s?e[f]:h,l||f===h||mt(h)?f:f+ye(h)}:zr(e))},lh=function(e,t,n,s){return Vt(we(e)?!t:n===!0?!!(n=0):!s,function(){return we(e)?e[~~(Math.random()*e.length)]:(n=n||1e-5)&&(s=n<1?Math.pow(10,(n+"").length-2):1)&&Math.floor(Math.round((e-n/2+Math.random()*(t-e+n*.99))/n)*n*s)/s})},uf=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(s){return t.reduce(function(l,h){return h(l)},s)}},df=function(e,t){return function(n){return e(parseFloat(n))+(t||ye(n))}},pf=function(e,t,n){return ch(e,t,0,1,n)},hh=function(e,t,n){return Vt(n,function(s){return e[~~t(s)]})},ff=function r(e,t,n){var s=t-e;return we(e)?hh(e,r(0,e.length),t):Vt(n,function(l){return(s+(l-e)%s)%s+e})},mf=function r(e,t,n){var s=t-e,l=s*2;return we(e)?hh(e,r(0,e.length-1),t):Vt(n,function(h){return h=(l+(h-e)%l)%l||0,e+(h>s?l-h:h)})},Cn=function(e){for(var t=0,n="",s,l,h,c;~(s=e.indexOf("random(",t));)h=e.indexOf(")",s),c=e.charAt(s+7)==="[",l=e.substr(s+7,h-s-7).match(c?Kl:Ir),n+=e.substr(t,s-t)+lh(c?l:+l[0],c?0:+l[1],+l[2]||1e-5),t=h+1;return n+e.substr(t,e.length-t)},ch=function(e,t,n,s,l){var h=t-e,c=s-n;return Vt(l,function(p){return n+((p-e)/h*c||0)})},_f=function r(e,t,n,s){var l=isNaN(e+t)?0:function(v){return(1-v)*e+v*t};if(!l){var h=ve(e),c={},p,d,f,_,g;if(n===!0&&(s=1)&&(n=null),h)e={p:e},t={p:t};else if(we(e)&&!we(t)){for(f=[],_=e.length,g=_-2,d=1;d<_;d++)f.push(r(e[d-1],e[d]));_--,l=function(y){y*=_;var b=Math.min(g,~~y);return f[b](y-b)},n=t}else s||(e=li(we(e)?[]:{},e));if(!f){for(p in t)co.call(c,e,p,"get",t[p]);l=function(y){return mo(y,c)||(h?e.p:e)}}}return Vt(n,l)},ka=function(e,t,n){var s=e.labels,l=Ye,h,c,p;for(h in s)c=s[h]-t,c<0==!!n&&c&&l>(c=Math.abs(c))&&(p=h,l=c);return p},qe=function(e,t,n){var s=e.vars,l=s[t],h,c;if(l)return h=s[t+"Params"],c=s.callbackScope||e,n&&kt.length&&ps(),h?l.apply(c,h):l.call(c)},_n=function(e){return pt(e),e.scrollTrigger&&e.scrollTrigger.kill(!1),e.progress()<1&&qe(e,"onInterrupt"),e},Ai,vf=function(e){e=!e.name&&e.default||e;var t=e.name,n=_e(e),s=t&&!n&&e.init?function(){this._props=[]}:e,l={init:En,render:mo,add:co,kill:kf,modifier:Df,rawVars:0},h={targetTest:0,get:0,getSetter:fo,aliases:{},register:0};if(Fi(),e!==s){if(Ne[t])return;We(s,We(fs(e,l),h)),li(s.prototype,li(l,fs(e,h))),Ne[s.prop=t]=s,e.targetTest&&(rs.push(s),oo[t]=1),t=(t==="css"?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}ql(t,s),e.register&&e.register(Je,s,Ue)},se=255,vn={aqua:[0,se,se],lime:[0,se,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,se],navy:[0,0,128],white:[se,se,se],olive:[128,128,0],yellow:[se,se,0],orange:[se,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[se,0,0],pink:[se,192,203],cyan:[0,se,se],transparent:[se,se,se,0]},fr=function(e,t,n){return e+=e<0?1:e>1?-1:0,(e*6<1?t+(n-t)*e*6:e<.5?n:e*3<2?t+(n-t)*(2/3-e)*6:t)*se+.5|0},uh=function(e,t,n){var s=e?mt(e)?[e>>16,e>>8&se,e&se]:0:vn.black,l,h,c,p,d,f,_,g,v,y;if(!s){if(e.substr(-1)===","&&(e=e.substr(0,e.length-1)),vn[e])s=vn[e];else if(e.charAt(0)==="#"){if(e.length<6&&(l=e.charAt(1),h=e.charAt(2),c=e.charAt(3),e="#"+l+l+h+h+c+c+(e.length===5?e.charAt(4)+e.charAt(4):"")),e.length===9)return s=parseInt(e.substr(1,6),16),[s>>16,s>>8&se,s&se,parseInt(e.substr(7),16)/255];e=parseInt(e.substr(1),16),s=[e>>16,e>>8&se,e&se]}else if(e.substr(0,3)==="hsl"){if(s=y=e.match(Ir),!t)p=+s[0]%360/360,d=+s[1]/100,f=+s[2]/100,h=f<=.5?f*(d+1):f+d-f*d,l=f*2-h,s.length>3&&(s[3]*=1),s[0]=fr(p+1/3,l,h),s[1]=fr(p,l,h),s[2]=fr(p-1/3,l,h);else if(~e.indexOf("="))return s=e.match(Gl),n&&s.length<4&&(s[3]=1),s}else s=e.match(Ir)||vn.transparent;s=s.map(Number)}return t&&!y&&(l=s[0]/se,h=s[1]/se,c=s[2]/se,_=Math.max(l,h,c),g=Math.min(l,h,c),f=(_+g)/2,_===g?p=d=0:(v=_-g,d=f>.5?v/(2-_-g):v/(_+g),p=_===l?(h-c)/v+(h<c?6:0):_===h?(c-l)/v+2:(l-h)/v+4,p*=60),s[0]=~~(p+.5),s[1]=~~(d*100+.5),s[2]=~~(f*100+.5)),n&&s.length<4&&(s[3]=1),s},dh=function(e){var t=[],n=[],s=-1;return e.split(Lt).forEach(function(l){var h=l.match(Oi)||[];t.push.apply(t,h),n.push(s+=h.length+1)}),t.c=n,t},La=function(e,t,n){var s="",l=(e+s).match(Lt),h=t?"hsla(":"rgba(",c=0,p,d,f,_;if(!l)return e;if(l=l.map(function(g){return(g=uh(g,t,1))&&h+(t?g[0]+","+g[1]+"%,"+g[2]+"%,"+g[3]:g.join(","))+")"}),n&&(f=dh(e),p=n.c,p.join(s)!==f.c.join(s)))for(d=e.replace(Lt,"1").split(Oi),_=d.length-1;c<_;c++)s+=d[c]+(~p.indexOf(c)?l.shift()||h+"0,0,0,0)":(f.length?f:l.length?l:n).shift());if(!d)for(d=e.split(Lt),_=d.length-1;c<_;c++)s+=d[c]+l[c];return s+d[_]},Lt=(function(){var r="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",e;for(e in vn)r+="|"+e+"\\b";return new RegExp(r+")","gi")})(),gf=/hsl[a]?\(/,ph=function(e){var t=e.join(" "),n;if(Lt.lastIndex=0,Lt.test(t))return n=gf.test(t),e[1]=La(e[1],n),e[0]=La(e[0],n,dh(e[1])),!0},Tn,Fe=(function(){var r=Date.now,e=500,t=33,n=r(),s=n,l=1e3/240,h=l,c=[],p,d,f,_,g,v,y=function b(x){var w=r()-s,E=x===!0,T,O,A,M;if(w>e&&(n+=w-t),s+=w,A=s-n,T=A-h,(T>0||E)&&(M=++_.frame,g=A-_.time*1e3,_.time=A=A/1e3,h+=T+(T>=l?4:l-T),O=1),E||(p=d(b)),O)for(v=0;v<c.length;v++)c[v](A,g,M,x)};return _={time:0,frame:0,tick:function(){y(!0)},deltaRatio:function(x){return g/(1e3/(x||60))},wake:function(){Yl&&(!Br&&zl()&&(ot=Br=window,so=ot.document||{},He.gsap=Je,(ot.gsapVersions||(ot.gsapVersions=[])).push(Je.version),$l(us||ot.GreenSockGlobals||!ot.gsap&&ot||{}),f=ot.requestAnimationFrame),p&&_.sleep(),d=f||function(x){return setTimeout(x,h-_.time*1e3+1|0)},Tn=1,y(2))},sleep:function(){(f?ot.cancelAnimationFrame:clearTimeout)(p),Tn=0,d=En},lagSmoothing:function(x,w){e=x||1/re,t=Math.min(w,e,0)},fps:function(x){l=1e3/(x||240),h=_.time*1e3+l},add:function(x,w,E){var T=w?function(O,A,M,R){x(O,A,M,R),_.remove(T)}:x;return _.remove(x),c[E?"unshift":"push"](T),Fi(),T},remove:function(x,w){~(w=c.indexOf(x))&&c.splice(w,1)&&v>=w&&v--},_listeners:c},_})(),Fi=function(){return!Tn&&Fe.wake()},$={},bf=/^[\d.\-M][\d.\-,\s]/,xf=/["']/g,yf=function(e){for(var t={},n=e.substr(1,e.length-3).split(":"),s=n[0],l=1,h=n.length,c,p,d;l<h;l++)p=n[l],c=l!==h-1?p.lastIndexOf(","):p.length,d=p.substr(0,c),t[s]=isNaN(d)?d.replace(xf,"").trim():+d,s=p.substr(c+1).trim();return t},wf=function(e){var t=e.indexOf("(")+1,n=e.indexOf(")"),s=e.indexOf("(",t);return e.substring(t,~s&&s<n?e.indexOf(")",n+1):n)},Ef=function(e){var t=(e+"").split("("),n=$[t[0]];return n&&t.length>1&&n.config?n.config.apply(null,~e.indexOf("{")?[yf(t[1])]:wf(e).split(",").map(Ql)):$._CE&&bf.test(e)?$._CE("",e):n},fh=function(e){return function(t){return 1-e(1-t)}},mh=function r(e,t){for(var n=e._first,s;n;)n instanceof De?r(n,t):n.vars.yoyoEase&&(!n._yoyo||!n._repeat)&&n._yoyo!==t&&(n.timeline?r(n.timeline,t):(s=n._ease,n._ease=n._yEase,n._yEase=s,n._yoyo=t)),n=n._next},ri=function(e,t){return e&&(_e(e)?e:$[e]||Ef(e))||t},ci=function(e,t,n,s){n===void 0&&(n=function(p){return 1-t(1-p)}),s===void 0&&(s=function(p){return p<.5?t(p*2)/2:1-t((1-p)*2)/2});var l={easeIn:t,easeOut:n,easeInOut:s},h;return Le(e,function(c){$[c]=He[c]=l,$[h=c.toLowerCase()]=n;for(var p in l)$[h+(p==="easeIn"?".in":p==="easeOut"?".out":".inOut")]=$[c+"."+p]=l[p]}),l},_h=function(e){return function(t){return t<.5?(1-e(1-t*2))/2:.5+e((t-.5)*2)/2}},mr=function r(e,t,n){var s=t>=1?t:1,l=(n||(e?.3:.45))/(t<1?t:1),h=l/Ur*(Math.asin(1/s)||0),c=function(f){return f===1?1:s*Math.pow(2,-10*f)*Zp((f-h)*l)+1},p=e==="out"?c:e==="in"?function(d){return 1-c(1-d)}:_h(c);return l=Ur/l,p.config=function(d,f){return r(e,d,f)},p},_r=function r(e,t){t===void 0&&(t=1.70158);var n=function(h){return h?--h*h*((t+1)*h+t)+1:0},s=e==="out"?n:e==="in"?function(l){return 1-n(1-l)}:_h(n);return s.config=function(l){return r(e,l)},s};Le("Linear,Quad,Cubic,Quart,Quint,Strong",function(r,e){var t=e<5?e+1:e;ci(r+",Power"+(t-1),e?function(n){return Math.pow(n,t)}:function(n){return n},function(n){return 1-Math.pow(1-n,t)},function(n){return n<.5?Math.pow(n*2,t)/2:1-Math.pow((1-n)*2,t)/2})});$.Linear.easeNone=$.none=$.Linear.easeIn;ci("Elastic",mr("in"),mr("out"),mr());(function(r,e){var t=1/e,n=2*t,s=2.5*t,l=function(c){return c<t?r*c*c:c<n?r*Math.pow(c-1.5/e,2)+.75:c<s?r*(c-=2.25/e)*c+.9375:r*Math.pow(c-2.625/e,2)+.984375};ci("Bounce",function(h){return 1-l(1-h)},l)})(7.5625,2.75);ci("Expo",function(r){return r?Math.pow(2,10*(r-1)):0});ci("Circ",function(r){return-(Vl(1-r*r)-1)});ci("Sine",function(r){return r===1?1:-Wp(r*$p)+1});ci("Back",_r("in"),_r("out"),_r());$.SteppedEase=$.steps=He.SteppedEase={config:function(e,t){e===void 0&&(e=1);var n=1/e,s=e+(t?0:1),l=t?1:0,h=1-re;return function(c){return((s*Rn(0,h,c)|0)+l)*n}}};Ii.ease=$["quad.out"];Le("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(r){return ao+=r+","+r+"Params,"});var vh=function(e,t){this.id=qp++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:Zl,this.set=t?t.getSetter:fo},Sn=(function(){function r(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,Ni(this,+t.duration,1,1),this.data=t.data,Tn||Fe.wake()}var e=r.prototype;return e.delay=function(n){return n||n===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+n-this._delay),this._delay=n,this):this._delay},e.duration=function(n){return arguments.length?this.totalDuration(this._repeat>0?n+(n+this._rDelay)*this._repeat:n):this.totalDuration()&&this._dur},e.totalDuration=function(n){return arguments.length?(this._dirty=0,Ni(this,this._repeat<0?n:(n-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(n,s){if(Fi(),!arguments.length)return this._tTime;var l=this._dp;if(l&&l.smoothChildTiming&&this._ts){for(ho(this,n),!l._dp||l.parent||th(l,this);l&&l.parent;)l.parent._time!==l._start+(l._ts>=0?l._tTime/l._ts:(l.totalDuration()-l._tTime)/-l._ts)&&l.totalTime(l._tTime,!0),l=l.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&n<this._tDur||this._ts<0&&n>0||!this._tDur&&!n)&&at(this._dp,this,this._start-this._delay)}return(this._tTime!==n||!this._dur&&!s||this._initted&&Math.abs(this._zTime)===re||!n&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=n),Xl(this,n,s)),this},e.time=function(n,s){return arguments.length?this.totalTime(Math.min(this.totalDuration(),n+Ra(this))%(this._dur+this._rDelay)||(n?this._dur:0),s):this._time},e.totalProgress=function(n,s){return arguments.length?this.totalTime(this.totalDuration()*n,s):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.ratio},e.progress=function(n,s){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-n:n)+Ra(this),s):this.duration()?Math.min(1,this._time/this._dur):this.ratio},e.iteration=function(n,s){var l=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(n-1)*l,s):this._repeat?Bi(this._tTime,l)+1:1},e.timeScale=function(n){if(!arguments.length)return this._rts===-re?0:this._rts;if(this._rts===n)return this;var s=this.parent&&this._ts?ms(this.parent._time,this):this._tTime;return this._rts=+n||0,this._ts=this._ps||n===-re?0:this._rts,this.totalTime(Rn(-this._delay,this._tDur,s),!0),Ps(this),tf(this)},e.paused=function(n){return arguments.length?(this._ps!==n&&(this._ps=n,n?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(Fi(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==re&&(this._tTime-=re)))),this):this._ps},e.startTime=function(n){if(arguments.length){this._start=n;var s=this.parent||this._dp;return s&&(s._sort||!this.parent)&&at(s,this,n-this._delay),this}return this._start},e.endTime=function(n){return this._start+(ke(n)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(n){var s=this.parent||this._dp;return s?n&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?ms(s.rawTime(n),this):this._tTime:this._tTime},e.globalTime=function(n){for(var s=this,l=arguments.length?n:s.rawTime();s;)l=s._start+l/(s._ts||1),s=s._dp;return l},e.repeat=function(n){return arguments.length?(this._repeat=n===1/0?-2:n,Da(this)):this._repeat===-2?1/0:this._repeat},e.repeatDelay=function(n){if(arguments.length){var s=this._time;return this._rDelay=n,Da(this),s?this.time(s):this}return this._rDelay},e.yoyo=function(n){return arguments.length?(this._yoyo=n,this):this._yoyo},e.seek=function(n,s){return this.totalTime(Ke(this,n),ke(s))},e.restart=function(n,s){return this.play().totalTime(n?-this._delay:0,ke(s))},e.play=function(n,s){return n!=null&&this.seek(n,s),this.reversed(!1).paused(!1)},e.reverse=function(n,s){return n!=null&&this.seek(n||this.totalDuration(),s),this.reversed(!0).paused(!1)},e.pause=function(n,s){return n!=null&&this.seek(n,s),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(n){return arguments.length?(!!n!==this.reversed()&&this.timeScale(-this._rts||(n?-re:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-re,this},e.isActive=function(){var n=this.parent||this._dp,s=this._start,l;return!!(!n||this._ts&&this._initted&&n.isActive()&&(l=n.rawTime(!0))>=s&&l<this.endTime(!0)-re)},e.eventCallback=function(n,s,l){var h=this.vars;return arguments.length>1?(s?(h[n]=s,l&&(h[n+"Params"]=l),n==="onUpdate"&&(this._onUpdate=s)):delete h[n],this):h[n]},e.then=function(n){var s=this;return new Promise(function(l){var h=_e(n)?n:Jl,c=function(){var d=s.then;s.then=null,_e(h)&&(h=h(s))&&(h.then||h===s)&&(s.then=d),l(h),s.then=d};s._initted&&s.totalProgress()===1&&s._ts>=0||!s._tTime&&s._ts<0?c():s._prom=c})},e.kill=function(){_n(this)},r})();We(Sn.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-re,_prom:0,_ps:!1,_rts:1});var De=(function(r){Fl(e,r);function e(n,s){var l;return n===void 0&&(n={}),l=r.call(this,n)||this,l.labels={},l.smoothChildTiming=!!n.smoothChildTiming,l.autoRemoveChildren=!!n.autoRemoveChildren,l._sort=ke(n.sortChildren),ce&&at(n.parent||ce,dt(l),s),n.reversed&&l.reverse(),n.paused&&l.paused(!0),n.scrollTrigger&&ih(dt(l),n.scrollTrigger),l}var t=e.prototype;return t.to=function(s,l,h){return yn(0,arguments,this),this},t.from=function(s,l,h){return yn(1,arguments,this),this},t.fromTo=function(s,l,h,c){return yn(2,arguments,this),this},t.set=function(s,l,h){return l.duration=0,l.parent=this,xn(l).repeatDelay||(l.repeat=0),l.immediateRender=!!l.immediateRender,new me(s,l,Ke(this,h),1),this},t.call=function(s,l,h){return at(this,me.delayedCall(0,s,l),h)},t.staggerTo=function(s,l,h,c,p,d,f){return h.duration=l,h.stagger=h.stagger||c,h.onComplete=d,h.onCompleteParams=f,h.parent=this,new me(s,h,Ke(this,p)),this},t.staggerFrom=function(s,l,h,c,p,d,f){return h.runBackwards=1,xn(h).immediateRender=ke(h.immediateRender),this.staggerTo(s,l,h,c,p,d,f)},t.staggerFromTo=function(s,l,h,c,p,d,f,_){return c.startAt=h,xn(c).immediateRender=ke(c.immediateRender),this.staggerTo(s,l,c,p,d,f,_)},t.render=function(s,l,h){var c=this._time,p=this._dirty?this.totalDuration():this._tDur,d=this._dur,f=s<=0?0:be(s),_=this._zTime<0!=s<0&&(this._initted||!d),g,v,y,b,x,w,E,T,O,A,M,R;if(this!==ce&&f>p&&s>=0&&(f=p),f!==this._tTime||h||_){if(c!==this._time&&d&&(f+=this._time-c,s+=this._time-c),g=f,O=this._start,T=this._ts,w=!T,_&&(d||(c=this._zTime),(s||!l)&&(this._zTime=s)),this._repeat){if(M=this._yoyo,x=d+this._rDelay,this._repeat<-1&&s<0)return this.totalTime(x*100+s,l,h);if(g=be(f%x),f===p?(b=this._repeat,g=d):(b=~~(f/x),b&&b===f/x&&(g=d,b--),g>d&&(g=d)),A=Bi(this._tTime,x),!c&&this._tTime&&A!==b&&(A=b),M&&b&1&&(g=d-g,R=1),b!==A&&!this._lock){var D=M&&A&1,k=D===(M&&b&1);if(b<A&&(D=!D),c=D?0:d,this._lock=1,this.render(c||(R?0:be(b*x)),l,!d)._lock=0,this._tTime=f,!l&&this.parent&&qe(this,"onRepeat"),this.vars.repeatRefresh&&!R&&(this.invalidate()._lock=1),c&&c!==this._time||w!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(d=this._dur,p=this._tDur,k&&(this._lock=2,c=D?d:-1e-4,this.render(c,!0),this.vars.repeatRefresh&&!R&&this.invalidate()),this._lock=0,!this._ts&&!w)return this;mh(this,R)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(E=of(this,be(c),be(g)),E&&(f-=g-(g=E._start))),this._tTime=f,this._time=g,this._act=!T,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=s,c=0),!c&&g&&!l&&(qe(this,"onStart"),this._tTime!==f))return this;if(g>=c&&s>=0)for(v=this._first;v;){if(y=v._next,(v._act||g>=v._start)&&v._ts&&E!==v){if(v.parent!==this)return this.render(s,l,h);if(v.render(v._ts>0?(g-v._start)*v._ts:(v._dirty?v.totalDuration():v._tDur)+(g-v._start)*v._ts,l,h),g!==this._time||!this._ts&&!w){E=0,y&&(f+=this._zTime=-re);break}}v=y}else{v=this._last;for(var I=s<0?s:g;v;){if(y=v._prev,(v._act||I<=v._end)&&v._ts&&E!==v){if(v.parent!==this)return this.render(s,l,h);if(v.render(v._ts>0?(I-v._start)*v._ts:(v._dirty?v.totalDuration():v._tDur)+(I-v._start)*v._ts,l,h),g!==this._time||!this._ts&&!w){E=0,y&&(f+=this._zTime=I?-re:re);break}}v=y}}if(E&&!l&&(this.pause(),E.render(g>=c?0:-re)._zTime=g>=c?1:-1,this._ts))return this._start=O,Ps(this),this.render(s,l,h);this._onUpdate&&!l&&qe(this,"onUpdate",!0),(f===p&&this._tTime>=this.totalDuration()||!f&&c)&&(O===this._start||Math.abs(T)!==Math.abs(this._ts))&&(this._lock||((s||!d)&&(f===p&&this._ts>0||!f&&this._ts<0)&&pt(this,1),!l&&!(s<0&&!c)&&(f||c||!p)&&(qe(this,f===p&&s>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(f<p&&this.timeScale()>0)&&this._prom())))}return this},t.add=function(s,l){var h=this;if(mt(l)||(l=Ke(this,l,s)),!(s instanceof Sn)){if(we(s))return s.forEach(function(c){return h.add(c,l)}),this;if(ve(s))return this.addLabel(s,l);if(_e(s))s=me.delayedCall(0,s);else return this}return this!==s?at(this,s,l):this},t.getChildren=function(s,l,h,c){s===void 0&&(s=!0),l===void 0&&(l=!0),h===void 0&&(h=!0),c===void 0&&(c=-Ye);for(var p=[],d=this._first;d;)d._start>=c&&(d instanceof me?l&&p.push(d):(h&&p.push(d),s&&p.push.apply(p,d.getChildren(!0,l,h)))),d=d._next;return p},t.getById=function(s){for(var l=this.getChildren(1,1,1),h=l.length;h--;)if(l[h].vars.id===s)return l[h]},t.remove=function(s){return ve(s)?this.removeLabel(s):_e(s)?this.killTweensOf(s):(Ss(this,s),s===this._recent&&(this._recent=this._last),si(this))},t.totalTime=function(s,l){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=be(Fe.time-(this._ts>0?s/this._ts:(this.totalDuration()-s)/-this._ts))),r.prototype.totalTime.call(this,s,l),this._forcing=0,this):this._tTime},t.addLabel=function(s,l){return this.labels[s]=Ke(this,l),this},t.removeLabel=function(s){return delete this.labels[s],this},t.addPause=function(s,l,h){var c=me.delayedCall(0,l||En,h);return c.data="isPause",this._hasPause=1,at(this,c,Ke(this,s))},t.removePause=function(s){var l=this._first;for(s=Ke(this,s);l;)l._start===s&&l.data==="isPause"&&pt(l),l=l._next},t.killTweensOf=function(s,l,h){for(var c=this.getTweensOf(s,h),p=c.length;p--;)At!==c[p]&&c[p].kill(s,l);return this},t.getTweensOf=function(s,l){for(var h=[],c=$e(s),p=this._first,d=mt(l),f;p;)p instanceof me?Qp(p._targets,c)&&(d?(!At||p._initted&&p._ts)&&p.globalTime(0)<=l&&p.globalTime(p.totalDuration())>l:!l||p.isActive())&&h.push(p):(f=p.getTweensOf(c,l)).length&&h.push.apply(h,f),p=p._next;return h},t.tweenTo=function(s,l){l=l||{};var h=this,c=Ke(h,s),p=l,d=p.startAt,f=p.onStart,_=p.onStartParams,g=p.immediateRender,v,y=me.to(h,We({ease:l.ease||"none",lazy:!1,immediateRender:!1,time:c,overwrite:"auto",duration:l.duration||Math.abs((c-(d&&"time"in d?d.time:h._time))/h.timeScale())||re,onStart:function(){if(h.pause(),!v){var x=l.duration||Math.abs((c-(d&&"time"in d?d.time:h._time))/h.timeScale());y._dur!==x&&Ni(y,x,0,1).render(y._time,!0,!0),v=1}f&&f.apply(y,_||[])}},l));return g?y.render(0):y},t.tweenFromTo=function(s,l,h){return this.tweenTo(l,We({startAt:{time:Ke(this,s)}},h))},t.recent=function(){return this._recent},t.nextLabel=function(s){return s===void 0&&(s=this._time),ka(this,Ke(this,s))},t.previousLabel=function(s){return s===void 0&&(s=this._time),ka(this,Ke(this,s),1)},t.currentLabel=function(s){return arguments.length?this.seek(s,!0):this.previousLabel(this._time+re)},t.shiftChildren=function(s,l,h){h===void 0&&(h=0);for(var c=this._first,p=this.labels,d;c;)c._start>=h&&(c._start+=s,c._end+=s),c=c._next;if(l)for(d in p)p[d]>=h&&(p[d]+=s);return si(this)},t.invalidate=function(){var s=this._first;for(this._lock=0;s;)s.invalidate(),s=s._next;return r.prototype.invalidate.call(this)},t.clear=function(s){s===void 0&&(s=!0);for(var l=this._first,h;l;)h=l._next,this.remove(l),l=h;return this._dp&&(this._time=this._tTime=this._pTime=0),s&&(this.labels={}),si(this)},t.totalDuration=function(s){var l=0,h=this,c=h._last,p=Ye,d,f,_;if(arguments.length)return h.timeScale((h._repeat<0?h.duration():h.totalDuration())/(h.reversed()?-s:s));if(h._dirty){for(_=h.parent;c;)d=c._prev,c._dirty&&c.totalDuration(),f=c._start,f>p&&h._sort&&c._ts&&!h._lock?(h._lock=1,at(h,c,f-c._delay,1)._lock=0):p=f,f<0&&c._ts&&(l-=f,(!_&&!h._dp||_&&_.smoothChildTiming)&&(h._start+=f/h._ts,h._time-=f,h._tTime-=f),h.shiftChildren(-f,!1,-1/0),p=0),c._end>l&&c._ts&&(l=c._end),c=d;Ni(h,h===ce&&h._time>l?h._time:l,1,1),h._dirty=0}return h._tDur},e.updateRoot=function(s){if(ce._ts&&(Xl(ce,ms(s,ce)),Wl=Fe.frame),Fe.frame>=Aa){Aa+=Ve.autoSleep||120;var l=ce._first;if((!l||!l._ts)&&Ve.autoSleep&&Fe._listeners.length<2){for(;l&&!l._ts;)l=l._next;l||Fe.sleep()}}},e})(Sn);We(De.prototype,{_lock:0,_hasPause:0,_forcing:0});var Cf=function(e,t,n,s,l,h,c){var p=new Ue(this._pt,e,t,0,1,Eh,null,l),d=0,f=0,_,g,v,y,b,x,w,E;for(p.b=n,p.e=s,n+="",s+="",(w=~s.indexOf("random("))&&(s=Cn(s)),h&&(E=[n,s],h(E,e,t),n=E[0],s=E[1]),g=n.match(dr)||[];_=dr.exec(s);)y=_[0],b=s.substring(d,_.index),v?v=(v+1)%5:b.substr(-5)==="rgba("&&(v=1),y!==g[f++]&&(x=parseFloat(g[f-1])||0,p._pt={_next:p._pt,p:b||f===1?b:",",s:x,c:y.charAt(1)==="="?Mi(x,y)-x:parseFloat(y)-x,m:v&&v<4?Math.round:0},d=dr.lastIndex);return p.c=d<s.length?s.substring(d,s.length):"",p.fp=c,(jl.test(s)||w)&&(p.e=0),this._pt=p,p},co=function(e,t,n,s,l,h,c,p,d){_e(s)&&(s=s(l||0,e,h));var f=e[t],_=n!=="get"?n:_e(f)?d?e[t.indexOf("set")||!_e(e["get"+t.substr(3)])?t:"get"+t.substr(3)](d):e[t]():f,g=_e(f)?d?Af:yh:po,v;if(ve(s)&&(~s.indexOf("random(")&&(s=Cn(s)),s.charAt(1)==="="&&(v=Mi(_,s)+(ye(_)||0),(v||v===0)&&(s=v))),_!==s||Hr)return!isNaN(_*s)&&s!==""?(v=new Ue(this._pt,e,t,+_||0,s-(_||0),typeof f=="boolean"?Rf:wh,0,g),d&&(v.fp=d),c&&v.modifier(c,this,e),this._pt=v):(!f&&!(t in e)&&ro(t,s),Cf.call(this,e,t,_,s,g,p||Ve.stringFilter,d))},Tf=function(e,t,n,s,l){if(_e(e)&&(e=wn(e,l,t,n,s)),!_t(e)||e.style&&e.nodeType||we(e)||Hl(e))return ve(e)?wn(e,l,t,n,s):e;var h={},c;for(c in e)h[c]=wn(e[c],l,t,n,s);return h},gh=function(e,t,n,s,l,h){var c,p,d,f;if(Ne[e]&&(c=new Ne[e]).init(l,c.rawVars?t[e]:Tf(t[e],s,l,h,n),n,s,h)!==!1&&(n._pt=p=new Ue(n._pt,l,e,0,1,c.render,c,0,c.priority),n!==Ai))for(d=n._ptLookup[n._targets.indexOf(l)],f=c._props.length;f--;)d[c._props[f]]=p;return c},At,Hr,uo=function r(e,t){var n=e.vars,s=n.ease,l=n.startAt,h=n.immediateRender,c=n.lazy,p=n.onUpdate,d=n.onUpdateParams,f=n.callbackScope,_=n.runBackwards,g=n.yoyoEase,v=n.keyframes,y=n.autoRevert,b=e._dur,x=e._startAt,w=e._targets,E=e.parent,T=E&&E.data==="nested"?E.parent._targets:w,O=e._overwrite==="auto"&&!io,A=e.timeline,M,R,D,k,I,H,K,ee,q,z,U,ue,Te;if(A&&(!v||!s)&&(s="none"),e._ease=ri(s,Ii.ease),e._yEase=g?fh(ri(g===!0?s:g,Ii.ease)):0,g&&e._yoyo&&!e._repeat&&(g=e._yEase,e._yEase=e._ease,e._ease=g),e._from=!A&&!!n.runBackwards,!A||v&&!n.stagger){if(ee=w[0]?ni(w[0]).harness:0,ue=ee&&n[ee.prop],M=fs(n,oo),x&&(pt(x.render(-1,!0)),x._lazy=0),l)if(pt(e._startAt=me.set(w,We({data:"isStart",overwrite:!1,parent:E,immediateRender:!0,lazy:ke(c),startAt:null,delay:0,onUpdate:p,onUpdateParams:d,callbackScope:f,stagger:0},l))),t<0&&!h&&!y&&e._startAt.render(-1,!0),h){if(t>0&&!y&&(e._startAt=0),b&&t<=0){t&&(e._zTime=t);return}}else y===!1&&(e._startAt=0);else if(_&&b){if(x)!y&&(e._startAt=0);else if(t&&(h=!1),D=We({overwrite:!1,data:"isFromStart",lazy:h&&ke(c),immediateRender:h,stagger:0,parent:E},M),ue&&(D[ee.prop]=ue),pt(e._startAt=me.set(w,D)),t<0&&e._startAt.render(-1,!0),e._zTime=t,!h)r(e._startAt,re);else if(!t)return}for(e._pt=e._ptCache=0,c=b&&ke(c)||c&&!b,R=0;R<w.length;R++){if(I=w[R],K=I._gsap||lo(w)[R]._gsap,e._ptLookup[R]=z={},Nr[K.id]&&kt.length&&ps(),U=T===w?R:T.indexOf(I),ee&&(q=new ee).init(I,ue||M,e,U,T)!==!1&&(e._pt=k=new Ue(e._pt,I,q.name,0,1,q.render,q,0,q.priority),q._props.forEach(function(Se){z[Se]=k}),q.priority&&(H=1)),!ee||ue)for(D in M)Ne[D]&&(q=gh(D,M,e,U,I,T))?q.priority&&(H=1):z[D]=k=co.call(e,I,D,"get",M[D],U,T,0,n.stringFilter);e._op&&e._op[R]&&e.kill(I,e._op[R]),O&&e._pt&&(At=e,ce.killTweensOf(I,z,e.globalTime(t)),Te=!e.parent,At=0),e._pt&&c&&(Nr[K.id]=1)}H&&Ch(e),e._onInit&&e._onInit(e)}e._onUpdate=p,e._initted=(!e._op||e._pt)&&!Te,v&&t<=0&&A.render(Ye,!0,!0)},Sf=function(e,t,n,s,l,h,c){var p=(e._pt&&e._ptCache||(e._ptCache={}))[t],d,f,_;if(!p)for(p=e._ptCache[t]=[],f=e._ptLookup,_=e._targets.length;_--;){if(d=f[_][t],d&&d.d&&d.d._pt)for(d=d.d._pt;d&&d.p!==t;)d=d._next;if(!d)return Hr=1,e.vars[t]="+=0",uo(e,c),Hr=0,1;p.push(d)}for(_=p.length;_--;)d=p[_],d.s=(s||s===0)&&!l?s:d.s+(s||0)+h*d.c,d.c=n-d.s,d.e&&(d.e=de(n)+ye(d.e)),d.b&&(d.b=d.s+ye(d.b))},Pf=function(e,t){var n=e[0]?ni(e[0]).harness:0,s=n&&n.aliases,l,h,c,p;if(!s)return t;l=li({},t);for(h in s)if(h in l)for(p=s[h].split(","),c=p.length;c--;)l[p[c]]=l[h];return l},Of=function(e,t,n,s){var l=t.ease||s||"power1.inOut",h,c;if(we(t))c=n[e]||(n[e]=[]),t.forEach(function(p,d){return c.push({t:d/(t.length-1)*100,v:p,e:l})});else for(h in t)c=n[h]||(n[h]=[]),h==="ease"||c.push({t:parseFloat(e),v:t[h],e:l})},wn=function(e,t,n,s,l){return _e(e)?e.call(t,n,s,l):ve(e)&&~e.indexOf("random(")?Cn(e):e},bh=ao+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",xh={};Le(bh+",id,stagger,delay,duration,paused,scrollTrigger",function(r){return xh[r]=1});var me=(function(r){Fl(e,r);function e(n,s,l,h){var c;typeof s=="number"&&(l.duration=s,s=l,l=null),c=r.call(this,h?s:xn(s))||this;var p=c.vars,d=p.duration,f=p.delay,_=p.immediateRender,g=p.stagger,v=p.overwrite,y=p.keyframes,b=p.defaults,x=p.scrollTrigger,w=p.yoyoEase,E=s.parent||ce,T=(we(n)||Hl(n)?mt(n[0]):"length"in s)?[n]:$e(n),O,A,M,R,D,k,I,H;if(c._targets=T.length?lo(T):ds("GSAP target "+n+" not found. https://greensock.com",!Ve.nullTargetWarn)||[],c._ptLookup=[],c._overwrite=v,y||g||Xn(d)||Xn(f)){if(s=c.vars,O=c.timeline=new De({data:"nested",defaults:b||{}}),O.kill(),O.parent=O._dp=dt(c),O._start=0,g||Xn(d)||Xn(f)){if(R=T.length,I=g&&oh(g),_t(g))for(D in g)~bh.indexOf(D)&&(H||(H={}),H[D]=g[D]);for(A=0;A<R;A++)M=fs(s,xh),M.stagger=0,w&&(M.yoyoEase=w),H&&li(M,H),k=T[A],M.duration=+wn(d,dt(c),A,k,T),M.delay=(+wn(f,dt(c),A,k,T)||0)-c._delay,!g&&R===1&&M.delay&&(c._delay=f=M.delay,c._start+=f,M.delay=0),O.to(k,M,I?I(A,k,T):0),O._ease=$.none;O.duration()?d=f=0:c.timeline=0}else if(y){xn(We(O.vars.defaults,{ease:"none"})),O._ease=ri(y.ease||s.ease||"none");var K=0,ee,q,z;if(we(y))y.forEach(function(U){return O.to(T,U,">")});else{M={};for(D in y)D==="ease"||D==="easeEach"||Of(D,y[D],M,y.easeEach);for(D in M)for(ee=M[D].sort(function(U,ue){return U.t-ue.t}),K=0,A=0;A<ee.length;A++)q=ee[A],z={ease:q.e,duration:(q.t-(A?ee[A-1].t:0))/100*d},z[D]=q.v,O.to(T,z,K),K+=z.duration;O.duration()<d&&O.to({},{duration:d-O.duration()})}}d||c.duration(d=O.duration())}else c.timeline=0;return v===!0&&!io&&(At=dt(c),ce.killTweensOf(T),At=0),at(E,dt(c),l),s.reversed&&c.reverse(),s.paused&&c.paused(!0),(_||!d&&!y&&c._start===be(E._time)&&ke(_)&&nf(dt(c))&&E.data!=="nested")&&(c._tTime=-re,c.render(Math.max(0,-f))),x&&ih(dt(c),x),c}var t=e.prototype;return t.render=function(s,l,h){var c=this._time,p=this._tDur,d=this._dur,f=s>p-re&&s>=0?p:s<re?0:s,_,g,v,y,b,x,w,E,T;if(!d)rf(this,s,l,h);else if(f!==this._tTime||!s||h||!this._initted&&this._tTime||this._startAt&&this._zTime<0!=s<0){if(_=f,E=this.timeline,this._repeat){if(y=d+this._rDelay,this._repeat<-1&&s<0)return this.totalTime(y*100+s,l,h);if(_=be(f%y),f===p?(v=this._repeat,_=d):(v=~~(f/y),v&&v===f/y&&(_=d,v--),_>d&&(_=d)),x=this._yoyo&&v&1,x&&(T=this._yEase,_=d-_),b=Bi(this._tTime,y),_===c&&!h&&this._initted)return this._tTime=f,this;v!==b&&(E&&this._yEase&&mh(E,x),this.vars.repeatRefresh&&!x&&!this._lock&&(this._lock=h=1,this.render(be(y*v),!0).invalidate()._lock=0))}if(!this._initted){if(nh(this,s<0?s:_,h,l))return this._tTime=0,this;if(c!==this._time)return this;if(d!==this._dur)return this.render(s,l,h)}if(this._tTime=f,this._time=_,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=w=(T||this._ease)(_/d),this._from&&(this.ratio=w=1-w),_&&!c&&!l&&(qe(this,"onStart"),this._tTime!==f))return this;for(g=this._pt;g;)g.r(w,g.d),g=g._next;E&&E.render(s<0?s:!_&&x?-re:E._dur*E._ease(_/this._dur),l,h)||this._startAt&&(this._zTime=s),this._onUpdate&&!l&&(s<0&&this._startAt&&this._startAt.render(s,!0,h),qe(this,"onUpdate")),this._repeat&&v!==b&&this.vars.onRepeat&&!l&&this.parent&&qe(this,"onRepeat"),(f===this._tDur||!f)&&this._tTime===f&&(s<0&&this._startAt&&!this._onUpdate&&this._startAt.render(s,!0,!0),(s||!d)&&(f===this._tDur&&this._ts>0||!f&&this._ts<0)&&pt(this,1),!l&&!(s<0&&!c)&&(f||c)&&(qe(this,f===p?"onComplete":"onReverseComplete",!0),this._prom&&!(f<p&&this.timeScale()>0)&&this._prom()))}return this},t.targets=function(){return this._targets},t.invalidate=function(){return this._pt=this._op=this._startAt=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(),r.prototype.invalidate.call(this)},t.resetTo=function(s,l,h,c){Tn||Fe.wake(),this._ts||this.play();var p=Math.min(this._dur,(this._dp._time-this._start)*this._ts),d;return this._initted||uo(this,p),d=this._ease(p/this._dur),Sf(this,s,l,h,c,d,p)?this.resetTo(s,l,h,c):(ho(this,0),this.parent||eh(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},t.kill=function(s,l){if(l===void 0&&(l="all"),!s&&(!l||l==="all"))return this._lazy=this._pt=0,this.parent?_n(this):this;if(this.timeline){var h=this.timeline.totalDuration();return this.timeline.killTweensOf(s,l,At&&At.vars.overwrite!==!0)._first||_n(this),this.parent&&h!==this.timeline.totalDuration()&&Ni(this,this._dur*this.timeline._tDur/h,0,1),this}var c=this._targets,p=s?$e(s):c,d=this._ptLookup,f=this._pt,_,g,v,y,b,x,w;if((!l||l==="all")&&ef(c,p))return l==="all"&&(this._pt=0),_n(this);for(_=this._op=this._op||[],l!=="all"&&(ve(l)&&(b={},Le(l,function(E){return b[E]=1}),l=b),l=Pf(c,l)),w=c.length;w--;)if(~p.indexOf(c[w])){g=d[w],l==="all"?(_[w]=l,y=g,v={}):(v=_[w]=_[w]||{},y=l);for(b in y)x=g&&g[b],x&&((!("kill"in x.d)||x.d.kill(b)===!0)&&Ss(this,x,"_pt"),delete g[b]),v!=="all"&&(v[b]=1)}return this._initted&&!this._pt&&f&&_n(this),this},e.to=function(s,l){return new e(s,l,arguments[2])},e.from=function(s,l){return yn(1,arguments)},e.delayedCall=function(s,l,h,c){return new e(l,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:s,onComplete:l,onReverseComplete:l,onCompleteParams:h,onReverseCompleteParams:h,callbackScope:c})},e.fromTo=function(s,l,h){return yn(2,arguments)},e.set=function(s,l){return l.duration=0,l.repeatDelay||(l.repeat=0),new e(s,l)},e.killTweensOf=function(s,l,h){return ce.killTweensOf(s,l,h)},e})(Sn);We(me.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});Le("staggerTo,staggerFrom,staggerFromTo",function(r){me[r]=function(){var e=new De,t=Vr.call(arguments,0);return t.splice(r==="staggerFromTo"?5:4,0,0),e[r].apply(e,t)}});var po=function(e,t,n){return e[t]=n},yh=function(e,t,n){return e[t](n)},Af=function(e,t,n,s){return e[t](s.fp,n)},Mf=function(e,t,n){return e.setAttribute(t,n)},fo=function(e,t){return _e(e[t])?yh:no(e[t])&&e.setAttribute?Mf:po},wh=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e6)/1e6,t)},Rf=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},Eh=function(e,t){var n=t._pt,s="";if(!e&&t.b)s=t.b;else if(e===1&&t.e)s=t.e;else{for(;n;)s=n.p+(n.m?n.m(n.s+n.c*e):Math.round((n.s+n.c*e)*1e4)/1e4)+s,n=n._next;s+=t.c}t.set(t.t,t.p,s,t)},mo=function(e,t){for(var n=t._pt;n;)n.r(e,n.d),n=n._next},Df=function(e,t,n,s){for(var l=this._pt,h;l;)h=l._next,l.p===s&&l.modifier(e,t,n),l=h},kf=function(e){for(var t=this._pt,n,s;t;)s=t._next,t.p===e&&!t.op||t.op===e?Ss(this,t,"_pt"):t.dep||(n=1),t=s;return!n},Lf=function(e,t,n,s){s.mSet(e,t,s.m.call(s.tween,n,s.mt),s)},Ch=function(e){for(var t=e._pt,n,s,l,h;t;){for(n=t._next,s=l;s&&s.pr>t.pr;)s=s._next;(t._prev=s?s._prev:h)?t._prev._next=t:l=t,(t._next=s)?s._prev=t:h=t,t=n}e._pt=l},Ue=(function(){function r(t,n,s,l,h,c,p,d,f){this.t=n,this.s=l,this.c=h,this.p=s,this.r=c||wh,this.d=p||this,this.set=d||po,this.pr=f||0,this._next=t,t&&(t._prev=this)}var e=r.prototype;return e.modifier=function(n,s,l){this.mSet=this.mSet||this.set,this.set=Lf,this.m=n,this.mt=l,this.tween=s},r})();Le(ao+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(r){return oo[r]=1});He.TweenMax=He.TweenLite=me;He.TimelineLite=He.TimelineMax=De;ce=new De({sortChildren:!1,defaults:Ii,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});Ve.stringFilter=ph;var _s={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach(function(s){return vf(s)})},timeline:function(e){return new De(e)},getTweensOf:function(e,t){return ce.getTweensOf(e,t)},getProperty:function(e,t,n,s){ve(e)&&(e=$e(e)[0]);var l=ni(e||{}).get,h=n?Jl:Ql;return n==="native"&&(n=""),e&&(t?h((Ne[t]&&Ne[t].get||l)(e,t,n,s)):function(c,p,d){return h((Ne[c]&&Ne[c].get||l)(e,c,p,d))})},quickSetter:function(e,t,n){if(e=$e(e),e.length>1){var s=e.map(function(f){return Je.quickSetter(f,t,n)}),l=s.length;return function(f){for(var _=l;_--;)s[_](f)}}e=e[0]||{};var h=Ne[t],c=ni(e),p=c.harness&&(c.harness.aliases||{})[t]||t,d=h?function(f){var _=new h;Ai._pt=0,_.init(e,n?f+n:f,Ai,0,[e]),_.render(1,_),Ai._pt&&mo(1,Ai)}:c.set(e,p);return h?d:function(f){return d(e,p,n?f+n:f,c,1)}},quickTo:function(e,t,n){var s,l=Je.to(e,li((s={},s[t]="+=0.1",s.paused=!0,s),n||{})),h=function(p,d,f){return l.resetTo(t,p,d,f)};return h.tween=l,h},isTweening:function(e){return ce.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=ri(e.ease,Ii.ease)),Ma(Ii,e||{})},config:function(e){return Ma(Ve,e||{})},registerEffect:function(e){var t=e.name,n=e.effect,s=e.plugins,l=e.defaults,h=e.extendTimeline;(s||"").split(",").forEach(function(c){return c&&!Ne[c]&&!He[c]&&ds(t+" effect requires "+c+" plugin.")}),pr[t]=function(c,p,d){return n($e(c),We(p||{},l),d)},h&&(De.prototype[t]=function(c,p,d){return this.add(pr[t](c,_t(p)?p:(d=p)&&{},this),d)})},registerEase:function(e,t){$[e]=ri(t)},parseEase:function(e,t){return arguments.length?ri(e,t):$},getById:function(e){return ce.getById(e)},exportRoot:function(e,t){e===void 0&&(e={});var n=new De(e),s,l;for(n.smoothChildTiming=ke(e.smoothChildTiming),ce.remove(n),n._dp=0,n._time=n._tTime=ce._time,s=ce._first;s;)l=s._next,(t||!(!s._dur&&s instanceof me&&s.vars.onComplete===s._targets[0]))&&at(n,s,s._start-s._delay),s=l;return at(ce,n,0),n},utils:{wrap:ff,wrapYoyo:mf,distribute:oh,random:lh,snap:ah,normalize:pf,getUnit:ye,clamp:lf,splitColor:uh,toArray:$e,selector:cf,mapRange:ch,pipe:uf,unitize:df,interpolate:_f,shuffle:rh},install:$l,effects:pr,ticker:Fe,updateRoot:De.updateRoot,plugins:Ne,globalTimeline:ce,core:{PropTween:Ue,globals:ql,Tween:me,Timeline:De,Animation:Sn,getCache:ni,_removeLinkedListItem:Ss,suppressOverwrites:function(e){return io=e}}};Le("to,from,fromTo,delayedCall,set,killTweensOf",function(r){return _s[r]=me[r]});Fe.add(De.updateRoot);Ai=_s.to({},{duration:0});var Uf=function(e,t){for(var n=e._pt;n&&n.p!==t&&n.op!==t&&n.fp!==t;)n=n._next;return n},If=function(e,t){var n=e._targets,s,l,h;for(s in t)for(l=n.length;l--;)h=e._ptLookup[l][s],h&&(h=h.d)&&(h._pt&&(h=Uf(h,s)),h&&h.modifier&&h.modifier(t[s],e,n[l],s))},vr=function(e,t){return{name:e,rawVars:1,init:function(s,l,h){h._onInit=function(c){var p,d;if(ve(l)&&(p={},Le(l,function(f){return p[f]=1}),l=p),t){p={};for(d in l)p[d]=t(l[d]);l=p}If(c,l)}}}},Je=_s.registerPlugin({name:"attr",init:function(e,t,n,s,l){var h,c;for(h in t)c=this.add(e,"setAttribute",(e.getAttribute(h)||0)+"",t[h],s,l,0,0,h),c&&(c.op=h),this._props.push(h)}},{name:"endArray",init:function(e,t){for(var n=t.length;n--;)this.add(e,n,e[n]||0,t[n])}},vr("roundProps",zr),vr("modifiers"),vr("snap",ah))||_s;me.version=De.version=Je.version="3.10.4";Yl=1;zl()&&Fi();$.Power0;$.Power1;$.Power2;$.Power3;$.Power4;$.Linear;$.Quad;$.Cubic;$.Quart;$.Quint;$.Strong;$.Elastic;$.Back;$.SteppedEase;$.Bounce;$.Sine;$.Expo;$.Circ;var Ua,Mt,Ri,_o,ii,Ia,Bf=function(){return typeof window<"u"},Ut={},ei=180/Math.PI,Di=Math.PI/180,yi=Math.atan2,Ba=1e8,Th=/([A-Z])/g,Nf=/(left|right|width|margin|padding|x)/i,Ff=/[\s,\(]\S/,Rt={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},Sh=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},Vf=function(e,t){return t.set(t.t,t.p,e===1?t.e:Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},zf=function(e,t){return t.set(t.t,t.p,e?Math.round((t.s+t.c*e)*1e4)/1e4+t.u:t.b,t)},Hf=function(e,t){var n=t.s+t.c*e;t.set(t.t,t.p,~~(n+(n<0?-.5:.5))+t.u,t)},Ph=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},Oh=function(e,t){return t.set(t.t,t.p,e!==1?t.b:t.e,t)},Gf=function(e,t,n){return e.style[t]=n},jf=function(e,t,n){return e.style.setProperty(t,n)},Kf=function(e,t,n){return e._gsap[t]=n},Yf=function(e,t,n){return e._gsap.scaleX=e._gsap.scaleY=n},$f=function(e,t,n,s,l){var h=e._gsap;h.scaleX=h.scaleY=n,h.renderTransform(l,h)},qf=function(e,t,n,s,l){var h=e._gsap;h[t]=n,h.renderTransform(l,h)},ge="transform",It=ge+"Origin",Ah,Gr=function(e,t){var n=Mt.createElementNS?Mt.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):Mt.createElement(e);return n.style?n:Mt.createElement(e)},ft=function r(e,t,n){var s=getComputedStyle(e);return s[t]||s.getPropertyValue(t.replace(Th,"-$1").toLowerCase())||s.getPropertyValue(t)||!n&&r(e,Vi(t)||t,1)||""},Na="O,Moz,ms,Ms,Webkit".split(","),Vi=function(e,t,n){var s=t||ii,l=s.style,h=5;if(e in l&&!n)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);h--&&!(Na[h]+e in l););return h<0?null:(h===3?"ms":h>=0?Na[h]:"")+e},jr=function(){Bf()&&window.document&&(Ua=window,Mt=Ua.document,Ri=Mt.documentElement,ii=Gr("div")||{style:{}},Gr("div"),ge=Vi(ge),It=ge+"Origin",ii.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",Ah=!!Vi("perspective"),_o=1)},gr=function r(e){var t=Gr("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),n=this.parentNode,s=this.nextSibling,l=this.style.cssText,h;if(Ri.appendChild(t),t.appendChild(this),this.style.display="block",e)try{h=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=r}catch{}else this._gsapBBox&&(h=this._gsapBBox());return n&&(s?n.insertBefore(this,s):n.appendChild(this)),Ri.removeChild(t),this.style.cssText=l,h},Fa=function(e,t){for(var n=t.length;n--;)if(e.hasAttribute(t[n]))return e.getAttribute(t[n])},Mh=function(e){var t;try{t=e.getBBox()}catch{t=gr.call(e,!0)}return t&&(t.width||t.height)||e.getBBox===gr||(t=gr.call(e,!0)),t&&!t.width&&!t.x&&!t.y?{x:+Fa(e,["x","cx","x1"])||0,y:+Fa(e,["y","cy","y1"])||0,width:0,height:0}:t},Rh=function(e){return!!(e.getCTM&&(!e.parentNode||e.ownerSVGElement)&&Mh(e))},Pn=function(e,t){if(t){var n=e.style;t in Ut&&t!==It&&(t=ge),n.removeProperty?((t.substr(0,2)==="ms"||t.substr(0,6)==="webkit")&&(t="-"+t),n.removeProperty(t.replace(Th,"-$1").toLowerCase())):n.removeAttribute(t)}},Dt=function(e,t,n,s,l,h){var c=new Ue(e._pt,t,n,0,1,h?Oh:Ph);return e._pt=c,c.b=s,c.e=l,e._props.push(n),c},Va={deg:1,rad:1,turn:1},Bt=function r(e,t,n,s){var l=parseFloat(n)||0,h=(n+"").trim().substr((l+"").length)||"px",c=ii.style,p=Nf.test(t),d=e.tagName.toLowerCase()==="svg",f=(d?"client":"offset")+(p?"Width":"Height"),_=100,g=s==="px",v=s==="%",y,b,x,w;return s===h||!l||Va[s]||Va[h]?l:(h!=="px"&&!g&&(l=r(e,t,n,"px")),w=e.getCTM&&Rh(e),(v||h==="%")&&(Ut[t]||~t.indexOf("adius"))?(y=w?e.getBBox()[p?"width":"height"]:e[f],de(v?l/y*_:l/100*y)):(c[p?"width":"height"]=_+(g?h:s),b=~t.indexOf("adius")||s==="em"&&e.appendChild&&!d?e:e.parentNode,w&&(b=(e.ownerSVGElement||{}).parentNode),(!b||b===Mt||!b.appendChild)&&(b=Mt.body),x=b._gsap,x&&v&&x.width&&p&&x.time===Fe.time?de(l/x.width*_):((v||h==="%")&&(c.position=ft(e,"position")),b===e&&(c.position="static"),b.appendChild(ii),y=ii[f],b.removeChild(ii),c.position="absolute",p&&v&&(x=ni(b),x.time=Fe.time,x.width=b[f]),de(g?y*l/_:y&&l?_/y*l:0))))},ti=function(e,t,n,s){var l;return _o||jr(),t in Rt&&t!=="transform"&&(t=Rt[t],~t.indexOf(",")&&(t=t.split(",")[0])),Ut[t]&&t!=="transform"?(l=An(e,s),l=t!=="transformOrigin"?l[t]:l.svg?l.origin:gs(ft(e,It))+" "+l.zOrigin+"px"):(l=e.style[t],(!l||l==="auto"||s||~(l+"").indexOf("calc("))&&(l=vs[t]&&vs[t](e,t,n)||ft(e,t)||Zl(e,t)||(t==="opacity"?1:0))),n&&!~(l+"").trim().indexOf(" ")?Bt(e,t,l,n)+n:l},Wf=function(e,t,n,s){if(!n||n==="none"){var l=Vi(t,e,1),h=l&&ft(e,l,1);h&&h!==n?(t=l,n=h):t==="borderColor"&&(n=ft(e,"borderTopColor"))}var c=new Ue(this._pt,e.style,t,0,1,Eh),p=0,d=0,f,_,g,v,y,b,x,w,E,T,O,A;if(c.b=n,c.e=s,n+="",s+="",s==="auto"&&(e.style[t]=s,s=ft(e,t)||s,e.style[t]=n),f=[n,s],ph(f),n=f[0],s=f[1],g=n.match(Oi)||[],A=s.match(Oi)||[],A.length){for(;_=Oi.exec(s);)x=_[0],E=s.substring(p,_.index),y?y=(y+1)%5:(E.substr(-5)==="rgba("||E.substr(-5)==="hsla(")&&(y=1),x!==(b=g[d++]||"")&&(v=parseFloat(b)||0,O=b.substr((v+"").length),x.charAt(1)==="="&&(x=Mi(v,x)+O),w=parseFloat(x),T=x.substr((w+"").length),p=Oi.lastIndex-T.length,T||(T=T||Ve.units[t]||O,p===s.length&&(s+=T,c.e+=T)),O!==T&&(v=Bt(e,t,b,T)||0),c._pt={_next:c._pt,p:E||d===1?E:",",s:v,c:w-v,m:y&&y<4||t==="zIndex"?Math.round:0});c.c=p<s.length?s.substring(p,s.length):""}else c.r=t==="display"&&s==="none"?Oh:Ph;return jl.test(s)&&(c.e=0),this._pt=c,c},za={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},Zf=function(e){var t=e.split(" "),n=t[0],s=t[1]||"50%";return(n==="top"||n==="bottom"||s==="left"||s==="right")&&(e=n,n=s,s=e),t[0]=za[n]||n,t[1]=za[s]||s,t.join(" ")},Xf=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var n=t.t,s=n.style,l=t.u,h=n._gsap,c,p,d;if(l==="all"||l===!0)s.cssText="",p=1;else for(l=l.split(","),d=l.length;--d>-1;)c=l[d],Ut[c]&&(p=1,c=c==="transformOrigin"?It:ge),Pn(n,c);p&&(Pn(n,ge),h&&(h.svg&&n.removeAttribute("transform"),An(n,1),h.uncache=1))}},vs={clearProps:function(e,t,n,s,l){if(l.data!=="isFromStart"){var h=e._pt=new Ue(e._pt,t,n,0,0,Xf);return h.u=s,h.pr=-10,h.tween=l,e._props.push(n),1}}},On=[1,0,0,1,0,0],Dh={},kh=function(e){return e==="matrix(1, 0, 0, 1, 0, 0)"||e==="none"||!e},Ha=function(e){var t=ft(e,ge);return kh(t)?On:t.substr(7).match(Gl).map(de)},vo=function(e,t){var n=e._gsap||ni(e),s=e.style,l=Ha(e),h,c,p,d;return n.svg&&e.getAttribute("transform")?(p=e.transform.baseVal.consolidate().matrix,l=[p.a,p.b,p.c,p.d,p.e,p.f],l.join(",")==="1,0,0,1,0,0"?On:l):(l===On&&!e.offsetParent&&e!==Ri&&!n.svg&&(p=s.display,s.display="block",h=e.parentNode,(!h||!e.offsetParent)&&(d=1,c=e.nextSibling,Ri.appendChild(e)),l=Ha(e),p?s.display=p:Pn(e,"display"),d&&(c?h.insertBefore(e,c):h?h.appendChild(e):Ri.removeChild(e))),t&&l.length>6?[l[0],l[1],l[4],l[5],l[12],l[13]]:l)},Kr=function(e,t,n,s,l,h){var c=e._gsap,p=l||vo(e,!0),d=c.xOrigin||0,f=c.yOrigin||0,_=c.xOffset||0,g=c.yOffset||0,v=p[0],y=p[1],b=p[2],x=p[3],w=p[4],E=p[5],T=t.split(" "),O=parseFloat(T[0])||0,A=parseFloat(T[1])||0,M,R,D,k;n?p!==On&&(R=v*x-y*b)&&(D=O*(x/R)+A*(-b/R)+(b*E-x*w)/R,k=O*(-y/R)+A*(v/R)-(v*E-y*w)/R,O=D,A=k):(M=Mh(e),O=M.x+(~T[0].indexOf("%")?O/100*M.width:O),A=M.y+(~(T[1]||T[0]).indexOf("%")?A/100*M.height:A)),s||s!==!1&&c.smooth?(w=O-d,E=A-f,c.xOffset=_+(w*v+E*b)-w,c.yOffset=g+(w*y+E*x)-E):c.xOffset=c.yOffset=0,c.xOrigin=O,c.yOrigin=A,c.smooth=!!s,c.origin=t,c.originIsAbsolute=!!n,e.style[It]="0px 0px",h&&(Dt(h,c,"xOrigin",d,O),Dt(h,c,"yOrigin",f,A),Dt(h,c,"xOffset",_,c.xOffset),Dt(h,c,"yOffset",g,c.yOffset)),e.setAttribute("data-svg-origin",O+" "+A)},An=function(e,t){var n=e._gsap||new vh(e);if("x"in n&&!t&&!n.uncache)return n;var s=e.style,l=n.scaleX<0,h="px",c="deg",p=ft(e,It)||"0",d,f,_,g,v,y,b,x,w,E,T,O,A,M,R,D,k,I,H,K,ee,q,z,U,ue,Te,Se,pe,Ee,W,Z,ht;return d=f=_=y=b=x=w=E=T=0,g=v=1,n.svg=!!(e.getCTM&&Rh(e)),M=vo(e,n.svg),n.svg&&(U=(!n.uncache||p==="0px 0px")&&!t&&e.getAttribute("data-svg-origin"),Kr(e,U||p,!!U||n.originIsAbsolute,n.smooth!==!1,M)),O=n.xOrigin||0,A=n.yOrigin||0,M!==On&&(I=M[0],H=M[1],K=M[2],ee=M[3],d=q=M[4],f=z=M[5],M.length===6?(g=Math.sqrt(I*I+H*H),v=Math.sqrt(ee*ee+K*K),y=I||H?yi(H,I)*ei:0,w=K||ee?yi(K,ee)*ei+y:0,w&&(v*=Math.abs(Math.cos(w*Di))),n.svg&&(d-=O-(O*I+A*K),f-=A-(O*H+A*ee))):(ht=M[6],W=M[7],Se=M[8],pe=M[9],Ee=M[10],Z=M[11],d=M[12],f=M[13],_=M[14],R=yi(ht,Ee),b=R*ei,R&&(D=Math.cos(-R),k=Math.sin(-R),U=q*D+Se*k,ue=z*D+pe*k,Te=ht*D+Ee*k,Se=q*-k+Se*D,pe=z*-k+pe*D,Ee=ht*-k+Ee*D,Z=W*-k+Z*D,q=U,z=ue,ht=Te),R=yi(-K,Ee),x=R*ei,R&&(D=Math.cos(-R),k=Math.sin(-R),U=I*D-Se*k,ue=H*D-pe*k,Te=K*D-Ee*k,Z=ee*k+Z*D,I=U,H=ue,K=Te),R=yi(H,I),y=R*ei,R&&(D=Math.cos(R),k=Math.sin(R),U=I*D+H*k,ue=q*D+z*k,H=H*D-I*k,z=z*D-q*k,I=U,q=ue),b&&Math.abs(b)+Math.abs(y)>359.9&&(b=y=0,x=180-x),g=de(Math.sqrt(I*I+H*H+K*K)),v=de(Math.sqrt(z*z+ht*ht)),R=yi(q,z),w=Math.abs(R)>2e-4?R*ei:0,T=Z?1/(Z<0?-Z:Z):0),n.svg&&(U=e.getAttribute("transform"),n.forceCSS=e.setAttribute("transform","")||!kh(ft(e,ge)),U&&e.setAttribute("transform",U))),Math.abs(w)>90&&Math.abs(w)<270&&(l?(g*=-1,w+=y<=0?180:-180,y+=y<=0?180:-180):(v*=-1,w+=w<=0?180:-180)),t=t||n.uncache,n.x=d-((n.xPercent=d&&(!t&&n.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-d)?-50:0)))?e.offsetWidth*n.xPercent/100:0)+h,n.y=f-((n.yPercent=f&&(!t&&n.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-f)?-50:0)))?e.offsetHeight*n.yPercent/100:0)+h,n.z=_+h,n.scaleX=de(g),n.scaleY=de(v),n.rotation=de(y)+c,n.rotationX=de(b)+c,n.rotationY=de(x)+c,n.skewX=w+c,n.skewY=E+c,n.transformPerspective=T+h,(n.zOrigin=parseFloat(p.split(" ")[2])||0)&&(s[It]=gs(p)),n.xOffset=n.yOffset=0,n.force3D=Ve.force3D,n.renderTransform=n.svg?Jf:Ah?Lh:Qf,n.uncache=0,n},gs=function(e){return(e=e.split(" "))[0]+" "+e[1]},br=function(e,t,n){var s=ye(t);return de(parseFloat(t)+parseFloat(Bt(e,"x",n+"px",s)))+s},Qf=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,Lh(e,t)},$t="0deg",ln="0px",qt=") ",Lh=function(e,t){var n=t||this,s=n.xPercent,l=n.yPercent,h=n.x,c=n.y,p=n.z,d=n.rotation,f=n.rotationY,_=n.rotationX,g=n.skewX,v=n.skewY,y=n.scaleX,b=n.scaleY,x=n.transformPerspective,w=n.force3D,E=n.target,T=n.zOrigin,O="",A=w==="auto"&&e&&e!==1||w===!0;if(T&&(_!==$t||f!==$t)){var M=parseFloat(f)*Di,R=Math.sin(M),D=Math.cos(M),k;M=parseFloat(_)*Di,k=Math.cos(M),h=br(E,h,R*k*-T),c=br(E,c,-Math.sin(M)*-T),p=br(E,p,D*k*-T+T)}x!==ln&&(O+="perspective("+x+qt),(s||l)&&(O+="translate("+s+"%, "+l+"%) "),(A||h!==ln||c!==ln||p!==ln)&&(O+=p!==ln||A?"translate3d("+h+", "+c+", "+p+") ":"translate("+h+", "+c+qt),d!==$t&&(O+="rotate("+d+qt),f!==$t&&(O+="rotateY("+f+qt),_!==$t&&(O+="rotateX("+_+qt),(g!==$t||v!==$t)&&(O+="skew("+g+", "+v+qt),(y!==1||b!==1)&&(O+="scale("+y+", "+b+qt),E.style[ge]=O||"translate(0, 0)"},Jf=function(e,t){var n=t||this,s=n.xPercent,l=n.yPercent,h=n.x,c=n.y,p=n.rotation,d=n.skewX,f=n.skewY,_=n.scaleX,g=n.scaleY,v=n.target,y=n.xOrigin,b=n.yOrigin,x=n.xOffset,w=n.yOffset,E=n.forceCSS,T=parseFloat(h),O=parseFloat(c),A,M,R,D,k;p=parseFloat(p),d=parseFloat(d),f=parseFloat(f),f&&(f=parseFloat(f),d+=f,p+=f),p||d?(p*=Di,d*=Di,A=Math.cos(p)*_,M=Math.sin(p)*_,R=Math.sin(p-d)*-g,D=Math.cos(p-d)*g,d&&(f*=Di,k=Math.tan(d-f),k=Math.sqrt(1+k*k),R*=k,D*=k,f&&(k=Math.tan(f),k=Math.sqrt(1+k*k),A*=k,M*=k)),A=de(A),M=de(M),R=de(R),D=de(D)):(A=_,D=g,M=R=0),(T&&!~(h+"").indexOf("px")||O&&!~(c+"").indexOf("px"))&&(T=Bt(v,"x",h,"px"),O=Bt(v,"y",c,"px")),(y||b||x||w)&&(T=de(T+y-(y*A+b*R)+x),O=de(O+b-(y*M+b*D)+w)),(s||l)&&(k=v.getBBox(),T=de(T+s/100*k.width),O=de(O+l/100*k.height)),k="matrix("+A+","+M+","+R+","+D+","+T+","+O+")",v.setAttribute("transform",k),E&&(v.style[ge]=k)},em=function(e,t,n,s,l){var h=360,c=ve(l),p=parseFloat(l)*(c&&~l.indexOf("rad")?ei:1),d=p-s,f=s+d+"deg",_,g;return c&&(_=l.split("_")[1],_==="short"&&(d%=h,d!==d%(h/2)&&(d+=d<0?h:-h)),_==="cw"&&d<0?d=(d+h*Ba)%h-~~(d/h)*h:_==="ccw"&&d>0&&(d=(d-h*Ba)%h-~~(d/h)*h)),e._pt=g=new Ue(e._pt,t,n,s,d,Vf),g.e=f,g.u="deg",e._props.push(n),g},Ga=function(e,t){for(var n in t)e[n]=t[n];return e},tm=function(e,t,n){var s=Ga({},n._gsap),l="perspective,force3D,transformOrigin,svgOrigin",h=n.style,c,p,d,f,_,g,v,y;s.svg?(d=n.getAttribute("transform"),n.setAttribute("transform",""),h[ge]=t,c=An(n,1),Pn(n,ge),n.setAttribute("transform",d)):(d=getComputedStyle(n)[ge],h[ge]=t,c=An(n,1),h[ge]=d);for(p in Ut)d=s[p],f=c[p],d!==f&&l.indexOf(p)<0&&(v=ye(d),y=ye(f),_=v!==y?Bt(n,p,d,y):parseFloat(d),g=parseFloat(f),e._pt=new Ue(e._pt,c,p,_,g-_,Sh),e._pt.u=y||0,e._props.push(p));Ga(c,s)};Le("padding,margin,Width,Radius",function(r,e){var t="Top",n="Right",s="Bottom",l="Left",h=(e<3?[t,n,s,l]:[t+l,t+n,s+n,s+l]).map(function(c){return e<2?r+c:"border"+c+r});vs[e>1?"border"+r:r]=function(c,p,d,f,_){var g,v;if(arguments.length<4)return g=h.map(function(y){return ti(c,y,d)}),v=g.join(" "),v.split(g[0]).length===5?g[0]:v;g=(f+"").split(" "),v={},h.forEach(function(y,b){return v[y]=g[b]=g[b]||g[(b-1)/2|0]}),c.init(p,v,_)}});var Uh={name:"css",register:jr,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,n,s,l){var h=this._props,c=e.style,p=n.vars.startAt,d,f,_,g,v,y,b,x,w,E,T,O,A,M,R;_o||jr();for(b in t)if(b!=="autoRound"&&(f=t[b],!(Ne[b]&&gh(b,t,n,s,e,l)))){if(v=typeof f,y=vs[b],v==="function"&&(f=f.call(n,s,e,l),v=typeof f),v==="string"&&~f.indexOf("random(")&&(f=Cn(f)),y)y(this,e,b,f,n)&&(R=1);else if(b.substr(0,2)==="--")d=(getComputedStyle(e).getPropertyValue(b)+"").trim(),f+="",Lt.lastIndex=0,Lt.test(d)||(x=ye(d),w=ye(f)),w?x!==w&&(d=Bt(e,b,d,w)+w):x&&(f+=x),this.add(c,"setProperty",d,f,s,l,0,0,b),h.push(b);else if(v!=="undefined"){if(p&&b in p?(d=typeof p[b]=="function"?p[b].call(n,s,e,l):p[b],ve(d)&&~d.indexOf("random(")&&(d=Cn(d)),ye(d+"")||(d+=Ve.units[b]||ye(ti(e,b))||""),(d+"").charAt(1)==="="&&(d=ti(e,b))):d=ti(e,b),g=parseFloat(d),E=v==="string"&&f.charAt(1)==="="&&f.substr(0,2),E&&(f=f.substr(2)),_=parseFloat(f),b in Rt&&(b==="autoAlpha"&&(g===1&&ti(e,"visibility")==="hidden"&&_&&(g=0),Dt(this,c,"visibility",g?"inherit":"hidden",_?"inherit":"hidden",!_)),b!=="scale"&&b!=="transform"&&(b=Rt[b],~b.indexOf(",")&&(b=b.split(",")[0]))),T=b in Ut,T){if(O||(A=e._gsap,A.renderTransform&&!t.parseTransform||An(e,t.parseTransform),M=t.smoothOrigin!==!1&&A.smooth,O=this._pt=new Ue(this._pt,c,ge,0,1,A.renderTransform,A,0,-1),O.dep=1),b==="scale")this._pt=new Ue(this._pt,A,"scaleY",A.scaleY,(E?Mi(A.scaleY,E+_):_)-A.scaleY||0),h.push("scaleY",b),b+="X";else if(b==="transformOrigin"){f=Zf(f),A.svg?Kr(e,f,0,M,0,this):(w=parseFloat(f.split(" ")[2])||0,w!==A.zOrigin&&Dt(this,A,"zOrigin",A.zOrigin,w),Dt(this,c,b,gs(d),gs(f)));continue}else if(b==="svgOrigin"){Kr(e,f,1,M,0,this);continue}else if(b in Dh){em(this,A,b,g,E?Mi(g,E+f):f);continue}else if(b==="smoothOrigin"){Dt(this,A,"smooth",A.smooth,f);continue}else if(b==="force3D"){A[b]=f;continue}else if(b==="transform"){tm(this,f,e);continue}}else b in c||(b=Vi(b)||b);if(T||(_||_===0)&&(g||g===0)&&!Ff.test(f)&&b in c)x=(d+"").substr((g+"").length),_||(_=0),w=ye(f)||(b in Ve.units?Ve.units[b]:x),x!==w&&(g=Bt(e,b,d,w)),this._pt=new Ue(this._pt,T?A:c,b,g,(E?Mi(g,E+_):_)-g,!T&&(w==="px"||b==="zIndex")&&t.autoRound!==!1?Hf:Sh),this._pt.u=w||0,x!==w&&w!=="%"&&(this._pt.b=d,this._pt.r=zf);else if(b in c)Wf.call(this,e,b,d,E?E+f:f);else if(b in e)this.add(e,b,d||e[b],E?E+f:f,s,l);else{ro(b,f);continue}h.push(b)}}R&&Ch(this)},get:ti,aliases:Rt,getSetter:function(e,t,n){var s=Rt[t];return s&&s.indexOf(",")<0&&(t=s),t in Ut&&t!==It&&(e._gsap.x||ti(e,"x"))?n&&Ia===n?t==="scale"?Yf:Kf:(Ia=n||{})&&(t==="scale"?$f:qf):e.style&&!no(e.style[t])?Gf:~t.indexOf("-")?jf:fo(e,t)},core:{_removeProperty:Pn,_getMatrix:vo}};Je.utils.checkPrefix=Vi;(function(r,e,t,n){var s=Le(r+","+e+","+t,function(l){Ut[l]=1});Le(e,function(l){Ve.units[l]="deg",Dh[l]=1}),Rt[s[13]]=r+","+e,Le(n,function(l){var h=l.split(":");Rt[h[1]]=s[h[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");Le("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(r){Ve.units[r]="px"});Je.registerPlugin(Uh);var Yr=Je.registerPlugin(Uh)||Je;Yr.core.Tween;var os={exports:{}},im=os.exports,ja;function nm(){return ja||(ja=1,(function(r,e){(function(t,n){r.exports=n()})(im,function(){var t=function(){function n(v){return h.appendChild(v.dom),v}function s(v){for(var y=0;y<h.children.length;y++)h.children[y].style.display=y===v?"block":"none";l=v}var l=0,h=document.createElement("div");h.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",h.addEventListener("click",function(v){v.preventDefault(),s(++l%h.children.length)},!1);var c=(performance||Date).now(),p=c,d=0,f=n(new t.Panel("FPS","#0ff","#002")),_=n(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var g=n(new t.Panel("MB","#f08","#201"));return s(0),{REVISION:16,dom:h,addPanel:n,showPanel:s,begin:function(){c=(performance||Date).now()},end:function(){d++;var v=(performance||Date).now();if(_.update(v-c,200),v>p+1e3&&(f.update(1e3*d/(v-p),100),p=v,d=0,g)){var y=performance.memory;g.update(y.usedJSHeapSize/1048576,y.jsHeapSizeLimit/1048576)}return v},update:function(){c=this.end()},domElement:h,setMode:s}};return t.Panel=function(n,s,l){var h=1/0,c=0,p=Math.round,d=p(window.devicePixelRatio||1),f=80*d,_=48*d,g=3*d,v=2*d,y=3*d,b=15*d,x=74*d,w=30*d,E=document.createElement("canvas");E.width=f,E.height=_,E.style.cssText="width:80px;height:48px";var T=E.getContext("2d");return T.font="bold "+9*d+"px Helvetica,Arial,sans-serif",T.textBaseline="top",T.fillStyle=l,T.fillRect(0,0,f,_),T.fillStyle=s,T.fillText(n,g,v),T.fillRect(y,b,x,w),T.fillStyle=l,T.globalAlpha=.9,T.fillRect(y,b,x,w),{dom:E,update:function(O,A){h=Math.min(h,O),c=Math.max(c,O),T.fillStyle=l,T.globalAlpha=1,T.fillRect(0,0,f,b),T.fillStyle=s,T.fillText(p(O)+" "+n+" ("+p(h)+"-"+p(c)+")",g,v),T.drawImage(E,y+d,b,x-d,w,y,b,x-d,w),T.fillRect(y+x-d,b,d,w),T.fillStyle=l,T.globalAlpha=.9,T.fillRect(y+x-d,b,d,p((1-O/A)*w))}}},t})})(os)),os.exports}var sm=nm();const rm=Al(sm);var gn={exports:{}};var om=gn.exports,Ka;function am(){return Ka||(Ka=1,(function(r,e){(function(t,n){n(e)})(om,(function(t){class n{constructor(i){const[o,u]=i.split("-"),m=o.split(".");this.major=parseInt(m[0],10),this.minor=parseInt(m[1],10),this.patch=parseInt(m[2],10),this.prerelease=u??null}toString(){const i=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[i,this.prerelease].join("-"):i}}class s{constructor(i){this.controller_=i}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(i){this.controller_.viewProps.set("disabled",i)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(i){this.controller_.viewProps.set("hidden",i)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class l{constructor(i){this.target=i}}class h extends l{constructor(i,o,u,m){super(i),this.value=o,this.presetKey=u,this.last=m??!0}}class c extends l{constructor(i,o,u){super(i),this.value=o,this.presetKey=u}}class p extends l{constructor(i,o){super(i),this.expanded=o}}function d(a){return a}function f(a){return a==null}function _(a,i){if(a.length!==i.length)return!1;for(let o=0;o<a.length;o++)if(a[o]!==i[o])return!1;return!0}const g={alreadydisposed:()=>"View has been already disposed",invalidparams:a=>`Invalid parameters for '${a.name}'`,nomatchingcontroller:a=>`No matching controller for '${a.key}'`,nomatchingview:a=>`No matching view for '${JSON.stringify(a.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:a=>`Property '${a.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class v{constructor(i){var o;this.message=(o=g[i.type](i.context))!==null&&o!==void 0?o:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=i.type}static alreadyDisposed(){return new v({type:"alreadydisposed"})}static notBindable(){return new v({type:"notbindable"})}static propertyNotFound(i){return new v({type:"propertynotfound",context:{name:i}})}static shouldNeverHappen(){return new v({type:"shouldneverhappen"})}}class y{constructor(i,o,u){this.obj_=i,this.key_=o,this.presetKey_=u??o}static isBindable(i){return!(i===null||typeof i!="object")}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(i){this.obj_[this.key_]=i}writeProperty(i,o){const u=this.read();if(!y.isBindable(u))throw v.notBindable();if(!(i in u))throw v.propertyNotFound(i);u[i]=o}}class b extends s{get label(){return this.controller_.props.get("label")}set label(i){this.controller_.props.set("label",i)}get title(){var i;return(i=this.controller_.valueController.props.get("title"))!==null&&i!==void 0?i:""}set title(i){this.controller_.valueController.props.set("title",i)}on(i,o){const u=o.bind(this);return this.controller_.valueController.emitter.on(i,()=>{u(new l(this))}),this}}class x{constructor(){this.observers_={}}on(i,o){let u=this.observers_[i];return u||(u=this.observers_[i]=[]),u.push({handler:o}),this}off(i,o){const u=this.observers_[i];return u&&(this.observers_[i]=u.filter(m=>m.handler!==o)),this}emit(i,o){const u=this.observers_[i];u&&u.forEach(m=>{m.handler(o)})}}const w="tp";function E(a){return(o,u)=>[w,"-",a,"v",o?`_${o}`:"",u?`-${u}`:""].join("")}function T(a,i){return o=>i(a(o))}function O(a){return a.rawValue}function A(a,i){a.emitter.on("change",T(O,i)),i(a.rawValue)}function M(a,i,o){A(a.value(i),o)}function R(a,i,o){o?a.classList.add(i):a.classList.remove(i)}function D(a,i){return o=>{R(a,i,o)}}function k(a,i){A(a,o=>{i.textContent=o??""})}const I=E("btn");class H{constructor(i,o){this.element=i.createElement("div"),this.element.classList.add(I()),o.viewProps.bindClassModifiers(this.element);const u=i.createElement("button");u.classList.add(I("b")),o.viewProps.bindDisabled(u),this.element.appendChild(u),this.buttonElement=u;const m=i.createElement("div");m.classList.add(I("t")),k(o.props.value("title"),m),this.buttonElement.appendChild(m)}}class K{constructor(i,o){this.emitter=new x,this.onClick_=this.onClick_.bind(this),this.props=o.props,this.viewProps=o.viewProps,this.view=new H(i,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class ee{constructor(i,o){var u;this.constraint_=o?.constraint,this.equals_=(u=o?.equals)!==null&&u!==void 0?u:((m,C)=>m===C),this.emitter=new x,this.rawValue_=i}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(i){this.setRawValue(i,{forceEmit:!1,last:!0})}setRawValue(i,o){const u=o??{forceEmit:!1,last:!0},m=this.constraint_?this.constraint_.constrain(i):i;this.equals_(this.rawValue_,m)&&!u.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=m,this.emitter.emit("change",{options:u,rawValue:m,sender:this}))}}class q{constructor(i){this.emitter=new x,this.value_=i}get rawValue(){return this.value_}set rawValue(i){this.setRawValue(i,{forceEmit:!1,last:!0})}setRawValue(i,o){const u=o??{forceEmit:!1,last:!0};this.value_===i&&!u.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=i,this.emitter.emit("change",{options:u,rawValue:this.value_,sender:this}))}}function z(a,i){const o=i?.constraint,u=i?.equals;return!o&&!u?new q(a):new ee(a,i)}class U{constructor(i){this.emitter=new x,this.valMap_=i;for(const o in this.valMap_)this.valMap_[o].emitter.on("change",()=>{this.emitter.emit("change",{key:o,sender:this})})}static createCore(i){return Object.keys(i).reduce((u,m)=>Object.assign(u,{[m]:z(i[m])}),{})}static fromObject(i){const o=this.createCore(i);return new U(o)}get(i){return this.valMap_[i].rawValue}set(i,o){this.valMap_[i].rawValue=o}value(i){return this.valMap_[i]}}function ue(a,i){const u=Object.keys(i).reduce((m,C)=>{if(m===void 0)return;const S=i[C],L=S(a[C]);return L.succeeded?Object.assign(Object.assign({},m),{[C]:L.value}):void 0},{});return u}function Te(a,i){return a.reduce((o,u)=>{if(o===void 0)return;const m=i(u);if(!(!m.succeeded||m.value===void 0))return[...o,m.value]},[])}function Se(a){return a===null?!1:typeof a=="object"}function pe(a){return i=>o=>{if(!i&&o===void 0)return{succeeded:!1,value:void 0};if(i&&o===void 0)return{succeeded:!0,value:void 0};const u=a(o);return u!==void 0?{succeeded:!0,value:u}:{succeeded:!1,value:void 0}}}function Ee(a){return{custom:i=>pe(i)(a),boolean:pe(i=>typeof i=="boolean"?i:void 0)(a),number:pe(i=>typeof i=="number"?i:void 0)(a),string:pe(i=>typeof i=="string"?i:void 0)(a),function:pe(i=>typeof i=="function"?i:void 0)(a),constant:i=>pe(o=>o===i?i:void 0)(a),raw:pe(i=>i)(a),object:i=>pe(o=>{if(Se(o))return ue(o,i)})(a),array:i=>pe(o=>{if(Array.isArray(o))return Te(o,i)})(a)}}const W={optional:Ee(!0),required:Ee(!1)};function Z(a,i){const o=W.required.object(i)(a);return o.succeeded?o.value:void 0}function ht(a){return a&&a.parentElement&&a.parentElement.removeChild(a),null}function Yh(){return["veryfirst","first","last","verylast"]}const yo=E(""),wo={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class Hi{constructor(i){this.parent_=null,this.blade=i.blade,this.view=i.view,this.viewProps=i.viewProps;const o=this.view.element;this.blade.value("positions").emitter.on("change",()=>{Yh().forEach(u=>{o.classList.remove(yo(void 0,wo[u]))}),this.blade.get("positions").forEach(u=>{o.classList.add(yo(void 0,wo[u]))})}),this.viewProps.handleDispose(()=>{ht(o)})}get parent(){return this.parent_}}const tt="http://www.w3.org/2000/svg";function kn(a){a.offsetHeight}function $h(a,i){const o=a.style.transition;a.style.transition="none",i(),a.style.transition=o}function Ms(a){return a.ontouchstart!==void 0}function qh(){return new Function("return this")()}function Wh(){return qh().document}function Zh(a){const i=a.ownerDocument.defaultView;return i&&"document"in i?a.getContext("2d"):null}const Xh={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Ln(a,i){const o=a.createElementNS(tt,"svg");return o.innerHTML=Xh[i],o}function Eo(a,i,o){a.insertBefore(i,a.children[o])}function Co(a){a.parentElement&&a.parentElement.removeChild(a)}function To(a){for(;a.children.length>0;)a.removeChild(a.children[0])}function Qh(a){for(;a.childNodes.length>0;)a.removeChild(a.childNodes[0])}function So(a){return a.relatedTarget?a.relatedTarget:"explicitOriginalTarget"in a?a.explicitOriginalTarget:null}const Gi=E("lbl");function Jh(a,i){const o=a.createDocumentFragment();return i.split(`
`).map(m=>a.createTextNode(m)).forEach((m,C)=>{C>0&&o.appendChild(a.createElement("br")),o.appendChild(m)}),o}class Po{constructor(i,o){this.element=i.createElement("div"),this.element.classList.add(Gi()),o.viewProps.bindClassModifiers(this.element);const u=i.createElement("div");u.classList.add(Gi("l")),M(o.props,"label",C=>{f(C)?this.element.classList.add(Gi(void 0,"nol")):(this.element.classList.remove(Gi(void 0,"nol")),Qh(u),u.appendChild(Jh(i,C)))}),this.element.appendChild(u),this.labelElement=u;const m=i.createElement("div");m.classList.add(Gi("v")),this.element.appendChild(m),this.valueElement=m}}class Un extends Hi{constructor(i,o){const u=o.valueController.viewProps;super(Object.assign(Object.assign({},o),{view:new Po(i,{props:o.props,viewProps:u}),viewProps:u})),this.props=o.props,this.valueController=o.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const ec={id:"button",type:"blade",accept(a){const i=W,o=Z(a,{title:i.required.string,view:i.required.constant("button"),label:i.optional.string});return o?{params:o}:null},controller(a){return new Un(a.document,{blade:a.blade,props:U.fromObject({label:a.params.label}),valueController:new K(a.document,{props:U.fromObject({title:a.params.title}),viewProps:a.viewProps})})},api(a){return!(a.controller instanceof Un)||!(a.controller.valueController instanceof K)?null:new b(a.controller)}};class ui extends Hi{constructor(i){super(i),this.value=i.value}}function ji(){return new U({positions:z([],{equals:_})})}class Ki extends U{constructor(i){super(i)}static create(i){const o={completed:!0,expanded:i,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},u=U.createCore(o);return new Ki(u)}get styleExpanded(){var i;return(i=this.get("temporaryExpanded"))!==null&&i!==void 0?i:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const i=this.get("expandedHeight");return this.get("shouldFixHeight")&&!f(i)?`${i}px`:"auto"}bindExpandedClass(i,o){const u=()=>{this.styleExpanded?i.classList.add(o):i.classList.remove(o)};M(this,"expanded",u),M(this,"temporaryExpanded",u)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function tc(a,i){let o=0;return $h(i,()=>{a.set("expandedHeight",null),a.set("temporaryExpanded",!0),kn(i),o=i.clientHeight,a.set("temporaryExpanded",null),kn(i)}),o}function Oo(a,i){i.style.height=a.styleHeight}function Rs(a,i){a.value("expanded").emitter.on("beforechange",()=>{a.set("completed",!1),f(a.get("expandedHeight"))&&a.set("expandedHeight",tc(a,i)),a.set("shouldFixHeight",!0),kn(i)}),a.emitter.on("change",()=>{Oo(a,i)}),Oo(a,i),i.addEventListener("transitionend",o=>{o.propertyName==="height"&&a.cleanUpTransition()})}class Ds extends s{constructor(i,o){super(i),this.rackApi_=o}}function ic(a,i){return a.addBlade(Object.assign(Object.assign({},i),{view:"button"}))}function nc(a,i){return a.addBlade(Object.assign(Object.assign({},i),{view:"folder"}))}function sc(a,i){const o=i||{};return a.addBlade(Object.assign(Object.assign({},o),{view:"separator"}))}function rc(a,i){return a.addBlade(Object.assign(Object.assign({},i),{view:"tab"}))}class ks{constructor(i){this.emitter=new x,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=i}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(i){for(const o of this.allItems())if(i(o))return o;return null}includes(i){return this.cache_.has(i)}add(i,o){if(this.includes(i))throw v.shouldNeverHappen();const u=o!==void 0?o:this.items_.length;this.items_.splice(u,0,i),this.cache_.add(i);const m=this.extract_(i);m&&(m.emitter.on("add",this.onSubListAdd_),m.emitter.on("remove",this.onSubListRemove_),m.allItems().forEach(C=>{this.cache_.add(C)})),this.emitter.emit("add",{index:u,item:i,root:this,target:this})}remove(i){const o=this.items_.indexOf(i);if(o<0)return;this.items_.splice(o,1),this.cache_.delete(i);const u=this.extract_(i);u&&(u.emitter.off("add",this.onSubListAdd_),u.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:o,item:i,root:this,target:this})}onSubListAdd_(i){this.cache_.add(i.item),this.emitter.emit("add",{index:i.index,item:i.item,root:this,target:i.target})}onSubListRemove_(i){this.cache_.delete(i.item),this.emitter.emit("remove",{index:i.index,item:i.item,root:this,target:i.target})}}class Ls extends s{constructor(i){super(i),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new x,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(i){this.controller_.props.set("label",i)}on(i,o){const u=o.bind(this);return this.emitter_.on(i,m=>{u(m.event)}),this}refresh(){this.controller_.binding.read()}onBindingChange_(i){const o=i.sender.target.read();this.emitter_.emit("change",{event:new h(this,o,this.controller_.binding.target.presetKey,i.options.last)})}}class it extends Un{constructor(i,o){super(i,o),this.binding=o.binding}}class Us extends s{constructor(i){super(i),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new x,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(i){this.controller_.props.set("label",i)}on(i,o){const u=o.bind(this);return this.emitter_.on(i,m=>{u(m.event)}),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(i){const o=i.sender.target.read();this.emitter_.emit("update",{event:new c(this,o,this.controller_.binding.target.presetKey)})}}class vt extends Un{constructor(i,o){super(i,o),this.binding=o.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function oc(a){return a instanceof In?a.apiSet_:a instanceof Ds?a.rackApi_.apiSet_:null}function Yi(a,i){const o=a.find(u=>u.controller_===i);if(!o)throw v.shouldNeverHappen();return o}function Ao(a,i,o){if(!y.isBindable(a))throw v.notBindable();return new y(a,i,o)}class In extends s{constructor(i,o){super(i),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new x,this.apiSet_=new ks(oc),this.pool_=o;const u=this.controller_.rack;u.emitter.on("add",this.onRackAdd_),u.emitter.on("remove",this.onRackRemove_),u.emitter.on("inputchange",this.onRackInputChange_),u.emitter.on("monitorupdate",this.onRackMonitorUpdate_),u.children.forEach(m=>{this.setUpApi_(m)})}get children(){return this.controller_.rack.children.map(i=>Yi(this.apiSet_,i))}addInput(i,o,u){const m=u||{},C=this.controller_.view.element.ownerDocument,S=this.pool_.createInput(C,Ao(i,o,m.presetKey),m),L=new Ls(S);return this.add(L,m.index)}addMonitor(i,o,u){const m=u||{},C=this.controller_.view.element.ownerDocument,S=this.pool_.createMonitor(C,Ao(i,o),m),L=new Us(S);return this.add(L,m.index)}addFolder(i){return nc(this,i)}addButton(i){return ic(this,i)}addSeparator(i){return sc(this,i)}addTab(i){return rc(this,i)}add(i,o){this.controller_.rack.add(i.controller_,o);const u=this.apiSet_.find(m=>m.controller_===i.controller_);return u&&this.apiSet_.remove(u),this.apiSet_.add(i),i}remove(i){this.controller_.rack.remove(i.controller_)}addBlade(i){const o=this.controller_.view.element.ownerDocument,u=this.pool_.createBlade(o,i),m=this.pool_.createBladeApi(u);return this.add(m,i.index)}on(i,o){const u=o.bind(this);return this.emitter_.on(i,m=>{u(m.event)}),this}setUpApi_(i){this.apiSet_.find(u=>u.controller_===i)||this.apiSet_.add(this.pool_.createBladeApi(i))}onRackAdd_(i){this.setUpApi_(i.bladeController)}onRackRemove_(i){if(i.isRoot){const o=Yi(this.apiSet_,i.bladeController);this.apiSet_.remove(o)}}onRackInputChange_(i){const o=i.bladeController;if(o instanceof it){const u=Yi(this.apiSet_,o),m=o.binding;this.emitter_.emit("change",{event:new h(u,m.target.read(),m.target.presetKey,i.options.last)})}else if(o instanceof ui){const u=Yi(this.apiSet_,o);this.emitter_.emit("change",{event:new h(u,o.value.rawValue,void 0,i.options.last)})}}onRackMonitorUpdate_(i){if(!(i.bladeController instanceof vt))throw v.shouldNeverHappen();const o=Yi(this.apiSet_,i.bladeController),u=i.bladeController.binding;this.emitter_.emit("update",{event:new c(o,u.target.read(),u.target.presetKey)})}}class Is extends Ds{constructor(i,o){super(i,new In(i.rackController,o)),this.emitter_=new x,this.controller_.foldable.value("expanded").emitter.on("change",u=>{this.emitter_.emit("fold",{event:new p(this,u.sender.rawValue)})}),this.rackApi_.on("change",u=>{this.emitter_.emit("change",{event:u})}),this.rackApi_.on("update",u=>{this.emitter_.emit("update",{event:u})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(i){this.controller_.foldable.set("expanded",i)}get title(){return this.controller_.props.get("title")}set title(i){this.controller_.props.set("title",i)}get children(){return this.rackApi_.children}addInput(i,o,u){return this.rackApi_.addInput(i,o,u)}addMonitor(i,o,u){return this.rackApi_.addMonitor(i,o,u)}addFolder(i){return this.rackApi_.addFolder(i)}addButton(i){return this.rackApi_.addButton(i)}addSeparator(i){return this.rackApi_.addSeparator(i)}addTab(i){return this.rackApi_.addTab(i)}add(i,o){return this.rackApi_.add(i,o)}remove(i){this.rackApi_.remove(i)}addBlade(i){return this.rackApi_.addBlade(i)}on(i,o){const u=o.bind(this);return this.emitter_.on(i,m=>{u(m.event)}),this}}class Bs extends Hi{constructor(i){super({blade:i.blade,view:i.view,viewProps:i.rackController.viewProps}),this.rackController=i.rackController}}class ac{constructor(i,o){const u=E(o.viewName);this.element=i.createElement("div"),this.element.classList.add(u()),o.viewProps.bindClassModifiers(this.element)}}function lc(a,i){for(let o=0;o<a.length;o++){const u=a[o];if(u instanceof it&&u.binding===i)return u}return null}function hc(a,i){for(let o=0;o<a.length;o++){const u=a[o];if(u instanceof vt&&u.binding===i)return u}return null}function cc(a,i){for(let o=0;o<a.length;o++){const u=a[o];if(u instanceof ui&&u.value===i)return u}return null}function Ns(a){return a instanceof $i?a.rack:a instanceof Bs?a.rackController.rack:null}function uc(a){const i=Ns(a);return i?i.bcSet_:null}class dc{constructor(i){var o;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new x,this.blade_=i??null,(o=this.blade_)===null||o===void 0||o.value("positions").emitter.on("change",this.onBladePositionsChange_),this.bcSet_=new ks(uc),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(i,o){i.parent&&i.parent.remove(i),i.parent_=this,this.bcSet_.add(i,o)}remove(i){i.parent_=null,this.bcSet_.remove(i)}find(i){return this.bcSet_.allItems().filter(o=>o instanceof i)}onSetAdd_(i){this.updatePositions_();const o=i.target===i.root;if(this.emitter.emit("add",{bladeController:i.item,index:i.index,isRoot:o,sender:this}),!o)return;const u=i.item;if(u.viewProps.emitter.on("change",this.onChildViewPropsChange_),u.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),u.viewProps.handleDispose(this.onChildDispose_),u instanceof it)u.binding.emitter.on("change",this.onChildInputChange_);else if(u instanceof vt)u.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(u instanceof ui)u.value.emitter.on("change",this.onChildValueChange_);else{const m=Ns(u);if(m){const C=m.emitter;C.on("layout",this.onDescendantLayout_),C.on("inputchange",this.onDescendantInputChange_),C.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(i){this.updatePositions_();const o=i.target===i.root;if(this.emitter.emit("remove",{bladeController:i.item,isRoot:o,sender:this}),!o)return;const u=i.item;if(u instanceof it)u.binding.emitter.off("change",this.onChildInputChange_);else if(u instanceof vt)u.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(u instanceof ui)u.value.emitter.off("change",this.onChildValueChange_);else{const m=Ns(u);if(m){const C=m.emitter;C.off("layout",this.onDescendantLayout_),C.off("inputchange",this.onDescendantInputChange_),C.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const i=this.bcSet_.items.filter(m=>!m.viewProps.get("hidden")),o=i[0],u=i[i.length-1];this.bcSet_.items.forEach(m=>{const C=[];m===o&&(C.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&C.push("veryfirst")),m===u&&(C.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&C.push("verylast")),m.blade.set("positions",C)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(i){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(o=>o.viewProps.get("disposed")).forEach(o=>{this.bcSet_.remove(o)})}onChildInputChange_(i){const o=lc(this.find(it),i.sender);if(!o)throw v.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:o,options:i.options,sender:this})}onChildMonitorUpdate_(i){const o=hc(this.find(vt),i.sender);if(!o)throw v.shouldNeverHappen();this.emitter.emit("monitorupdate",{bladeController:o,sender:this})}onChildValueChange_(i){const o=cc(this.find(ui),i.sender);if(!o)throw v.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:o,options:i.options,sender:this})}onDescendantLayout_(i){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(i){this.emitter.emit("inputchange",{bladeController:i.bladeController,options:i.options,sender:this})}onDescendantMonitorUpdate_(i){this.emitter.emit("monitorupdate",{bladeController:i.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class $i extends Hi{constructor(i,o){super(Object.assign(Object.assign({},o),{view:new ac(i,{viewName:"brk",viewProps:o.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const u=new dc(o.root?void 0:o.blade);u.emitter.on("add",this.onRackAdd_),u.emitter.on("remove",this.onRackRemove_),this.rack=u,this.viewProps.handleDispose(()=>{for(let m=this.rack.children.length-1;m>=0;m--)this.rack.children[m].viewProps.set("disposed",!0)})}onRackAdd_(i){i.isRoot&&Eo(this.view.element,i.bladeController.view.element,i.index)}onRackRemove_(i){i.isRoot&&Co(i.bladeController.view.element)}}const Mo=E("cnt");class pc{constructor(i,o){this.className_=E(o.viewName||"fld"),this.element=i.createElement("div"),this.element.classList.add(this.className_(),Mo()),o.viewProps.bindClassModifiers(this.element),this.foldable_=o.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),M(this.foldable_,"completed",D(this.element,this.className_(void 0,"cpl")));const u=i.createElement("button");u.classList.add(this.className_("b")),M(o.props,"title",L=>{f(L)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),o.viewProps.bindDisabled(u),this.element.appendChild(u),this.buttonElement=u;const m=i.createElement("div");m.classList.add(this.className_("t")),k(o.props.value("title"),m),this.buttonElement.appendChild(m),this.titleElement=m;const C=i.createElement("div");C.classList.add(this.className_("m")),this.buttonElement.appendChild(C);const S=o.containerElement;S.classList.add(this.className_("c")),this.element.appendChild(S),this.containerElement=S}}class Fs extends Bs{constructor(i,o){var u;const m=Ki.create((u=o.expanded)!==null&&u!==void 0?u:!0),C=new $i(i,{blade:o.blade,root:o.root,viewProps:o.viewProps});super(Object.assign(Object.assign({},o),{rackController:C,view:new pc(i,{containerElement:C.view.element,foldable:m,props:o.props,viewName:o.root?"rot":void 0,viewProps:o.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=o.props,this.foldable=m,Rs(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const fc={id:"folder",type:"blade",accept(a){const i=W,o=Z(a,{title:i.required.string,view:i.required.constant("folder"),expanded:i.optional.boolean});return o?{params:o}:null},controller(a){return new Fs(a.document,{blade:a.blade,expanded:a.params.expanded,props:U.fromObject({title:a.params.title}),viewProps:a.viewProps})},api(a){return a.controller instanceof Fs?new Is(a.controller,a.pool):null}};class di extends ui{constructor(i,o){const u=o.valueController.viewProps;super(Object.assign(Object.assign({},o),{value:o.valueController.value,view:new Po(i,{props:o.props,viewProps:u}),viewProps:u})),this.props=o.props,this.valueController=o.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class Ro extends s{}const Do=E("spr");class mc{constructor(i,o){this.element=i.createElement("div"),this.element.classList.add(Do()),o.viewProps.bindClassModifiers(this.element);const u=i.createElement("hr");u.classList.add(Do("r")),this.element.appendChild(u)}}class ko extends Hi{constructor(i,o){super(Object.assign(Object.assign({},o),{view:new mc(i,{viewProps:o.viewProps})}))}}const _c={id:"separator",type:"blade",accept(a){const o=Z(a,{view:W.required.constant("separator")});return o?{params:o}:null},controller(a){return new ko(a.document,{blade:a.blade,viewProps:a.viewProps})},api(a){return a.controller instanceof ko?new Ro(a.controller):null}},vc=E("");function Lo(a,i){return D(a,vc(void 0,i))}class gt extends U{constructor(i){super(i)}static create(i){var o,u;const m=i??{},C={disabled:(o=m.disabled)!==null&&o!==void 0?o:!1,disposed:!1,hidden:(u=m.hidden)!==null&&u!==void 0?u:!1},S=U.createCore(C);return new gt(S)}bindClassModifiers(i){M(this,"disabled",Lo(i,"disabled")),M(this,"hidden",Lo(i,"hidden"))}bindDisabled(i){M(this,"disabled",o=>{i.disabled=o})}bindTabIndex(i){M(this,"disabled",o=>{i.tabIndex=o?-1:0})}handleDispose(i){this.value("disposed").emitter.on("change",o=>{o&&i()})}}const qi=E("tbi");class gc{constructor(i,o){this.element=i.createElement("div"),this.element.classList.add(qi()),o.viewProps.bindClassModifiers(this.element),M(o.props,"selected",C=>{C?this.element.classList.add(qi(void 0,"sel")):this.element.classList.remove(qi(void 0,"sel"))});const u=i.createElement("button");u.classList.add(qi("b")),o.viewProps.bindDisabled(u),this.element.appendChild(u),this.buttonElement=u;const m=i.createElement("div");m.classList.add(qi("t")),k(o.props.value("title"),m),this.buttonElement.appendChild(m),this.titleElement=m}}class bc{constructor(i,o){this.emitter=new x,this.onClick_=this.onClick_.bind(this),this.props=o.props,this.viewProps=o.viewProps,this.view=new gc(i,{props:o.props,viewProps:o.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Uo{constructor(i,o){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new bc(i,{props:o.itemProps,viewProps:gt.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new $i(i,{blade:ji(),viewProps:gt.create()}),this.props=o.props,M(this.props,"selected",u=>{this.itemController.props.set("selected",u),this.contentController.viewProps.set("hidden",!u)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class Io{constructor(i,o){this.controller_=i,this.rackApi_=o}get title(){var i;return(i=this.controller_.itemController.props.get("title"))!==null&&i!==void 0?i:""}set title(i){this.controller_.itemController.props.set("title",i)}get selected(){return this.controller_.props.get("selected")}set selected(i){this.controller_.props.set("selected",i)}get children(){return this.rackApi_.children}addButton(i){return this.rackApi_.addButton(i)}addFolder(i){return this.rackApi_.addFolder(i)}addSeparator(i){return this.rackApi_.addSeparator(i)}addTab(i){return this.rackApi_.addTab(i)}add(i,o){this.rackApi_.add(i,o)}remove(i){this.rackApi_.remove(i)}addInput(i,o,u){return this.rackApi_.addInput(i,o,u)}addMonitor(i,o,u){return this.rackApi_.addMonitor(i,o,u)}addBlade(i){return this.rackApi_.addBlade(i)}}class Bo extends Ds{constructor(i,o){super(i,new In(i.rackController,o)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.emitter_=new x,this.pageApiMap_=new Map,this.rackApi_.on("change",u=>{this.emitter_.emit("change",{event:u})}),this.rackApi_.on("update",u=>{this.emitter_.emit("update",{event:u})}),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach(u=>{this.setUpPageApi_(u)})}get pages(){return this.controller_.pageSet.items.map(i=>{const o=this.pageApiMap_.get(i);if(!o)throw v.shouldNeverHappen();return o})}addPage(i){const o=this.controller_.view.element.ownerDocument,u=new Uo(o,{itemProps:U.fromObject({selected:!1,title:i.title}),props:U.fromObject({selected:!1})});this.controller_.add(u,i.index);const m=this.pageApiMap_.get(u);if(!m)throw v.shouldNeverHappen();return m}removePage(i){this.controller_.remove(i)}on(i,o){const u=o.bind(this);return this.emitter_.on(i,m=>{u(m.event)}),this}setUpPageApi_(i){const o=this.rackApi_.apiSet_.find(m=>m.controller_===i.contentController);if(!o)throw v.shouldNeverHappen();const u=new Io(i,o);this.pageApiMap_.set(i,u)}onPageAdd_(i){this.setUpPageApi_(i.item)}onPageRemove_(i){if(!this.pageApiMap_.get(i.item))throw v.shouldNeverHappen();this.pageApiMap_.delete(i.item)}}const Bn=E("tab");class xc{constructor(i,o){this.element=i.createElement("div"),this.element.classList.add(Bn(),Mo()),o.viewProps.bindClassModifiers(this.element),A(o.empty,D(this.element,Bn(void 0,"nop")));const u=i.createElement("div");u.classList.add(Bn("i")),this.element.appendChild(u),this.itemsElement=u;const m=o.contentsElement;m.classList.add(Bn("c")),this.element.appendChild(m),this.contentsElement=m}}class No extends Bs{constructor(i,o){const u=new $i(i,{blade:o.blade,viewProps:o.viewProps}),m=z(!0);super({blade:o.blade,rackController:u,view:new xc(i,{contentsElement:u.view.element,empty:m,viewProps:o.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onPageSelectedChange_=this.onPageSelectedChange_.bind(this),this.pageSet_=new ks(()=>null),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.empty_=m,this.applyPages_()}get pageSet(){return this.pageSet_}add(i,o){this.pageSet_.add(i,o??this.pageSet_.items.length)}remove(i){this.pageSet_.remove(this.pageSet_.items[i])}applyPages_(){this.keepSelection_(),this.empty_.rawValue=this.pageSet_.items.length===0}onPageAdd_(i){const o=i.item;Eo(this.view.itemsElement,o.itemController.view.element,i.index),this.rackController.rack.add(o.contentController,i.index),o.props.value("selected").emitter.on("change",this.onPageSelectedChange_),this.applyPages_()}onPageRemove_(i){const o=i.item;Co(o.itemController.view.element),this.rackController.rack.remove(o.contentController),o.props.value("selected").emitter.off("change",this.onPageSelectedChange_),this.applyPages_()}keepSelection_(){if(this.pageSet_.items.length===0)return;const i=this.pageSet_.items.findIndex(o=>o.props.get("selected"));i<0?this.pageSet_.items.forEach((o,u)=>{o.props.set("selected",u===0)}):this.pageSet_.items.forEach((o,u)=>{o.props.set("selected",u===i)})}onPageSelectedChange_(i){if(i.rawValue){const o=this.pageSet_.items.findIndex(u=>u.props.value("selected")===i.sender);this.pageSet_.items.forEach((u,m)=>{u.props.set("selected",m===o)})}else this.keepSelection_()}}const Fo={id:"tab",type:"blade",accept(a){const i=W,o=Z(a,{pages:i.required.array(i.required.object({title:i.required.string})),view:i.required.constant("tab")});return!o||o.pages.length===0?null:{params:o}},controller(a){const i=new No(a.document,{blade:a.blade,viewProps:a.viewProps});return a.params.pages.forEach(o=>{const u=new Uo(a.document,{itemProps:U.fromObject({selected:!1,title:o.title}),props:U.fromObject({selected:!1})});i.add(u)}),i},api(a){return a.controller instanceof No?new Bo(a.controller,a.pool):null}};function yc(a,i){const o=a.accept(i.params);if(!o)return null;const u=W.optional.boolean(i.params.disabled).value,m=W.optional.boolean(i.params.hidden).value;return a.controller({blade:ji(),document:i.document,params:Object.assign(Object.assign({},o.params),{disabled:u,hidden:m}),viewProps:gt.create({disabled:u,hidden:m})})}class wc{constructor(){this.disabled=!1,this.emitter=new x}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class Ec{constructor(i,o){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=i,this.emitter=new x,this.interval_=o,this.setTimer_()}get disabled(){return this.disabled_}set disabled(i){this.disabled_=i,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const i=this.doc_.defaultView;i&&i.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const i=this.doc_.defaultView;i&&(this.timerId_=i.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class zt{constructor(i){this.constraints=i}constrain(i){return this.constraints.reduce((o,u)=>u.constrain(o),i)}}function nt(a,i){if(a instanceof i)return a;if(a instanceof zt){const o=a.constraints.reduce((u,m)=>u||(m instanceof i?m:null),null);if(o)return o}return null}class Wi{constructor(i){this.options=i}constrain(i){const o=this.options;return o.length===0||o.filter(m=>m.value===i).length>0?i:o[0].value}}class Ie{constructor(i){this.maxValue=i.max,this.minValue=i.min}constrain(i){let o=i;return f(this.minValue)||(o=Math.max(o,this.minValue)),f(this.maxValue)||(o=Math.min(o,this.maxValue)),o}}class Ht{constructor(i){this.step=i}constrain(i){return(i<0?-Math.round(-i/this.step):Math.round(i/this.step))*this.step}}const Vs=E("lst");class Cc{constructor(i,o){this.onValueChange_=this.onValueChange_.bind(this),this.props_=o.props,this.element=i.createElement("div"),this.element.classList.add(Vs()),o.viewProps.bindClassModifiers(this.element);const u=i.createElement("select");u.classList.add(Vs("s")),M(this.props_,"options",C=>{To(u),C.forEach((S,L)=>{const N=i.createElement("option");N.dataset.index=String(L),N.textContent=S.text,N.value=String(S.value),u.appendChild(N)})}),o.viewProps.bindDisabled(u),this.element.appendChild(u),this.selectElement=u;const m=i.createElement("div");m.classList.add(Vs("m")),m.appendChild(Ln(i,"dropdown")),this.element.appendChild(m),o.value.emitter.on("change",this.onValueChange_),this.value_=o.value,this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class Zi{constructor(i,o){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=o.props,this.value=o.value,this.viewProps=o.viewProps,this.view=new Cc(i,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(i){const u=i.currentTarget.selectedOptions.item(0);if(!u)return;const m=Number(u.dataset.index);this.value.rawValue=this.props.get("options")[m].value}}const Vo=E("pop");class Tc{constructor(i,o){this.element=i.createElement("div"),this.element.classList.add(Vo()),o.viewProps.bindClassModifiers(this.element),A(o.shows,D(this.element,Vo(void 0,"v")))}}class zo{constructor(i,o){this.shows=z(!1),this.viewProps=o.viewProps,this.view=new Tc(i,{shows:this.shows,viewProps:this.viewProps})}}const Ho=E("txt");class Sc{constructor(i,o){this.onChange_=this.onChange_.bind(this),this.element=i.createElement("div"),this.element.classList.add(Ho()),o.viewProps.bindClassModifiers(this.element),this.props_=o.props,this.props_.emitter.on("change",this.onChange_);const u=i.createElement("input");u.classList.add(Ho("i")),u.type="text",o.viewProps.bindDisabled(u),this.element.appendChild(u),this.inputElement=u,o.value.emitter.on("change",this.onChange_),this.value_=o.value,this.refresh()}refresh(){const i=this.props_.get("formatter");this.inputElement.value=i(this.value_.rawValue)}onChange_(){this.refresh()}}class Nn{constructor(i,o){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=o.parser,this.props=o.props,this.value=o.value,this.viewProps=o.viewProps,this.view=new Sc(i,{props:o.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(i){const u=i.currentTarget.value,m=this.parser_(u);f(m)||(this.value.rawValue=m),this.view.refresh()}}function Pc(a){return String(a)}function Go(a){return a==="false"?!1:!!a}function jo(a){return Pc(a)}class Oc{constructor(i){this.text=i}evaluate(){return Number(this.text)}toString(){return this.text}}const Ac={"**":(a,i)=>Math.pow(a,i),"*":(a,i)=>a*i,"/":(a,i)=>a/i,"%":(a,i)=>a%i,"+":(a,i)=>a+i,"-":(a,i)=>a-i,"<<":(a,i)=>a<<i,">>":(a,i)=>a>>i,">>>":(a,i)=>a>>>i,"&":(a,i)=>a&i,"^":(a,i)=>a^i,"|":(a,i)=>a|i};class Mc{constructor(i,o,u){this.left=o,this.operator=i,this.right=u}evaluate(){const i=Ac[this.operator];if(!i)throw new Error(`unexpected binary operator: '${this.operator}`);return i(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const Rc={"+":a=>a,"-":a=>-a,"~":a=>~a};class Dc{constructor(i,o){this.operator=i,this.expression=o}evaluate(){const i=Rc[this.operator];if(!i)throw new Error(`unexpected unary operator: '${this.operator}`);return i(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function zs(a){return(i,o)=>{for(let u=0;u<a.length;u++){const m=a[u](i,o);if(m!=="")return m}return""}}function Xi(a,i){var o;const u=a.substr(i).match(/^\s+/);return(o=u&&u[0])!==null&&o!==void 0?o:""}function kc(a,i){const o=a.substr(i,1);return o.match(/^[1-9]$/)?o:""}function Qi(a,i){var o;const u=a.substr(i).match(/^[0-9]+/);return(o=u&&u[0])!==null&&o!==void 0?o:""}function Lc(a,i){const o=Qi(a,i);if(o!=="")return o;const u=a.substr(i,1);if(i+=1,u!=="-"&&u!=="+")return"";const m=Qi(a,i);return m===""?"":u+m}function Hs(a,i){const o=a.substr(i,1);if(i+=1,o.toLowerCase()!=="e")return"";const u=Lc(a,i);return u===""?"":o+u}function Ko(a,i){const o=a.substr(i,1);if(o==="0")return o;const u=kc(a,i);return i+=u.length,u===""?"":u+Qi(a,i)}function Uc(a,i){const o=Ko(a,i);if(i+=o.length,o==="")return"";const u=a.substr(i,1);if(i+=u.length,u!==".")return"";const m=Qi(a,i);return i+=m.length,o+u+m+Hs(a,i)}function Ic(a,i){const o=a.substr(i,1);if(i+=o.length,o!==".")return"";const u=Qi(a,i);return i+=u.length,u===""?"":o+u+Hs(a,i)}function Bc(a,i){const o=Ko(a,i);return i+=o.length,o===""?"":o+Hs(a,i)}const Nc=zs([Uc,Ic,Bc]);function Fc(a,i){var o;const u=a.substr(i).match(/^[01]+/);return(o=u&&u[0])!==null&&o!==void 0?o:""}function Vc(a,i){const o=a.substr(i,2);if(i+=o.length,o.toLowerCase()!=="0b")return"";const u=Fc(a,i);return u===""?"":o+u}function zc(a,i){var o;const u=a.substr(i).match(/^[0-7]+/);return(o=u&&u[0])!==null&&o!==void 0?o:""}function Hc(a,i){const o=a.substr(i,2);if(i+=o.length,o.toLowerCase()!=="0o")return"";const u=zc(a,i);return u===""?"":o+u}function Gc(a,i){var o;const u=a.substr(i).match(/^[0-9a-f]+/i);return(o=u&&u[0])!==null&&o!==void 0?o:""}function jc(a,i){const o=a.substr(i,2);if(i+=o.length,o.toLowerCase()!=="0x")return"";const u=Gc(a,i);return u===""?"":o+u}const Kc=zs([Vc,Hc,jc]),Yc=zs([Kc,Nc]);function $c(a,i){const o=Yc(a,i);return i+=o.length,o===""?null:{evaluable:new Oc(o),cursor:i}}function qc(a,i){const o=a.substr(i,1);if(i+=o.length,o!=="(")return null;const u=$o(a,i);if(!u)return null;i=u.cursor,i+=Xi(a,i).length;const m=a.substr(i,1);return i+=m.length,m!==")"?null:{evaluable:u.evaluable,cursor:i}}function Wc(a,i){return $c(a,i)||qc(a,i)}function Yo(a,i){const o=Wc(a,i);if(o)return o;const u=a.substr(i,1);if(i+=u.length,u!=="+"&&u!=="-"&&u!=="~")return null;const m=Yo(a,i);return m?(i=m.cursor,{cursor:i,evaluable:new Dc(u,m.evaluable)}):null}function Zc(a,i,o){o+=Xi(i,o).length;const u=a.filter(m=>i.startsWith(m,o))[0];return u?(o+=u.length,o+=Xi(i,o).length,{cursor:o,operator:u}):null}function Xc(a,i){return(o,u)=>{const m=a(o,u);if(!m)return null;u=m.cursor;let C=m.evaluable;for(;;){const S=Zc(i,o,u);if(!S)break;u=S.cursor;const L=a(o,u);if(!L)return null;u=L.cursor,C=new Mc(S.operator,C,L.evaluable)}return C?{cursor:u,evaluable:C}:null}}const Qc=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((a,i)=>Xc(a,i),Yo);function $o(a,i){return i+=Xi(a,i).length,Qc(a,i)}function Jc(a){const i=$o(a,0);return!i||i.cursor+Xi(a,i.cursor).length!==a.length?null:i.evaluable}function ct(a){var i;const o=Jc(a);return(i=o?.evaluate())!==null&&i!==void 0?i:null}function qo(a){if(typeof a=="number")return a;if(typeof a=="string"){const i=ct(a);if(!f(i))return i}return 0}function eu(a){return String(a)}function Pe(a){return i=>i.toFixed(Math.max(Math.min(a,20),0))}const tu=Pe(0);function Fn(a){return tu(a)+"%"}function Wo(a){return String(a)}function Gs(a){return a}function Zo(a,i){for(;a.length<i;)a.push(void 0)}function iu(a){const i=[];return Zo(i,a),z(i)}function nu(a){const i=a.indexOf(void 0);return i<0?a:a.slice(0,i)}function su(a,i){const o=[...nu(a),i];return o.length>a.length?o.splice(0,o.length-a.length):Zo(o,a.length),o}function Ji({primary:a,secondary:i,forward:o,backward:u}){let m=!1;function C(S){m||(m=!0,S(),m=!1)}a.emitter.on("change",S=>{C(()=>{i.setRawValue(o(a,i),S.options)})}),i.emitter.on("change",S=>{C(()=>{a.setRawValue(u(a,i),S.options)}),C(()=>{i.setRawValue(o(a,i),S.options)})}),C(()=>{i.setRawValue(o(a,i),{forceEmit:!1,last:!0})})}function Oe(a,i){const o=a*(i.altKey?.1:1)*(i.shiftKey?10:1);return i.upKey?+o:i.downKey?-o:0}function en(a){return{altKey:a.altKey,downKey:a.key==="ArrowDown",shiftKey:a.shiftKey,upKey:a.key==="ArrowUp"}}function ut(a){return{altKey:a.altKey,downKey:a.key==="ArrowLeft",shiftKey:a.shiftKey,upKey:a.key==="ArrowRight"}}function ru(a){return a==="ArrowUp"||a==="ArrowDown"}function Xo(a){return ru(a)||a==="ArrowLeft"||a==="ArrowRight"}function js(a,i){const o=i.ownerDocument.defaultView,u=i.getBoundingClientRect();return{x:a.pageX-((o&&o.scrollX||0)+u.left),y:a.pageY-((o&&o.scrollY||0)+u.top)}}class Gt{constructor(i){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=i,this.emitter=new x,i.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),i.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),i.addEventListener("touchend",this.onTouchEnd_),i.addEventListener("mousedown",this.onMouseDown_)}computePosition_(i){const o=this.elem_.getBoundingClientRect();return{bounds:{width:o.width,height:o.height},point:i?{x:i.x,y:i.y}:null}}onMouseDown_(i){var o;i.preventDefault(),(o=i.currentTarget)===null||o===void 0||o.focus();const u=this.elem_.ownerDocument;u.addEventListener("mousemove",this.onDocumentMouseMove_),u.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:i.altKey,data:this.computePosition_(js(i,this.elem_)),sender:this,shiftKey:i.shiftKey})}onDocumentMouseMove_(i){this.emitter.emit("move",{altKey:i.altKey,data:this.computePosition_(js(i,this.elem_)),sender:this,shiftKey:i.shiftKey})}onDocumentMouseUp_(i){const o=this.elem_.ownerDocument;o.removeEventListener("mousemove",this.onDocumentMouseMove_),o.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:i.altKey,data:this.computePosition_(js(i,this.elem_)),sender:this,shiftKey:i.shiftKey})}onTouchStart_(i){i.preventDefault();const o=i.targetTouches.item(0),u=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:i.altKey,data:this.computePosition_(o?{x:o.clientX-u.left,y:o.clientY-u.top}:void 0),sender:this,shiftKey:i.shiftKey}),this.lastTouch_=o}onTouchMove_(i){const o=i.targetTouches.item(0),u=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:i.altKey,data:this.computePosition_(o?{x:o.clientX-u.left,y:o.clientY-u.top}:void 0),sender:this,shiftKey:i.shiftKey}),this.lastTouch_=o}onTouchEnd_(i){var o;const u=(o=i.targetTouches.item(0))!==null&&o!==void 0?o:this.lastTouch_,m=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:i.altKey,data:this.computePosition_(u?{x:u.clientX-m.left,y:u.clientY-m.top}:void 0),sender:this,shiftKey:i.shiftKey})}}function le(a,i,o,u,m){const C=(a-i)/(o-i);return u+C*(m-u)}function Qo(a){return String(a.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function ae(a,i,o){return Math.min(Math.max(a,i),o)}function Ks(a,i){return(a%i+i)%i}const Ge=E("txt");class ou{constructor(i,o){this.onChange_=this.onChange_.bind(this),this.props_=o.props,this.props_.emitter.on("change",this.onChange_),this.element=i.createElement("div"),this.element.classList.add(Ge(),Ge(void 0,"num")),o.arrayPosition&&this.element.classList.add(Ge(void 0,o.arrayPosition)),o.viewProps.bindClassModifiers(this.element);const u=i.createElement("input");u.classList.add(Ge("i")),u.type="text",o.viewProps.bindDisabled(u),this.element.appendChild(u),this.inputElement=u,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=o.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Ge()),this.inputElement.classList.add(Ge("i"));const m=i.createElement("div");m.classList.add(Ge("k")),this.element.appendChild(m),this.knobElement=m;const C=i.createElementNS(tt,"svg");C.classList.add(Ge("g")),this.knobElement.appendChild(C);const S=i.createElementNS(tt,"path");S.classList.add(Ge("gb")),C.appendChild(S),this.guideBodyElem_=S;const L=i.createElementNS(tt,"path");L.classList.add(Ge("gh")),C.appendChild(L),this.guideHeadElem_=L;const N=i.createElement("div");N.classList.add(E("tt")()),this.knobElement.appendChild(N),this.tooltipElem_=N,o.value.emitter.on("change",this.onChange_),this.value=o.value,this.refresh()}onDraggingChange_(i){if(i.rawValue===null){this.element.classList.remove(Ge(void 0,"drg"));return}this.element.classList.add(Ge(void 0,"drg"));const o=i.rawValue/this.props_.get("draggingScale"),u=o+(o>0?-1:o<0?1:0),m=ae(-u,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${u+m},0 L${u},4 L${u+m},8`,`M ${o},-1 L${o},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${o},4`);const C=this.props_.get("formatter");this.tooltipElem_.textContent=C(this.value.rawValue),this.tooltipElem_.style.left=`${o}px`}refresh(){const i=this.props_.get("formatter");this.inputElement.value=i(this.value.rawValue)}onChange_(){this.refresh()}}class tn{constructor(i,o){this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=o.baseStep,this.parser_=o.parser,this.props=o.props,this.value=o.value,this.viewProps=o.viewProps,this.dragging_=z(null),this.view=new ou(i,{arrayPosition:o.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const u=new Gt(this.view.knobElement);u.emitter.on("down",this.onPointerDown_),u.emitter.on("move",this.onPointerMove_),u.emitter.on("up",this.onPointerUp_)}onInputChange_(i){const u=i.currentTarget.value,m=this.parser_(u);f(m)||(this.value.rawValue=m),this.view.refresh()}onInputKeyDown_(i){const o=Oe(this.baseStep_,en(i));o!==0&&this.value.setRawValue(this.value.rawValue+o,{forceEmit:!1,last:!1})}onInputKeyUp_(i){Oe(this.baseStep_,en(i))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(i){if(!i.point)return null;const o=i.point.x-i.bounds.width/2;return this.originRawValue_+o*this.props.get("draggingScale")}onPointerMove_(i){const o=this.computeDraggingValue_(i.data);o!==null&&(this.value.setRawValue(o,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(i){const o=this.computeDraggingValue_(i.data);o!==null&&(this.value.setRawValue(o,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const Ys=E("sld");class au{constructor(i,o){this.onChange_=this.onChange_.bind(this),this.props_=o.props,this.props_.emitter.on("change",this.onChange_),this.element=i.createElement("div"),this.element.classList.add(Ys()),o.viewProps.bindClassModifiers(this.element);const u=i.createElement("div");u.classList.add(Ys("t")),o.viewProps.bindTabIndex(u),this.element.appendChild(u),this.trackElement=u;const m=i.createElement("div");m.classList.add(Ys("k")),this.trackElement.appendChild(m),this.knobElement=m,o.value.emitter.on("change",this.onChange_),this.value=o.value,this.update_()}update_(){const i=ae(le(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${i}%`}onChange_(){this.update_()}}class lu{constructor(i,o){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=o.baseStep,this.value=o.value,this.viewProps=o.viewProps,this.props=o.props,this.view=new au(i,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Gt(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(i,o){i.point&&this.value.setRawValue(le(ae(i.point.x,0,i.bounds.width),0,i.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),o)}onPointerDownOrMove_(i){this.handlePointerEvent_(i.data,{forceEmit:!1,last:!1})}onPointerUp_(i){this.handlePointerEvent_(i.data,{forceEmit:!0,last:!0})}onKeyDown_(i){const o=Oe(this.baseStep_,ut(i));o!==0&&this.value.setRawValue(this.value.rawValue+o,{forceEmit:!1,last:!1})}onKeyUp_(i){Oe(this.baseStep_,ut(i))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const $s=E("sldtxt");class hu{constructor(i,o){this.element=i.createElement("div"),this.element.classList.add($s());const u=i.createElement("div");u.classList.add($s("s")),this.sliderView_=o.sliderView,u.appendChild(this.sliderView_.element),this.element.appendChild(u);const m=i.createElement("div");m.classList.add($s("t")),this.textView_=o.textView,m.appendChild(this.textView_.element),this.element.appendChild(m)}}class qs{constructor(i,o){this.value=o.value,this.viewProps=o.viewProps,this.sliderC_=new lu(i,{baseStep:o.baseStep,props:o.sliderProps,value:o.value,viewProps:this.viewProps}),this.textC_=new tn(i,{baseStep:o.baseStep,parser:o.parser,props:o.textProps,value:o.value,viewProps:o.viewProps}),this.view=new hu(i,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function nn(a,i){a.write(i)}function Vn(a){const i=W;if(Array.isArray(a))return i.required.array(i.required.object({text:i.required.string,value:i.required.raw}))(a).value;if(typeof a=="object")return i.required.raw(a).value}function Jo(a){if(a==="inline"||a==="popup")return a}function bt(a){const i=W;return i.required.object({max:i.optional.number,min:i.optional.number,step:i.optional.number})(a).value}function ea(a){if(Array.isArray(a))return a;const i=[];return Object.keys(a).forEach(o=>{i.push({text:o,value:a[o]})}),i}function Ws(a){return f(a)?null:new Wi(ea(a))}function Zs(a){const i=a?nt(a,Wi):null;return i?i.options:null}function cu(a){const i=a?nt(a,Ht):null;return i?i.step:null}function zn(a,i){const o=a&&nt(a,Ht);return o?Qo(o.step):Math.max(Qo(i),2)}function pi(a){const i=cu(a);return i??1}function fi(a,i){var o;const u=a&&nt(a,Ht),m=Math.abs((o=u?.step)!==null&&o!==void 0?o:i);return m===0?.1:Math.pow(10,Math.floor(Math.log10(m))-1)}const Hn=E("ckb");class uu{constructor(i,o){this.onValueChange_=this.onValueChange_.bind(this),this.element=i.createElement("div"),this.element.classList.add(Hn()),o.viewProps.bindClassModifiers(this.element);const u=i.createElement("label");u.classList.add(Hn("l")),this.element.appendChild(u);const m=i.createElement("input");m.classList.add(Hn("i")),m.type="checkbox",u.appendChild(m),this.inputElement=m,o.viewProps.bindDisabled(this.inputElement);const C=i.createElement("div");C.classList.add(Hn("w")),u.appendChild(C);const S=Ln(i,"check");C.appendChild(S),o.value.emitter.on("change",this.onValueChange_),this.value=o.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class du{constructor(i,o){this.onInputChange_=this.onInputChange_.bind(this),this.value=o.value,this.viewProps=o.viewProps,this.view=new uu(i,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(i){const o=i.currentTarget;this.value.rawValue=o.checked}}function pu(a){const i=[],o=Ws(a.options);return o&&i.push(o),new zt(i)}const fu={id:"input-bool",type:"input",accept:(a,i)=>{if(typeof a!="boolean")return null;const u=Z(i,{options:W.optional.custom(Vn)});return u?{initialValue:a,params:u}:null},binding:{reader:a=>Go,constraint:a=>pu(a.params),writer:a=>nn},controller:a=>{var i;const o=a.document,u=a.value,m=a.constraint;return m&&nt(m,Wi)?new Zi(o,{props:U.fromObject({options:(i=Zs(m))!==null&&i!==void 0?i:[]}),value:u,viewProps:a.viewProps}):new du(o,{value:u,viewProps:a.viewProps})}},jt=E("col");class mu{constructor(i,o){this.element=i.createElement("div"),this.element.classList.add(jt()),o.foldable.bindExpandedClass(this.element,jt(void 0,"expanded")),M(o.foldable,"completed",D(this.element,jt(void 0,"cpl")));const u=i.createElement("div");u.classList.add(jt("h")),this.element.appendChild(u);const m=i.createElement("div");m.classList.add(jt("s")),u.appendChild(m),this.swatchElement=m;const C=i.createElement("div");if(C.classList.add(jt("t")),u.appendChild(C),this.textElement=C,o.pickerLayout==="inline"){const S=i.createElement("div");S.classList.add(jt("p")),this.element.appendChild(S),this.pickerElement=S}else this.pickerElement=null}}function _u(a,i,o){const u=ae(a/255,0,1),m=ae(i/255,0,1),C=ae(o/255,0,1),S=Math.max(u,m,C),L=Math.min(u,m,C),N=S-L;let V=0,X=0;const te=(L+S)/2;return N!==0&&(X=N/(1-Math.abs(S+L-1)),u===S?V=(m-C)/N:m===S?V=2+(C-u)/N:V=4+(u-m)/N,V=V/6+(V<0?1:0)),[V*360,X*100,te*100]}function vu(a,i,o){const u=(a%360+360)%360,m=ae(i/100,0,1),C=ae(o/100,0,1),S=(1-Math.abs(2*C-1))*m,L=S*(1-Math.abs(u/60%2-1)),N=C-S/2;let V,X,te;return u>=0&&u<60?[V,X,te]=[S,L,0]:u>=60&&u<120?[V,X,te]=[L,S,0]:u>=120&&u<180?[V,X,te]=[0,S,L]:u>=180&&u<240?[V,X,te]=[0,L,S]:u>=240&&u<300?[V,X,te]=[L,0,S]:[V,X,te]=[S,0,L],[(V+N)*255,(X+N)*255,(te+N)*255]}function gu(a,i,o){const u=ae(a/255,0,1),m=ae(i/255,0,1),C=ae(o/255,0,1),S=Math.max(u,m,C),L=Math.min(u,m,C),N=S-L;let V;N===0?V=0:S===u?V=60*(((m-C)/N%6+6)%6):S===m?V=60*((C-u)/N+2):V=60*((u-m)/N+4);const X=S===0?0:N/S,te=S;return[V,X*100,te*100]}function ta(a,i,o){const u=Ks(a,360),m=ae(i/100,0,1),C=ae(o/100,0,1),S=C*m,L=S*(1-Math.abs(u/60%2-1)),N=C-S;let V,X,te;return u>=0&&u<60?[V,X,te]=[S,L,0]:u>=60&&u<120?[V,X,te]=[L,S,0]:u>=120&&u<180?[V,X,te]=[0,S,L]:u>=180&&u<240?[V,X,te]=[0,L,S]:u>=240&&u<300?[V,X,te]=[L,0,S]:[V,X,te]=[S,0,L],[(V+N)*255,(X+N)*255,(te+N)*255]}function bu(a,i,o){const u=o+i*(100-Math.abs(2*o-100))/200;return[a,u!==0?i*(100-Math.abs(2*o-100))/u:0,o+i*(100-Math.abs(2*o-100))/200]}function xu(a,i,o){const u=100-Math.abs(o*(200-i)/100-100);return[a,u!==0?i*o/u:0,o*(200-i)/200]}function mi(a){return[a[0],a[1],a[2]]}function ia(a,i){return[a[0],a[1],a[2],i]}const yu={hsl:{hsl:(a,i,o)=>[a,i,o],hsv:bu,rgb:vu},hsv:{hsl:xu,hsv:(a,i,o)=>[a,i,o],rgb:ta},rgb:{hsl:_u,hsv:gu,rgb:(a,i,o)=>[a,i,o]}};function wu(a,i,o){return yu[i][o](...a)}const Eu={hsl:a=>{var i;return[Ks(a[0],360),ae(a[1],0,100),ae(a[2],0,100),ae((i=a[3])!==null&&i!==void 0?i:1,0,1)]},hsv:a=>{var i;return[Ks(a[0],360),ae(a[1],0,100),ae(a[2],0,100),ae((i=a[3])!==null&&i!==void 0?i:1,0,1)]},rgb:a=>{var i;return[ae(a[0],0,255),ae(a[1],0,255),ae(a[2],0,255),ae((i=a[3])!==null&&i!==void 0?i:1,0,1)]}};function Gn(a,i){return typeof a!="object"||f(a)?!1:i in a&&typeof a[i]=="number"}class Y{constructor(i,o){this.mode_=o,this.comps_=Eu[o](i)}static black(){return new Y([0,0,0],"rgb")}static fromObject(i){const o="a"in i?[i.r,i.g,i.b,i.a]:[i.r,i.g,i.b];return new Y(o,"rgb")}static toRgbaObject(i){return i.toRgbaObject()}static isRgbColorObject(i){return Gn(i,"r")&&Gn(i,"g")&&Gn(i,"b")}static isRgbaColorObject(i){return this.isRgbColorObject(i)&&Gn(i,"a")}static isColorObject(i){return this.isRgbColorObject(i)}static equals(i,o){if(i.mode_!==o.mode_)return!1;const u=i.comps_,m=o.comps_;for(let C=0;C<u.length;C++)if(u[C]!==m[C])return!1;return!0}get mode(){return this.mode_}getComponents(i){return ia(wu(mi(this.comps_),this.mode_,i||this.mode_),this.comps_[3])}toRgbaObject(){const i=this.getComponents("rgb");return{r:i[0],g:i[1],b:i[2],a:i[3]}}}const xt=E("colp");class Cu{constructor(i,o){this.alphaViews_=null,this.element=i.createElement("div"),this.element.classList.add(xt());const u=i.createElement("div");u.classList.add(xt("hsv"));const m=i.createElement("div");m.classList.add(xt("sv")),this.svPaletteView_=o.svPaletteView,m.appendChild(this.svPaletteView_.element),u.appendChild(m);const C=i.createElement("div");C.classList.add(xt("h")),this.hPaletteView_=o.hPaletteView,C.appendChild(this.hPaletteView_.element),u.appendChild(C),this.element.appendChild(u);const S=i.createElement("div");if(S.classList.add(xt("rgb")),this.textView_=o.textView,S.appendChild(this.textView_.element),this.element.appendChild(S),o.alphaViews){this.alphaViews_={palette:o.alphaViews.palette,text:o.alphaViews.text};const L=i.createElement("div");L.classList.add(xt("a"));const N=i.createElement("div");N.classList.add(xt("ap")),N.appendChild(this.alphaViews_.palette.element),L.appendChild(N);const V=i.createElement("div");V.classList.add(xt("at")),V.appendChild(this.alphaViews_.text.element),L.appendChild(V),this.element.appendChild(L)}}get allFocusableElements(){const i=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(o=>o.inputElement)];return this.alphaViews_&&i.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),i}}function Xs(a){const i=W;return Z(a,{alpha:i.optional.boolean,expanded:i.optional.boolean,picker:i.optional.custom(Jo)})}function Kt(a){return a?.1:1}function je(a,i){const o=a.match(/^(.+)%$/);return Math.min(o?parseFloat(o[1])*.01*i:parseFloat(a),i)}const Tu={deg:a=>a,grad:a=>a*360/400,rad:a=>a*360/(2*Math.PI),turn:a=>a*360};function na(a){const i=a.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!i)return parseFloat(a);const o=parseFloat(i[1]),u=i[2];return Tu[u](o)}const Qs={"func.rgb":a=>{const i=a.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!i)return null;const o=[je(i[1],255),je(i[2],255),je(i[3],255)];return isNaN(o[0])||isNaN(o[1])||isNaN(o[2])?null:new Y(o,"rgb")},"func.rgba":a=>{const i=a.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!i)return null;const o=[je(i[1],255),je(i[2],255),je(i[3],255),je(i[4],1)];return isNaN(o[0])||isNaN(o[1])||isNaN(o[2])||isNaN(o[3])?null:new Y(o,"rgb")},"func.hsl":a=>{const i=a.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!i)return null;const o=[na(i[1]),je(i[2],100),je(i[3],100)];return isNaN(o[0])||isNaN(o[1])||isNaN(o[2])?null:new Y(o,"hsl")},"func.hsla":a=>{const i=a.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!i)return null;const o=[na(i[1]),je(i[2],100),je(i[3],100),je(i[4],1)];return isNaN(o[0])||isNaN(o[1])||isNaN(o[2])||isNaN(o[3])?null:new Y(o,"hsl")},"hex.rgb":a=>{const i=a.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(i)return new Y([parseInt(i[1]+i[1],16),parseInt(i[2]+i[2],16),parseInt(i[3]+i[3],16)],"rgb");const o=a.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return o?new Y([parseInt(o[1],16),parseInt(o[2],16),parseInt(o[3],16)],"rgb"):null},"hex.rgba":a=>{const i=a.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(i)return new Y([parseInt(i[1]+i[1],16),parseInt(i[2]+i[2],16),parseInt(i[3]+i[3],16),le(parseInt(i[4]+i[4],16),0,255,0,1)],"rgb");const o=a.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return o?new Y([parseInt(o[1],16),parseInt(o[2],16),parseInt(o[3],16),le(parseInt(o[4],16),0,255,0,1)],"rgb"):null}};function jn(a){return Object.keys(Qs).reduce((o,u)=>{if(o)return o;const m=Qs[u];return m(a)?u:null},null)}const Kn=a=>{const i=jn(a);return i?Qs[i](a):null};function Su(a){return a==="func.hsla"||a==="func.rgba"||a==="hex.rgba"}function Pu(a){if(typeof a=="string"){const i=Kn(a);if(i)return i}return Y.black()}function sa(a){const i=ae(Math.floor(a),0,255).toString(16);return i.length===1?`0${i}`:i}function Js(a,i="#"){const o=mi(a.getComponents("rgb")).map(sa).join("");return`${i}${o}`}function Yn(a,i="#"){const o=a.getComponents("rgb"),u=[o[0],o[1],o[2],o[3]*255].map(sa).join("");return`${i}${u}`}function ra(a){const i=Pe(0);return`rgb(${mi(a.getComponents("rgb")).map(u=>i(u)).join(", ")})`}function $n(a){const i=Pe(2),o=Pe(0);return`rgba(${a.getComponents("rgb").map((m,C)=>(C===3?i:o)(m)).join(", ")})`}function Ou(a){const i=[Pe(0),Fn,Fn];return`hsl(${mi(a.getComponents("hsl")).map((u,m)=>i[m](u)).join(", ")})`}function Au(a){const i=[Pe(0),Fn,Fn,Pe(2)];return`hsla(${a.getComponents("hsl").map((u,m)=>i[m](u)).join(", ")})`}const Mu={"func.hsl":Ou,"func.hsla":Au,"func.rgb":ra,"func.rgba":$n,"hex.rgb":Js,"hex.rgba":Yn};function oa(a){return Mu[a]}const sn=E("apl");class Ru{constructor(i,o){this.onValueChange_=this.onValueChange_.bind(this),this.value=o.value,this.value.emitter.on("change",this.onValueChange_),this.element=i.createElement("div"),this.element.classList.add(sn()),o.viewProps.bindTabIndex(this.element);const u=i.createElement("div");u.classList.add(sn("b")),this.element.appendChild(u);const m=i.createElement("div");m.classList.add(sn("c")),u.appendChild(m),this.colorElem_=m;const C=i.createElement("div");C.classList.add(sn("m")),this.element.appendChild(C),this.markerElem_=C;const S=i.createElement("div");S.classList.add(sn("p")),this.markerElem_.appendChild(S),this.previewElem_=S,this.update_()}update_(){const i=this.value.rawValue,o=i.getComponents("rgb"),u=new Y([o[0],o[1],o[2],0],"rgb"),m=new Y([o[0],o[1],o[2],255],"rgb"),C=["to right",$n(u),$n(m)];this.colorElem_.style.background=`linear-gradient(${C.join(",")})`,this.previewElem_.style.backgroundColor=$n(i);const S=le(o[3],0,1,0,100);this.markerElem_.style.left=`${S}%`}onValueChange_(){this.update_()}}class Du{constructor(i,o){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=o.value,this.viewProps=o.viewProps,this.view=new Ru(i,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Gt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(i,o){if(!i.point)return;const u=i.point.x/i.bounds.width,m=this.value.rawValue,[C,S,L]=m.getComponents("hsv");this.value.setRawValue(new Y([C,S,L,u],"hsv"),o)}onPointerDown_(i){this.handlePointerEvent_(i.data,{forceEmit:!1,last:!1})}onPointerMove_(i){this.handlePointerEvent_(i.data,{forceEmit:!1,last:!1})}onPointerUp_(i){this.handlePointerEvent_(i.data,{forceEmit:!0,last:!0})}onKeyDown_(i){const o=Oe(Kt(!0),ut(i));if(o===0)return;const u=this.value.rawValue,[m,C,S,L]=u.getComponents("hsv");this.value.setRawValue(new Y([m,C,S,L+o],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(i){Oe(Kt(!0),ut(i))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const _i=E("coltxt");function ku(a){const i=a.createElement("select"),o=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}];return i.appendChild(o.reduce((u,m)=>{const C=a.createElement("option");return C.textContent=m.text,C.value=m.value,u.appendChild(C),u},a.createDocumentFragment())),i}class Lu{constructor(i,o){this.element=i.createElement("div"),this.element.classList.add(_i());const u=i.createElement("div");u.classList.add(_i("m")),this.modeElem_=ku(i),this.modeElem_.classList.add(_i("ms")),u.appendChild(this.modeSelectElement);const m=i.createElement("div");m.classList.add(_i("mm")),m.appendChild(Ln(i,"dropdown")),u.appendChild(m),this.element.appendChild(u);const C=i.createElement("div");C.classList.add(_i("w")),this.element.appendChild(C),this.textsElem_=C,this.textViews_=o.textViews,this.applyTextViews_(),A(o.colorMode,S=>{this.modeElem_.value=S})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(i){this.textViews_=i,this.applyTextViews_()}applyTextViews_(){To(this.textsElem_);const i=this.element.ownerDocument;this.textViews_.forEach(o=>{const u=i.createElement("div");u.classList.add(_i("c")),u.appendChild(o.element),this.textsElem_.appendChild(u)})}}const Uu=Pe(0),Iu={rgb:()=>new Ie({min:0,max:255}),hsl:a=>a===0?new Ie({min:0,max:360}):new Ie({min:0,max:100}),hsv:a=>a===0?new Ie({min:0,max:360}):new Ie({min:0,max:100})};function er(a,i,o){return new tn(a,{arrayPosition:o===0?"fst":o===2?"lst":"mid",baseStep:Kt(!1),parser:i.parser,props:U.fromObject({draggingScale:1,formatter:Uu}),value:z(0,{constraint:Iu[i.colorMode](o)}),viewProps:i.viewProps})}class Bu{constructor(i,o){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.parser_=o.parser,this.value=o.value,this.viewProps=o.viewProps,this.colorMode=z(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(i),this.view=new Lu(i,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(i){const o={colorMode:this.colorMode.rawValue,parser:this.parser_,viewProps:this.viewProps},u=[er(i,o,0),er(i,o,1),er(i,o,2)];return u.forEach((m,C)=>{Ji({primary:this.value,secondary:m.value,forward:S=>S.rawValue.getComponents(this.colorMode.rawValue)[C],backward:(S,L)=>{const N=this.colorMode.rawValue,V=S.rawValue.getComponents(N);return V[C]=L.rawValue,new Y(ia(mi(V),V[3]),N)}})}),u}onModeSelectChange_(i){const o=i.currentTarget;this.colorMode.rawValue=o.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const tr=E("hpl");class Nu{constructor(i,o){this.onValueChange_=this.onValueChange_.bind(this),this.value=o.value,this.value.emitter.on("change",this.onValueChange_),this.element=i.createElement("div"),this.element.classList.add(tr()),o.viewProps.bindTabIndex(this.element);const u=i.createElement("div");u.classList.add(tr("c")),this.element.appendChild(u);const m=i.createElement("div");m.classList.add(tr("m")),this.element.appendChild(m),this.markerElem_=m,this.update_()}update_(){const i=this.value.rawValue,[o]=i.getComponents("hsv");this.markerElem_.style.backgroundColor=ra(new Y([o,100,100],"hsv"));const u=le(o,0,360,0,100);this.markerElem_.style.left=`${u}%`}onValueChange_(){this.update_()}}class Fu{constructor(i,o){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=o.value,this.viewProps=o.viewProps,this.view=new Nu(i,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Gt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(i,o){if(!i.point)return;const u=le(ae(i.point.x,0,i.bounds.width),0,i.bounds.width,0,359),m=this.value.rawValue,[,C,S,L]=m.getComponents("hsv");this.value.setRawValue(new Y([u,C,S,L],"hsv"),o)}onPointerDown_(i){this.handlePointerEvent_(i.data,{forceEmit:!1,last:!1})}onPointerMove_(i){this.handlePointerEvent_(i.data,{forceEmit:!1,last:!1})}onPointerUp_(i){this.handlePointerEvent_(i.data,{forceEmit:!0,last:!0})}onKeyDown_(i){const o=Oe(Kt(!1),ut(i));if(o===0)return;const u=this.value.rawValue,[m,C,S,L]=u.getComponents("hsv");this.value.setRawValue(new Y([m+o,C,S,L],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(i){Oe(Kt(!1),ut(i))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const ir=E("svp"),aa=64;class Vu{constructor(i,o){this.onValueChange_=this.onValueChange_.bind(this),this.value=o.value,this.value.emitter.on("change",this.onValueChange_),this.element=i.createElement("div"),this.element.classList.add(ir()),o.viewProps.bindTabIndex(this.element);const u=i.createElement("canvas");u.height=aa,u.width=aa,u.classList.add(ir("c")),this.element.appendChild(u),this.canvasElement=u;const m=i.createElement("div");m.classList.add(ir("m")),this.element.appendChild(m),this.markerElem_=m,this.update_()}update_(){const i=Zh(this.canvasElement);if(!i)return;const u=this.value.rawValue.getComponents("hsv"),m=this.canvasElement.width,C=this.canvasElement.height,S=i.getImageData(0,0,m,C),L=S.data;for(let X=0;X<C;X++)for(let te=0;te<m;te++){const Yt=le(te,0,m,0,100),on=le(X,0,C,100,0),an=ta(u[0],Yt,on),xi=(X*m+te)*4;L[xi]=an[0],L[xi+1]=an[1],L[xi+2]=an[2],L[xi+3]=255}i.putImageData(S,0,0);const N=le(u[1],0,100,0,100);this.markerElem_.style.left=`${N}%`;const V=le(u[2],0,100,100,0);this.markerElem_.style.top=`${V}%`}onValueChange_(){this.update_()}}class zu{constructor(i,o){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=o.value,this.viewProps=o.viewProps,this.view=new Vu(i,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Gt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(i,o){if(!i.point)return;const u=le(i.point.x,0,i.bounds.width,0,100),m=le(i.point.y,0,i.bounds.height,100,0),[C,,,S]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new Y([C,u,m,S],"hsv"),o)}onPointerDown_(i){this.handlePointerEvent_(i.data,{forceEmit:!1,last:!1})}onPointerMove_(i){this.handlePointerEvent_(i.data,{forceEmit:!1,last:!1})}onPointerUp_(i){this.handlePointerEvent_(i.data,{forceEmit:!0,last:!0})}onKeyDown_(i){Xo(i.key)&&i.preventDefault();const[o,u,m,C]=this.value.rawValue.getComponents("hsv"),S=Kt(!1),L=Oe(S,ut(i)),N=Oe(S,en(i));L===0&&N===0||this.value.setRawValue(new Y([o,u+L,m+N,C],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(i){const o=Kt(!1),u=Oe(o,ut(i)),m=Oe(o,en(i));u===0&&m===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Hu{constructor(i,o){this.value=o.value,this.viewProps=o.viewProps,this.hPaletteC_=new Fu(i,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new zu(i,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=o.supportsAlpha?{palette:new Du(i,{value:this.value,viewProps:this.viewProps}),text:new tn(i,{parser:ct,baseStep:.1,props:U.fromObject({draggingScale:.01,formatter:Pe(2)}),value:z(0,{constraint:new Ie({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Ji({primary:this.value,secondary:this.alphaIcs_.text.value,forward:u=>u.rawValue.getComponents()[3],backward:(u,m)=>{const C=u.rawValue.getComponents();return C[3]=m.rawValue,new Y(C,u.rawValue.mode)}}),this.textC_=new Bu(i,{parser:ct,value:this.value,viewProps:this.viewProps}),this.view=new Cu(i,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:o.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view})}get textController(){return this.textC_}}const nr=E("colsw");class Gu{constructor(i,o){this.onValueChange_=this.onValueChange_.bind(this),o.value.emitter.on("change",this.onValueChange_),this.value=o.value,this.element=i.createElement("div"),this.element.classList.add(nr()),o.viewProps.bindClassModifiers(this.element);const u=i.createElement("div");u.classList.add(nr("sw")),this.element.appendChild(u),this.swatchElem_=u;const m=i.createElement("button");m.classList.add(nr("b")),o.viewProps.bindDisabled(m),this.element.appendChild(m),this.buttonElement=m,this.update_()}update_(){const i=this.value.rawValue;this.swatchElem_.style.backgroundColor=Yn(i)}onValueChange_(){this.update_()}}class ju{constructor(i,o){this.value=o.value,this.viewProps=o.viewProps,this.view=new Gu(i,{value:this.value,viewProps:this.viewProps})}}class sr{constructor(i,o){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=o.value,this.viewProps=o.viewProps,this.foldable_=Ki.create(o.expanded),this.swatchC_=new ju(i,{value:this.value,viewProps:this.viewProps});const u=this.swatchC_.view.buttonElement;u.addEventListener("blur",this.onButtonBlur_),u.addEventListener("click",this.onButtonClick_),this.textC_=new Nn(i,{parser:o.parser,props:U.fromObject({formatter:o.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new mu(i,{foldable:this.foldable_,pickerLayout:o.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=o.pickerLayout==="popup"?new zo(i,{viewProps:this.viewProps}):null;const m=new Hu(i,{supportsAlpha:o.supportsAlpha,value:this.value,viewProps:this.viewProps});m.view.allFocusableElements.forEach(C=>{C.addEventListener("blur",this.onPopupChildBlur_),C.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=m,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(m.view.element),Ji({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:C=>C.rawValue,backward:(C,S)=>S.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Rs(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(i){if(!this.popC_)return;const o=this.view.element,u=i.relatedTarget;(!u||!o.contains(u))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(i){if(!this.popC_)return;const o=this.popC_.view.element,u=So(i);u&&o.contains(u)||u&&u===this.swatchC_.view.buttonElement&&!Ms(o.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(i){this.popC_?i.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&i.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function Ku(a){return Y.isColorObject(a)?Y.fromObject(a):Y.black()}function Yu(a){return mi(a.getComponents("rgb")).reduce((i,o)=>i<<8|Math.floor(o)&255,0)}function $u(a){return a.getComponents("rgb").reduce((i,o,u)=>{const m=Math.floor(u===3?o*255:o)&255;return i<<8|m},0)>>>0}function qu(a){return new Y([a>>16&255,a>>8&255,a&255],"rgb")}function Wu(a){return new Y([a>>24&255,a>>16&255,a>>8&255,le(a&255,0,255,0,1)],"rgb")}function Zu(a){return typeof a!="number"?Y.black():qu(a)}function Xu(a){return typeof a!="number"?Y.black():Wu(a)}function Qu(a){const i=oa(a);return(o,u)=>{nn(o,i(u))}}function Ju(a){const i=a?$u:Yu;return(o,u)=>{nn(o,i(u))}}function ed(a,i){const o=i.toRgbaObject();a.writeProperty("r",o.r),a.writeProperty("g",o.g),a.writeProperty("b",o.b),a.writeProperty("a",o.a)}function td(a,i){const o=i.toRgbaObject();a.writeProperty("r",o.r),a.writeProperty("g",o.g),a.writeProperty("b",o.b)}function id(a){return a?ed:td}function rr(a){return"alpha"in a&&a.alpha===!0}function nd(a){return a?i=>Yn(i,"0x"):i=>Js(i,"0x")}const sd={id:"input-color-number",type:"input",accept:(a,i)=>{if(typeof a!="number"||!("view"in i)||i.view!=="color")return null;const o=Xs(i);return o?{initialValue:a,params:o}:null},binding:{reader:a=>rr(a.params)?Xu:Zu,equals:Y.equals,writer:a=>Ju(rr(a.params))},controller:a=>{const i=rr(a.params),o="expanded"in a.params?a.params.expanded:void 0,u="picker"in a.params?a.params.picker:void 0;return new sr(a.document,{expanded:o??!1,formatter:nd(i),parser:Kn,pickerLayout:u??"popup",supportsAlpha:i,value:a.value,viewProps:a.viewProps})}};function rd(a){return Y.isRgbaColorObject(a)}const od={id:"input-color-object",type:"input",accept:(a,i)=>{if(!Y.isColorObject(a))return null;const o=Xs(i);return o?{initialValue:a,params:o}:null},binding:{reader:a=>Ku,equals:Y.equals,writer:a=>id(rd(a.initialValue))},controller:a=>{const i=Y.isRgbaColorObject(a.initialValue),o="expanded"in a.params?a.params.expanded:void 0,u="picker"in a.params?a.params.picker:void 0,m=i?Yn:Js;return new sr(a.document,{expanded:o??!1,formatter:m,parser:Kn,pickerLayout:u??"popup",supportsAlpha:i,value:a.value,viewProps:a.viewProps})}},ad={id:"input-color-string",type:"input",accept:(a,i)=>{if(typeof a!="string"||"view"in i&&i.view==="text"||!jn(a))return null;const u=Xs(i);return u?{initialValue:a,params:u}:null},binding:{reader:a=>Pu,equals:Y.equals,writer:a=>{const i=jn(a.initialValue);if(!i)throw v.shouldNeverHappen();return Qu(i)}},controller:a=>{const i=jn(a.initialValue);if(!i)throw v.shouldNeverHappen();const o=oa(i),u="expanded"in a.params?a.params.expanded:void 0,m="picker"in a.params?a.params.picker:void 0;return new sr(a.document,{expanded:u??!1,formatter:o,parser:Kn,pickerLayout:m??"popup",supportsAlpha:Su(i),value:a.value,viewProps:a.viewProps})}};class yt{constructor(i){this.components=i.components,this.asm_=i.assembly}constrain(i){const o=this.asm_.toComponents(i).map((u,m)=>{var C,S;return(S=(C=this.components[m])===null||C===void 0?void 0:C.constrain(u))!==null&&S!==void 0?S:u});return this.asm_.fromComponents(o)}}const la=E("pndtxt");class ld{constructor(i,o){this.textViews=o.textViews,this.element=i.createElement("div"),this.element.classList.add(la()),this.textViews.forEach(u=>{const m=i.createElement("div");m.classList.add(la("a")),m.appendChild(u.element),this.element.appendChild(m)})}}function hd(a,i,o){return new tn(a,{arrayPosition:o===0?"fst":o===i.axes.length-1?"lst":"mid",baseStep:i.axes[o].baseStep,parser:i.parser,props:i.axes[o].textProps,value:z(0,{constraint:i.axes[o].constraint}),viewProps:i.viewProps})}class or{constructor(i,o){this.value=o.value,this.viewProps=o.viewProps,this.acs_=o.axes.map((u,m)=>hd(i,o,m)),this.acs_.forEach((u,m)=>{Ji({primary:this.value,secondary:u.value,forward:C=>o.assembly.toComponents(C.rawValue)[m],backward:(C,S)=>{const L=o.assembly.toComponents(C.rawValue);return L[m]=S.rawValue,o.assembly.fromComponents(L)}})}),this.view=new ld(i,{textViews:this.acs_.map(u=>u.view)})}}function cd(a){return"step"in a&&!f(a.step)?new Ht(a.step):null}function ud(a){return"max"in a&&!f(a.max)||"min"in a&&!f(a.min)?new Ie({max:a.max,min:a.min}):null}function dd(a){const i=[],o=cd(a);o&&i.push(o);const u=ud(a);u&&i.push(u);const m=Ws(a.options);return m&&i.push(m),new zt(i)}function pd(a){const i=a?nt(a,Ie):null;return i?[i.minValue,i.maxValue]:[void 0,void 0]}function fd(a){const[i,o]=pd(a);return[i??0,o??100]}const md={id:"input-number",type:"input",accept:(a,i)=>{if(typeof a!="number")return null;const o=W,u=Z(i,{format:o.optional.function,max:o.optional.number,min:o.optional.number,options:o.optional.custom(Vn),step:o.optional.number});return u?{initialValue:a,params:u}:null},binding:{reader:a=>qo,constraint:a=>dd(a.params),writer:a=>nn},controller:a=>{var i,o;const u=a.value,m=a.constraint;if(m&&nt(m,Wi))return new Zi(a.document,{props:U.fromObject({options:(i=Zs(m))!==null&&i!==void 0?i:[]}),value:u,viewProps:a.viewProps});const C=(o="format"in a.params?a.params.format:void 0)!==null&&o!==void 0?o:Pe(zn(m,u.rawValue));if(m&&nt(m,Ie)){const[S,L]=fd(m);return new qs(a.document,{baseStep:pi(m),parser:ct,sliderProps:U.fromObject({maxValue:L,minValue:S}),textProps:U.fromObject({draggingScale:fi(m,u.rawValue),formatter:C}),value:u,viewProps:a.viewProps})}return new tn(a.document,{baseStep:pi(m),parser:ct,props:U.fromObject({draggingScale:fi(m,u.rawValue),formatter:C}),value:u,viewProps:a.viewProps})}};class wt{constructor(i=0,o=0){this.x=i,this.y=o}getComponents(){return[this.x,this.y]}static isObject(i){if(f(i))return!1;const o=i.x,u=i.y;return!(typeof o!="number"||typeof u!="number")}static equals(i,o){return i.x===o.x&&i.y===o.y}toObject(){return{x:this.x,y:this.y}}}const ha={toComponents:a=>a.getComponents(),fromComponents:a=>new wt(...a)},vi=E("p2d");class _d{constructor(i,o){this.element=i.createElement("div"),this.element.classList.add(vi()),o.viewProps.bindClassModifiers(this.element),A(o.expanded,D(this.element,vi(void 0,"expanded")));const u=i.createElement("div");u.classList.add(vi("h")),this.element.appendChild(u);const m=i.createElement("button");m.classList.add(vi("b")),m.appendChild(Ln(i,"p2dpad")),o.viewProps.bindDisabled(m),u.appendChild(m),this.buttonElement=m;const C=i.createElement("div");if(C.classList.add(vi("t")),u.appendChild(C),this.textElement=C,o.pickerLayout==="inline"){const S=i.createElement("div");S.classList.add(vi("p")),this.element.appendChild(S),this.pickerElement=S}else this.pickerElement=null}}const Et=E("p2dp");class vd{constructor(i,o){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=o.invertsY,this.maxValue_=o.maxValue,this.element=i.createElement("div"),this.element.classList.add(Et()),o.layout==="popup"&&this.element.classList.add(Et(void 0,"p"));const u=i.createElement("div");u.classList.add(Et("p")),o.viewProps.bindTabIndex(u),this.element.appendChild(u),this.padElement=u;const m=i.createElementNS(tt,"svg");m.classList.add(Et("g")),this.padElement.appendChild(m),this.svgElem_=m;const C=i.createElementNS(tt,"line");C.classList.add(Et("ax")),C.setAttributeNS(null,"x1","0"),C.setAttributeNS(null,"y1","50%"),C.setAttributeNS(null,"x2","100%"),C.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(C);const S=i.createElementNS(tt,"line");S.classList.add(Et("ax")),S.setAttributeNS(null,"x1","50%"),S.setAttributeNS(null,"y1","0"),S.setAttributeNS(null,"x2","50%"),S.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(S);const L=i.createElementNS(tt,"line");L.classList.add(Et("l")),L.setAttributeNS(null,"x1","50%"),L.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(L),this.lineElem_=L;const N=i.createElement("div");N.classList.add(Et("m")),this.padElement.appendChild(N),this.markerElem_=N,o.value.emitter.on("change",this.onValueChange_),this.value=o.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[i,o]=this.value.rawValue.getComponents(),u=this.maxValue_,m=le(i,-u,+u,0,100),C=le(o,-u,+u,0,100),S=this.invertsY_?100-C:C;this.lineElem_.setAttributeNS(null,"x2",`${m}%`),this.lineElem_.setAttributeNS(null,"y2",`${S}%`),this.markerElem_.style.left=`${m}%`,this.markerElem_.style.top=`${S}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function ca(a,i,o){return[Oe(i[0],ut(a)),Oe(i[1],en(a))*(o?1:-1)]}class gd{constructor(i,o){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=o.value,this.viewProps=o.viewProps,this.baseSteps_=o.baseSteps,this.maxValue_=o.maxValue,this.invertsY_=o.invertsY,this.view=new vd(i,{invertsY:this.invertsY_,layout:o.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Gt(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(i,o){if(!i.point)return;const u=this.maxValue_,m=le(i.point.x,0,i.bounds.width,-u,+u),C=le(this.invertsY_?i.bounds.height-i.point.y:i.point.y,0,i.bounds.height,-u,+u);this.value.setRawValue(new wt(m,C),o)}onPointerDown_(i){this.handlePointerEvent_(i.data,{forceEmit:!1,last:!1})}onPointerMove_(i){this.handlePointerEvent_(i.data,{forceEmit:!1,last:!1})}onPointerUp_(i){this.handlePointerEvent_(i.data,{forceEmit:!0,last:!0})}onPadKeyDown_(i){Xo(i.key)&&i.preventDefault();const[o,u]=ca(i,this.baseSteps_,this.invertsY_);o===0&&u===0||this.value.setRawValue(new wt(this.value.rawValue.x+o,this.value.rawValue.y+u),{forceEmit:!1,last:!1})}onPadKeyUp_(i){const[o,u]=ca(i,this.baseSteps_,this.invertsY_);o===0&&u===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class bd{constructor(i,o){var u,m;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=o.value,this.viewProps=o.viewProps,this.foldable_=Ki.create(o.expanded),this.popC_=o.pickerLayout==="popup"?new zo(i,{viewProps:this.viewProps}):null;const C=new gd(i,{baseSteps:[o.axes[0].baseStep,o.axes[1].baseStep],invertsY:o.invertsY,layout:o.pickerLayout,maxValue:o.maxValue,value:this.value,viewProps:this.viewProps});C.view.allFocusableElements.forEach(S=>{S.addEventListener("blur",this.onPopupChildBlur_),S.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=C,this.textC_=new or(i,{assembly:ha,axes:o.axes,parser:o.parser,value:this.value,viewProps:this.viewProps}),this.view=new _d(i,{expanded:this.foldable_.value("expanded"),pickerLayout:o.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(u=this.view.buttonElement)===null||u===void 0||u.addEventListener("blur",this.onPadButtonBlur_),(m=this.view.buttonElement)===null||m===void 0||m.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Ji({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:S=>S.rawValue,backward:(S,L)=>L.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Rs(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(i){if(!this.popC_)return;const o=this.view.element,u=i.relatedTarget;(!u||!o.contains(u))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(i){if(!this.popC_)return;const o=this.popC_.view.element,u=So(i);u&&o.contains(u)||u&&u===this.view.buttonElement&&!Ms(o.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(i){this.popC_?i.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&i.key==="Escape"&&this.view.buttonElement.focus()}}function xd(a){return wt.isObject(a)?new wt(a.x,a.y):new wt}function yd(a,i){a.writeProperty("x",i.x),a.writeProperty("y",i.y)}function ua(a){if(!a)return;const i=[];return f(a.step)||i.push(new Ht(a.step)),(!f(a.max)||!f(a.min))&&i.push(new Ie({max:a.max,min:a.min})),new zt(i)}function wd(a){return new yt({assembly:ha,components:[ua("x"in a?a.x:void 0),ua("y"in a?a.y:void 0)]})}function da(a,i){const o=a&&nt(a,Ie);if(o)return Math.max(Math.abs(o.minValue||0),Math.abs(o.maxValue||0));const u=pi(a);return Math.max(Math.abs(u)*10,Math.abs(i)*10)}function Ed(a,i){const o=i instanceof yt?i.components[0]:void 0,u=i instanceof yt?i.components[1]:void 0,m=da(o,a.x),C=da(u,a.y);return Math.max(m,C)}function pa(a,i){return{baseStep:pi(i),constraint:i,textProps:U.fromObject({draggingScale:fi(i,a),formatter:Pe(zn(i,a))})}}function Cd(a){if(!("y"in a))return!1;const i=a.y;return i&&"inverted"in i?!!i.inverted:!1}const Td={id:"input-point2d",type:"input",accept:(a,i)=>{if(!wt.isObject(a))return null;const o=W,u=Z(i,{expanded:o.optional.boolean,picker:o.optional.custom(Jo),x:o.optional.custom(bt),y:o.optional.object({inverted:o.optional.boolean,max:o.optional.number,min:o.optional.number,step:o.optional.number})});return u?{initialValue:a,params:u}:null},binding:{reader:a=>xd,constraint:a=>wd(a.params),equals:wt.equals,writer:a=>yd},controller:a=>{const i=a.document,o=a.value,u=a.constraint;if(!(u instanceof yt))throw v.shouldNeverHappen();const m="expanded"in a.params?a.params.expanded:void 0,C="picker"in a.params?a.params.picker:void 0;return new bd(i,{axes:[pa(o.rawValue.x,u.components[0]),pa(o.rawValue.y,u.components[1])],expanded:m??!1,invertsY:Cd(a.params),maxValue:Ed(o.rawValue,u),parser:ct,pickerLayout:C??"popup",value:o,viewProps:a.viewProps})}};class gi{constructor(i=0,o=0,u=0){this.x=i,this.y=o,this.z=u}getComponents(){return[this.x,this.y,this.z]}static isObject(i){if(f(i))return!1;const o=i.x,u=i.y,m=i.z;return!(typeof o!="number"||typeof u!="number"||typeof m!="number")}static equals(i,o){return i.x===o.x&&i.y===o.y&&i.z===o.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const fa={toComponents:a=>a.getComponents(),fromComponents:a=>new gi(...a)};function Sd(a){return gi.isObject(a)?new gi(a.x,a.y,a.z):new gi}function Pd(a,i){a.writeProperty("x",i.x),a.writeProperty("y",i.y),a.writeProperty("z",i.z)}function ar(a){if(!a)return;const i=[];return f(a.step)||i.push(new Ht(a.step)),(!f(a.max)||!f(a.min))&&i.push(new Ie({max:a.max,min:a.min})),new zt(i)}function Od(a){return new yt({assembly:fa,components:[ar("x"in a?a.x:void 0),ar("y"in a?a.y:void 0),ar("z"in a?a.z:void 0)]})}function lr(a,i){return{baseStep:pi(i),constraint:i,textProps:U.fromObject({draggingScale:fi(i,a),formatter:Pe(zn(i,a))})}}const Ad={id:"input-point3d",type:"input",accept:(a,i)=>{if(!gi.isObject(a))return null;const o=W,u=Z(i,{x:o.optional.custom(bt),y:o.optional.custom(bt),z:o.optional.custom(bt)});return u?{initialValue:a,params:u}:null},binding:{reader:a=>Sd,constraint:a=>Od(a.params),equals:gi.equals,writer:a=>Pd},controller:a=>{const i=a.value,o=a.constraint;if(!(o instanceof yt))throw v.shouldNeverHappen();return new or(a.document,{assembly:fa,axes:[lr(i.rawValue.x,o.components[0]),lr(i.rawValue.y,o.components[1]),lr(i.rawValue.z,o.components[2])],parser:ct,value:i,viewProps:a.viewProps})}};class bi{constructor(i=0,o=0,u=0,m=0){this.x=i,this.y=o,this.z=u,this.w=m}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(i){if(f(i))return!1;const o=i.x,u=i.y,m=i.z,C=i.w;return!(typeof o!="number"||typeof u!="number"||typeof m!="number"||typeof C!="number")}static equals(i,o){return i.x===o.x&&i.y===o.y&&i.z===o.z&&i.w===o.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const ma={toComponents:a=>a.getComponents(),fromComponents:a=>new bi(...a)};function Md(a){return bi.isObject(a)?new bi(a.x,a.y,a.z,a.w):new bi}function Rd(a,i){a.writeProperty("x",i.x),a.writeProperty("y",i.y),a.writeProperty("z",i.z),a.writeProperty("w",i.w)}function qn(a){if(!a)return;const i=[];return f(a.step)||i.push(new Ht(a.step)),(!f(a.max)||!f(a.min))&&i.push(new Ie({max:a.max,min:a.min})),new zt(i)}function Dd(a){return new yt({assembly:ma,components:[qn("x"in a?a.x:void 0),qn("y"in a?a.y:void 0),qn("z"in a?a.z:void 0),qn("w"in a?a.w:void 0)]})}function kd(a,i){return{baseStep:pi(i),constraint:i,textProps:U.fromObject({draggingScale:fi(i,a),formatter:Pe(zn(i,a))})}}const Ld={id:"input-point4d",type:"input",accept:(a,i)=>{if(!bi.isObject(a))return null;const o=W,u=Z(i,{x:o.optional.custom(bt),y:o.optional.custom(bt),z:o.optional.custom(bt),w:o.optional.custom(bt)});return u?{initialValue:a,params:u}:null},binding:{reader:a=>Md,constraint:a=>Dd(a.params),equals:bi.equals,writer:a=>Rd},controller:a=>{const i=a.value,o=a.constraint;if(!(o instanceof yt))throw v.shouldNeverHappen();return new or(a.document,{assembly:ma,axes:i.rawValue.getComponents().map((u,m)=>kd(u,o.components[m])),parser:ct,value:i,viewProps:a.viewProps})}};function Ud(a){const i=[],o=Ws(a.options);return o&&i.push(o),new zt(i)}const Id={id:"input-string",type:"input",accept:(a,i)=>{if(typeof a!="string")return null;const u=Z(i,{options:W.optional.custom(Vn)});return u?{initialValue:a,params:u}:null},binding:{reader:a=>Wo,constraint:a=>Ud(a.params),writer:a=>nn},controller:a=>{var i;const o=a.document,u=a.value,m=a.constraint;return m&&nt(m,Wi)?new Zi(o,{props:U.fromObject({options:(i=Zs(m))!==null&&i!==void 0?i:[]}),value:u,viewProps:a.viewProps}):new Nn(o,{parser:C=>C,props:U.fromObject({formatter:Gs}),value:u,viewProps:a.viewProps})}},rn={monitor:{defaultInterval:200,defaultLineCount:3}},_a=E("mll");class Bd{constructor(i,o){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=o.formatter,this.element=i.createElement("div"),this.element.classList.add(_a()),o.viewProps.bindClassModifiers(this.element);const u=i.createElement("textarea");u.classList.add(_a("i")),u.style.height=`calc(var(--bld-us) * ${o.lineCount})`,u.readOnly=!0,o.viewProps.bindDisabled(u),this.element.appendChild(u),this.textareaElem_=u,o.value.emitter.on("change",this.onValueUpdate_),this.value=o.value,this.update_()}update_(){const i=this.textareaElem_,o=i.scrollTop===i.scrollHeight-i.clientHeight,u=[];this.value.rawValue.forEach(m=>{m!==void 0&&u.push(this.formatter_(m))}),i.textContent=u.join(`
`),o&&(i.scrollTop=i.scrollHeight)}onValueUpdate_(){this.update_()}}class hr{constructor(i,o){this.value=o.value,this.viewProps=o.viewProps,this.view=new Bd(i,{formatter:o.formatter,lineCount:o.lineCount,value:this.value,viewProps:this.viewProps})}}const va=E("sgl");class Nd{constructor(i,o){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=o.formatter,this.element=i.createElement("div"),this.element.classList.add(va()),o.viewProps.bindClassModifiers(this.element);const u=i.createElement("input");u.classList.add(va("i")),u.readOnly=!0,u.type="text",o.viewProps.bindDisabled(u),this.element.appendChild(u),this.inputElement=u,o.value.emitter.on("change",this.onValueUpdate_),this.value=o.value,this.update_()}update_(){const i=this.value.rawValue,o=i[i.length-1];this.inputElement.value=o!==void 0?this.formatter_(o):""}onValueUpdate_(){this.update_()}}class cr{constructor(i,o){this.value=o.value,this.viewProps=o.viewProps,this.view=new Nd(i,{formatter:o.formatter,value:this.value,viewProps:this.viewProps})}}const Fd={id:"monitor-bool",type:"monitor",accept:(a,i)=>{if(typeof a!="boolean")return null;const u=Z(i,{lineCount:W.optional.number});return u?{initialValue:a,params:u}:null},binding:{reader:a=>Go},controller:a=>{var i;return a.value.rawValue.length===1?new cr(a.document,{formatter:jo,value:a.value,viewProps:a.viewProps}):new hr(a.document,{formatter:jo,lineCount:(i=a.params.lineCount)!==null&&i!==void 0?i:rn.monitor.defaultLineCount,value:a.value,viewProps:a.viewProps})}};class Vd{constructor(){this.emitter=new x,this.index_=-1}get index(){return this.index_}set index(i){this.index_!==i&&(this.index_=i,this.emitter.emit("change",{index:i,sender:this}))}}const Ct=E("grl");class zd{constructor(i,o){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=i.createElement("div"),this.element.classList.add(Ct()),o.viewProps.bindClassModifiers(this.element),this.formatter_=o.formatter,this.minValue_=o.minValue,this.maxValue_=o.maxValue,this.cursor_=o.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const u=i.createElementNS(tt,"svg");u.classList.add(Ct("g")),u.style.height=`calc(var(--bld-us) * ${o.lineCount})`,this.element.appendChild(u),this.svgElem_=u;const m=i.createElementNS(tt,"polyline");this.svgElem_.appendChild(m),this.lineElem_=m;const C=i.createElement("div");C.classList.add(Ct("t"),E("tt")()),this.element.appendChild(C),this.tooltipElem_=C,o.value.emitter.on("change",this.onValueUpdate_),this.value=o.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const i=this.svgElem_.getBoundingClientRect(),o=this.value.rawValue.length-1,u=this.minValue_,m=this.maxValue_,C=[];this.value.rawValue.forEach((X,te)=>{if(X===void 0)return;const Yt=le(te,0,o,0,i.width),on=le(X,u,m,i.height,0);C.push([Yt,on].join(","))}),this.lineElem_.setAttributeNS(null,"points",C.join(" "));const S=this.tooltipElem_,L=this.value.rawValue[this.cursor_.index];if(L===void 0){S.classList.remove(Ct("t","a"));return}const N=le(this.cursor_.index,0,o,0,i.width),V=le(L,u,m,i.height,0);S.style.left=`${N}px`,S.style.top=`${V}px`,S.textContent=`${this.formatter_(L)}`,S.classList.contains(Ct("t","a"))||(S.classList.add(Ct("t","a"),Ct("t","in")),kn(S),S.classList.remove(Ct("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class Hd{constructor(i,o){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.value=o.value,this.viewProps=o.viewProps,this.cursor_=new Vd,this.view=new zd(i,{cursor:this.cursor_,formatter:o.formatter,lineCount:o.lineCount,maxValue:o.maxValue,minValue:o.minValue,value:this.value,viewProps:this.viewProps}),!Ms(i))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const u=new Gt(this.view.element);u.emitter.on("down",this.onGraphPointerDown_),u.emitter.on("move",this.onGraphPointerMove_),u.emitter.on("up",this.onGraphPointerUp_)}}onGraphMouseLeave_(){this.cursor_.index=-1}onGraphMouseMove_(i){const o=this.view.element.getBoundingClientRect();this.cursor_.index=Math.floor(le(i.offsetX,0,o.width,0,this.value.rawValue.length))}onGraphPointerDown_(i){this.onGraphPointerMove_(i)}onGraphPointerMove_(i){if(!i.data.point){this.cursor_.index=-1;return}this.cursor_.index=Math.floor(le(i.data.point.x,0,i.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.index=-1}}function ur(a){return"format"in a&&!f(a.format)?a.format:Pe(2)}function Gd(a){var i;return a.value.rawValue.length===1?new cr(a.document,{formatter:ur(a.params),value:a.value,viewProps:a.viewProps}):new hr(a.document,{formatter:ur(a.params),lineCount:(i=a.params.lineCount)!==null&&i!==void 0?i:rn.monitor.defaultLineCount,value:a.value,viewProps:a.viewProps})}function jd(a){var i,o,u;return new Hd(a.document,{formatter:ur(a.params),lineCount:(i=a.params.lineCount)!==null&&i!==void 0?i:rn.monitor.defaultLineCount,maxValue:(o="max"in a.params?a.params.max:null)!==null&&o!==void 0?o:100,minValue:(u="min"in a.params?a.params.min:null)!==null&&u!==void 0?u:0,value:a.value,viewProps:a.viewProps})}function ga(a){return"view"in a&&a.view==="graph"}const Kd={id:"monitor-number",type:"monitor",accept:(a,i)=>{if(typeof a!="number")return null;const o=W,u=Z(i,{format:o.optional.function,lineCount:o.optional.number,max:o.optional.number,min:o.optional.number,view:o.optional.string});return u?{initialValue:a,params:u}:null},binding:{defaultBufferSize:a=>ga(a)?64:1,reader:a=>qo},controller:a=>ga(a.params)?jd(a):Gd(a)},Yd={id:"monitor-string",type:"monitor",accept:(a,i)=>{if(typeof a!="string")return null;const o=W,u=Z(i,{lineCount:o.optional.number,multiline:o.optional.boolean});return u?{initialValue:a,params:u}:null},binding:{reader:a=>Wo},controller:a=>{var i;const o=a.value;return o.rawValue.length>1||"multiline"in a.params&&a.params.multiline?new hr(a.document,{formatter:Gs,lineCount:(i=a.params.lineCount)!==null&&i!==void 0?i:rn.monitor.defaultLineCount,value:o,viewProps:a.viewProps}):new cr(a.document,{formatter:Gs,value:o,viewProps:a.viewProps})}};class $d{constructor(i){this.onValueChange_=this.onValueChange_.bind(this),this.reader=i.reader,this.writer=i.writer,this.emitter=new x,this.value=i.value,this.value.emitter.on("change",this.onValueChange_),this.target=i.target,this.read()}read(){const i=this.target.read();i!==void 0&&(this.value.rawValue=this.reader(i))}write_(i){this.writer(this.target,i)}onValueChange_(i){this.write_(i.rawValue),this.emitter.emit("change",{options:i.options,rawValue:i.rawValue,sender:this})}}function qd(a,i){const o=a.accept(i.target.read(),i.params);if(f(o))return null;const u=W,m={target:i.target,initialValue:o.initialValue,params:o.params},C=a.binding.reader(m),S=a.binding.constraint?a.binding.constraint(m):void 0,L=z(C(o.initialValue),{constraint:S,equals:a.binding.equals}),N=new $d({reader:C,target:i.target,value:L,writer:a.binding.writer(m)}),V=u.optional.boolean(i.params.disabled).value,X=u.optional.boolean(i.params.hidden).value,te=a.controller({constraint:S,document:i.document,initialValue:o.initialValue,params:o.params,value:N.value,viewProps:gt.create({disabled:V,hidden:X})}),Yt=u.optional.string(i.params.label).value;return new it(i.document,{binding:N,blade:ji(),props:U.fromObject({label:Yt||i.target.key}),valueController:te})}class Wd{constructor(i){this.onTick_=this.onTick_.bind(this),this.reader_=i.reader,this.target=i.target,this.emitter=new x,this.value=i.value,this.ticker=i.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const i=this.target.read();if(i===void 0)return;const o=this.value.rawValue,u=this.reader_(i);this.value.rawValue=su(o,u),this.emitter.emit("update",{rawValue:u,sender:this})}onTick_(i){this.read()}}function Zd(a,i){return i===0?new wc:new Ec(a,i??rn.monitor.defaultInterval)}function Xd(a,i){var o,u,m;const C=W,S=a.accept(i.target.read(),i.params);if(f(S))return null;const L={target:i.target,initialValue:S.initialValue,params:S.params},N=a.binding.reader(L),V=(u=(o=C.optional.number(i.params.bufferSize).value)!==null&&o!==void 0?o:a.binding.defaultBufferSize&&a.binding.defaultBufferSize(S.params))!==null&&u!==void 0?u:1,X=C.optional.number(i.params.interval).value,te=new Wd({reader:N,target:i.target,ticker:Zd(i.document,X),value:iu(V)}),Yt=C.optional.boolean(i.params.disabled).value,on=C.optional.boolean(i.params.hidden).value,an=a.controller({document:i.document,params:S.params,value:te.value,viewProps:gt.create({disabled:Yt,hidden:on})}),xi=(m=C.optional.string(i.params.label).value)!==null&&m!==void 0?m:i.target.key;return new vt(i.document,{binding:te,blade:ji(),props:U.fromObject({label:xi}),valueController:an})}class Qd{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(i){i.type==="blade"?this.pluginsMap_.blades.unshift(i):i.type==="input"?this.pluginsMap_.inputs.unshift(i):i.type==="monitor"&&this.pluginsMap_.monitors.unshift(i)}createInput(i,o,u){const m=o.read();if(f(m))throw new v({context:{key:o.key},type:"nomatchingcontroller"});const C=this.pluginsMap_.inputs.reduce((S,L)=>S||qd(L,{document:i,target:o,params:u}),null);if(C)return C;throw new v({context:{key:o.key},type:"nomatchingcontroller"})}createMonitor(i,o,u){const m=this.pluginsMap_.monitors.reduce((C,S)=>C||Xd(S,{document:i,params:u,target:o}),null);if(m)return m;throw new v({context:{key:o.key},type:"nomatchingcontroller"})}createBlade(i,o){const u=this.pluginsMap_.blades.reduce((m,C)=>m||yc(C,{document:i,params:o}),null);if(!u)throw new v({type:"nomatchingview",context:{params:o}});return u}createBladeApi(i){if(i instanceof it)return new Ls(i);if(i instanceof vt)return new Us(i);if(i instanceof $i)return new In(i,this);const o=this.pluginsMap_.blades.reduce((u,m)=>u||m.api({controller:i,pool:this}),null);if(!o)throw v.shouldNeverHappen();return o}}function Jd(){const a=new Qd;return[Td,Ad,Ld,Id,md,ad,od,sd,fu,Fd,Yd,Kd,ec,fc,_c,Fo].forEach(i=>{a.register(i)}),a}class ba extends s{constructor(i){super(i),this.emitter_=new x,this.controller_.valueController.value.emitter.on("change",o=>{this.emitter_.emit("change",{event:new h(this,o.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(i){this.controller_.props.set("label",i)}get options(){return this.controller_.valueController.props.get("options")}set options(i){this.controller_.valueController.props.set("options",i)}get value(){return this.controller_.valueController.value.rawValue}set value(i){this.controller_.valueController.value.rawValue=i}on(i,o){const u=o.bind(this);return this.emitter_.on(i,m=>{u(m.event)}),this}}class xa extends s{constructor(i){super(i),this.emitter_=new x,this.controller_.valueController.value.emitter.on("change",o=>{this.emitter_.emit("change",{event:new h(this,o.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(i){this.controller_.props.set("label",i)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(i){this.controller_.valueController.sliderController.props.set("maxValue",i)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(i){this.controller_.valueController.sliderController.props.set("minValue",i)}get value(){return this.controller_.valueController.value.rawValue}set value(i){this.controller_.valueController.value.rawValue=i}on(i,o){const u=o.bind(this);return this.emitter_.on(i,m=>{u(m.event)}),this}}class ya extends s{constructor(i){super(i),this.emitter_=new x,this.controller_.valueController.value.emitter.on("change",o=>{this.emitter_.emit("change",{event:new h(this,o.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(i){this.controller_.props.set("label",i)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(i){this.controller_.valueController.props.set("formatter",i)}get value(){return this.controller_.valueController.value.rawValue}set value(i){this.controller_.valueController.value.rawValue=i}on(i,o){const u=o.bind(this);return this.emitter_.on(i,m=>{u(m.event)}),this}}const ep=(function(){return{id:"list",type:"blade",accept(a){const i=W,o=Z(a,{options:i.required.custom(Vn),value:i.required.raw,view:i.required.constant("list"),label:i.optional.string});return o?{params:o}:null},controller(a){const i=new Zi(a.document,{props:U.fromObject({options:ea(a.params.options)}),value:z(a.params.value),viewProps:a.viewProps});return new di(a.document,{blade:a.blade,props:U.fromObject({label:a.params.label}),valueController:i})},api(a){return!(a.controller instanceof di)||!(a.controller.valueController instanceof Zi)?null:new ba(a.controller)}}})();function tp(a){return a.reduce((i,o)=>Object.assign(i,{[o.presetKey]:o.read()}),{})}function ip(a,i){a.forEach(o=>{const u=i[o.presetKey];u!==void 0&&o.write(u)})}class np extends Is{constructor(i,o){super(i,o)}get element(){return this.controller_.view.element}importPreset(i){const o=this.controller_.rackController.rack.find(it).map(u=>u.binding.target);ip(o,i),this.refresh()}exportPreset(){const i=this.controller_.rackController.rack.find(it).map(o=>o.binding.target);return tp(i)}refresh(){this.controller_.rackController.rack.find(it).forEach(i=>{i.binding.read()}),this.controller_.rackController.rack.find(vt).forEach(i=>{i.binding.read()})}}class sp extends Fs{constructor(i,o){super(i,{expanded:o.expanded,blade:o.blade,props:o.props,root:!0,viewProps:o.viewProps})}}const rp={id:"slider",type:"blade",accept(a){const i=W,o=Z(a,{max:i.required.number,min:i.required.number,view:i.required.constant("slider"),format:i.optional.function,label:i.optional.string,value:i.optional.number});return o?{params:o}:null},controller(a){var i,o;const u=(i=a.params.value)!==null&&i!==void 0?i:0,m=new qs(a.document,{baseStep:1,parser:ct,sliderProps:U.fromObject({maxValue:a.params.max,minValue:a.params.min}),textProps:U.fromObject({draggingScale:fi(void 0,u),formatter:(o=a.params.format)!==null&&o!==void 0?o:eu}),value:z(u),viewProps:a.viewProps});return new di(a.document,{blade:a.blade,props:U.fromObject({label:a.params.label}),valueController:m})},api(a){return!(a.controller instanceof di)||!(a.controller.valueController instanceof qs)?null:new xa(a.controller)}},op=(function(){return{id:"text",type:"blade",accept(a){const i=W,o=Z(a,{parse:i.required.function,value:i.required.raw,view:i.required.constant("text"),format:i.optional.function,label:i.optional.string});return o?{params:o}:null},controller(a){var i;const o=new Nn(a.document,{parser:a.params.parse,props:U.fromObject({formatter:(i=a.params.format)!==null&&i!==void 0?i:(u=>String(u))}),value:z(a.params.value),viewProps:a.viewProps});return new di(a.document,{blade:a.blade,props:U.fromObject({label:a.params.label}),valueController:o})},api(a){return!(a.controller instanceof di)||!(a.controller.valueController instanceof Nn)?null:new ya(a.controller)}}})();function ap(a){const i=a.createElement("div");return i.classList.add(E("dfw")()),a.body&&a.body.appendChild(i),i}function wa(a,i,o){if(a.querySelector(`style[data-tp-style=${i}]`))return;const u=a.createElement("style");u.dataset.tpStyle=i,u.textContent=o,a.head.appendChild(u)}class lp extends np{constructor(i){var o;const u=i||{},m=(o=u.document)!==null&&o!==void 0?o:Wh(),C=Jd(),S=new sp(m,{expanded:u.expanded,blade:ji(),props:U.fromObject({title:u.title}),viewProps:gt.create()});super(S,C),this.pool_=C,this.containerElem_=u.container||ap(m),this.containerElem_.appendChild(this.element),this.doc_=m,this.usesDefaultWrapper_=!u.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw v.alreadyDisposed();return this.doc_}dispose(){const i=this.containerElem_;if(!i)throw v.alreadyDisposed();if(this.usesDefaultWrapper_){const o=i.parentElement;o&&o.removeChild(i)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(i){("plugin"in i?[i.plugin]:"plugins"in i?i.plugins:[]).forEach(u=>{this.pool_.register(u),this.embedPluginStyle_(u)})}embedPluginStyle_(i){i.css&&wa(this.document,`plugin-${i.id}`,i.css)}setUpDefaultPlugins_(){wa(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor transparent;scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:transparent}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:transparent solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, #28292e);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, #adafb8);--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, #28292e);--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, #bbbcc4);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, #bbbcc4);--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_i,.tp-fldv_c>.tp-tabv>.tp-tabv_i{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a:before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_c{border-left:var(--cnt-bg) solid 4px}.tp-fldv_b:hover+.tp-fldv_c{border-left-color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_c{border-left-color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_c{border-left-color:var(--cnt-bg-a)}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv.tp-v-disabled{opacity:.5}.tp-tabv_i{align-items:flex-end;display:flex;overflow:hidden}.tp-tabv.tp-tabv-nop .tp-tabv_i{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_i::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{border-left:var(--cnt-bg) solid 4px;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p)}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:-2px;position:absolute;width:2px}.tp-tbiv_b{background-color:var(--cnt-bg);display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);width:100%}.tp-tbiv_b:hover{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active{background-color:var(--cnt-bg-a)}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) transparent transparent transparent;border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c,.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_i{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach(i=>{this.embedPluginStyle_(i)}),this.registerPlugin({plugins:[rp,ep,Fo,op]})}}const hp=new n("3.0.8");t.BladeApi=s,t.ButtonApi=b,t.FolderApi=Is,t.InputBindingApi=Ls,t.ListApi=ba,t.MonitorBindingApi=Us,t.Pane=lp,t.SeparatorApi=Ro,t.SliderApi=xa,t.TabApi=Bo,t.TabPageApi=Io,t.TextApi=ya,t.TpChangeEvent=h,t.VERSION=hp,Object.defineProperty(t,"__esModule",{value:!0})}))})(gn,gn.exports)),gn.exports}var lm=am();function hm(r,e){const t=new lm.Pane({title:"controls",expanded:!0});t.addInput(r,"amount",{min:1,max:6}),t.addInput(r,"xscale",{min:30,max:500});const n=t.addFolder({title:"audio",expanded:!0});return n.addMonitor(e,"loudness",{view:"graph",min:0,max:1}),n.addMonitor(e,"perceptualSpread",{view:"graph",min:0,max:1}),n.addMonitor(e,"perceptualSharpness",{view:"graph",min:0,max:1}),n.addMonitor(e,"spectralFlatness",{view:"graph",min:0,max:1}),n.addMonitor(e,"spectralKurtosis",{view:"graph",min:0,max:1}),t}function xr(r,e,t){t[0]=r[0]>e[0]?e[0]:r[0],t[1]=r[1]<e[1]?e[1]:r[1],t[2]=r[2]>e[2]?e[2]:r[2],t[3]=r[3]<e[3]?e[3]:r[3],t[4]=r[4]>e[4]?e[4]:r[4],t[5]=r[5]<e[5]?e[5]:r[5]}function cm(r,e,t){let n=!1;const s=r[0]>e[0]?e[0]:r[0],l=r[1]<e[1]?e[1]:r[1],h=r[2]>e[2]?e[2]:r[2],c=r[3]<e[3]?e[3]:r[3],p=r[4]>e[4]?e[4]:r[4],d=r[5]<e[5]?e[5]:r[5];return t[0]>s&&(t[0]=s,n=!0),t[1]<l&&(t[1]=l,n=!0),t[2]>h&&(t[2]=h,n=!0),t[3]<c&&(t[3]=c,n=!0),t[4]>p&&(t[4]=p,n=!0),t[5]<d&&(t[5]=d,n=!0),n}function um(r,e){return!(e[0]>r[0]||e[1]<r[1]||e[2]>r[2]||e[3]<r[3]||e[4]>r[4]||e[5]<r[5])}function dm(r,e){let t=!1;return e[0]>r[0]&&(e[0]=r[0],t=!0),e[1]<r[1]&&(e[1]=r[1],t=!0),e[2]>r[2]&&(e[2]=r[2],t=!0),e[3]<r[3]&&(e[3]=r[3],t=!0),e[4]>r[4]&&(e[4]=r[4],t=!0),e[5]<r[5]&&(e[5]=r[5],t=!0),t}function Qn(r,e){r[0]-=e,r[1]+=e,r[2]-=e,r[3]+=e,r[4]-=e,r[5]+=e}function wi(r){const e=r[1]-r[0],t=r[3]-r[2],n=r[5]-r[4];return 2*(e*t+t*n+n*e)}function Wt(r,e){const t=r[0]>e[0]?e[0]:r[0],n=r[1]<e[1]?e[1]:r[1],s=r[2]>e[2]?e[2]:r[2],l=r[3]<e[3]?e[3]:r[3],h=r[4]>e[4]?e[4]:r[4],c=r[5]<e[5]?e[5]:r[5],p=n-t,d=l-s,f=c-h;return 2*(p*d+d*f+f*p)}function pm(r){const e=r[1]-r[0],t=r[3]-r[2],n=r[5]-r[4];return e>t?e>n?0:2:t>n?1:2}function bn(r,e){const t=r[0]-e[0],n=e[0]-r[1];let s=t>n?t:n;s<0&&(s=0);const l=r[2]-e[1],h=e[1]-r[3];let c=l>h?l:h;c<0&&(c=0);const p=r[4]-e[2],d=e[2]-r[5];let f=p>d?p:d;return f<0&&(f=0),s*s+c*c+f*f}function fm(r,e){let t,n,s,l,h,c;const p=r[0]-e[0],d=e[0]-r[1];p>d?(t=p,n=d):(t=d,n=p),t<0&&(t=0);const f=r[2]-e[1],_=e[1]-r[3];f>_?(s=f,l=_):(s=_,l=f),s<0&&(s=0);const g=r[4]-e[2],v=e[2]-r[5];return g>v?(h=g,c=v):(h=v,c=g),h<0&&(h=0),{min:t*t+s*s+h*h,max:n*n+l*l+c*c}}class mm{constructor(){this.array=[]}clear(){this.array=[]}push(e){const t=this.array,n=e.inheritedCost,s=t.length>6?t.length-6:0;let l;for(l=t.length-1;l>=s&&!(n<=t[l].inheritedCost);l--);l>t.length-7&&t.splice(l+1,0,e)}pop(){return this.array.pop()}}class _m{constructor(e=!1){this.root=null,this._sortedList=new mm,this.count=0,this.highPrecision=e,this._typeArray=e?Float64Array:Float32Array}createFromArray(e,t,n,s=0){const l=t.length,h=this._typeArray;h!==(t[0].BYTES_PER_ELEMENT===4?Float32Array:Float64Array)&&console.warn("Different precision.");const c=new h(6);let p,d;this.root=f(0,l,null);function f(y,b,x){if(b===1){const O=t[y];s>0&&Qn(O,s);const A={box:O,object:e[y],parent:x};return n&&n(A),A}const w=_(y,b);g();let E=v(y,b);(E===y||E===y+b)&&(E=y+(b>>1));const T={box:w,parent:x};return T.left=f(y,E-y,T),T.right=f(E,b-E+y,T),T}function _(y,b){const x=new h(6),w=y+b;x[0]=1/0,x[1]=-1/0,x[2]=1/0,x[3]=-1/0,x[4]=1/0,x[5]=-1/0,c[0]=1/0,c[1]=-1/0,c[2]=1/0,c[3]=-1/0,c[4]=1/0,c[5]=-1/0;for(let E=y;E<w;E++){const T=t[E],O=T[0],A=T[1],M=T[2],R=T[3],D=T[4],k=T[5];x[0]>O&&(x[0]=O),x[1]<A&&(x[1]=A),x[2]>M&&(x[2]=M),x[3]<R&&(x[3]=R),x[4]>D&&(x[4]=D),x[5]<k&&(x[5]=k);const I=(A+O)*.5,H=(R+M)*.5,K=(k+D)*.5;c[0]>I&&(c[0]=I),c[1]<I&&(c[1]=I),c[2]>H&&(c[2]=H),c[3]<H&&(c[3]=H),c[4]>K&&(c[4]=K),c[5]<K&&(c[5]=K)}return x[0]-=s,x[1]+=s,x[2]-=s,x[3]+=s,x[4]-=s,x[5]+=s,x}function g(){p=pm(c)*2,d=(c[p]+c[p+1])*.5}function v(y,b){let x=y,w=y+b-1;for(;x<=w;){const E=t[x];if((E[p+1]+E[p])*.5>=d)for(;;){const T=t[w];if((T[p+1]+T[p])*.5<d){const O=e[x];e[x]=e[w],e[w]=O;const A=t[x];t[x]=t[w],t[w]=A,w--;break}if(w--,w<=x)return x}x++}return x}}insert(e,t,n){n>0&&Qn(t,n);const s=this.createLeafNode(e,t);return this.root===null?this.root=s:this.insertLeaf(s),this.count++,s}insertRange(e,t,n,s){console.warn("Method not optimized yet. It just calls 'insert' N times.");const l=e.length,h=n>0?n:n?null:0;for(let c=0;c<l;c++){const p=this.insert(e[c],t[c],h??n[c]);s&&s(p)}}move(e,t){if(!e.parent||um(e.box,e.parent.box)){t>0&&Qn(e.box,t);return}t>0&&Qn(e.box,t);const n=this.delete(e);this.insertLeaf(e,n),this.count++}delete(e){const t=e.parent;if(t===null)return this.root=null,null;const n=t.parent,s=t.left===e?t.right:t.left;return s.parent=n,e.parent=null,n===null?(this.root=s,t):(n.left===t?n.left=s:n.right=s,this.refit(n),this.count--,t)}clear(){this.root=null}insertLeaf(e,t){const n=this.findBestSibling(e.box),s=n.parent;t===void 0?t=this.createInternalNode(s,n,e):(t.parent=s,t.left=n,t.right=e),n.parent=t,e.parent=t,s===null?this.root=t:s.left===n?s.left=t:s.right=t,this.refitAndRotate(e,n)}createLeafNode(e,t){return{box:t,object:e,parent:null}}createInternalNode(e,t,n){return{parent:e,left:t,right:n,box:new this._typeArray(6)}}findBestSibling(e){const t=this.root;let n=t,s=Wt(e,t.box);const l=wi(e);if(t.object!==void 0)return t;const h=this._sortedList;h.clear();let c={node:t,inheritedCost:s-wi(t.box)};do{const{node:p,inheritedCost:d}=c;if(l+d>=s)break;const f=p.left,_=p.right,g=Wt(e,f.box)+d,v=g-wi(f.box),y=Wt(e,_.box)+d,b=y-wi(_.box);if(g>y?s>y&&(n=_,s=y):s>g&&(n=f,s=g),b>v){if(l+v>=s||(f.object===void 0&&h.push({node:f,inheritedCost:v}),l+b>=s))continue;_.object===void 0&&h.push({node:_,inheritedCost:b})}else{if(l+b>=s||(_.object===void 0&&h.push({node:_,inheritedCost:b}),l+v>=s))continue;f.object===void 0&&h.push({node:f,inheritedCost:v})}}while(c=h.pop());return n}refit(e){for(xr(e.left.box,e.right.box,e.box);e=e.parent;)if(!cm(e.left.box,e.right.box,e.box))return}refitAndRotate(e,t){const n=e.box;e=e.parent;const s=e.box;for(xr(n,t.box,s);e=e.parent;){const l=e.box;if(!dm(n,l))return;const h=e.left,c=e.right,p=h.box,d=c.box;let f=null,_=null,g=0;if(c.object===void 0){const v=c.left,y=c.right,b=wi(c.box),x=b-Wt(p,v.box),w=b-Wt(p,y.box);x>w?x>0&&(f=h,_=y,g=x):w>0&&(f=h,_=v,g=w)}if(h.object===void 0){const v=h.left,y=h.right,b=wi(h.box),x=b-Wt(d,v.box),w=b-Wt(d,y.box);x>w?x>g&&(f=c,_=y):w>g&&(f=c,_=v)}f!==null&&this.swap(f,_)}}swap(e,t){const n=e.parent,s=t.parent,l=s.box;n.left===e?n.left=t:n.right=t,s.left===t?s.left=e:s.right=e,e.parent=s,t.parent=n,xr(s.left.box,s.right.box,l)}}const go=0,vm=1;class gm{constructor(e,t){this.coordinateSystem=t,this.array=e?new Float64Array(24):new Float32Array(24)}setFromProjectionMatrix(e){if(this.updatePlane(0,e[3]+e[0],e[7]+e[4],e[11]+e[8],e[15]+e[12]),this.updatePlane(1,e[3]-e[0],e[7]-e[4],e[11]-e[8],e[15]-e[12]),this.updatePlane(2,e[3]-e[1],e[7]-e[5],e[11]-e[9],e[15]-e[13]),this.updatePlane(3,e[3]+e[1],e[7]+e[5],e[11]+e[9],e[15]+e[13]),this.updatePlane(4,e[3]-e[2],e[7]-e[6],e[11]-e[10],e[15]-e[14]),this.coordinateSystem===go)this.updatePlane(5,e[3]+e[2],e[7]+e[6],e[11]+e[10],e[15]+e[14]);else if(this.coordinateSystem===vm)this.updatePlane(5,e[2],e[6],e[10],e[14]);else throw new Error("Invalid coordinate system: "+this.coordinateSystem);return this}updatePlane(e,t,n,s,l){const h=this.array,c=e*4,p=Math.sqrt(t*t+n*n+s*s);h[c+0]=t/p,h[c+1]=n/p,h[c+2]=s/p,h[c+3]=l/p}intersectsBoxMask(e,t){const n=this.array;let s,l,h,c,p,d;for(let f=0;f<6;f++){if(!(t&32>>f))continue;const _=f*4,g=n[_+0],v=n[_+1],y=n[_+2],b=n[_+3];if(g>0?(s=e[1],c=e[0]):(s=e[0],c=e[1]),v>0?(l=e[3],p=e[2]):(l=e[2],p=e[3]),y>0?(h=e[5],d=e[4]):(h=e[4],d=e[5]),g*s+v*l+y*h<-b)return-1;g*c+v*p+y*d>-b&&(t^=32>>f)}return t}isIntersected(e,t){const n=this.array;for(let s=0;s<6;s++){if(!(t&32>>s))continue;const l=s*4,h=n[l+0],c=n[l+1],p=n[l+2],d=n[l+3],f=h>0?e[1]:e[0],_=c>0?e[3]:e[2],g=p>0?e[5]:e[4];if(h*f+c*_+p*g<-d)return!1}return!0}isIntersectedMargin(e,t,n){if(t===0)return!0;const s=this.array;for(let l=0;l<6;l++){if(!(t&32>>l))continue;const h=l*4,c=s[h+0],p=s[h+1],d=s[h+2],f=s[h+3],_=c>0?e[1]-n:e[0]+n,g=p>0?e[3]-n:e[2]+n,v=d>0?e[5]-n:e[4]+n;if(c*_+p*g+d*v<-f)return!1}return!0}}function Ya(r,e,t,n,s,l){let h=n[0],c=e[0],p=t[0],d=(r[h]-c)*p,f=(r[h^1]-c)*p,_=d>0?d:0,g=f<1/0?f:1/0;return h=n[1],c=e[1],p=t[1],d=(r[h+2]-c)*p,d>g||(f=(r[h^3]-c)*p,_>f)||(_=d>_?d:_,g=f<g?f:g,h=n[2],c=e[2],p=t[2],d=(r[h+4]-c)*p,d>g)||(f=(r[h^5]-c)*p,_>f)?!1:(_=d>_?d:_,g=f<g?f:g,_<=l&&g>=s)}function $a(r,e){return r[1]>=e[0]&&e[1]>=r[0]&&r[3]>=e[2]&&e[3]>=r[2]&&r[5]>=e[4]&&e[5]>=r[4]}function bm(r,e,t){return bn(t,r)<=e*e}class xm{constructor(e,t=go){this._sign=new Uint8Array(3),this.builder=e;const n=e.highPrecision;this.frustum=new gm(n,t),this._dirInv=n?new Float64Array(3):new Float32Array(3)}get root(){return this.builder.root}createFromArray(e,t,n,s){e?.length>0&&this.builder.createFromArray(e,t,n,s)}insert(e,t,n){return this.builder.insert(e,t,n)}insertRange(e,t,n,s){e?.length>0&&this.builder.insertRange(e,t,n,s)}move(e,t){this.builder.move(e,t)}delete(e){return this.builder.delete(e)}clear(){this.builder.clear()}traverse(e){if(this.root===null)return;t(this.root,0);function t(n,s){if(n.object!==void 0){e(n,s);return}e(n,s)||(t(n.left,s+1),t(n.right,s+1))}}intersectsRay(e,t,n,s=0,l=1/0){if(this.root===null)return!1;const h=this._dirInv,c=this._sign;return h[0]=1/e[0],h[1]=1/e[1],h[2]=1/e[2],c[0]=h[0]<0?1:0,c[1]=h[1]<0?1:0,c[2]=h[2]<0?1:0,p(this.root);function p(d){return Ya(d.box,t,h,c,s,l)?d.object!==void 0?n(d.object):p(d.left)||p(d.right):!1}}intersectsBox(e,t){if(this.root===null)return!1;return n(this.root);function n(s){return $a(e,s.box)?s.object!==void 0?t(s.object):n(s.left)||n(s.right):!1}}intersectsSphere(e,t,n){if(this.root===null)return!1;return s(this.root);function s(l){return bm(e,t,l.box)?l.object!==void 0?n(l.object):s(l.left)||s(l.right):!1}}isNodeIntersected(e,t){const n=e.box;let s;for(;s=e.parent;){const h=s.left===e?s.right:s.left;if(l(h))return!0;e=s}return!1;function l(h){return $a(n,h.box)?h.object!==void 0?t(h.object):l(h.left)||l(h.right):!1}}rayIntersections(e,t,n,s=0,l=1/0){if(this.root===null)return;const h=this._dirInv,c=this._sign;h[0]=1/e[0],h[1]=1/e[1],h[2]=1/e[2],c[0]=h[0]<0?1:0,c[1]=h[1]<0?1:0,c[2]=h[2]<0?1:0,p(this.root);function p(d){if(Ya(d.box,t,h,c,s,l)){if(d.object!==void 0){n(d.object);return}p(d.left),p(d.right)}}}frustumCulling(e,t){if(this.root===null)return;const n=this.frustum.setFromProjectionMatrix(e);s(this.root,63);function s(h,c){if(h.object!==void 0){n.isIntersected(h.box,c)&&t(h,n,c);return}if(c=n.intersectsBoxMask(h.box,c),!(c<0)){if(c===0){l(h.left),l(h.right);return}s(h.left,c),s(h.right,c)}}function l(h){if(h.object!==void 0){t(h,n,0);return}l(h.left),l(h.right)}}frustumCullingLOD(e,t,n,s){if(this.root===null)return;const l=this.frustum.setFromProjectionMatrix(e);h(this.root,63,null);function h(d,f,_){const g=d.box;if(_===null&&(_=p(g)),d.object!==void 0){l.isIntersected(g,f)&&s(d,_,l,f);return}if(f=l.intersectsBoxMask(g,f),!(f<0)){if(f===0){c(d.left,_),c(d.right,_);return}h(d.left,f,_),h(d.right,f,_)}}function c(d,f){if(f===null&&(f=p(d.box)),d.object!==void 0){s(d,f,l,0);return}c(d.left,f),c(d.right,f)}function p(d){const{min:f,max:_}=fm(d,t);for(let g=n.length-1;g>0;g--)if(_>=n[g])return f>=n[g]?g:null;return 0}}closestPointToPoint(e,t){if(this.root===null)return;let n=1/0;return s(this.root),Math.sqrt(n);function s(l){if(l.object!==void 0){if(t){const p=t(l.object)??bn(l.box,e);p<n&&(n=p)}else n=bn(l.box,e);return}const h=bn(l.left.box,e),c=bn(l.right.box,e);h<c?h<n&&(s(l.left),c<n&&s(l.right)):c<n&&(s(l.right),h<n&&s(l.left))}}}function qa(r,e){return e[0]=r.x,e[1]=r.y,e[2]=r.z,e}function Wa(r,e){const t=r.min,n=r.max;return e[0]=t.x,e[1]=n.x,e[2]=t.y,e[3]=n.y,e[4]=t.z,e[5]=n.z,e}class Ih{constructor(e,t,n){if(this.isInstanceEntity=!0,this.position=new ze,this.scale=new ze(1,1,1),this.quaternion=new Ml,this.id=t,this.owner=e,n){const s=this.quaternion,l=this.rotation=new fp;l._onChange(()=>s.setFromEuler(l,!1)),s._onChange(()=>l.setFromQuaternion(s,void 0,!1))}}get visible(){return this.owner.getVisibilityAt(this.id)}set visible(e){this.owner.setVisibilityAt(this.id,e)}get active(){return this.owner.getActiveAt(this.id)}set active(e){this.owner.setActiveAt(this.id,e)}get color(){return this.owner.getColorAt(this.id)}set color(e){this.owner.setColorAt(this.id,e)}get opacity(){return this.owner.getOpacityAt(this.id)}set opacity(e){this.owner.setOpacityAt(this.id,e)}get morph(){return this.owner.getMorphAt(this.id)}set morph(e){this.owner.setMorphAt(this.id,e)}get matrix(){return this.owner.getMatrixAt(this.id)}get matrixWorld(){return this.matrix.premultiply(this.owner.matrixWorld)}setMatrixIdentity(){const e=this.owner,t=e.matricesTexture._data,n=this.id,s=n*16;t[s+0]=1,t[s+1]=0,t[s+2]=0,t[s+3]=0,t[s+4]=0,t[s+5]=1,t[s+6]=0,t[s+7]=0,t[s+8]=0,t[s+9]=0,t[s+10]=1,t[s+11]=0,t[s+12]=0,t[s+13]=0,t[s+14]=0,t[s+15]=1,e.matricesTexture.enqueueUpdate(n)}updateMatrix(){const e=this.owner,t=this.position,n=this.quaternion,s=this.scale,l=e.matricesTexture._data,h=this.id,c=h*16,p=n._x,d=n._y,f=n._z,_=n._w,g=p+p,v=d+d,y=f+f,b=p*g,x=p*v,w=p*y,E=d*v,T=d*y,O=f*y,A=_*g,M=_*v,R=_*y,D=s.x,k=s.y,I=s.z;l[c+0]=(1-(E+O))*D,l[c+1]=(x+R)*D,l[c+2]=(w-M)*D,l[c+3]=0,l[c+4]=(x-R)*k,l[c+5]=(1-(b+O))*k,l[c+6]=(T+A)*k,l[c+7]=0,l[c+8]=(w+M)*I,l[c+9]=(T-A)*I,l[c+10]=(1-(b+E))*I,l[c+11]=0,l[c+12]=t.x,l[c+13]=t.y,l[c+14]=t.z,l[c+15]=1,e.matricesTexture.enqueueUpdate(h),e.bvh&&e.autoUpdateBVH&&e.bvh.move(h)}updateMatrixPosition(){const e=this.owner,t=this.position,n=e.matricesTexture._data,s=this.id,l=s*16;n[l+12]=t.x,n[l+13]=t.y,n[l+14]=t.z,e.matricesTexture.enqueueUpdate(s),e.bvh&&e.autoUpdateBVH&&e.bvh.move(s)}getUniform(e,t){return this.owner.getUniformAt(this.id,e,t)}updateBones(e=!0,t){this.owner.setBonesAt(this.id,e,t)}setUniform(e,t){this.owner.setUniformAt(this.id,e,t)}copyTo(e){e.position.copy(this.position),e.scale.copy(this.scale),e.quaternion.copy(this.quaternion),this.rotation&&e.rotation.copy(this.rotation)}applyMatrix4(e){return this.matrix.premultiply(e).decompose(this.position,this.quaternion,this.scale),this}applyQuaternion(e){return this.quaternion.premultiply(e),this}rotateOnAxis(e,t){return Jn.setFromAxisAngle(e,t),this.quaternion.multiply(Jn),this}rotateOnWorldAxis(e,t){return Jn.setFromAxisAngle(e,t),this.quaternion.premultiply(Jn),this}rotateX(e){return this.rotateOnAxis(Xa,e)}rotateY(e){return this.rotateOnAxis(Qa,e)}rotateZ(e){return this.rotateOnAxis(Ja,e)}translateOnAxis(e,t){return Za.copy(e).applyQuaternion(this.quaternion),this.position.add(Za.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Xa,e)}translateY(e){return this.translateOnAxis(Qa,e)}translateZ(e){return this.translateOnAxis(Ja,e)}remove(){return this.owner.removeInstances(this.id),this}}const Jn=new Ml,Za=new ze,Xa=new ze(1,0,0),Qa=new ze(0,1,0),Ja=new ze(0,0,1);class ym{constructor(e,t=0,n=!1,s=!0){this.nodesMap=new Map,this.LODsMap=new Map,this._geoBoundingSphere=null,this._sphereTarget=null,this.target=e,this.accurateCulling=s,this._margin=t;const l=e._geometry;if(l.boundingBox||l.computeBoundingBox(),this.geoBoundingBox=l.boundingBox,n){l.boundingSphere||l.computeBoundingSphere();const h=l.boundingSphere.center;h.x===0&&h.y===0&&h.z===0?(this._geoBoundingSphere=l.boundingSphere,this._sphereTarget={centerX:0,centerY:0,centerZ:0,maxScale:0}):(console.warn('"getBoxFromSphere" is ignored because geometry is not centered.'),n=!1)}this.bvh=new xm(new _m,go),this._origin=new Float32Array(3),this._dir=new Float32Array(3),this._cameraPos=new Float32Array(3),this._getBoxFromSphere=n}create(){const e=this.target._instancesCount,t=this.target._instancesArrayCount,n=new Array(e),s=new Uint32Array(e);let l=0;this.clear();for(let h=0;h<t;h++)this.target.getActiveAt(h)&&(n[l]=this.getBox(h,new Float32Array(6)),s[l]=h,l++);this.bvh.createFromArray(s,n,h=>{this.nodesMap.set(h.object,h)},this._margin)}insert(e){const t=this.bvh.insert(e,this.getBox(e,new Float32Array(6)),this._margin);this.nodesMap.set(e,t)}insertRange(e){const t=e.length,n=new Array(t);for(let s=0;s<t;s++)n[s]=this.getBox(e[s],new Float32Array(6));this.bvh.insertRange(e,n,this._margin,s=>{this.nodesMap.set(s.object,s)})}move(e){const t=this.nodesMap.get(e);t&&(this.getBox(e,t.box),this.bvh.move(t,this._margin))}delete(e){const t=this.nodesMap.get(e);t&&(this.bvh.delete(t),this.nodesMap.delete(e))}clear(){this.bvh.clear(),this.nodesMap.clear()}frustumCulling(e,t){this._margin>0&&this.accurateCulling?this.bvh.frustumCulling(e.elements,(n,s,l)=>{s.isIntersectedMargin(n.box,l,this._margin)&&t(n)}):this.bvh.frustumCulling(e.elements,t)}frustumCullingLOD(e,t,n,s){this.LODsMap.has(n)||this.LODsMap.set(n,new Float32Array(n.length));const l=this.LODsMap.get(n);for(let c=0;c<n.length;c++)l[c]=n[c].distance;const h=this._cameraPos;h[0]=t.x,h[1]=t.y,h[2]=t.z,this._margin>0&&this.accurateCulling?this.bvh.frustumCullingLOD(e.elements,h,l,(c,p,d,f)=>{d.isIntersectedMargin(c.box,f,this._margin)&&s(c,p)}):this.bvh.frustumCullingLOD(e.elements,h,l,s)}raycast(e,t){const n=e.ray,s=this._origin,l=this._dir;qa(n.origin,s),qa(n.direction,l),this.bvh.rayIntersections(l,s,t,e.near,e.far)}intersectBox(e,t){this._boxArray||(this._boxArray=new Float32Array(6));const n=this._boxArray;return Wa(e,n),this.bvh.intersectsBox(n,t)}getBox(e,t){if(this._getBoxFromSphere){const n=this.target.matricesTexture._data,{centerX:s,centerY:l,centerZ:h,maxScale:c}=this.getSphereFromMatrix_centeredGeometry(e,n,this._sphereTarget),p=this._geoBoundingSphere.radius*c;t[0]=s-p,t[1]=s+p,t[2]=l-p,t[3]=l+p,t[4]=h-p,t[5]=h+p}else el.copy(this.geoBoundingBox).applyMatrix4(this.target.getMatrixAt(e)),Wa(el,t);return t}getSphereFromMatrix_centeredGeometry(e,t,n){const s=e*16,l=t[s+0],h=t[s+1],c=t[s+2],p=t[s+4],d=t[s+5],f=t[s+6],_=t[s+8],g=t[s+9],v=t[s+10],y=l*l+h*h+c*c,b=p*p+d*d+f*f,x=_*_+g*g+v*v;return n.maxScale=Math.sqrt(Math.max(y,b,x)),n.centerX=t[s+12],n.centerY=t[s+13],n.centerZ=t[s+14],n}}const el=new eo;class wm extends mp{constructor(e,t,n,s,l,h=1){const c=e.createBuffer();super(c,t,n,s,l.length/n),this.isGLInstancedBufferAttribute=!0,this._needsUpdate=!1,this.isInstancedBufferAttribute=!0,this.meshPerAttribute=h,this.array=l,this._cacheArray=l,e.bindBuffer(e.ARRAY_BUFFER,c),e.bufferData(e.ARRAY_BUFFER,l,e.DYNAMIC_DRAW)}update(e,t){if(!this._needsUpdate||t===0)return;const n=e.getContext();n.bindBuffer(n.ARRAY_BUFFER,this.buffer),this.array===this._cacheArray?n.bufferSubData(n.ARRAY_BUFFER,0,this.array,0,t):(n.bufferData(n.ARRAY_BUFFER,this.array,n.DYNAMIC_DRAW),this._cacheArray=this.array),this._needsUpdate=!1}clone(){return this}}let Os=null,bs=null;const yr={};function Em(r){var e;return((e=bs.get(r))==null?void 0:e())??Os(r)}function Cm(r){if(bs.has(r))return;const e={};bs.set(r,()=>{if(r.isMeshDistanceMaterial){const t=Os(r);e.light=t.light}return e})}function Tm(r,e,t){const n=e.properties;Os=n.get;const s=`${!!r.colorsTexture}_${r._useOpacity}_${!!r.boneTexture}_${!!r.uniformsTexture}`;yr[s]??(yr[s]=new WeakMap),bs=yr[s],n.get=Em,Cm(t)}function Sm(r){r.properties.get=Os}function Bh(r,e){return Math.max(e,Math.ceil(Math.sqrt(r/e))*e)}function Pm(r,e,t,n){e===3&&(console.warn('"channels" cannot be 3. Set to 4. More info: https://github.com/mrdoob/three.js/pull/23228'),e=4);const s=Bh(n,t),l=new r(s*s*e),h=r.name.includes("Float"),c=r.name.includes("Uint"),p=h?Jr:c?Rl:_p;let d;switch(e){case 1:d=h?Qr:yp;break;case 2:d=h?bp:xp;break;case 4:d=h?vp:gp;break}return{array:l,size:s,type:p,format:d}}class xs extends Xr{constructor(e,t,n,s,l,h){t===3&&(t=4);const{array:c,format:p,size:d,type:f}=Pm(e,t,n,s);super(c,d,d,p,f),this.partialUpdate=!0,this.maxUpdateCalls=1/0,this._utils=null,this._needsUpdate=!0,this._lastWidth=-1,this._data=c,this._channels=t,this._pixelsPerInstance=n,this._stride=n*t,this._rowToUpdate=new Array(d),this._uniformMap=l,this._fetchUniformsInFragmentShader=h,this.needsUpdate=!0}resize(e){const t=Bh(e,this._pixelsPerInstance);if(t===this.image.width)return;const n=this._data,s=this._channels;this._rowToUpdate.length=t;const l=n.constructor,h=new l(t*t*s),c=Math.min(n.length,h.length);h.set(new l(n.buffer,0,c)),this.dispose(),this.image={data:h,height:t,width:t},this._data=h}enqueueUpdate(e){if(this._needsUpdate=!0,!this.partialUpdate)return;const t=this.image.width/this._pixelsPerInstance,n=Math.floor(e/t);this._rowToUpdate[n]=!0}bindToProgram(e,t,n,s,l){if(!s[l])return;s[l].value=this;const h=this.getSlot(n,l);if(h===void 0)return;const c=e.properties.get(this);e.state.bindTexture(t.TEXTURE_2D,c.__webglTexture,t.TEXTURE0+h)}update(e,t,n){const s=e.properties.get(this),l=s.__version!==this.version;if(!this._needsUpdate&&!l)return;const h=this._lastWidth!==this.image.width;if(!s.__webglTexture||h)e.initTexture(this);else{const c=this.getSlot(t,n)??e.capabilities.maxTextures-1;this.partialUpdate?this.updatePartial(s,e,c):this.updateFull(s,e,c),s.__version=this.version}this._lastWidth=this.image.width,this._needsUpdate=!1}getSlot(e,t){var n;return(n=e[t])==null?void 0:n.cache[0]}updateFull(e,t,n){this.updateRows(e,t,[{row:0,count:this.image.height}],n)}updatePartial(e,t,n){const s=this.getUpdateRowsInfo();s.length!==0&&(s.length>this.maxUpdateCalls?this.updateFull(e,t,n):this.updateRows(e,t,s,n),this._rowToUpdate.fill(!1))}getUpdateRowsInfo(){const e=this._rowToUpdate,t=[];for(let n=0,s=e.length;n<s;n++)if(e[n]){const l=n;for(;n<s&&e[n];n++);t.push({row:l,count:n-l})}return t}updateRows(e,t,n,s){var l;const h=t.getContext();this._utils??(this._utils=new pp(h,t.extensions,t.capabilities));const c=this._utils.convert(this.format),p=this._utils.convert(this.type),{data:d,width:f}=this.image,_=this._channels;t.state.activeTexture(h.TEXTURE0+s),t.state.bindTexture(h.TEXTURE_2D,e.__webglTexture,h.TEXTURE0+s);const g=ss.getPrimaries(ss.workingColorSpace),v=this.colorSpace===ls?null:ss.getPrimaries(this.colorSpace),y=this.colorSpace===ls||g===v?h.NONE:h.BROWSER_DEFAULT_WEBGL;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,this.flipY),h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),h.pixelStorei(h.UNPACK_ALIGNMENT,this.unpackAlignment),h.pixelStorei(h.UNPACK_COLORSPACE_CONVERSION_WEBGL,y);for(const{count:b,row:x}of n)h.texSubImage2D(h.TEXTURE_2D,0,0,x,f,b,c,p,d,x*f*_);(l=this.onUpdate)==null||l.call(this,this)}setUniformAt(e,t,n){const{offset:s,size:l}=this._uniformMap.get(t),h=this._stride;l===1?this._data[e*h+s]=n:n.toArray(this._data,e*h+s)}getUniformAt(e,t,n){const{offset:s,size:l}=this._uniformMap.get(t),h=this._stride;return l===1?this._data[e*h+s]:n.fromArray(this._data,e*h+s)}getUniformsGLSL(e,t,n){const s=this.getUniformsVertexGLSL(e,t,n),l=this.getUniformsFragmentGLSL(e,t,n);return{vertex:s,fragment:l}}getUniformsVertexGLSL(e,t,n){if(this._fetchUniformsInFragmentShader)return`
        flat varying ${n} ez_v${t}; 
        void main() {
          ez_v${t} = ${t};`;const s=this.texelsFetchGLSL(e,t),l=this.getFromTexelsGLSL(),{assignVarying:h,declareVarying:c}=this.getVarying();return`
      uniform highp sampler2D ${e};  
      ${c}
      void main() {
        ${s}
        ${l}
        ${h}`}getUniformsFragmentGLSL(e,t,n){if(!this._fetchUniformsInFragmentShader){const{declareVarying:h,getVarying:c}=this.getVarying();return`
      ${h}
      void main() {
        ${c}`}const s=this.texelsFetchGLSL(e,`ez_v${t}`),l=this.getFromTexelsGLSL();return`
      uniform highp sampler2D ${e};  
      flat varying ${n} ez_v${t};
      void main() {
        ${s}
        ${l}`}texelsFetchGLSL(e,t){const n=this._pixelsPerInstance;let s=`
      int size = textureSize(${e}, 0).x;
      int j = int(${t}) * ${n};
      int x = j % size;
      int y = j / size;
    `;for(let l=0;l<n;l++)s+=`vec4 ez_texel${l} = texelFetch(${e}, ivec2(x + ${l}, y), 0);
`;return s}getFromTexelsGLSL(){const e=this._uniformMap;let t="";for(const[n,{type:s,offset:l,size:h}]of e){const c=Math.floor(l/this._channels);if(s==="mat3")t+=`mat3 ${n} = mat3(ez_texel${c}.rgb, vec3(ez_texel${c}.a, ez_texel${c+1}.rg), vec3(ez_texel${c+1}.ba, ez_texel${c+2}.r));
`;else if(s==="mat4")t+=`mat4 ${n} = mat4(ez_texel${c}, ez_texel${c+1}, ez_texel${c+2}, ez_texel${c+3});
`;else{const p=this.getUniformComponents(l,h);t+=`${s} ${n} = ez_texel${c}.${p};
`}}return t}getVarying(){const e=this._uniformMap;let t="",n="",s="";for(const[l,{type:h}]of e)t+=`flat varying ${h} ez_v${l};
`,n+=`ez_v${l} = ${l};
`,s+=`${h} ${l} = ez_v${l};
`;return{declareVarying:t,assignVarying:n,getVarying:s}}getUniformComponents(e,t){const n=e%this._channels;let s="";for(let l=0;l<t;l++)s+=Om[n+l];return s}copy(e){return super.copy(e),this.partialUpdate=e.partialUpdate,this.maxUpdateCalls=e.maxUpdateCalls,this._channels=e._channels,this._pixelsPerInstance=e._pixelsPerInstance,this._stride=e._stride,this._rowToUpdate=e._rowToUpdate,this._uniformMap=e._uniformMap,this._fetchUniformsInFragmentShader=e._fetchUniformsInFragmentShader,this}}const Om=["r","g","b","a"];class B extends Es{constructor(e,t,n={},s){if(!e)throw new Error('"geometry" is mandatory.');if(!t)throw new Error('"material" is mandatory.');const{allowsEuler:l,renderer:h,createEntities:c}=n;super(e,null),this.type="InstancedMesh2",this.isInstancedMesh2=!0,this.instances=null,this.instanceIndex=null,this.colorsTexture=null,this.morphTexture=null,this.boneTexture=null,this.uniformsTexture=null,this.boundingBox=null,this.boundingSphere=null,this.bvh=null,this.customSort=null,this.raycastOnlyFrustum=!1,this.LODinfo=null,this.autoUpdate=!0,this.bindMode=Ea,this.bindMatrix=null,this.bindMatrixInverse=null,this.skeleton=null,this.autoUpdateBVH=!0,this.onFrustumEnter=null,this._renderer=null,this._instancesCount=0,this._instancesArrayCount=0,this._perObjectFrustumCulled=!0,this._sortObjects=!1,this._indexArrayNeedsUpdate=!1,this._useOpacity=!1,this._currentMaterial=null,this._customProgramCacheKeyBase=null,this._onBeforeCompileBase=null,this._freeIds=[],this.isInstancedMesh=!0,this.instanceMatrix=new up(new Float32Array(0),16),this.instanceColor=null,this._customProgramCacheKey=()=>`ez_${!!this.colorsTexture}_${this._useOpacity}_${!!this.boneTexture}_${!!this.uniformsTexture}_${this._customProgramCacheKeyBase.call(this._currentMaterial)}`,this._onBeforeCompile=(d,f)=>{if(this._onBeforeCompileBase&&this._onBeforeCompileBase.call(this._currentMaterial,d,f),d.defines??(d.defines={}),d.defines.USE_INSTANCING_INDIRECT="",d.uniforms.matricesTexture={value:this.matricesTexture},this.uniformsTexture){d.uniforms.uniformsTexture={value:this.uniformsTexture};const{vertex:_,fragment:g}=this.uniformsTexture.getUniformsGLSL("uniformsTexture","instanceIndex","uint");d.vertexShader=d.vertexShader.replace("void main() {",_),d.fragmentShader=d.fragmentShader.replace("void main() {",g)}this.colorsTexture&&d.fragmentShader.includes("#include <color_pars_fragment>")&&(d.defines.USE_INSTANCING_COLOR_INDIRECT="",d.uniforms.colorsTexture={value:this.colorsTexture},d.vertexShader=d.vertexShader.replace("<color_vertex>","<instanced_color_vertex>"),d.vertexColors&&(d.defines.USE_VERTEX_COLOR=""),this._useOpacity?d.defines.USE_COLOR_ALPHA="":d.defines.USE_COLOR=""),this.boneTexture&&(d.defines.USE_SKINNING="",d.defines.USE_INSTANCING_SKINNING="",d.uniforms.bindMatrix={value:this.bindMatrix},d.uniforms.bindMatrixInverse={value:this.bindMatrixInverse},d.uniforms.bonesPerInstance={value:this.skeleton.bones.length},d.uniforms.boneTexture={value:this.boneTexture})};const p=n.capacity>0?n.capacity:Am;this._renderer=h,this._capacity=p,this._parentLOD=s,this._geometry=e,this.material=t,this._allowsEuler=l??!1,this._tempInstance=new Ih(this,-1,l),this.availabilityArray=s?.availabilityArray??new Array(p*2),this._createEntities=c,this.initLastRenderInfo(),this.initIndexAttribute(),this.initMatricesTexture()}get capacity(){return this._capacity}get instancesCount(){return this._instancesCount}get perObjectFrustumCulled(){return this._perObjectFrustumCulled}set perObjectFrustumCulled(e){this._perObjectFrustumCulled=e,this._indexArrayNeedsUpdate=!0}get sortObjects(){return this._sortObjects}set sortObjects(e){this._sortObjects=e,this._indexArrayNeedsUpdate=!0}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.patchGeometry(e)}onBeforeShadow(e,t,n,s,l,h,c){this.patchMaterial(e,h),this.updateTextures(e,h);const p=e.info.render.frame;this.instanceIndex&&this.autoUpdate&&!this.frustumCullingAlreadyPerformed(p,n,s)&&this.performFrustumCulling(s,n),this.count!==0&&(this.instanceIndex.update(this._renderer,this.count),this.bindTextures(e,h))}onBeforeRender(e,t,n,s,l,h){if(this.patchMaterial(e,l),this.updateTextures(e,l),!this.instanceIndex){this._renderer=e;return}const c=e.info.render.frame;this.autoUpdate&&!this.frustumCullingAlreadyPerformed(c,n,null)&&this.performFrustumCulling(n),this.count!==0&&(this.instanceIndex.update(this._renderer,this.count),this.bindTextures(e,l))}onAfterShadow(e,t,n,s,l,h,c){this.unpatchMaterial(e,h)}onAfterRender(e,t,n,s,l,h){this.unpatchMaterial(e,l),!(this.instanceIndex||h&&!this.isLastGroup(h.materialIndex))&&this.initIndexAttribute()}updateTextures(e,t){var n,s,l;const h=e.properties.get(t);this.matricesTexture.update(e,h,"matricesTexture"),(n=this.colorsTexture)==null||n.update(e,h,"colorsTexture"),(s=this.uniformsTexture)==null||s.update(e,h,"uniformsTexture"),(l=this.boneTexture)==null||l.update(e,h,"boneTexture")}bindTextures(e,t){var n,s,l;const h=e.properties.get(t),c=h.uniforms;if(!c)return;const p=h.currentProgram,d=p?.program;if(!d)return;const f=e.getContext(),_=p.getUniforms().map,g=f.getParameter(f.CURRENT_PROGRAM);e.state.useProgram(d),this.matricesTexture.bindToProgram(e,f,_,c,"matricesTexture"),(n=this.colorsTexture)==null||n.bindToProgram(e,f,_,c,"colorsTexture"),(s=this.uniformsTexture)==null||s.bindToProgram(e,f,_,c,"uniformsTexture"),(l=this.boneTexture)==null||l.bindToProgram(e,f,_,c,"boneTexture"),e.state.useProgram(g)}isLastGroup(e){const t=this.material;for(let n=t.length-1;n>=e;n--)if(t[n].visible)return n===e}initIndexAttribute(){if(!this._renderer){this.count=0;return}const e=this._renderer.getContext(),t=this._capacity,n=new Uint32Array(t);for(let s=0;s<t;s++)n[s]=s;this.instanceIndex=new wm(e,e.UNSIGNED_INT,1,4,n),this._geometry.setAttribute("instanceIndex",this.instanceIndex)}initLastRenderInfo(){this._parentLOD||(this._lastRenderInfo={frame:-1,camera:null,shadowCamera:null})}initMatricesTexture(){this._parentLOD||(this.matricesTexture=new xs(Float32Array,4,4,this._capacity))}initColorsTexture(){this._parentLOD||(this.colorsTexture=new xs(Float32Array,4,1,this._capacity),this.colorsTexture.colorSpace=ss.workingColorSpace,this.colorsTexture._data.fill(1),this.materialsNeedsUpdate())}materialsNeedsUpdate(){if(this.material.isMaterial){this.material.needsUpdate=!0;return}for(const e of this.material)e.needsUpdate=!0}patchGeometry(e){const t=e.getAttribute("instanceIndex");if(t){if(t===this.instanceIndex)return;console.warn("The geometry has been cloned because it was already used."),e=e.clone(),e.deleteAttribute("instanceIndex")}this.instanceIndex&&e.setAttribute("instanceIndex",this.instanceIndex)}patchMaterial(e,t){this._currentMaterial=t,this._customProgramCacheKeyBase=t.customProgramCacheKey,this._onBeforeCompileBase=t.onBeforeCompile,t.customProgramCacheKey=this._customProgramCacheKey,t.onBeforeCompile=this._onBeforeCompile,Tm(this,e,t)}unpatchMaterial(e,t){this._currentMaterial=null,Sm(e),t.onBeforeCompile=this._onBeforeCompileBase,t.customProgramCacheKey=this._customProgramCacheKeyBase,this._onBeforeCompileBase=null,this._customProgramCacheKeyBase=null}computeBVH(e={}){this.bvh||(this.bvh=new ym(this,e.margin,e.getBBoxFromBSphere,e.accurateCulling)),this.bvh.clear(),this.bvh.create()}disposeBVH(){this.bvh=null}setMatrixAt(e,t){if(t.toArray(this.matricesTexture._data,e*16),this.instances){const n=this.instances[e];t.decompose(n.position,n.quaternion,n.scale)}this.matricesTexture.enqueueUpdate(e),this.bvh&&this.autoUpdateBVH&&this.bvh.move(e)}getMatrixAt(e,t=Mm){return t.fromArray(this.matricesTexture._data,e*16)}getPositionAt(e,t=Rm){const n=e*16,s=this.matricesTexture._data;return t.x=s[n+12],t.y=s[n+13],t.z=s[n+14],t}getPositionAndMaxScaleOnAxisAt(e,t){const n=e*16,s=this.matricesTexture._data,l=s[n+0],h=s[n+1],c=s[n+2],p=l*l+h*h+c*c,d=s[n+4],f=s[n+5],_=s[n+6],g=d*d+f*f+_*_,v=s[n+8],y=s[n+9],b=s[n+10],x=v*v+y*y+b*b;return t.x=s[n+12],t.y=s[n+13],t.z=s[n+14],Math.sqrt(Math.max(p,g,x))}applyMatrixAtToSphere(e,t,n,s){const l=e*16,h=this.matricesTexture._data,c=h[l+0],p=h[l+1],d=h[l+2],f=h[l+3],_=h[l+4],g=h[l+5],v=h[l+6],y=h[l+7],b=h[l+8],x=h[l+9],w=h[l+10],E=h[l+11],T=h[l+12],O=h[l+13],A=h[l+14],M=h[l+15],R=t.center,D=n.x,k=n.y,I=n.z,H=1/(f*D+y*k+E*I+M);R.x=(c*D+_*k+b*I+T)*H,R.y=(p*D+g*k+x*I+O)*H,R.z=(d*D+v*k+w*I+A)*H;const K=c*c+p*p+d*d,ee=_*_+g*g+v*v,q=b*b+x*x+w*w;t.radius=s*Math.sqrt(Math.max(K,ee,q))}setVisibilityAt(e,t){this.availabilityArray[e*2]=t,this._indexArrayNeedsUpdate=!0}getVisibilityAt(e){return this.availabilityArray[e*2]}setActiveAt(e,t){this.availabilityArray[e*2+1]=t,this._indexArrayNeedsUpdate=!0}getActiveAt(e){return this.availabilityArray[e*2+1]}getActiveAndVisibilityAt(e){const t=e*2,n=this.availabilityArray;return n[t]&&n[t+1]}setActiveAndVisibilityAt(e,t){const n=e*2,s=this.availabilityArray;s[n]=t,s[n+1]=t,this._indexArrayNeedsUpdate=!0}setColorAt(e,t){this.colorsTexture===null&&this.initColorsTexture(),t.isColor?t.toArray(this.colorsTexture._data,e*4):nl.set(t).toArray(this.colorsTexture._data,e*4),this.colorsTexture.enqueueUpdate(e)}getColorAt(e,t=nl){return t.fromArray(this.colorsTexture._data,e*4)}setOpacityAt(e,t){this._useOpacity||(this.colorsTexture===null?this.initColorsTexture():this.materialsNeedsUpdate(),this._useOpacity=!0),this.colorsTexture._data[e*4+3]=t,this.colorsTexture.enqueueUpdate(e)}getOpacityAt(e){return this._useOpacity?this.colorsTexture._data[e*4+3]:1}copyTo(e,t){this.getMatrixAt(e,t.matrix).decompose(t.position,t.quaternion,t.scale)}computeBoundingBox(){const e=this._geometry,t=this._instancesArrayCount;this.boundingBox??(this.boundingBox=new eo),e.boundingBox===null&&e.computeBoundingBox();const n=e.boundingBox,s=this.boundingBox;s.makeEmpty();for(let l=0;l<t;l++)this.getActiveAt(l)&&(tl.copy(n).applyMatrix4(this.getMatrixAt(l)),s.union(tl))}computeBoundingSphere(){const e=this._geometry,t=this._instancesArrayCount;this.boundingSphere??(this.boundingSphere=new Cs),e.boundingSphere===null&&e.computeBoundingSphere();const n=e.boundingSphere,s=this.boundingSphere;s.makeEmpty();for(let l=0;l<t;l++)this.getActiveAt(l)&&(il.copy(n).applyMatrix4(this.getMatrixAt(l)),s.union(il))}clone(e){const t={capacity:this._capacity,renderer:this._renderer,allowsEuler:this._allowsEuler,createEntities:this._createEntities};return new this.constructor(this.geometry,this.material,t).copy(this,e)}copy(e,t){return super.copy(e,t),this.count=e._capacity,this._instancesCount=e._instancesCount,this._instancesArrayCount=e._instancesArrayCount,this._capacity=e._capacity,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this.matricesTexture=e.matricesTexture.clone(),this.matricesTexture.image.data=this.matricesTexture.image.data.slice(),e.colorsTexture!==null&&(this.colorsTexture=e.colorsTexture.clone(),this.colorsTexture.image.data=this.colorsTexture.image.data.slice()),e.uniformsTexture!==null&&(this.uniformsTexture=e.uniformsTexture.clone(),this.uniformsTexture.image.data=this.uniformsTexture.image.data.slice()),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone(),this.morphTexture.image.data=this.morphTexture.image.data.slice()),e.boneTexture!==null&&(this.boneTexture=e.boneTexture.clone(),this.boneTexture.image.data=this.boneTexture.image.data.slice()),this}dispose(){var e,t,n,s;this.dispatchEvent({type:"dispose"}),this.matricesTexture.dispose(),(e=this.colorsTexture)==null||e.dispose(),(t=this.morphTexture)==null||t.dispose(),(n=this.boneTexture)==null||n.dispose(),(s=this.uniformsTexture)==null||s.dispose()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMatrixInverse&&(this.bindMode===Ea?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===dp?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("Unrecognized bindMode: "+this.bindMode))}}const Am=1e3,tl=new eo,il=new Cs,Mm=new Ui,nl=new as,Rm=new ze;B.prototype.resizeBuffers=function(r){var e;const t=this._capacity;this._capacity=r;const n=Math.min(r,t);if(this.instanceIndex){const s=new Uint32Array(r);s.set(new Uint32Array(this.instanceIndex.array.buffer,0,n)),this.instanceIndex.array=s}if(this.LODinfo){for(const s of this.LODinfo.objects)if(s._capacity=r,s.instanceIndex){const l=new Uint32Array(r);l.set(new Uint32Array(s.instanceIndex.array.buffer,0,n)),s.instanceIndex.array=l}}if(this.availabilityArray.length=r*2,this.matricesTexture.resize(r),this.colorsTexture&&(this.colorsTexture.resize(r),r>t&&this.colorsTexture._data.fill(1,t*4)),this.morphTexture){const s=this.morphTexture.image.data,l=s.length/t;this.morphTexture.dispose(),this.morphTexture=new Xr(new Float32Array(l*r),l,r,Qr,Jr),this.morphTexture.image.data.set(s)}return(e=this.uniformsTexture)==null||e.resize(r),this};B.prototype.setInstancesArrayCount=function(r){if(r<this._instancesArrayCount){const t=this.bvh;if(t)for(let n=this._instancesArrayCount-1;n>=r;n--)this.getActiveAt(n)&&t.delete(n);this._instancesArrayCount=r;return}if(r>this._capacity){let t=this._capacity+(this._capacity>>1)+512;for(;t<r;)t+=(t>>1)+512;this.resizeBuffers(t)}const e=this._instancesArrayCount;this._instancesArrayCount=r,this._createEntities&&this.createEntities(e)};function Nh(r,e){return r.depth-e.depth}function Fh(r,e){return e.depth-r.depth}class Dm{constructor(){this.array=[],this.pool=[]}push(e,t){const n=this.pool,s=this.array,l=s.length;l>=n.length&&n.push({depth:null,index:null,depthSort:null});const h=n[l];h.depth=e,h.index=t,s.push(h)}reset(){this.array.length=0}}const ys=new wp,Qe=new Dm,hi=new Ui,ki=new Ui,As=new ze,Dn=new ze,Li=new ze,km=new ze,Xe=new Cs;B.prototype.performFrustumCulling=function(r,e=r){const t=this._parentLOD??this,n=t.LODinfo;let s;if(n){s=r!==e?n.shadowRender??n.render:n.render;for(const l of n.objects)l.count=0}else t.count=0;t._instancesArrayCount!==0&&(s?.levels.length>0?t.frustumCullingLOD(s,r,e):t.frustumCulling(r))};B.prototype.frustumCullingAlreadyPerformed=function(r,e,t){const n=this._lastRenderInfo;return n.frame===r&&n.camera===e&&n.shadowCamera===t?!0:(n.frame=r,n.camera=e,n.shadowCamera=t,!1)};B.prototype.frustumCulling=function(r){var e;const t=this._sortObjects,n=this._perObjectFrustumCulled,s=this.instanceIndex.array;if(this.instanceIndex._needsUpdate=!0,!n&&!t){this.updateIndexArray();return}if(t&&(ki.copy(this.matrixWorld).invert(),Dn.setFromMatrixPosition(r.matrixWorld).applyMatrix4(ki),As.set(0,0,-1).transformDirection(r.matrixWorld).transformDirection(ki)),n?(hi.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse).multiply(this.matrixWorld),this.bvh?this.BVHCulling(r):this.linearCulling(r)):this.updateRenderList(),t){const l=this.customSort;l===null?Qe.array.sort((e=this.material)!=null&&e.transparent?Fh:Nh):l(Qe.array);const h=Qe.array,c=h.length;for(let p=0;p<c;p++)s[p]=h[p].index;this.count=c,Qe.reset()}};B.prototype.updateIndexArray=function(){if(!this._indexArrayNeedsUpdate)return;const r=this.instanceIndex.array,e=this._instancesArrayCount;let t=0;for(let n=0;n<e;n++)this.getActiveAndVisibilityAt(n)&&(r[t++]=n);this.count=t,this._indexArrayNeedsUpdate=!1};B.prototype.updateRenderList=function(){const r=this._instancesArrayCount;for(let e=0;e<r;e++)if(this.getActiveAndVisibilityAt(e)){const t=this.getPositionAt(e).sub(Dn).dot(As);Qe.push(t,e)}};B.prototype.BVHCulling=function(r){const e=this.instanceIndex.array,t=this._instancesArrayCount,n=this._sortObjects,s=this.onFrustumEnter;let l=0;this.bvh.frustumCulling(hi,h=>{const c=h.object;if(c<t&&this.getVisibilityAt(c)&&(!s||s(c,r)))if(n){const p=this.getPositionAt(c).sub(Dn).dot(As);Qe.push(p,c)}else e[l++]=c}),this.count=l};B.prototype.linearCulling=function(r){const e=this.instanceIndex.array;this.geometry.boundingSphere||this.geometry.computeBoundingSphere();const t=this._geometry.boundingSphere,n=t.radius,s=t.center,l=this._instancesArrayCount,h=s.x===0&&s.y===0&&s.z===0,c=this._sortObjects,p=this.onFrustumEnter;let d=0;ys.setFromProjectionMatrix(hi);for(let f=0;f<l;f++)if(this.getActiveAndVisibilityAt(f)){if(h){const _=this.getPositionAndMaxScaleOnAxisAt(f,Xe.center);Xe.radius=n*_}else this.applyMatrixAtToSphere(f,Xe,s,n);if(ys.intersectsSphere(Xe)&&(!p||p(f,r)))if(c){const _=km.subVectors(Xe.center,Dn).dot(As);Qe.push(_,f)}else e[d++]=f}this.count=d};B.prototype.frustumCullingLOD=function(r,e,t){var n,s;const{count:l,levels:h}=r,c=e===t&&this._sortObjects;for(let d=0;d<h.length;d++)l[d]=0,h[d].object.instanceIndex&&(h[d].object.instanceIndex._needsUpdate=!0);hi.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse).multiply(this.matrixWorld),ki.copy(this.matrixWorld).invert(),Dn.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ki),Li.setFromMatrixPosition(t.matrixWorld).applyMatrix4(ki);const p=r.levels.map(d=>d.object.instanceIndex.array);if(this.bvh?this.BVHCullingLOD(r,p,c,e,t):this.linearCullingLOD(r,p,c,e,t),c){const d=this.customSort,f=Qe.array;let _=0,g=h[1].distance;d===null?f.sort((n=h[0].object.material)!=null&&n.transparent?Fh:Nh):d(f);for(let v=0,y=f.length;v<y;v++){const b=f[v];b.depth>g&&(_++,g=((s=h[_+1])==null?void 0:s.distance)??1/0),p[_][l[_]++]=b.index}Qe.reset()}for(let d=0;d<h.length;d++){const f=h[d].object;f.count=l[d]}};B.prototype.BVHCullingLOD=function(r,e,t,n,s){const{count:l,levels:h}=r,c=this._instancesArrayCount,p=this.onFrustumEnter;t?this.bvh.frustumCulling(hi,d=>{const f=d.object;if(f<c&&this.getVisibilityAt(f)&&(!p||p(f,n,s))){const _=this.getPositionAt(f).distanceToSquared(Li);Qe.push(_,f)}}):this.bvh.frustumCullingLOD(hi,Li,h,(d,f)=>{const _=d.object;if(_<c&&this.getVisibilityAt(_)){if(f===null){const g=this.getPositionAt(_).distanceToSquared(Li);f=this.getObjectLODIndexForDistance(h,g)}(!p||p(_,n,s,f))&&(e[f][l[f]++]=_)}})};B.prototype.linearCullingLOD=function(r,e,t,n,s){const{count:l,levels:h}=r;this.geometry.boundingSphere||this.geometry.computeBoundingSphere();const c=this._geometry.boundingSphere,p=c.radius,d=c.center,f=this._instancesArrayCount,_=d.x===0&&d.y===0&&d.z===0,g=this.onFrustumEnter;ys.setFromProjectionMatrix(hi);for(let v=0;v<f;v++)if(this.getActiveAndVisibilityAt(v)){if(_){const y=this.getPositionAndMaxScaleOnAxisAt(v,Xe.center);Xe.radius=p*y}else this.applyMatrixAtToSphere(v,Xe,d,p);if(ys.intersectsSphere(Xe))if(t){if(!g||g(v,n,s))continue;const y=Xe.center.distanceToSquared(Li);Qe.push(y,v)}else{const y=Xe.center.distanceToSquared(Li),b=this.getObjectLODIndexForDistance(h,y);(!g||g(v,n,s,b))&&(e[b][l[b]++]=v)}}};B.prototype.clearTempInstance=function(r){const e=this._tempInstance;return e.id=r,this.clearInstance(e)};B.prototype.clearTempInstancePosition=function(r){const e=this._tempInstance;return e.id=r,e.position.set(0,0,0),e};B.prototype.clearInstance=function(r){return r.position.set(0,0,0),r.scale.set(1,1,1),r.quaternion.identity(),r};B.prototype.updateInstances=function(r){const e=this._instancesArrayCount,t=this.instances;for(let n=0;n<e;n++){if(!this.getActiveAt(n))continue;const s=t?t[n]:this.clearTempInstance(n);r(s,n),s.updateMatrix()}return this};B.prototype.updateInstancesPosition=function(r){const e=this._instancesArrayCount,t=this.instances;for(let n=0;n<e;n++){if(!this.getActiveAt(n))continue;const s=t?t[n]:this.clearTempInstancePosition(n);r(s,n),s.updateMatrixPosition()}return this};B.prototype.createEntities=function(r){const e=this._instancesArrayCount;if(!this.instances)this.instances=new Array(e);else if(this.instances.length<e)this.instances.length=e;else return this;const t=this.instances;for(let n=r;n<e;n++)t[n]||(t[n]=new Ih(this,n,this._allowsEuler));return this};B.prototype.addInstances=function(r,e){!e&&this.bvh&&console.warn("InstancedMesh2: if `computeBVH()` has already been called, it is better to valorize the instances in the `onCreation` callback for better performance.");const t=this._freeIds;if(t.length>0){let l=-1;const h=Math.min(t.length,r),c=t.length-h;for(let p=t.length-1;p>=c;p--){const d=t[p];d>l&&(l=d),this.addInstance(d,e)}t.length-=h,r-=h,this._instancesArrayCount=Math.max(l+1,this._instancesArrayCount)}const n=this._instancesArrayCount,s=n+r;this.setInstancesArrayCount(s);for(let l=n;l<s;l++)this.addInstance(l,e);return this};B.prototype.addInstance=function(r,e){var t;this._instancesCount++,this.setActiveAndVisibilityAt(r,!0);const n=this.instances?this.clearInstance(this.instances[r]):this.clearTempInstance(r);e?(e(n,r),n.updateMatrix()):n.setMatrixIdentity(),(t=this.bvh)==null||t.insert(r)};B.prototype.removeInstances=function(...r){const e=this._freeIds,t=this.bvh;for(const n of r)n<this._instancesArrayCount&&this.getActiveAt(n)&&(this.setActiveAt(n,!1),e.push(n),t?.delete(n),this._instancesCount--);for(let n=this._instancesArrayCount-1;n>=0&&!this.getActiveAt(n);n--)this._instancesArrayCount--;return this};B.prototype.clearInstances=function(){var r;if(this._instancesCount=0,this._instancesArrayCount=0,this._freeIds.length=0,(r=this.bvh)==null||r.clear(),this.LODinfo)for(const e of this.LODinfo.objects)e.count=0;return this};B.prototype.getObjectLODIndexForDistance=function(r,e){for(let t=r.length-1;t>0;t--){const n=r[t],s=n.distance-n.distance*n.hysteresis;if(e>=s)return t}return 0};B.prototype.setFirstLODDistance=function(r){if(this._parentLOD)throw new Error("Cannot create LOD for this InstancedMesh2.");return this.LODinfo||(this.LODinfo={render:null,shadowRender:null,objects:[this]}),this.LODinfo.render||(this.LODinfo.render={levels:[{distance:r,hysteresis:0,object:this}],count:[0]}),this};B.prototype.addLOD=function(r,e,t=0,n=0){var s;if(this._parentLOD)throw new Error("Cannot create LOD for this InstancedMesh2.");if(!((s=this.LODinfo)!=null&&s.render)&&t===0)throw new Error('Cannot set distance to 0 for the first LOD. Call "setFirstLODDistance" method before use "addLOD".');return this.setFirstLODDistance(0),this.addLevel(this.LODinfo.render,r,e,t,n),this};B.prototype.addShadowLOD=function(r,e=0,t=0){if(this._parentLOD)throw new Error("Cannot create LOD for this InstancedMesh2.");this.LODinfo||(this.LODinfo={render:null,shadowRender:null,objects:[this]}),this.LODinfo.shadowRender||(this.LODinfo.shadowRender={levels:[],count:[]});const n=this.addLevel(this.LODinfo.shadowRender,r,null,e,t);return n.castShadow=!0,this.castShadow=!0,this};B.prototype.addLevel=function(r,e,t,n,s){const l=this.LODinfo.objects,h=r.levels;let c,p;n=n**2;const d=l.findIndex(f=>f.geometry===e);if(d===-1){const f={capacity:this._capacity,renderer:this._renderer};p=new B(e,t??new Nt,f,this),p.frustumCulled=!1,this.patchLevel(p),l.push(p),this.add(p)}else p=l[d],t&&(p.material=t);for(c=0;c<h.length&&!(n<h[c].distance);c++);return h.splice(c,0,{distance:n,hysteresis:s,object:p}),r.count.push(0),p};B.prototype.updateLevel=function(r,e,t,n){if(!r)throw new Error("Render list is invalid.");const s=r.levels[e];if(!s)throw new Error("Cannot update an empty LOD.");if(t!=null&&!Number.isNaN(t)){const l=t**2;s.distance=l}return n!=null&&!Number.isNaN(n)&&(s.hysteresis=n),this};B.prototype.updateLOD=function(r,e,t){var n;const s=(n=this==null?void 0:this.LODinfo)==null?void 0:n.render;if(r===0)throw new Error("Cannot change distance for LOD0. It is the main mesh and must stay at 0.");return this.updateLevel(s,r,e,t)};B.prototype.updateShadowLOD=function(r,e,t){var n;return this.updateLevel((n=this.LODinfo)==null?void 0:n.shadowRender,r,e,t)};B.prototype.updateAllLevels=function(r,e,t){var n;if(!(r!=null&&r.levels))throw new Error("Invalid LOD list.");const s=r.levels,l=((n=this.LODinfo)==null?void 0:n.render)===r,h=l?1:0;l&&(s[0].distance=0);const c=e?.length>0;let p=[];c&&(p=l&&e[0]===0?e.slice(1,Math.min(s.length,e.length)):e.slice(0,Math.min(s.length-h,e.length)),p.every((f,_)=>{if(_>0&&f<=p[_-1])throw new Error(`LOD distances must be strictly increasing: d[${_-1}]=${p[_-1]} < d[${_}]=${f}`);return!0}));const d=c?p.length:s.length-h;for(let f=0;f<d;f++){const _=c?p[f]:void 0,g=Array.isArray(t)?t[f]:t;this.updateLevel(r,h+f,_,g)}return this};B.prototype.updateAllLOD=function(r,e){var t;return this.updateAllLevels((t=this.LODinfo)==null?void 0:t.render,r,e)};B.prototype.updateAllShadowLOD=function(r,e){var t;return this.updateAllLevels((t=this.LODinfo)==null?void 0:t.shadowRender,r,e)};B.prototype.disposeLOD=function(r){r.geometry.dispose();const e=r.material;if(Array.isArray(e))for(const t of e)t.dispose();else e.dispose()};B.prototype.removeLOD=function(r,e=!0){var t,n,s,l,h,c;const p=this.LODinfo,d=p?.render;if(!(d!=null&&d.levels))throw new Error("Invalid LOD list.");const f=d.levels.length;if(r<0||r>=f)throw new Error("Level index OOB");if(f>1&&r===0)throw new Error("Cannot remove LOD0 while others exist");const[_]=d.levels.splice(r,1);(n=(t=d.count)==null?void 0:t.splice)==null||n.call(t,r,1),d.levels.length<=1&&(p.render=null);const g=_.object,v=(s=this.LODinfo)==null?void 0:s.shadowRender;if(v!=null&&v.levels&&r<v.levels.length&&(v.levels.splice(r,1),(h=(l=v.count)==null?void 0:l.splice)==null||h.call(l,r,1),v.levels.length===0&&(this.LODinfo.shadowRender=null)),e&&g!==this)try{this.remove(g);const y=((c=p.objects)==null?void 0:c.indexOf(g))??-1;y!==-1&&p.objects.splice(y,1),this.disposeLOD(g)}catch(y){console.error(y)}return this};B.prototype.patchLevel=function(r){Object.defineProperty(r,"renderOrder",{get(){return this._parentLOD.renderOrder}}),Object.defineProperty(r,"_lastRenderInfo",{get(){return this._parentLOD._lastRenderInfo}}),Object.defineProperty(r,"matricesTexture",{get(){return this._parentLOD.matricesTexture}}),Object.defineProperty(r,"colorsTexture",{get(){return this._parentLOD.colorsTexture}}),Object.defineProperty(r,"uniformsTexture",{get(){return this._parentLOD.uniformsTexture}}),Object.defineProperty(r,"morphTexture",{get(){return this._parentLOD.morphTexture}}),Object.defineProperty(r,"boneTexture",{get(){return this._parentLOD.boneTexture}}),Object.defineProperty(r,"skeleton",{get(){return this._parentLOD.skeleton}}),Object.defineProperty(r,"bindMatrixInverse",{get(){return this._parentLOD.bindMatrixInverse}}),Object.defineProperty(r,"bindMatrix",{get(){return this._parentLOD.bindMatrix}})};const Lm=new Es;B.prototype.getMorphAt=function(r,e=Lm){const t=e.morphTargetInfluences,n=this.morphTexture.source.data.data,s=t.length+1,l=r*s+1;for(let h=0;h<t.length;h++)t[h]=n[l+h];return e};B.prototype.setMorphAt=function(r,e){const t=e.morphTargetInfluences,n=t.length+1;this.morphTexture===null&&!this._parentLOD&&(this.morphTexture=new Xr(new Float32Array(n*this._capacity),n,this._capacity,Qr,Jr));const s=this.morphTexture.source.data.data;let l=0;for(const p of t)l+=p;const h=this._geometry.morphTargetsRelative?1:1-l,c=n*r;s[c]=h,s.set(t,c+1),this.morphTexture.needsUpdate=!0};const wr=[],ws=new Es,Um=new cp,sl=new ze,rl=new ze,ol=new Ui,al=new Cs;B.prototype.raycast=function(r,e){if(this._parentLOD||!this.material||this._instancesArrayCount===0||!this.instanceIndex)return;ws.geometry=this._geometry,ws.material=this.material;const t=r.ray,n=r.near,s=r.far;ol.copy(this.matrixWorld).invert(),rl.setFromMatrixScale(this.matrixWorld),sl.copy(r.ray.direction).multiply(rl);const l=sl.length();r.ray=Um.copy(r.ray).applyMatrix4(ol),r.near/=l,r.far/=l,this.raycastInstances(r,e),r.ray=t,r.near=n,r.far=s};B.prototype.raycastInstances=function(r,e){if(this.bvh)this.bvh.raycast(r,t=>this.checkObjectIntersection(r,t,e));else{if(this.boundingSphere===null&&this.computeBoundingSphere(),al.copy(this.boundingSphere),!r.ray.intersectsSphere(al))return;const t=this.instanceIndex.array,n=this.raycastOnlyFrustum&&this._perObjectFrustumCulled?this.count:this._instancesArrayCount;for(let s=0;s<n;s++)this.checkObjectIntersection(r,t[s],e)}};B.prototype.checkObjectIntersection=function(r,e,t){if(!(e>this._instancesArrayCount||!this.getActiveAndVisibilityAt(e))){this.getMatrixAt(e,ws.matrixWorld),ws.raycast(r,wr);for(const n of wr)n.instanceId=e,n.object=this,t.push(n);wr.length=0}};B.prototype.initSkeleton=function(r,e=!0){if(r&&this.skeleton!==r&&!this._parentLOD){const t=r.bones;if(this.skeleton=r,this.bindMatrix=new Ui,this.bindMatrixInverse=new Ui,this.boneTexture=new xs(Float32Array,4,4*t.length,this._capacity),e)for(const n of t)n.matrixAutoUpdate=!1,n.matrixWorldAutoUpdate=!1;this.materialsNeedsUpdate()}};B.prototype.setBonesAt=function(r,e=!0,t){const n=this.skeleton;if(!n)throw new Error('"setBonesAt" cannot be called before "initSkeleton"');const s=n.bones,l=n.boneInverses;for(let h=0,c=s.length;h<c;h++){const p=s[h];e&&(t!=null&&t.has(p.name)||p.updateMatrix(),p.matrixWorld.multiplyMatrices(p.parent.matrixWorld,p.matrix)),this.multiplyBoneMatricesAt(r,h,p.matrixWorld,l[h])}this.boneTexture.enqueueUpdate(r)};B.prototype.multiplyBoneMatricesAt=function(r,e,t,n){const s=(r*this.skeleton.bones.length+e)*16,l=t.elements,h=n.elements,c=this.boneTexture._data,p=l[0],d=l[4],f=l[8],_=l[12],g=l[1],v=l[5],y=l[9],b=l[13],x=l[2],w=l[6],E=l[10],T=l[14],O=l[3],A=l[7],M=l[11],R=l[15],D=h[0],k=h[4],I=h[8],H=h[12],K=h[1],ee=h[5],q=h[9],z=h[13],U=h[2],ue=h[6],Te=h[10],Se=h[14],pe=h[3],Ee=h[7],W=h[11],Z=h[15];c[s+0]=p*D+d*K+f*U+_*pe,c[s+4]=p*k+d*ee+f*ue+_*Ee,c[s+8]=p*I+d*q+f*Te+_*W,c[s+12]=p*H+d*z+f*Se+_*Z,c[s+1]=g*D+v*K+y*U+b*pe,c[s+5]=g*k+v*ee+y*ue+b*Ee,c[s+9]=g*I+v*q+y*Te+b*W,c[s+13]=g*H+v*z+y*Se+b*Z,c[s+2]=x*D+w*K+E*U+T*pe,c[s+6]=x*k+w*ee+E*ue+T*Ee,c[s+10]=x*I+w*q+E*Te+T*W,c[s+14]=x*H+w*z+E*Se+T*Z,c[s+3]=O*D+A*K+M*U+R*pe,c[s+7]=O*k+A*ee+M*ue+R*Ee,c[s+11]=O*I+A*q+M*Te+R*W,c[s+15]=O*H+A*z+M*Se+R*Z};B.prototype.getUniformAt=function(r,e,t){if(!this.uniformsTexture)throw new Error(`Before get/set uniform, it's necessary to use "initUniformsPerInstance".`);return this.uniformsTexture.getUniformAt(r,e,t)};B.prototype.setUniformAt=function(r,e,t){if(!this.uniformsTexture)throw new Error(`Before get/set uniform, it's necessary to use "initUniformsPerInstance".`);this.uniformsTexture.setUniformAt(r,e,t),this.uniformsTexture.enqueueUpdate(r)};B.prototype.initUniformsPerInstance=function(r){if(!this._parentLOD){const{channels:e,pixelsPerInstance:t,uniformMap:n,fetchInFragmentShader:s}=this.getUniformSchemaResult(r);this.uniformsTexture=new xs(Float32Array,e,t,this._capacity,n,s),this.materialsNeedsUpdate()}};B.prototype.getUniformSchemaResult=function(r){let e=0;const t=new Map,n=[],s=r.vertex??{},l=r.fragment??{};let h=!0;for(const d in s){const f=s[d],_=this.getUniformSize(f);e+=_,n.push({name:d,type:f,size:_}),h=!1}for(const d in l)if(!s[d]){const f=l[d],_=this.getUniformSize(f);e+=_,n.push({name:d,type:f,size:_})}n.sort((d,f)=>f.size-d.size);const c=[];for(const{name:d,size:f,type:_}of n){const g=this.getUniformOffset(f,c);t.set(d,{offset:g,size:f,type:_})}const p=Math.ceil(e/4);return{channels:Math.min(e,4),pixelsPerInstance:p,uniformMap:t,fetchInFragmentShader:h}};B.prototype.getUniformOffset=function(r,e){if(r<4){for(let n=0;n<e.length;n++)if(e[n]+r<=4){const s=n*4+e[n];return e[n]+=r,s}}const t=e.length*4;for(;r>0;r-=4)e.push(r);return t};B.prototype.getUniformSize=function(r){switch(r){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;case"mat3":return 9;case"mat4":return 16;default:throw new Error(`Invalid uniform type: ${r}`)}};var Im=`#ifdef USE_INSTANCING_INDIRECT\r
  attribute uint instanceIndex;\r
  uniform highp sampler2D matricesTexture;  

  mat4 getInstancedMatrix() {\r
    int size = textureSize( matricesTexture, 0 ).x;\r
    int j = int( instanceIndex ) * 4;\r
    int x = j % size;\r
    int y = j / size;\r
    vec4 v1 = texelFetch( matricesTexture, ivec2( x, y ), 0 );\r
    vec4 v2 = texelFetch( matricesTexture, ivec2( x + 1, y ), 0 );\r
    vec4 v3 = texelFetch( matricesTexture, ivec2( x + 2, y ), 0 );\r
    vec4 v4 = texelFetch( matricesTexture, ivec2( x + 3, y ), 0 );\r
    return mat4( v1, v2, v3, v4 );\r
  }\r
#endif`,Bm=`#ifdef USE_INSTANCING_COLOR_INDIRECT\r
  uniform highp sampler2D colorsTexture;

  #ifdef USE_COLOR_ALPHA\r
    vec4 getColorTexture() {\r
      int size = textureSize( colorsTexture, 0 ).x;\r
      int j = int( instanceIndex );\r
      int x = j % size;\r
      int y = j / size;\r
      return texelFetch( colorsTexture, ivec2( x, y ), 0 );\r
    }\r
  #else\r
    vec3 getColorTexture() {\r
      int size = textureSize( colorsTexture, 0 ).x;\r
      int j = int( instanceIndex );\r
      int x = j % size;\r
      int y = j / size;\r
      return texelFetch( colorsTexture, ivec2( x, y ), 0 ).rgb;\r
    }\r
  #endif\r
#endif`,Nm=`#ifdef USE_INSTANCING_INDIRECT\r
  mat4 instanceMatrix = getInstancedMatrix();

  #ifdef USE_INSTANCING_COLOR_INDIRECT\r
    vColor *= getColorTexture();\r
  #endif\r
#endif`,Fm=`#ifdef USE_INSTANCING_COLOR_INDIRECT\r
  #ifdef USE_VERTEX_COLOR\r
    vColor = color;\r
  #else\r
    #ifdef USE_COLOR_ALPHA\r
      vColor = vec4( 1.0 );\r
    #else\r
      vColor = vec3( 1.0 );\r
    #endif\r
  #endif\r
#endif`,Vm=`#ifdef USE_SKINNING\r
  uniform mat4 bindMatrix;\r
  uniform mat4 bindMatrixInverse;\r
  uniform highp sampler2D boneTexture;

  #ifdef USE_INSTANCING_SKINNING\r
    uniform int bonesPerInstance;\r
  #endif

  mat4 getBoneMatrix( const in float i ) {\r
    int size = textureSize( boneTexture, 0 ).x;

    #ifdef USE_INSTANCING_SKINNING\r
      int j = ( bonesPerInstance * int( instanceIndex ) + int( i ) ) * 4;\r
    #else\r
      int j = int( i ) * 4;\r
    #endif

    int x = j % size;\r
    int y = j / size;\r
    vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\r
    vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\r
    vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\r
    vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\r
    return mat4( v1, v2, v3, v4 );\r
  }\r
#endif`;fe.instanced_pars_vertex=Im;fe.instanced_color_pars_vertex=Bm;fe.instanced_vertex=Nm;fe.instanced_color_vertex=Fm;function bo(r){return r.replace("#ifdef USE_INSTANCING","#if defined USE_INSTANCING || defined USE_INSTANCING_INDIRECT")}fe.project_vertex=bo(fe.project_vertex);fe.worldpos_vertex=bo(fe.worldpos_vertex);fe.defaultnormal_vertex=bo(fe.defaultnormal_vertex);fe.batching_pars_vertex=fe.batching_pars_vertex.concat(`
#include <instanced_pars_vertex>`);fe.color_pars_vertex=fe.color_pars_vertex.concat(`
#include <instanced_color_pars_vertex>`);fe.batching_vertex=fe.batching_vertex.concat(`
#include <instanced_vertex>`);fe.skinning_pars_vertex=Vm;fe.morphinstance_vertex&&(fe.morphinstance_vertex=fe.morphinstance_vertex.replaceAll("gl_InstanceID","instanceIndex"));var Er=1/1e3,zm=1e3,Hm=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(r){typeof document<"u"&&document.hidden!==void 0&&(r?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=r)}get delta(){return this._delta*Er}get fixedDelta(){return this._fixedDelta*Er}set fixedDelta(r){this._fixedDelta=r*zm}get elapsed(){return this._elapsed*Er}update(r){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(r!==void 0?r:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}getDelta(){return this.delta}getElapsed(){return this.elapsed}handleEvent(r){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},Gm=(()=>{const r=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),e=new Float32Array([0,0,2,0,0,2]),t=new Pp;return t.setAttribute("position",new Ca(r,3)),t.setAttribute("uv",new Ca(e,2)),t})(),et=class $r{static get fullscreenGeometry(){return Gm}constructor(e="Pass",t=new cs,n=new Dl){this.name=e,this.renderer=null,this.scene=t,this.camera=n,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){const t=this.fullscreenMaterial;t!==null&&(t.needsUpdate=!0),this.rtt=!e}}set mainScene(e){}set mainCamera(e){}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;t!==null?t.material=e:(t=new Es($r.fullscreenGeometry,e),t.frustumCulled=!1,this.scene===null&&(this.scene=new cs),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,t=Ts){}render(e,t,n,s,l){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,n){}dispose(){for(const e of Object.keys(this)){const t=this[e];(t instanceof Ft||t instanceof Il||t instanceof Bl||t instanceof $r)&&this[e].dispose()}this.fullscreenMaterial!==null&&this.fullscreenMaterial.dispose()}},jm=class extends et{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(r,e,t,n,s){const l=r.state.buffers.stencil;l.setLocked(!1),l.setTest(!1)}},Km=`#ifdef COLOR_WRITE
#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#endif
#ifdef DEPTH_WRITE
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}
#endif
#ifdef USE_WEIGHTS
uniform vec4 channelWeights;
#endif
uniform float opacity;varying vec2 vUv;void main(){
#ifdef COLOR_WRITE
vec4 texel=texture2D(inputBuffer,vUv);
#ifdef USE_WEIGHTS
texel*=channelWeights;
#endif
gl_FragColor=opacity*texel;
#ifdef COLOR_SPACE_CONVERSION
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
#else
gl_FragColor=vec4(0.0);
#endif
#ifdef DEPTH_WRITE
gl_FragDepth=readDepth(vUv);
#endif
}`,Vh="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",zh=class extends Nt{constructor(){super({name:"CopyMaterial",defines:{DEPTH_PACKING:"0",COLOR_WRITE:"1"},uniforms:{inputBuffer:new ie(null),depthBuffer:new ie(null),channelWeights:new ie(null),opacity:new ie(1)},blending:zi,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Km,vertexShader:Vh}),this.depthFunc=Op}get inputBuffer(){return this.uniforms.inputBuffer.value}set inputBuffer(r){const e=r!==null;this.colorWrite!==e&&(e?this.defines.COLOR_WRITE=!0:delete this.defines.COLOR_WRITE,this.colorWrite=e,this.needsUpdate=!0),this.uniforms.inputBuffer.value=r}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(r){const e=r!==null;this.depthWrite!==e&&(e?this.defines.DEPTH_WRITE=!0:delete this.defines.DEPTH_WRITE,this.depthTest=e,this.depthWrite=e,this.needsUpdate=!0),this.uniforms.depthBuffer.value=r}set depthPacking(r){this.defines.DEPTH_PACKING=r.toFixed(0),this.needsUpdate=!0}get channelWeights(){return this.uniforms.channelWeights.value}set channelWeights(r){r!==null?(this.defines.USE_WEIGHTS="1",this.uniforms.channelWeights.value=r):delete this.defines.USE_WEIGHTS,this.needsUpdate=!0}setInputBuffer(r){this.uniforms.inputBuffer.value=r}getOpacity(r){return this.uniforms.opacity.value}setOpacity(r){this.uniforms.opacity.value=r}},Ym=class extends et{constructor(r,e=!0){super("CopyPass"),this.fullscreenMaterial=new zh,this.needsSwap=!1,this.renderTarget=r,r===void 0&&(this.renderTarget=new Ft(1,1,{minFilter:hs,magFilter:hs,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=e}get resize(){return this.autoResize}set resize(r){this.autoResize=r}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(r){this.autoResize=r}render(r,e,t,n,s){this.fullscreenMaterial.inputBuffer=e.texture,r.setRenderTarget(this.renderToScreen?null:this.renderTarget),r.render(this.scene,this.camera)}setSize(r,e){this.autoResize&&this.renderTarget.setSize(r,e)}initialize(r,e,t){t!==void 0&&(this.renderTarget.texture.type=t,t!==ai?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":r!==null&&r.outputColorSpace===xe&&(this.renderTarget.texture.colorSpace=xe))}},ll=new as,Hh=class extends et{constructor(r=!0,e=!0,t=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=r,this.depth=e,this.stencil=t,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(r,e,t){this.color=r,this.depth=e,this.stencil=t}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(r){this.overrideClearColor=r}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(r){this.overrideClearAlpha=r}render(r,e,t,n,s){const l=this.overrideClearColor,h=this.overrideClearAlpha,c=r.getClearAlpha(),p=l!==null,d=h>=0;p?(r.getClearColor(ll),r.setClearColor(l,d?h:c)):d&&r.setClearAlpha(h),r.setRenderTarget(this.renderToScreen?null:e),r.clear(this.color,this.depth,this.stencil),p?r.setClearColor(ll,c):d&&r.setClearAlpha(c)}},$m=class extends et{constructor(r,e){super("MaskPass",r,e),this.needsSwap=!1,this.clearPass=new Hh(!1,!1,!0),this.inverse=!1}set mainScene(r){this.scene=r}set mainCamera(r){this.camera=r}get inverted(){return this.inverse}set inverted(r){this.inverse=r}get clear(){return this.clearPass.enabled}set clear(r){this.clearPass.enabled=r}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(r){this.inverted=r}render(r,e,t,n,s){const l=r.getContext(),h=r.state.buffers,c=this.scene,p=this.camera,d=this.clearPass,f=this.inverted?0:1,_=1-f;h.color.setMask(!1),h.depth.setMask(!1),h.color.setLocked(!0),h.depth.setLocked(!0),h.stencil.setTest(!0),h.stencil.setOp(l.REPLACE,l.REPLACE,l.REPLACE),h.stencil.setFunc(l.ALWAYS,f,4294967295),h.stencil.setClear(_),h.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?d.render(r,null):(d.render(r,e),d.render(r,t))),this.renderToScreen?(r.setRenderTarget(null),r.render(c,p)):(r.setRenderTarget(e),r.render(c,p),r.setRenderTarget(t),r.render(c,p)),h.color.setLocked(!1),h.depth.setLocked(!1),h.stencil.setLocked(!1),h.stencil.setFunc(l.EQUAL,1,4294967295),h.stencil.setOp(l.KEEP,l.KEEP,l.KEEP),h.stencil.setLocked(!0)}},qm=class{constructor(r=null,{depthBuffer:e=!0,stencilBuffer:t=!1,multisampling:n=0,frameBufferType:s}={}){this.renderer=null,this.inputBuffer=this.createBuffer(e,t,s,n),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new Ym,this.depthTexture=null,this.passes=[],this.timer=new Hm,this.autoRenderToScreen=!0,this.setRenderer(r)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(r){const e=this.inputBuffer,t=this.multisampling;t>0&&r>0?(this.inputBuffer.samples=r,this.outputBuffer.samples=r,this.inputBuffer.dispose(),this.outputBuffer.dispose()):t!==r&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(e.depthBuffer,e.stencilBuffer,e.texture.type,r),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(r){if(this.renderer=r,r!==null){const e=r.getSize(new Ce),t=r.getContext().getContextAttributes().alpha,n=this.inputBuffer.texture.type;n===ai&&r.outputColorSpace===xe&&(this.inputBuffer.texture.colorSpace=xe,this.outputBuffer.texture.colorSpace=xe,this.inputBuffer.dispose(),this.outputBuffer.dispose()),r.autoClear=!1,this.setSize(e.width,e.height);for(const s of this.passes)s.initialize(r,t,n)}}replaceRenderer(r,e=!0){const t=this.renderer,n=t.domElement.parentNode;return this.setRenderer(r),e&&n!==null&&(n.removeChild(t.domElement),n.appendChild(r.domElement)),t}createDepthTexture(){const r=this.depthTexture=new Ep;return this.inputBuffer.depthTexture=r,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(r.format=Cp,r.type=Tp):r.type=Rl,r}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const r of this.passes)r.setDepthTexture(null)}}createBuffer(r,e,t,n){const s=this.renderer,l=s===null?new Ce:s.getDrawingBufferSize(new Ce),h={minFilter:hs,magFilter:hs,stencilBuffer:e,depthBuffer:r,type:t},c=new Ft(l.width,l.height,h);return n>0&&(c.samples=n),t===ai&&s!==null&&s.outputColorSpace===xe&&(c.texture.colorSpace=xe),c.texture.name="EffectComposer.Buffer",c.texture.generateMipmaps=!1,c}setMainScene(r){for(const e of this.passes)e.mainScene=r}setMainCamera(r){for(const e of this.passes)e.mainCamera=r}addPass(r,e){const t=this.passes,n=this.renderer,s=n.getDrawingBufferSize(new Ce),l=n.getContext().getContextAttributes().alpha,h=this.inputBuffer.texture.type;if(r.setRenderer(n),r.setSize(s.width,s.height),r.initialize(n,l,h),this.autoRenderToScreen&&(t.length>0&&(t[t.length-1].renderToScreen=!1),r.renderToScreen&&(this.autoRenderToScreen=!1)),e!==void 0?t.splice(e,0,r):t.push(r),this.autoRenderToScreen&&(t[t.length-1].renderToScreen=!0),r.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const c=this.createDepthTexture();for(r of t)r.setDepthTexture(c)}else r.setDepthTexture(this.depthTexture)}removePass(r){const e=this.passes,t=e.indexOf(r);if(t!==-1&&e.splice(t,1).length>0){if(this.depthTexture!==null){const l=(c,p)=>c||p.needsDepthTexture;e.reduce(l,!1)||(r.getDepthTexture()===this.depthTexture&&r.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&t===e.length&&(r.renderToScreen=!1,e.length>0&&(e[e.length-1].renderToScreen=!0))}}removeAllPasses(){const r=this.passes;this.deleteDepthTexture(),r.length>0&&(this.autoRenderToScreen&&(r[r.length-1].renderToScreen=!1),this.passes=[])}render(r){const e=this.renderer,t=this.copyPass;let n=this.inputBuffer,s=this.outputBuffer,l=!1,h,c,p;r===void 0&&(this.timer.update(),r=this.timer.getDelta());for(const d of this.passes)d.enabled&&(d.render(e,n,s,r,l),d.needsSwap&&(l&&(t.renderToScreen=d.renderToScreen,h=e.getContext(),c=e.state.buffers.stencil,c.setFunc(h.NOTEQUAL,1,4294967295),t.render(e,n,s,r,l),c.setFunc(h.EQUAL,1,4294967295)),p=n,n=s,s=p),d instanceof $m?l=!0:d instanceof jm&&(l=!1))}setSize(r,e,t){const n=this.renderer,s=n.getSize(new Ce);(r===void 0||e===void 0)&&(r=s.width,e=s.height),(s.width!==r||s.height!==e)&&n.setSize(r,e,t);const l=n.getDrawingBufferSize(new Ce);this.inputBuffer.setSize(l.width,l.height),this.outputBuffer.setSize(l.width,l.height);for(const h of this.passes)h.setSize(l.width,l.height)}reset(){this.dispose(),this.autoRenderToScreen=!0}dispose(){for(const r of this.passes)r.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose(),et.fullscreenGeometry.dispose()}},oi={NONE:0,DEPTH:1,CONVOLUTION:2},J={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},Wm=class{constructor(){this.shaderParts=new Map([[J.FRAGMENT_HEAD,null],[J.FRAGMENT_MAIN_UV,null],[J.FRAGMENT_MAIN_IMAGE,null],[J.VERTEX_HEAD,null],[J.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=oi.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=Ul}},Cr=!1,hl=class{constructor(r=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(r),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let t;if(e.material.flatShading)switch(e.material.side){case Zn:t=this.materialsFlatShadedDoubleSide;break;case Wn:t=this.materialsFlatShadedBackSide;break;default:t=this.materialsFlatShaded;break}else switch(e.material.side){case Zn:t=this.materialsDoubleSide;break;case Wn:t=this.materialsBackSide;break;default:t=this.materials;break}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=t[2]:e.isInstancedMesh?e.material=t[1]:e.material=t[0],++this.meshCount}}}cloneMaterial(r){if(!(r instanceof Nt))return r.clone();const e=r.uniforms,t=new Map;for(const s in e){const l=e[s].value;l.isRenderTargetTexture&&(e[s].value=null,t.set(s,l))}const n=r.clone();for(const s of t)e[s[0]].value=s[1],n.uniforms[s[0]].value=s[1];return n}setMaterial(r){if(this.disposeMaterials(),this.material=r,r!==null){const e=this.materials=[this.cloneMaterial(r),this.cloneMaterial(r),this.cloneMaterial(r)];for(const t of e)t.uniforms=Object.assign({},r.uniforms),t.side=Sp;e[2].skinning=!0,this.materialsBackSide=e.map(t=>{const n=this.cloneMaterial(t);return n.uniforms=Object.assign({},r.uniforms),n.side=Wn,n}),this.materialsDoubleSide=e.map(t=>{const n=this.cloneMaterial(t);return n.uniforms=Object.assign({},r.uniforms),n.side=Zn,n}),this.materialsFlatShaded=e.map(t=>{const n=this.cloneMaterial(t);return n.uniforms=Object.assign({},r.uniforms),n.flatShading=!0,n}),this.materialsFlatShadedBackSide=e.map(t=>{const n=this.cloneMaterial(t);return n.uniforms=Object.assign({},r.uniforms),n.flatShading=!0,n.side=Wn,n}),this.materialsFlatShadedDoubleSide=e.map(t=>{const n=this.cloneMaterial(t);return n.uniforms=Object.assign({},r.uniforms),n.flatShading=!0,n.side=Zn,n})}}render(r,e,t){const n=r.shadowMap.enabled;if(r.shadowMap.enabled=!1,Cr){const s=this.originalMaterials;this.meshCount=0,e.traverse(this.replaceMaterial),r.render(e,t);for(const l of s)l[0].material=l[1];this.meshCount!==s.size&&s.clear()}else{const s=e.overrideMaterial;e.overrideMaterial=this.material,r.render(e,t),e.overrideMaterial=s}r.shadowMap.enabled=n}disposeMaterials(){if(this.material!==null){const r=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const e of r)e.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return Cr}static set workaroundEnabled(r){Cr=r}},Tt=-1,lt=class extends to{constructor(r,e=Tt,t=Tt,n=1){super(),this.resizable=r,this.baseSize=new Ce(1,1),this.preferredSize=new Ce(e,t),this.target=this.preferredSize,this.s=n,this.effectiveSize=new Ce,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const r=this.baseSize,e=this.preferredSize,t=this.effectiveSize,n=this.scale;e.width!==Tt?t.width=e.width:e.height!==Tt?t.width=Math.round(e.height*(r.width/Math.max(r.height,1))):t.width=Math.round(r.width*n),e.height!==Tt?t.height=e.height:e.width!==Tt?t.height=Math.round(e.width/Math.max(r.width/Math.max(r.height,1),1)):t.height=Math.round(r.height*n)}get width(){return this.effectiveSize.width}set width(r){this.preferredWidth=r}get height(){return this.effectiveSize.height}set height(r){this.preferredHeight=r}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(r){this.s!==r&&(this.s=r,this.preferredSize.setScalar(Tt),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(r){this.scale=r}get baseWidth(){return this.baseSize.width}set baseWidth(r){this.baseSize.width!==r&&(this.baseSize.width=r,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(r){this.baseWidth=r}get baseHeight(){return this.baseSize.height}set baseHeight(r){this.baseSize.height!==r&&(this.baseSize.height=r,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(r){this.baseHeight=r}setBaseSize(r,e){(this.baseSize.width!==r||this.baseSize.height!==e)&&(this.baseSize.set(r,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(r){this.preferredSize.width!==r&&(this.preferredSize.width=r,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(r){this.preferredWidth=r}get preferredHeight(){return this.preferredSize.height}set preferredHeight(r){this.preferredSize.height!==r&&(this.preferredSize.height=r,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(r){this.preferredHeight=r}setPreferredSize(r,e){(this.preferredSize.width!==r||this.preferredSize.height!==e)&&(this.preferredSize.set(r,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(r){this.s=r.scale,this.baseSize.set(r.baseWidth,r.baseHeight),this.preferredSize.set(r.preferredWidth,r.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return Tt}},j={ADD:0,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},Zm="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb+y.rgb,y.a),y.a*opacity);}",Xm="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4((x.rgb+y.rgb)*0.5,y.a),y.a*opacity);}",Qm="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.xy,xHSL.z));return mix(x,vec4(z,y.a),y.a*opacity);}",Jm="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=x.rgb,b=y.rgb;vec3 z=mix(step(0.0,b)*(1.0-min(vec3(1.0),(1.0-a)/b)),vec3(1.0),step(1.0,a));return mix(x,vec4(z,y.a),y.a*opacity);}",e_="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=x.rgb,b=y.rgb;vec3 z=step(0.0,a)*mix(min(vec3(1.0),a/max(1.0-b,1e-9)),vec3(1.0),step(1.0,b));return mix(x,vec4(z,y.a),y.a*opacity);}",t_="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(min(x.rgb,y.rgb),y.a),y.a*opacity);}",i_="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(abs(x.rgb-y.rgb),y.a),y.a*opacity);}",n_="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb/max(y.rgb,1e-12),y.a),y.a*opacity);}",s_="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4((x.rgb+y.rgb-2.0*x.rgb*y.rgb),y.a),y.a*opacity);}",r_="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=min(x.rgb,1.0);vec3 b=min(y.rgb,1.0);vec3 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,b));return mix(x,vec4(z,y.a),y.a*opacity);}",o_="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(step(1.0,x.rgb+y.rgb),y.a),y.a*opacity);}",a_="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.x,xHSL.yz));return mix(x,vec4(z,y.a),y.a*opacity);}",l_="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(1.0-y.rgb,y.a),y.a*opacity);}",h_="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(y.rgb*(1.0-x.rgb),y.a),y.a*opacity);}",c_="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(max(x.rgb,y.rgb),y.a),y.a*opacity);}",u_="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(clamp(y.rgb+x.rgb-1.0,0.0,1.0),y.a),y.a*opacity);}",d_="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(min(x.rgb+y.rgb,1.0),y.a),y.a*opacity);}",p_="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(clamp(2.0*y.rgb+x.rgb-1.0,0.0,1.0),y.a),y.a*opacity);}",f_="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.xy,yHSL.z));return mix(x,vec4(z,y.a),y.a*opacity);}",m_="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb*y.rgb,y.a),y.a*opacity);}",__="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(1.0-abs(1.0-x.rgb-y.rgb),y.a),y.a*opacity);}",v_="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,y.a*opacity);}",g_="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 z=mix(2.0*y.rgb*x.rgb,1.0-2.0*(1.0-y.rgb)*(1.0-x.rgb),step(0.5,x.rgb));return mix(x,vec4(z,y.a),y.a*opacity);}",b_="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 y2=2.0*y.rgb;vec3 z=mix(mix(y2,x.rgb,step(0.5*x.rgb,y.rgb)),max(y2-1.0,vec3(0.0)),step(x.rgb,y2-1.0));return mix(x,vec4(z,y.a),y.a*opacity);}",x_="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 z=mix(min(x.rgb*x.rgb/max(1.0-y.rgb,1e-12),1.0),y.rgb,step(1.0,y.rgb));return mix(x,vec4(z,y.a),y.a*opacity);}",y_="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.x,yHSL.y,xHSL.z));return mix(x,vec4(z,y.a),y.a*opacity);}",w_="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb+y.rgb-min(x.rgb*y.rgb,1.0),y.a),y.a*opacity);}",E_="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=x.rgb;vec3 b=y.rgb;vec3 y2=2.0*b;vec3 w=step(0.5,b);vec3 c=a-(1.0-y2)*a*(1.0-a);vec3 d=mix(a+(y2-1.0)*(sqrt(a)-a),a+(y2-1.0)*a*((16.0*a-12.0)*a+3.0),w*(1.0-step(0.25,a)));vec3 z=mix(c,d,w);return mix(x,vec4(z,y.a),y.a*opacity);}",C_="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}",T_="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(max(x.rgb+y.rgb-1.0,0.0),y.a),y.a*opacity);}",S_="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 z=mix(max(1.0-min((1.0-x.rgb)/(2.0*y.rgb),1.0),0.0),min(x.rgb/(2.0*(1.0-y.rgb)),1.0),step(0.5,y.rgb));return mix(x,vec4(z,y.a),y.a*opacity);}",P_=new Map([[j.ADD,Zm],[j.AVERAGE,Xm],[j.COLOR,Qm],[j.COLOR_BURN,Jm],[j.COLOR_DODGE,e_],[j.DARKEN,t_],[j.DIFFERENCE,i_],[j.DIVIDE,n_],[j.DST,null],[j.EXCLUSION,s_],[j.HARD_LIGHT,r_],[j.HARD_MIX,o_],[j.HUE,a_],[j.INVERT,l_],[j.INVERT_RGB,h_],[j.LIGHTEN,c_],[j.LINEAR_BURN,u_],[j.LINEAR_DODGE,d_],[j.LINEAR_LIGHT,p_],[j.LUMINOSITY,f_],[j.MULTIPLY,m_],[j.NEGATION,__],[j.NORMAL,v_],[j.OVERLAY,g_],[j.PIN_LIGHT,b_],[j.REFLECT,x_],[j.SATURATION,y_],[j.SCREEN,w_],[j.SOFT_LIGHT,E_],[j.SRC,C_],[j.SUBTRACT,T_],[j.VIVID_LIGHT,S_]]),O_=class extends to{constructor(r,e=1){super(),this._blendFunction=r,this.opacity=new ie(e)}getOpacity(){return this.opacity.value}setOpacity(r){this.opacity.value=r}get blendFunction(){return this._blendFunction}set blendFunction(r){this._blendFunction=r,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(r){this.blendFunction=r}getShaderCode(){return P_.get(this.blendFunction)}},Gh=class extends to{constructor(r,e,{attributes:t=oi.NONE,blendFunction:n=j.NORMAL,defines:s=new Map,uniforms:l=new Map,extensions:h=null,vertexShader:c=null}={}){super(),this.name=r,this.renderer=null,this.attributes=t,this.fragmentShader=e,this.vertexShader=c,this.defines=s,this.uniforms=l,this.extensions=h,this.blendMode=new O_(n),this.blendMode.addEventListener("change",p=>this.setChanged()),this._inputColorSpace=Ul,this._outputColorSpace=ls}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(r){this._inputColorSpace=r,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(r){this._outputColorSpace=r,this.setChanged()}set mainScene(r){}set mainCamera(r){}getName(){return this.name}setRenderer(r){this.renderer=r}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(r){this.attributes=r,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(r){this.fragmentShader=r,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(r){this.vertexShader=r,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(r,e=Ts){}update(r,e,t){}setSize(r,e){}initialize(r,e,t){}dispose(){for(const r of Object.keys(this)){const e=this[r];(e instanceof Ft||e instanceof Il||e instanceof Bl||e instanceof et)&&this[r].dispose()}}},xo={MEDIUM:2,LARGE:3},A_=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,M_="uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",R_=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],D_=class extends Nt{constructor(r=new Ta){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new ie(null),texelSize:new ie(new Ta),scale:new ie(1),kernel:new ie(0)},blending:zi,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:A_,vertexShader:M_}),this.setTexelSize(r.x,r.y),this.kernelSize=xo.MEDIUM}set inputBuffer(r){this.uniforms.inputBuffer.value=r}setInputBuffer(r){this.inputBuffer=r}get kernelSequence(){return R_[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(r){this.uniforms.scale.value=r}getScale(){return this.uniforms.scale.value}setScale(r){this.uniforms.scale.value=r}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(r){this.uniforms.kernel.value=r}setKernel(r){this.kernel=r}setTexelSize(r,e){this.uniforms.texelSize.value.set(r,e,r*.5,e*.5)}setSize(r,e){const t=1/r,n=1/e;this.uniforms.texelSize.value.set(t,n,t*.5,n*.5)}},k_=class extends et{constructor({kernelSize:r=xo.MEDIUM,resolutionScale:e=.5,width:t=lt.AUTO_SIZE,height:n=lt.AUTO_SIZE,resolutionX:s=t,resolutionY:l=n}={}){super("KawaseBlurPass"),this.renderTargetA=new Ft(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const h=this.resolution=new lt(this,s,l,e);h.addEventListener("change",c=>this.setSize(h.baseWidth,h.baseHeight)),this._blurMaterial=new D_,this._blurMaterial.kernelSize=r,this.copyMaterial=new zh}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(r){this._blurMaterial=r}get dithering(){return this.copyMaterial.dithering}set dithering(r){this.copyMaterial.dithering=r}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(r){this.blurMaterial.kernelSize=r}get width(){return this.resolution.width}set width(r){this.resolution.preferredWidth=r}get height(){return this.resolution.height}set height(r){this.resolution.preferredHeight=r}get scale(){return this.blurMaterial.scale}set scale(r){this.blurMaterial.scale=r}getScale(){return this.blurMaterial.scale}setScale(r){this.blurMaterial.scale=r}getKernelSize(){return this.kernelSize}setKernelSize(r){this.kernelSize=r}getResolutionScale(){return this.resolution.scale}setResolutionScale(r){this.resolution.scale=r}render(r,e,t,n,s){const l=this.scene,h=this.camera,c=this.renderTargetA,p=this.renderTargetB,d=this.blurMaterial,f=d.kernelSequence;let _=e;this.fullscreenMaterial=d;for(let g=0,v=f.length;g<v;++g){const y=(g&1)===0?c:p;d.kernel=f[g],d.inputBuffer=_.texture,r.setRenderTarget(y),r.render(l,h),_=y}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=_.texture,r.setRenderTarget(this.renderToScreen?null:t),r.render(l,h)}setSize(r,e){const t=this.resolution;t.setBaseSize(r,e);const n=t.width,s=t.height;this.renderTargetA.setSize(n,s),this.renderTargetB.setSize(n,s),this.blurMaterial.setSize(r,e)}initialize(r,e,t){t!==void 0&&(this.renderTargetA.texture.type=t,this.renderTargetB.texture.type=t,t!==ai?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):r!==null&&r.outputColorSpace===xe&&(this.renderTargetA.texture.colorSpace=xe,this.renderTargetB.texture.colorSpace=xe))}static get AUTO_SIZE(){return lt.AUTO_SIZE}},L_=`#include <common>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);float mask=1.0;
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);mask=low*high;
#elif defined(THRESHOLD)
mask=smoothstep(threshold,threshold+smoothing,l);
#endif
#ifdef COLOR
gl_FragColor=texel*mask;
#else
gl_FragColor=vec4(l*mask);
#endif
}`,U_=class extends Nt{constructor(r=!1,e=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:kl.replace(/\D+/g,"")},uniforms:{inputBuffer:new ie(null),threshold:new ie(0),smoothing:new ie(1),range:new ie(null)},blending:zi,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:L_,vertexShader:Vh}),this.colorOutput=r,this.luminanceRange=e}set inputBuffer(r){this.uniforms.inputBuffer.value=r}setInputBuffer(r){this.uniforms.inputBuffer.value=r}get threshold(){return this.uniforms.threshold.value}set threshold(r){this.smoothing>0||r>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=r}getThreshold(){return this.threshold}setThreshold(r){this.threshold=r}get smoothing(){return this.uniforms.smoothing.value}set smoothing(r){this.threshold>0||r>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=r}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(r){this.smoothing=r}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(r){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(r){r?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(r){return this.colorOutput}setColorOutputEnabled(r){this.colorOutput=r}get useRange(){return this.luminanceRange!==null}set useRange(r){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(r){r!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=r,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(r){this.luminanceRange=r}},I_=class extends et{constructor({renderTarget:r,luminanceRange:e,colorOutput:t,resolutionScale:n=1,width:s=lt.AUTO_SIZE,height:l=lt.AUTO_SIZE,resolutionX:h=s,resolutionY:c=l}={}){super("LuminancePass"),this.fullscreenMaterial=new U_(t,e),this.needsSwap=!1,this.renderTarget=r,this.renderTarget===void 0&&(this.renderTarget=new Ft(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target");const p=this.resolution=new lt(this,h,c,n);p.addEventListener("change",d=>this.setSize(p.baseWidth,p.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(r,e,t,n,s){const l=this.fullscreenMaterial;l.inputBuffer=e.texture,r.setRenderTarget(this.renderToScreen?null:this.renderTarget),r.render(this.scene,this.camera)}setSize(r,e){const t=this.resolution;t.setBaseSize(r,e),this.renderTarget.setSize(t.width,t.height)}initialize(r,e,t){t!==void 0&&t!==ai&&(this.renderTarget.texture.type=t,this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},B_=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#define WEIGHT_INNER 0.125
#define WEIGHT_OUTER 0.0555555
varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;float clampToBorder(const in vec2 uv){return float(uv.s>=0.0&&uv.s<=1.0&&uv.t>=0.0&&uv.t<=1.0);}void main(){vec4 c=vec4(0.0);vec4 w=WEIGHT_INNER*vec4(clampToBorder(vUv00),clampToBorder(vUv01),clampToBorder(vUv02),clampToBorder(vUv03));c+=w.x*texture2D(inputBuffer,vUv00);c+=w.y*texture2D(inputBuffer,vUv01);c+=w.z*texture2D(inputBuffer,vUv02);c+=w.w*texture2D(inputBuffer,vUv03);w=WEIGHT_OUTER*vec4(clampToBorder(vUv04),clampToBorder(vUv05),clampToBorder(vUv06),clampToBorder(vUv07));c+=w.x*texture2D(inputBuffer,vUv04);c+=w.y*texture2D(inputBuffer,vUv05);c+=w.z*texture2D(inputBuffer,vUv06);c+=w.w*texture2D(inputBuffer,vUv07);w=WEIGHT_OUTER*vec4(clampToBorder(vUv08),clampToBorder(vUv09),clampToBorder(vUv10),clampToBorder(vUv11));c+=w.x*texture2D(inputBuffer,vUv08);c+=w.y*texture2D(inputBuffer,vUv09);c+=w.z*texture2D(inputBuffer,vUv10);c+=w.w*texture2D(inputBuffer,vUv11);c+=WEIGHT_OUTER*texture2D(inputBuffer,vUv);gl_FragColor=c;
#include <colorspace_fragment>
}`,N_="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;void main(){vUv=position.xy*0.5+0.5;vUv00=vUv+texelSize*vec2(-1.0,1.0);vUv01=vUv+texelSize*vec2(1.0,1.0);vUv02=vUv+texelSize*vec2(-1.0,-1.0);vUv03=vUv+texelSize*vec2(1.0,-1.0);vUv04=vUv+texelSize*vec2(-2.0,2.0);vUv05=vUv+texelSize*vec2(0.0,2.0);vUv06=vUv+texelSize*vec2(2.0,2.0);vUv07=vUv+texelSize*vec2(-2.0,0.0);vUv08=vUv+texelSize*vec2(2.0,0.0);vUv09=vUv+texelSize*vec2(-2.0,-2.0);vUv10=vUv+texelSize*vec2(0.0,-2.0);vUv11=vUv+texelSize*vec2(2.0,-2.0);gl_Position=vec4(position.xy,1.0,1.0);}",F_=class extends Nt{constructor(){super({name:"DownsamplingMaterial",uniforms:{inputBuffer:new ie(null),texelSize:new ie(new Ce)},blending:zi,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:B_,vertexShader:N_})}set inputBuffer(r){this.uniforms.inputBuffer.value=r}setSize(r,e){this.uniforms.texelSize.value.set(1/r,1/e)}},V_=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;uniform mediump sampler2D supportBuffer;
#else
uniform lowp sampler2D inputBuffer;uniform lowp sampler2D supportBuffer;
#endif
uniform float radius;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vec4 c=vec4(0.0);c+=texture2D(inputBuffer,vUv0)*0.0625;c+=texture2D(inputBuffer,vUv1)*0.125;c+=texture2D(inputBuffer,vUv2)*0.0625;c+=texture2D(inputBuffer,vUv3)*0.125;c+=texture2D(inputBuffer,vUv)*0.25;c+=texture2D(inputBuffer,vUv4)*0.125;c+=texture2D(inputBuffer,vUv5)*0.0625;c+=texture2D(inputBuffer,vUv6)*0.125;c+=texture2D(inputBuffer,vUv7)*0.0625;vec4 baseColor=texture2D(supportBuffer,vUv);gl_FragColor=mix(baseColor,c,radius);
#include <colorspace_fragment>
}`,z_="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,1.0);vUv1=vUv+texelSize*vec2(0.0,1.0);vUv2=vUv+texelSize*vec2(1.0,1.0);vUv3=vUv+texelSize*vec2(-1.0,0.0);vUv4=vUv+texelSize*vec2(1.0,0.0);vUv5=vUv+texelSize*vec2(-1.0,-1.0);vUv6=vUv+texelSize*vec2(0.0,-1.0);vUv7=vUv+texelSize*vec2(1.0,-1.0);gl_Position=vec4(position.xy,1.0,1.0);}",H_=class extends Nt{constructor(){super({name:"UpsamplingMaterial",uniforms:{inputBuffer:new ie(null),supportBuffer:new ie(null),texelSize:new ie(new Ce),radius:new ie(.85)},blending:zi,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:V_,vertexShader:z_})}set inputBuffer(r){this.uniforms.inputBuffer.value=r}set supportBuffer(r){this.uniforms.supportBuffer.value=r}get radius(){return this.uniforms.radius.value}set radius(r){this.uniforms.radius.value=r}setSize(r,e){this.uniforms.texelSize.value.set(1/r,1/e)}},G_=class extends et{constructor(){super("MipmapBlurPass"),this.needsSwap=!1,this.renderTarget=new Ft(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Upsampling.Mipmap0",this.downsamplingMipmaps=[],this.upsamplingMipmaps=[],this.downsamplingMaterial=new F_,this.upsamplingMaterial=new H_,this.resolution=new Ce}get texture(){return this.renderTarget.texture}get levels(){return this.downsamplingMipmaps.length}set levels(r){if(this.levels!==r){const e=this.renderTarget;this.dispose(),this.downsamplingMipmaps=[],this.upsamplingMipmaps=[];for(let t=0;t<r;++t){const n=e.clone();n.texture.name="Downsampling.Mipmap"+t,this.downsamplingMipmaps.push(n)}this.upsamplingMipmaps.push(e);for(let t=1,n=r-1;t<n;++t){const s=e.clone();s.texture.name="Upsampling.Mipmap"+t,this.upsamplingMipmaps.push(s)}this.setSize(this.resolution.x,this.resolution.y)}}get radius(){return this.upsamplingMaterial.radius}set radius(r){this.upsamplingMaterial.radius=r}render(r,e,t,n,s){const{scene:l,camera:h}=this,{downsamplingMaterial:c,upsamplingMaterial:p}=this,{downsamplingMipmaps:d,upsamplingMipmaps:f}=this;let _=e;this.fullscreenMaterial=c;for(let g=0,v=d.length;g<v;++g){const y=d[g];c.setSize(_.width,_.height),c.inputBuffer=_.texture,r.setRenderTarget(y),r.render(l,h),_=y}this.fullscreenMaterial=p;for(let g=f.length-1;g>=0;--g){const v=f[g];p.setSize(_.width,_.height),p.inputBuffer=_.texture,p.supportBuffer=d[g].texture,r.setRenderTarget(v),r.render(l,h),_=v}}setSize(r,e){const t=this.resolution;t.set(r,e);let n=t.width,s=t.height;for(let l=0,h=this.downsamplingMipmaps.length;l<h;++l)n=Math.round(n*.5),s=Math.round(s*.5),this.downsamplingMipmaps[l].setSize(n,s),l<this.upsamplingMipmaps.length&&this.upsamplingMipmaps[l].setSize(n,s)}initialize(r,e,t){if(t!==void 0){const n=this.downsamplingMipmaps.concat(this.upsamplingMipmaps);for(const s of n)s.texture.type=t;if(t!==ai)this.downsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.upsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1";else if(r!==null&&r.outputColorSpace===xe)for(const s of n)s.texture.colorSpace=xe}}dispose(){super.dispose();for(const r of this.downsamplingMipmaps.concat(this.upsamplingMipmaps))r.dispose()}},j_=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 texel=texture2D(map,uv);outputColor=vec4(texel.rgb*intensity,max(inputColor.a,texel.a));}`,K_=class extends Gh{constructor({blendFunction:r=j.SCREEN,luminanceThreshold:e=1,luminanceSmoothing:t=.03,mipmapBlur:n=!0,intensity:s=1,radius:l=.85,levels:h=8,kernelSize:c=xo.LARGE,resolutionScale:p=.5,width:d=lt.AUTO_SIZE,height:f=lt.AUTO_SIZE,resolutionX:_=d,resolutionY:g=f}={}){super("BloomEffect",j_,{blendFunction:r,uniforms:new Map([["map",new ie(null)],["intensity",new ie(s)]])}),this.renderTarget=new Ft(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.blurPass=new k_({kernelSize:c}),this.luminancePass=new I_({colorOutput:!0}),this.luminanceMaterial.threshold=e,this.luminanceMaterial.smoothing=t,this.mipmapBlurPass=new G_,this.mipmapBlurPass.enabled=n,this.mipmapBlurPass.radius=l,this.mipmapBlurPass.levels=h,this.uniforms.get("map").value=n?this.mipmapBlurPass.texture:this.renderTarget.texture;const v=this.resolution=new lt(this,_,g,p);v.addEventListener("change",y=>this.setSize(v.baseWidth,v.baseHeight))}get texture(){return this.mipmapBlurPass.enabled?this.mipmapBlurPass.texture:this.renderTarget.texture}getTexture(){return this.texture}getResolution(){return this.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(r){this.resolution.preferredWidth=r}get height(){return this.resolution.height}set height(r){this.resolution.preferredHeight=r}get dithering(){return this.blurPass.dithering}set dithering(r){this.blurPass.dithering=r}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(r){this.blurPass.kernelSize=r}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(r){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(r){this.uniforms.get("intensity").value=r}getIntensity(){return this.intensity}setIntensity(r){this.intensity=r}getResolutionScale(){return this.resolution.scale}setResolutionScale(r){this.resolution.scale=r}update(r,e,t){const n=this.renderTarget,s=this.luminancePass;s.enabled?(s.render(r,e),this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(r,s.renderTarget):this.blurPass.render(r,s.renderTarget,n)):this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(r,e):this.blurPass.render(r,e,n)}setSize(r,e){const t=this.resolution;t.setBaseSize(r,e),this.renderTarget.setSize(t.width,t.height),this.blurPass.resolution.copy(t),this.luminancePass.setSize(r,e),this.mipmapBlurPass.setSize(r,e)}initialize(r,e,t){this.blurPass.initialize(r,e,t),this.luminancePass.initialize(r,e,t),this.mipmapBlurPass.initialize(r,e,t),t!==void 0&&(this.renderTarget.texture.type=t,r!==null&&r.outputColorSpace===xe&&(this.renderTarget.texture.colorSpace=xe))}},Y_=class extends et{constructor(r,e,t=null){super("RenderPass",r,e),this.needsSwap=!1,this.clearPass=new Hh,this.overrideMaterialManager=t===null?null:new hl(t),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(r){this.scene=r}set mainCamera(r){this.camera=r}get renderToScreen(){return super.renderToScreen}set renderToScreen(r){super.renderToScreen=r,this.clearPass.renderToScreen=r}get overrideMaterial(){const r=this.overrideMaterialManager;return r!==null?r.material:null}set overrideMaterial(r){const e=this.overrideMaterialManager;r!==null?e!==null?e.setMaterial(r):this.overrideMaterialManager=new hl(r):e!==null&&(e.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(r){this.overrideMaterial=r}get clear(){return this.clearPass.enabled}set clear(r){this.clearPass.enabled=r}getSelection(){return this.selection}setSelection(r){this.selection=r}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(r){this.ignoreBackground=r}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(r){this.skipShadowMapUpdate=r}getClearPass(){return this.clearPass}render(r,e,t,n,s){const l=this.scene,h=this.camera,c=this.selection,p=h.layers.mask,d=l.background,f=r.shadowMap.autoUpdate,_=this.renderToScreen?null:e;c!==null&&h.layers.set(c.getLayer()),this.skipShadowMapUpdate&&(r.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(l.background=null),this.clearPass.enabled&&this.clearPass.render(r,e),r.setRenderTarget(_),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(r,l,h):r.render(l,h),h.layers.mask=p,l.background=d,r.shadowMap.autoUpdate=f}},$_=`uniform float count;
#ifdef SCROLL
uniform float scrollSpeed;
#endif
void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){float y=uv.y;
#ifdef SCROLL
y+=time*scrollSpeed;
#endif
vec2 sl=vec2(sin(y*count),cos(y*count));outputColor=vec4(sl.xyx,inputColor.a);}`,q_=class extends Gh{constructor({blendFunction:r=j.OVERLAY,density:e=1.25,scrollSpeed:t=0}={}){super("ScanlineEffect",$_,{blendFunction:r,uniforms:new Map([["count",new ie(0)],["scrollSpeed",new ie(0)]])}),this.resolution=new Ce,this.d=e,this.scrollSpeed=t}get density(){return this.d}set density(r){this.d=r,this.setSize(this.resolution.width,this.resolution.height)}getDensity(){return this.density}setDensity(r){this.density=r}get scrollSpeed(){return this.uniforms.get("scrollSpeed").value}set scrollSpeed(r){this.uniforms.get("scrollSpeed").value=r,r===0?this.defines.delete("SCROLL")&&this.setChanged():this.defines.has("SCROLL")||(this.defines.set("SCROLL","1"),this.setChanged())}setSize(r,e){this.resolution.set(r,e),this.uniforms.get("count").value=Math.round(e*this.density)}},W_=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
float depth=unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
float depth=texture2D(depthBuffer,uv).r;
#endif
#if defined(USE_LOGARITHMIC_DEPTH_BUFFER) || defined(LOG_DEPTH)
float d=pow(2.0,depth*log2(cameraFar+1.0))-1.0;float a=cameraFar/(cameraFar-cameraNear);float b=cameraFar*cameraNear/(cameraNear-cameraFar);depth=a+b/d;
#elif defined(USE_REVERSED_DEPTH_BUFFER)
depth=1.0-depth;
#endif
return depth;}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,Z_="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",X_=class extends Nt{constructor(r,e,t,n,s=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:kl.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new ie(null),depthBuffer:new ie(null),resolution:new ie(new Ce),texelSize:new ie(new Ce),cameraNear:new ie(.3),cameraFar:new ie(1e3),aspect:new ie(1),time:new ie(0)},blending:zi,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:s}),r&&this.setShaderParts(r),e&&this.setDefines(e),t&&this.setUniforms(t),this.copyCameraSettings(n)}set inputBuffer(r){this.uniforms.inputBuffer.value=r}setInputBuffer(r){this.uniforms.inputBuffer.value=r}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(r){this.uniforms.depthBuffer.value=r}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(r){this.defines.DEPTH_PACKING=r.toFixed(0),this.needsUpdate=!0}setDepthBuffer(r,e=Ts){this.depthBuffer=r,this.depthPacking=e}setShaderData(r){this.setShaderParts(r.shaderParts),this.setDefines(r.defines),this.setUniforms(r.uniforms),this.setExtensions(r.extensions)}setShaderParts(r){return this.fragmentShader=W_.replace(J.FRAGMENT_HEAD,r.get(J.FRAGMENT_HEAD)||"").replace(J.FRAGMENT_MAIN_UV,r.get(J.FRAGMENT_MAIN_UV)||"").replace(J.FRAGMENT_MAIN_IMAGE,r.get(J.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=Z_.replace(J.VERTEX_HEAD,r.get(J.VERTEX_HEAD)||"").replace(J.VERTEX_MAIN_SUPPORT,r.get(J.VERTEX_MAIN_SUPPORT)||""),this.needsUpdate=!0,this}setDefines(r){for(const e of r.entries())this.defines[e[0]]=e[1];return this.needsUpdate=!0,this}setUniforms(r){for(const e of r.entries())this.uniforms[e[0]]=e[1];return this}setExtensions(r){this.extensions={};for(const e of r)this.extensions[e]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(r){this.encodeOutput!==r&&(r?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(r){return this.encodeOutput}setOutputEncodingEnabled(r){this.encodeOutput=r}get time(){return this.uniforms.time.value}set time(r){this.uniforms.time.value=r}setDeltaTime(r){this.uniforms.time.value+=r}adoptCameraSettings(r){this.copyCameraSettings(r)}copyCameraSettings(r){r&&(this.uniforms.cameraNear.value=r.near,this.uniforms.cameraFar.value=r.far,r instanceof Ll?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(r,e){const t=this.uniforms;t.resolution.value.set(r,e),t.texelSize.value.set(1/r,1/e),t.aspect.value=r/e}static get Section(){return J}};function cl(r,e,t){for(const n of e){const s="$1"+r+n.charAt(0).toUpperCase()+n.slice(1),l=new RegExp("([^\\.])(\\b"+n+"\\b)","g");for(const h of t.entries())h[1]!==null&&t.set(h[0],h[1].replace(l,s))}}function Q_(r,e,t){let n=e.getFragmentShader(),s=e.getVertexShader();const l=n!==void 0&&/mainImage/.test(n),h=n!==void 0&&/mainUv/.test(n);if(t.attributes|=e.getAttributes(),n===void 0)throw new Error(`Missing fragment shader (${e.name})`);if(h&&(t.attributes&oi.CONVOLUTION)!==0)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${e.name})`);if(!l&&!h)throw new Error(`Could not find mainImage or mainUv function (${e.name})`);{const c=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,p=t.shaderParts;let d=p.get(J.FRAGMENT_HEAD)||"",f=p.get(J.FRAGMENT_MAIN_UV)||"",_=p.get(J.FRAGMENT_MAIN_IMAGE)||"",g=p.get(J.VERTEX_HEAD)||"",v=p.get(J.VERTEX_MAIN_SUPPORT)||"";const y=new Set,b=new Set;if(h&&(f+=`	${r}MainUv(UV);
`,t.uvTransformation=!0),s!==null&&/mainSupport/.test(s)){const E=/mainSupport *\([\w\s]*?uv\s*?\)/.test(s);v+=`	${r}MainSupport(`,v+=E?`vUv);
`:`);
`;for(const T of s.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const O of T[1].split(/\s*,\s*/))t.varyings.add(O),y.add(O),b.add(O);for(const T of s.matchAll(c))b.add(T[1])}for(const E of n.matchAll(c))b.add(E[1]);for(const E of e.defines.keys())b.add(E.replace(/\([\w\s,]*\)/g,""));for(const E of e.uniforms.keys())b.add(E);b.delete("while"),b.delete("for"),b.delete("if"),e.uniforms.forEach((E,T)=>t.uniforms.set(r+T.charAt(0).toUpperCase()+T.slice(1),E)),e.defines.forEach((E,T)=>t.defines.set(r+T.charAt(0).toUpperCase()+T.slice(1),E));const x=new Map([["fragment",n],["vertex",s]]);cl(r,b,t.defines),cl(r,b,x),n=x.get("fragment"),s=x.get("vertex");const w=e.blendMode;if(t.blendModes.set(w.blendFunction,w),l){e.inputColorSpace!==null&&e.inputColorSpace!==t.colorSpace&&(_+=e.inputColorSpace===xe?`color0 = sRGBTransferOETF(color0);
	`:`color0 = sRGBToLinear(color0);
	`),e.outputColorSpace!==ls?t.colorSpace=e.outputColorSpace:e.inputColorSpace!==null&&(t.colorSpace=e.inputColorSpace);const E=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;_+=`${r}MainImage(color0, UV, `,(t.attributes&oi.DEPTH)!==0&&E.test(n)&&(_+="depth, ",t.readDepth=!0),_+=`color1);
	`;const T=r+"BlendOpacity";t.uniforms.set(T,w.opacity),_+=`color0 = blend${w.blendFunction}(color0, color1, ${T});

	`,d+=`uniform float ${T};

`}if(d+=n+`
`,s!==null&&(g+=s+`
`),p.set(J.FRAGMENT_HEAD,d),p.set(J.FRAGMENT_MAIN_UV,f),p.set(J.FRAGMENT_MAIN_IMAGE,_),p.set(J.VERTEX_HEAD,g),p.set(J.VERTEX_MAIN_SUPPORT,v),e.extensions!==null)for(const E of e.extensions)t.extensions.add(E)}}var J_=class extends et{constructor(r,...e){super("EffectPass"),this.fullscreenMaterial=new X_(null,null,null,r),this.listener=t=>this.handleEvent(t),this.effects=[],this.setEffects(e),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(r){for(const e of this.effects)e.mainScene=r}set mainCamera(r){this.fullscreenMaterial.copyCameraSettings(r);for(const e of this.effects)e.mainCamera=r}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(r){this.fullscreenMaterial.encodeOutput=r}get dithering(){return this.fullscreenMaterial.dithering}set dithering(r){const e=this.fullscreenMaterial;e.dithering=r,e.needsUpdate=!0}setEffects(r){for(const e of this.effects)e.removeEventListener("change",this.listener);this.effects=r.sort((e,t)=>t.attributes-e.attributes);for(const e of this.effects)e.addEventListener("change",this.listener)}updateMaterial(){const r=new Wm;let e=0;for(const h of this.effects)if(h.blendMode.blendFunction===j.DST)r.attributes|=h.getAttributes()&oi.DEPTH;else{if((r.attributes&h.getAttributes()&oi.CONVOLUTION)!==0)throw new Error(`Convolution effects cannot be merged (${h.name})`);Q_("e"+e++,h,r)}let t=r.shaderParts.get(J.FRAGMENT_HEAD),n=r.shaderParts.get(J.FRAGMENT_MAIN_IMAGE),s=r.shaderParts.get(J.FRAGMENT_MAIN_UV);const l=/\bblend\b/g;for(const h of r.blendModes.values())t+=h.getShaderCode().replace(l,`blend${h.blendFunction}`)+`
`;(r.attributes&oi.DEPTH)!==0?(r.readDepth&&(n=`float depth = readDepth(UV);

	`+n),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,r.colorSpace===xe&&(n+=`color0 = sRGBToLinear(color0);
	`),r.uvTransformation?(s=`vec2 transformedUv = vUv;
`+s,r.defines.set("UV","transformedUv")):r.defines.set("UV","vUv"),r.shaderParts.set(J.FRAGMENT_HEAD,t),r.shaderParts.set(J.FRAGMENT_MAIN_IMAGE,n),r.shaderParts.set(J.FRAGMENT_MAIN_UV,s);for(const[h,c]of r.shaderParts)c!==null&&r.shaderParts.set(h,c.trim().replace(/^#/,`
#`));this.skipRendering=e===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(r)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(r,e=Ts){this.fullscreenMaterial.depthBuffer=r,this.fullscreenMaterial.depthPacking=e;for(const t of this.effects)t.setDepthTexture(r,e)}render(r,e,t,n,s){for(const l of this.effects)l.update(r,e,n);if(!this.skipRendering||this.renderToScreen){const l=this.fullscreenMaterial;l.inputBuffer=e.texture,l.time+=n*this.timeScale,r.setRenderTarget(this.renderToScreen?null:t),r.render(this.scene,this.camera)}}setSize(r,e){this.fullscreenMaterial.setSize(r,e);for(const t of this.effects)t.setSize(r,e)}initialize(r,e,t){this.renderer=r;for(const n of this.effects)n.initialize(r,e,t);this.updateMaterial(),t!==void 0&&t!==ai&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const r of this.effects)r.removeEventListener("change",this.listener),r.dispose()}handleEvent(r){switch(r.type){case"change":this.recompile();break}}},Tr,ul;function ev(){return ul||(ul=1,Tr={jet:[{index:0,rgb:[0,0,131]},{index:.125,rgb:[0,60,170]},{index:.375,rgb:[5,255,255]},{index:.625,rgb:[255,255,0]},{index:.875,rgb:[250,0,0]},{index:1,rgb:[128,0,0]}],hsv:[{index:0,rgb:[255,0,0]},{index:.169,rgb:[253,255,2]},{index:.173,rgb:[247,255,2]},{index:.337,rgb:[0,252,4]},{index:.341,rgb:[0,252,10]},{index:.506,rgb:[1,249,255]},{index:.671,rgb:[2,0,253]},{index:.675,rgb:[8,0,253]},{index:.839,rgb:[255,0,251]},{index:.843,rgb:[255,0,245]},{index:1,rgb:[255,0,6]}],hot:[{index:0,rgb:[0,0,0]},{index:.3,rgb:[230,0,0]},{index:.6,rgb:[255,210,0]},{index:1,rgb:[255,255,255]}],spring:[{index:0,rgb:[255,0,255]},{index:1,rgb:[255,255,0]}],summer:[{index:0,rgb:[0,128,102]},{index:1,rgb:[255,255,102]}],autumn:[{index:0,rgb:[255,0,0]},{index:1,rgb:[255,255,0]}],winter:[{index:0,rgb:[0,0,255]},{index:1,rgb:[0,255,128]}],bone:[{index:0,rgb:[0,0,0]},{index:.376,rgb:[84,84,116]},{index:.753,rgb:[169,200,200]},{index:1,rgb:[255,255,255]}],copper:[{index:0,rgb:[0,0,0]},{index:.804,rgb:[255,160,102]},{index:1,rgb:[255,199,127]}],greys:[{index:0,rgb:[0,0,0]},{index:1,rgb:[255,255,255]}],yignbu:[{index:0,rgb:[8,29,88]},{index:.125,rgb:[37,52,148]},{index:.25,rgb:[34,94,168]},{index:.375,rgb:[29,145,192]},{index:.5,rgb:[65,182,196]},{index:.625,rgb:[127,205,187]},{index:.75,rgb:[199,233,180]},{index:.875,rgb:[237,248,217]},{index:1,rgb:[255,255,217]}],greens:[{index:0,rgb:[0,68,27]},{index:.125,rgb:[0,109,44]},{index:.25,rgb:[35,139,69]},{index:.375,rgb:[65,171,93]},{index:.5,rgb:[116,196,118]},{index:.625,rgb:[161,217,155]},{index:.75,rgb:[199,233,192]},{index:.875,rgb:[229,245,224]},{index:1,rgb:[247,252,245]}],yiorrd:[{index:0,rgb:[128,0,38]},{index:.125,rgb:[189,0,38]},{index:.25,rgb:[227,26,28]},{index:.375,rgb:[252,78,42]},{index:.5,rgb:[253,141,60]},{index:.625,rgb:[254,178,76]},{index:.75,rgb:[254,217,118]},{index:.875,rgb:[255,237,160]},{index:1,rgb:[255,255,204]}],bluered:[{index:0,rgb:[0,0,255]},{index:1,rgb:[255,0,0]}],rdbu:[{index:0,rgb:[5,10,172]},{index:.35,rgb:[106,137,247]},{index:.5,rgb:[190,190,190]},{index:.6,rgb:[220,170,132]},{index:.7,rgb:[230,145,90]},{index:1,rgb:[178,10,28]}],picnic:[{index:0,rgb:[0,0,255]},{index:.1,rgb:[51,153,255]},{index:.2,rgb:[102,204,255]},{index:.3,rgb:[153,204,255]},{index:.4,rgb:[204,204,255]},{index:.5,rgb:[255,255,255]},{index:.6,rgb:[255,204,255]},{index:.7,rgb:[255,153,255]},{index:.8,rgb:[255,102,204]},{index:.9,rgb:[255,102,102]},{index:1,rgb:[255,0,0]}],rainbow:[{index:0,rgb:[150,0,90]},{index:.125,rgb:[0,0,200]},{index:.25,rgb:[0,25,255]},{index:.375,rgb:[0,152,255]},{index:.5,rgb:[44,255,150]},{index:.625,rgb:[151,255,0]},{index:.75,rgb:[255,234,0]},{index:.875,rgb:[255,111,0]},{index:1,rgb:[255,0,0]}],portland:[{index:0,rgb:[12,51,131]},{index:.25,rgb:[10,136,186]},{index:.5,rgb:[242,211,56]},{index:.75,rgb:[242,143,56]},{index:1,rgb:[217,30,30]}],blackbody:[{index:0,rgb:[0,0,0]},{index:.2,rgb:[230,0,0]},{index:.4,rgb:[230,210,0]},{index:.7,rgb:[255,255,255]},{index:1,rgb:[160,200,255]}],earth:[{index:0,rgb:[0,0,130]},{index:.1,rgb:[0,180,180]},{index:.2,rgb:[40,210,40]},{index:.4,rgb:[230,230,50]},{index:.6,rgb:[120,70,20]},{index:1,rgb:[255,255,255]}],electric:[{index:0,rgb:[0,0,0]},{index:.15,rgb:[30,0,100]},{index:.4,rgb:[120,0,100]},{index:.6,rgb:[160,90,0]},{index:.8,rgb:[230,200,0]},{index:1,rgb:[255,250,220]}],alpha:[{index:0,rgb:[255,255,255,0]},{index:1,rgb:[255,255,255,1]}],viridis:[{index:0,rgb:[68,1,84]},{index:.13,rgb:[71,44,122]},{index:.25,rgb:[59,81,139]},{index:.38,rgb:[44,113,142]},{index:.5,rgb:[33,144,141]},{index:.63,rgb:[39,173,129]},{index:.75,rgb:[92,200,99]},{index:.88,rgb:[170,220,50]},{index:1,rgb:[253,231,37]}],inferno:[{index:0,rgb:[0,0,4]},{index:.13,rgb:[31,12,72]},{index:.25,rgb:[85,15,109]},{index:.38,rgb:[136,34,106]},{index:.5,rgb:[186,54,85]},{index:.63,rgb:[227,89,51]},{index:.75,rgb:[249,140,10]},{index:.88,rgb:[249,201,50]},{index:1,rgb:[252,255,164]}],magma:[{index:0,rgb:[0,0,4]},{index:.13,rgb:[28,16,68]},{index:.25,rgb:[79,18,123]},{index:.38,rgb:[129,37,129]},{index:.5,rgb:[181,54,122]},{index:.63,rgb:[229,80,100]},{index:.75,rgb:[251,135,97]},{index:.88,rgb:[254,194,135]},{index:1,rgb:[252,253,191]}],plasma:[{index:0,rgb:[13,8,135]},{index:.13,rgb:[75,3,161]},{index:.25,rgb:[125,3,168]},{index:.38,rgb:[168,34,150]},{index:.5,rgb:[203,70,121]},{index:.63,rgb:[229,107,93]},{index:.75,rgb:[248,148,65]},{index:.88,rgb:[253,195,40]},{index:1,rgb:[240,249,33]}],warm:[{index:0,rgb:[125,0,179]},{index:.13,rgb:[172,0,187]},{index:.25,rgb:[219,0,170]},{index:.38,rgb:[255,0,130]},{index:.5,rgb:[255,63,74]},{index:.63,rgb:[255,123,0]},{index:.75,rgb:[234,176,0]},{index:.88,rgb:[190,228,0]},{index:1,rgb:[147,255,0]}],cool:[{index:0,rgb:[125,0,179]},{index:.13,rgb:[116,0,218]},{index:.25,rgb:[98,74,237]},{index:.38,rgb:[68,146,231]},{index:.5,rgb:[0,204,197]},{index:.63,rgb:[0,247,146]},{index:.75,rgb:[0,255,88]},{index:.88,rgb:[40,255,8]},{index:1,rgb:[147,255,0]}],"rainbow-soft":[{index:0,rgb:[125,0,179]},{index:.1,rgb:[199,0,180]},{index:.2,rgb:[255,0,121]},{index:.3,rgb:[255,108,0]},{index:.4,rgb:[222,194,0]},{index:.5,rgb:[150,255,0]},{index:.6,rgb:[0,255,55]},{index:.7,rgb:[0,246,150]},{index:.8,rgb:[50,167,222]},{index:.9,rgb:[103,51,235]},{index:1,rgb:[124,0,186]}],bathymetry:[{index:0,rgb:[40,26,44]},{index:.13,rgb:[59,49,90]},{index:.25,rgb:[64,76,139]},{index:.38,rgb:[63,110,151]},{index:.5,rgb:[72,142,158]},{index:.63,rgb:[85,174,163]},{index:.75,rgb:[120,206,163]},{index:.88,rgb:[187,230,172]},{index:1,rgb:[253,254,204]}],cdom:[{index:0,rgb:[47,15,62]},{index:.13,rgb:[87,23,86]},{index:.25,rgb:[130,28,99]},{index:.38,rgb:[171,41,96]},{index:.5,rgb:[206,67,86]},{index:.63,rgb:[230,106,84]},{index:.75,rgb:[242,149,103]},{index:.88,rgb:[249,193,135]},{index:1,rgb:[254,237,176]}],chlorophyll:[{index:0,rgb:[18,36,20]},{index:.13,rgb:[25,63,41]},{index:.25,rgb:[24,91,59]},{index:.38,rgb:[13,119,72]},{index:.5,rgb:[18,148,80]},{index:.63,rgb:[80,173,89]},{index:.75,rgb:[132,196,122]},{index:.88,rgb:[175,221,162]},{index:1,rgb:[215,249,208]}],density:[{index:0,rgb:[54,14,36]},{index:.13,rgb:[89,23,80]},{index:.25,rgb:[110,45,132]},{index:.38,rgb:[120,77,178]},{index:.5,rgb:[120,113,213]},{index:.63,rgb:[115,151,228]},{index:.75,rgb:[134,185,227]},{index:.88,rgb:[177,214,227]},{index:1,rgb:[230,241,241]}],"freesurface-blue":[{index:0,rgb:[30,4,110]},{index:.13,rgb:[47,14,176]},{index:.25,rgb:[41,45,236]},{index:.38,rgb:[25,99,212]},{index:.5,rgb:[68,131,200]},{index:.63,rgb:[114,156,197]},{index:.75,rgb:[157,181,203]},{index:.88,rgb:[200,208,216]},{index:1,rgb:[241,237,236]}],"freesurface-red":[{index:0,rgb:[60,9,18]},{index:.13,rgb:[100,17,27]},{index:.25,rgb:[142,20,29]},{index:.38,rgb:[177,43,27]},{index:.5,rgb:[192,87,63]},{index:.63,rgb:[205,125,105]},{index:.75,rgb:[216,162,148]},{index:.88,rgb:[227,199,193]},{index:1,rgb:[241,237,236]}],oxygen:[{index:0,rgb:[64,5,5]},{index:.13,rgb:[106,6,15]},{index:.25,rgb:[144,26,7]},{index:.38,rgb:[168,64,3]},{index:.5,rgb:[188,100,4]},{index:.63,rgb:[206,136,11]},{index:.75,rgb:[220,174,25]},{index:.88,rgb:[231,215,44]},{index:1,rgb:[248,254,105]}],par:[{index:0,rgb:[51,20,24]},{index:.13,rgb:[90,32,35]},{index:.25,rgb:[129,44,34]},{index:.38,rgb:[159,68,25]},{index:.5,rgb:[182,99,19]},{index:.63,rgb:[199,134,22]},{index:.75,rgb:[212,171,35]},{index:.88,rgb:[221,210,54]},{index:1,rgb:[225,253,75]}],phase:[{index:0,rgb:[145,105,18]},{index:.13,rgb:[184,71,38]},{index:.25,rgb:[186,58,115]},{index:.38,rgb:[160,71,185]},{index:.5,rgb:[110,97,218]},{index:.63,rgb:[50,123,164]},{index:.75,rgb:[31,131,110]},{index:.88,rgb:[77,129,34]},{index:1,rgb:[145,105,18]}],salinity:[{index:0,rgb:[42,24,108]},{index:.13,rgb:[33,50,162]},{index:.25,rgb:[15,90,145]},{index:.38,rgb:[40,118,137]},{index:.5,rgb:[59,146,135]},{index:.63,rgb:[79,175,126]},{index:.75,rgb:[120,203,104]},{index:.88,rgb:[193,221,100]},{index:1,rgb:[253,239,154]}],temperature:[{index:0,rgb:[4,35,51]},{index:.13,rgb:[23,51,122]},{index:.25,rgb:[85,59,157]},{index:.38,rgb:[129,79,143]},{index:.5,rgb:[175,95,130]},{index:.63,rgb:[222,112,101]},{index:.75,rgb:[249,146,66]},{index:.88,rgb:[249,196,65]},{index:1,rgb:[232,250,91]}],turbidity:[{index:0,rgb:[34,31,27]},{index:.13,rgb:[65,50,41]},{index:.25,rgb:[98,69,52]},{index:.38,rgb:[131,89,57]},{index:.5,rgb:[161,112,59]},{index:.63,rgb:[185,140,66]},{index:.75,rgb:[202,174,88]},{index:.88,rgb:[216,209,126]},{index:1,rgb:[233,246,171]}],"velocity-blue":[{index:0,rgb:[17,32,64]},{index:.13,rgb:[35,52,116]},{index:.25,rgb:[29,81,156]},{index:.38,rgb:[31,113,162]},{index:.5,rgb:[50,144,169]},{index:.63,rgb:[87,173,176]},{index:.75,rgb:[149,196,189]},{index:.88,rgb:[203,221,211]},{index:1,rgb:[254,251,230]}],"velocity-green":[{index:0,rgb:[23,35,19]},{index:.13,rgb:[24,64,38]},{index:.25,rgb:[11,95,45]},{index:.38,rgb:[39,123,35]},{index:.5,rgb:[95,146,12]},{index:.63,rgb:[152,165,18]},{index:.75,rgb:[201,186,69]},{index:.88,rgb:[233,216,137]},{index:1,rgb:[255,253,205]}],cubehelix:[{index:0,rgb:[0,0,0]},{index:.07,rgb:[22,5,59]},{index:.13,rgb:[60,4,105]},{index:.2,rgb:[109,1,135]},{index:.27,rgb:[161,0,147]},{index:.33,rgb:[210,2,142]},{index:.4,rgb:[251,11,123]},{index:.47,rgb:[255,29,97]},{index:.53,rgb:[255,54,69]},{index:.6,rgb:[255,85,46]},{index:.67,rgb:[255,120,34]},{index:.73,rgb:[255,157,37]},{index:.8,rgb:[241,191,57]},{index:.87,rgb:[224,220,93]},{index:.93,rgb:[218,241,142]},{index:1,rgb:[227,253,198]}]}),Tr}var Sr,dl;function tv(){if(dl)return Sr;dl=1;function r(e,t,n){return e*(1-n)+t*n}return Sr=r,Sr}var Pr,pl;function iv(){if(pl)return Pr;pl=1;var r=ev(),e=tv();Pr=t;function t(h){var c,p,d,f,_,g,v,y,E,b,x;if(h||(h={}),y=(h.nshades||72)-1,v=h.format||"hex",g=h.colormap,g||(g="jet"),typeof g=="string"){if(g=g.toLowerCase(),!r[g])throw Error(g+" not a supported colorscale");_=r[g]}else if(Array.isArray(g))_=g.slice();else throw Error("unsupported colormap option",g);if(_.length>y+1)throw new Error(g+" map requires nshades to be at least size "+_.length);Array.isArray(h.alpha)?h.alpha.length!==2?b=[1,1]:b=h.alpha.slice():typeof h.alpha=="number"?b=[h.alpha,h.alpha]:b=[1,1],c=_.map(function(A){return Math.round(A.index*y)}),b[0]=Math.min(Math.max(b[0],0),1),b[1]=Math.min(Math.max(b[1],0),1);var w=_.map(function(A,M){var R=_[M].index,D=_[M].rgb.slice();return D.length===4&&D[3]>=0&&D[3]<=1||(D[3]=b[0]+(b[1]-b[0])*R),D}),E=[];for(x=0;x<c.length-1;++x){f=c[x+1]-c[x],p=w[x],d=w[x+1];for(var T=0;T<f;T++){var O=T/f;E.push([Math.round(e(p[0],d[0],O)),Math.round(e(p[1],d[1],O)),Math.round(e(p[2],d[2],O)),e(p[3],d[3],O)])}}return E.push(_[_.length-1].rgb.concat(b[1])),v==="hex"?E=E.map(s):v==="rgbaString"?E=E.map(l):v==="float"&&(E=E.map(n)),E}function n(h){return[h[0]/255,h[1]/255,h[2]/255,h[3]]}function s(h){for(var c,p="#",d=0;d<3;++d)c=h[d],c=c.toString(16),p+=("00"+c).substr(c.length);return p}function l(h){return"rgba("+h.join(",")+")"}return Pr}var nv=iv();const sv=Al(nv),fl=(r,e)=>sv({colormap:r,nshades:e,format:"float",alpha:1}),ml=(r,e,t)=>r*(1-t)+e*t,_l=(r,e,t)=>rv((t-r)/(e-r)),rv=(r,e=0,t=1)=>Math.min(t,Math.max(e,r));var ov=Ap();const Re=1024,av=60,lv=-10,hv=-5,cv=["perceptualSharpness","perceptualSpread","spectralFlatness","spectralKurtosis","amplitudeSpectrum","loudness"],uv=10,dv=(r,e)=>{const t=[];for(let n=0;n<r;n++)t.push(Array(e).fill(0));return t},pv=(r,e,t=.4,n=.5)=>e*(1+Math.log10((r+1)/Re/2)),fv=r=>Math.floor(r/Re/2),mv=r=>{const{perceptualSpread:e,perceptualSharpness:t,spectralKurtosis:n,spectralFlatness:s,loudness:l}=r;return{loudness:_l(0,50,l.total),spectralKurtosis:_l(5,40,n),perceptualSharpness:t,perceptualSpread:e,spectralFlatness:s}},_v={audio:{channelCount:{ideal:2,min:1},echoCancellation:!0,autoGainControl:!0,noiseSuppression:!0}},vv=["amplitudeSpectrum","spectralCentroid","spectralRolloff","perceptualSharpness","loudness","rms","chroma","mfcc"];class gv{meydaPromise({constrains:e=_v,bufferSize:t=Re}){return!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia?Promise.reject(new Error("getUserMedia is not supported in this browser. Please use a modern browser with Web Audio API support.")):navigator.mediaDevices.getUserMedia(e).then(n=>this.successStream({stream:n,bufferSize:t})).catch(n=>this.errorStream(n))}successStream({stream:e,bufferSize:t}){this.audioContext=new AudioContext;const n=e.getAudioTracks()[0];return n&&(this.streamAudioSettings=n.getSettings()),this.source=this.audioContext.createMediaStreamSource(e),this.meyda=ov.createMeydaAnalyzer({audioContext:this.audioContext,source:this.source,bufferSize:t}),this.meyda.start(),e}errorStream(e){e.name==="NotAllowedError"?console.error("AudioFeaturesExtractor: Microphone access denied by user"):e.name==="NotFoundError"?console.error("AudioFeaturesExtractor: No microphone device found"):e.name==="NotSupportedError"?console.error("AudioFeaturesExtractor: getUserMedia not supported in this browser"):console.error("AudioFeaturesExtractor:",e.message||e)}features(e=vv){return!this.meyda||!this.audioContext?null:this.meyda.get(e)}signal(){return this.meyda?this.meyda._m.signal:null}}function bv(r){return Nl(document,"keydown").pipe(Mp(e=>e.keyCode===r),Rp(!1),Dp(e=>!e))}function xv(r){return Nl(r,"click").pipe(kp(250),Lp())}function yv(r,e,t){let n=!1;const s=t.subscribe(l=>{n=l,l?r.setAnimationLoop(null):r.setAnimationLoop(e)});return n||r.setAnimationLoop(e),()=>{r.setAnimationLoop(null),s.unsubscribe()}}const qr=Math.min(1.2,window.devicePixelRatio);function wv({renderer:r,composer:e}){const t=r.domElement,n=t.clientWidth*qr|0,s=t.clientHeight*qr|0,l=t.width!==n||t.height!==s;return l&&(r.setSize(n,s,!1),e.setSize(n,s)),l}const he={LEFT:1,RIGHT:2,MIDDLE:4},P=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,SCREEN_PAN:4,OFFSET:8,DOLLY:16,ZOOM:32,TOUCH_ROTATE:64,TOUCH_TRUCK:128,TOUCH_SCREEN_PAN:256,TOUCH_OFFSET:512,TOUCH_DOLLY:1024,TOUCH_ZOOM:2048,TOUCH_DOLLY_TRUCK:4096,TOUCH_DOLLY_SCREEN_PAN:8192,TOUCH_DOLLY_OFFSET:16384,TOUCH_DOLLY_ROTATE:32768,TOUCH_ZOOM_TRUCK:65536,TOUCH_ZOOM_OFFSET:131072,TOUCH_ZOOM_SCREEN_PAN:262144,TOUCH_ZOOM_ROTATE:524288}),Ei={NONE:0,IN:1,OUT:-1};function Zt(r){return r.isPerspectiveCamera}function Ot(r){return r.isOrthographicCamera}const St=Math.PI*2,vl=Math.PI/2,jh=1e-5,hn=Math.PI/180;function Ze(r,e,t){return Math.max(e,Math.min(t,r))}function oe(r,e=jh){return Math.abs(r)<e}function ne(r,e,t=jh){return oe(r-e,t)}function gl(r,e){return Math.round(r/e)*e}function cn(r){return isFinite(r)?r:r<0?-Number.MAX_VALUE:Number.MAX_VALUE}function un(r){return Math.abs(r)<Number.MAX_VALUE?r:r*(1/0)}function es(r,e,t,n,s=1/0,l){n=Math.max(1e-4,n);const h=2/n,c=h*l,p=1/(1+c+.48*c*c+.235*c*c*c);let d=r-e;const f=e,_=s*n;d=Ze(d,-_,_),e=r-d;const g=(t.value+h*d)*l;t.value=(t.value-h*g)*p;let v=e+(d+g)*p;return f-r>0==v>f&&(v=f,t.value=(v-f)/l),v}function bl(r,e,t,n,s=1/0,l,h){n=Math.max(1e-4,n);const c=2/n,p=c*l,d=1/(1+p+.48*p*p+.235*p*p*p);let f=e.x,_=e.y,g=e.z,v=r.x-f,y=r.y-_,b=r.z-g;const x=f,w=_,E=g,T=s*n,O=T*T,A=v*v+y*y+b*b;if(A>O){const z=Math.sqrt(A);v=v/z*T,y=y/z*T,b=b/z*T}f=r.x-v,_=r.y-y,g=r.z-b;const M=(t.x+c*v)*l,R=(t.y+c*y)*l,D=(t.z+c*b)*l;t.x=(t.x-c*M)*d,t.y=(t.y-c*R)*d,t.z=(t.z-c*D)*d,h.x=f+(v+M)*d,h.y=_+(y+R)*d,h.z=g+(b+D)*d;const k=x-r.x,I=w-r.y,H=E-r.z,K=h.x-x,ee=h.y-w,q=h.z-E;return k*K+I*ee+H*q>0&&(h.x=x,h.y=w,h.z=E,t.x=(h.x-x)/l,t.y=(h.y-w)/l,t.z=(h.z-E)/l),h}function Or(r,e){e.set(0,0),r.forEach(t=>{e.x+=t.clientX,e.y+=t.clientY}),e.x/=r.length,e.y/=r.length}function Ar(r,e){return Ot(r)?(console.warn(`${e} is not supported in OrthographicCamera`),!0):!1}class Ev{_listeners={};addEventListener(e,t){const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){const s=this._listeners[e];if(s!==void 0){const l=s.indexOf(t);l!==-1&&s.splice(l,1)}}removeAllEventListeners(e){if(!e){this._listeners={};return}Array.isArray(this._listeners[e])&&(this._listeners[e].length=0)}dispatchEvent(e){const n=this._listeners[e.type];if(n!==void 0){e.target=this;const s=n.slice(0);for(let l=0,h=s.length;l<h;l++)s[l].call(this,e)}}}const Cv="3.1.2",ts=1/8,Tv=/Mac/.test(globalThis?.navigator?.platform);let F,xl,is,Mr,Ae,G,Q,Ci,dn,st,rt,Xt,yl,wl,Be,Ti,Si,El,Rr,Cl,Dr,kr,ns;class Mn extends Ev{static install(e){F=e.THREE,xl=Object.freeze(new F.Vector3(0,0,0)),is=Object.freeze(new F.Vector3(0,1,0)),Mr=Object.freeze(new F.Vector3(0,0,1)),Ae=new F.Vector2,G=new F.Vector3,Q=new F.Vector3,Ci=new F.Vector3,dn=new F.Vector3,st=new F.Vector3,rt=new F.Vector3,Xt=new F.Vector3,yl=new F.Vector3,wl=new F.Vector3,Be=new F.Spherical,Ti=new F.Spherical,Si=new F.Box3,El=new F.Box3,Rr=new F.Sphere,Cl=new F.Quaternion,Dr=new F.Quaternion,kr=new F.Matrix4,ns=new F.Raycaster}static get ACTION(){return P}minPolarAngle=0;maxPolarAngle=Math.PI;minAzimuthAngle=-1/0;maxAzimuthAngle=1/0;minDistance=Number.EPSILON;maxDistance=1/0;infinityDolly=!1;minZoom=.01;maxZoom=1/0;smoothTime=.25;draggingSmoothTime=.125;maxSpeed=1/0;azimuthRotateSpeed=1;polarRotateSpeed=1;dollySpeed=1;dollyDragInverted=!1;truckSpeed=2;dollyToCursor=!1;dragToOffset=!1;boundaryFriction=0;restThreshold=.01;colliderMeshes=[];mouseButtons;touches;cancel=()=>{};lockPointer;unlockPointer;_enabled=!0;_camera;_yAxisUpSpace;_yAxisUpSpaceInverse;_state=P.NONE;_domElement;_viewport=null;_target;_targetEnd;_focalOffset;_focalOffsetEnd;_spherical;_sphericalEnd;_lastDistance;_zoom;_zoomEnd;_lastZoom;_cameraUp0;_target0;_position0;_zoom0;_focalOffset0;_dollyControlCoord;_changedDolly=0;_changedZoom=0;_nearPlaneCorners;_hasRested=!0;_boundary;_boundaryEnclosesCamera=!1;_needsUpdate=!0;_updatedLastTime=!1;_elementRect=new DOMRect;_isDragging=!1;_dragNeedsUpdate=!0;_activePointers=[];_lockedPointer=null;_interactiveArea=new DOMRect(0,0,1,1);_isUserControllingRotate=!1;_isUserControllingDolly=!1;_isUserControllingTruck=!1;_isUserControllingOffset=!1;_isUserControllingZoom=!1;_lastDollyDirection=Ei.NONE;_thetaVelocity={value:0};_phiVelocity={value:0};_radiusVelocity={value:0};_targetVelocity=new F.Vector3;_focalOffsetVelocity=new F.Vector3;_zoomVelocity={value:0};set verticalDragToForward(e){console.warn("camera-controls: `verticalDragToForward` was removed. Use `mouseButtons.left = CameraControls.ACTION.SCREEN_PAN` instead.")}constructor(e,t){super(),typeof F>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=e,this._yAxisUpSpace=new F.Quaternion().setFromUnitVectors(this._camera.up,is),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=P.NONE,this._target=new F.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new F.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new F.Spherical().setFromVector3(G.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new F.Vector3,new F.Vector3,new F.Vector3,new F.Vector3],this._updateNearPlaneCorners(),this._boundary=new F.Box3(new F.Vector3(-1/0,-1/0,-1/0),new F.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new F.Vector2,this.mouseButtons={left:P.ROTATE,middle:P.DOLLY,right:P.TRUCK,wheel:Zt(this._camera)?P.DOLLY:Ot(this._camera)?P.ZOOM:P.NONE},this.touches={one:P.TOUCH_ROTATE,two:Zt(this._camera)?P.TOUCH_DOLLY_TRUCK:Ot(this._camera)?P.TOUCH_ZOOM_TRUCK:P.NONE,three:P.TOUCH_TRUCK};const n=new F.Vector2,s=new F.Vector2,l=new F.Vector2,h=w=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const O=this._domElement.getBoundingClientRect(),A=w.clientX/O.width,M=w.clientY/O.height;if(A<this._interactiveArea.left||A>this._interactiveArea.right||M<this._interactiveArea.top||M>this._interactiveArea.bottom)return}const E=w.pointerType!=="mouse"?null:(w.buttons&he.LEFT)===he.LEFT?he.LEFT:(w.buttons&he.MIDDLE)===he.MIDDLE?he.MIDDLE:(w.buttons&he.RIGHT)===he.RIGHT?he.RIGHT:null;if(E!==null){const O=this._findPointerByMouseButton(E);O&&this._disposePointer(O)}if((w.buttons&he.LEFT)===he.LEFT&&this._lockedPointer)return;const T={pointerId:w.pointerId,clientX:w.clientX,clientY:w.clientY,deltaX:0,deltaY:0,mouseButton:E};this._activePointers.push(T),this._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",p),this._domElement.ownerDocument.addEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",p),this._isDragging=!0,g(w)},c=w=>{w.cancelable&&w.preventDefault();const E=w.pointerId,T=this._lockedPointer||this._findPointerById(E);if(T){if(T.clientX=w.clientX,T.clientY=w.clientY,T.deltaX=w.movementX,T.deltaY=w.movementY,this._state=0,w.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(w.buttons&he.LEFT)===he.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(w.buttons&he.MIDDLE)===he.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(w.buttons&he.RIGHT)===he.RIGHT&&(this._state=this._state|this.mouseButtons.right);v()}},p=w=>{const E=this._findPointerById(w.pointerId);if(!(E&&E===this._lockedPointer)){if(E&&this._disposePointer(E),w.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=P.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=P.NONE;y()}};let d=-1;const f=w=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===P.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const R=this._domElement.getBoundingClientRect(),D=w.clientX/R.width,k=w.clientY/R.height;if(D<this._interactiveArea.left||D>this._interactiveArea.right||k<this._interactiveArea.top||k>this._interactiveArea.bottom)return}if(w.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===P.ROTATE||this.mouseButtons.wheel===P.TRUCK){const R=performance.now();d-R<1e3&&this._getClientRect(this._elementRect),d=R}const E=Tv?-1:-3,T=w.deltaMode===1&&!w.ctrlKey?w.deltaY/E:w.deltaY/(E*10),O=this.dollyToCursor?(w.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,A=this.dollyToCursor?(w.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(w.ctrlKey?P.ZOOM:this.mouseButtons.wheel){case P.ROTATE:{this._rotateInternal(w.deltaX,w.deltaY),this._isUserControllingRotate=!0;break}case P.TRUCK:{this._truckInternal(w.deltaX,w.deltaY,!1,!1),this._isUserControllingTruck=!0;break}case P.SCREEN_PAN:{this._truckInternal(w.deltaX,w.deltaY,!1,!0),this._isUserControllingTruck=!0;break}case P.OFFSET:{this._truckInternal(w.deltaX,w.deltaY,!0,!1),this._isUserControllingOffset=!0;break}case P.DOLLY:{this._dollyInternal(-T,O,A),this._isUserControllingDolly=!0;break}case P.ZOOM:{this._zoomInternal(-T,O,A),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},_=w=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===Mn.ACTION.NONE){const E=w instanceof PointerEvent?w.pointerId:0,T=this._findPointerById(E);T&&this._disposePointer(T),this._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",p);return}w.preventDefault()}},g=w=>{if(!this._enabled)return;if(Or(this._activePointers,Ae),this._getClientRect(this._elementRect),n.copy(Ae),s.copy(Ae),this._activePointers.length>=2){const T=Ae.x-this._activePointers[1].clientX,O=Ae.y-this._activePointers[1].clientY,A=Math.sqrt(T*T+O*O);l.set(0,A);const M=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,R=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;s.set(M,R)}if(this._state=0,!w)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in w&&w.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(w.buttons&he.LEFT)===he.LEFT&&(this._state=this._state|this.mouseButtons.left),(w.buttons&he.MIDDLE)===he.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(w.buttons&he.RIGHT)===he.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&P.ROTATE)===P.ROTATE||(this._state&P.TOUCH_ROTATE)===P.TOUCH_ROTATE||(this._state&P.TOUCH_DOLLY_ROTATE)===P.TOUCH_DOLLY_ROTATE||(this._state&P.TOUCH_ZOOM_ROTATE)===P.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&P.TRUCK)===P.TRUCK||(this._state&P.SCREEN_PAN)===P.SCREEN_PAN||(this._state&P.TOUCH_TRUCK)===P.TOUCH_TRUCK||(this._state&P.TOUCH_SCREEN_PAN)===P.TOUCH_SCREEN_PAN||(this._state&P.TOUCH_DOLLY_TRUCK)===P.TOUCH_DOLLY_TRUCK||(this._state&P.TOUCH_DOLLY_SCREEN_PAN)===P.TOUCH_DOLLY_SCREEN_PAN||(this._state&P.TOUCH_ZOOM_TRUCK)===P.TOUCH_ZOOM_TRUCK||(this._state&P.TOUCH_ZOOM_SCREEN_PAN)===P.TOUCH_DOLLY_SCREEN_PAN)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&P.DOLLY)===P.DOLLY||(this._state&P.TOUCH_DOLLY)===P.TOUCH_DOLLY||(this._state&P.TOUCH_DOLLY_TRUCK)===P.TOUCH_DOLLY_TRUCK||(this._state&P.TOUCH_DOLLY_SCREEN_PAN)===P.TOUCH_DOLLY_SCREEN_PAN||(this._state&P.TOUCH_DOLLY_OFFSET)===P.TOUCH_DOLLY_OFFSET||(this._state&P.TOUCH_DOLLY_ROTATE)===P.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&P.ZOOM)===P.ZOOM||(this._state&P.TOUCH_ZOOM)===P.TOUCH_ZOOM||(this._state&P.TOUCH_ZOOM_TRUCK)===P.TOUCH_ZOOM_TRUCK||(this._state&P.TOUCH_ZOOM_SCREEN_PAN)===P.TOUCH_ZOOM_SCREEN_PAN||(this._state&P.TOUCH_ZOOM_OFFSET)===P.TOUCH_ZOOM_OFFSET||(this._state&P.TOUCH_ZOOM_ROTATE)===P.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&P.OFFSET)===P.OFFSET||(this._state&P.TOUCH_OFFSET)===P.TOUCH_OFFSET||(this._state&P.TOUCH_DOLLY_OFFSET)===P.TOUCH_DOLLY_OFFSET||(this._state&P.TOUCH_ZOOM_OFFSET)===P.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})},v=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,Or(this._activePointers,Ae);const E=this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,T=E?-E.deltaX:s.x-Ae.x,O=E?-E.deltaY:s.y-Ae.y;if(s.copy(Ae),((this._state&P.ROTATE)===P.ROTATE||(this._state&P.TOUCH_ROTATE)===P.TOUCH_ROTATE||(this._state&P.TOUCH_DOLLY_ROTATE)===P.TOUCH_DOLLY_ROTATE||(this._state&P.TOUCH_ZOOM_ROTATE)===P.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(T,O),this._isUserControllingRotate=!0),(this._state&P.DOLLY)===P.DOLLY||(this._state&P.ZOOM)===P.ZOOM){const A=this.dollyToCursor?(n.x-this._elementRect.x)/this._elementRect.width*2-1:0,M=this.dollyToCursor?(n.y-this._elementRect.y)/this._elementRect.height*-2+1:0,R=this.dollyDragInverted?-1:1;(this._state&P.DOLLY)===P.DOLLY?(this._dollyInternal(R*O*ts,A,M),this._isUserControllingDolly=!0):(this._zoomInternal(R*O*ts,A,M),this._isUserControllingZoom=!0)}if((this._state&P.TOUCH_DOLLY)===P.TOUCH_DOLLY||(this._state&P.TOUCH_ZOOM)===P.TOUCH_ZOOM||(this._state&P.TOUCH_DOLLY_TRUCK)===P.TOUCH_DOLLY_TRUCK||(this._state&P.TOUCH_ZOOM_TRUCK)===P.TOUCH_ZOOM_TRUCK||(this._state&P.TOUCH_DOLLY_SCREEN_PAN)===P.TOUCH_DOLLY_SCREEN_PAN||(this._state&P.TOUCH_ZOOM_SCREEN_PAN)===P.TOUCH_ZOOM_SCREEN_PAN||(this._state&P.TOUCH_DOLLY_OFFSET)===P.TOUCH_DOLLY_OFFSET||(this._state&P.TOUCH_ZOOM_OFFSET)===P.TOUCH_ZOOM_OFFSET||(this._state&P.TOUCH_DOLLY_ROTATE)===P.TOUCH_DOLLY_ROTATE||(this._state&P.TOUCH_ZOOM_ROTATE)===P.TOUCH_ZOOM_ROTATE){const A=Ae.x-this._activePointers[1].clientX,M=Ae.y-this._activePointers[1].clientY,R=Math.sqrt(A*A+M*M),D=l.y-R;l.set(0,R);const k=this.dollyToCursor?(s.x-this._elementRect.x)/this._elementRect.width*2-1:0,I=this.dollyToCursor?(s.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&P.TOUCH_DOLLY)===P.TOUCH_DOLLY||(this._state&P.TOUCH_DOLLY_ROTATE)===P.TOUCH_DOLLY_ROTATE||(this._state&P.TOUCH_DOLLY_TRUCK)===P.TOUCH_DOLLY_TRUCK||(this._state&P.TOUCH_DOLLY_SCREEN_PAN)===P.TOUCH_DOLLY_SCREEN_PAN||(this._state&P.TOUCH_DOLLY_OFFSET)===P.TOUCH_DOLLY_OFFSET?(this._dollyInternal(D*ts,k,I),this._isUserControllingDolly=!0):(this._zoomInternal(D*ts,k,I),this._isUserControllingZoom=!0)}((this._state&P.TRUCK)===P.TRUCK||(this._state&P.TOUCH_TRUCK)===P.TOUCH_TRUCK||(this._state&P.TOUCH_DOLLY_TRUCK)===P.TOUCH_DOLLY_TRUCK||(this._state&P.TOUCH_ZOOM_TRUCK)===P.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(T,O,!1,!1),this._isUserControllingTruck=!0),((this._state&P.SCREEN_PAN)===P.SCREEN_PAN||(this._state&P.TOUCH_SCREEN_PAN)===P.TOUCH_SCREEN_PAN||(this._state&P.TOUCH_DOLLY_SCREEN_PAN)===P.TOUCH_DOLLY_SCREEN_PAN||(this._state&P.TOUCH_ZOOM_SCREEN_PAN)===P.TOUCH_ZOOM_SCREEN_PAN)&&(this._truckInternal(T,O,!1,!0),this._isUserControllingTruck=!0),((this._state&P.OFFSET)===P.OFFSET||(this._state&P.TOUCH_OFFSET)===P.TOUCH_OFFSET||(this._state&P.TOUCH_DOLLY_OFFSET)===P.TOUCH_DOLLY_OFFSET||(this._state&P.TOUCH_ZOOM_OFFSET)===P.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(T,O,!0,!1),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},y=()=>{Or(this._activePointers,Ae),s.copy(Ae),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",p),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",p),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",b),this._domElement.ownerDocument.addEventListener("pointerlockerror",x),this._domElement.ownerDocument.addEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",p),g())},this.unlockPointer=()=>{this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),this._domElement?.ownerDocument.exitPointerLock(),this._domElement?.ownerDocument.removeEventListener("pointerlockchange",b),this._domElement?.ownerDocument.removeEventListener("pointerlockerror",x),this.cancel()};const b=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},x=()=>{this.unlockPointer()};this._addAllEventListeners=w=>{this._domElement=w,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",h),this._domElement.addEventListener("pointercancel",p),this._domElement.addEventListener("wheel",f,{passive:!1}),this._domElement.addEventListener("contextmenu",_)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",h),this._domElement.removeEventListener("pointercancel",p),this._domElement.removeEventListener("wheel",f,{passive:!1}),this._domElement.removeEventListener("contextmenu",_),this._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",p),this._domElement.ownerDocument.removeEventListener("pointerlockchange",b),this._domElement.ownerDocument.removeEventListener("pointerlockerror",x))},this.cancel=()=>{this._state!==P.NONE&&(this._state=P.NONE,this._activePointers.length=0,y())},t&&this.connect(t),this.update(0)}get camera(){return this._camera}set camera(e){this._camera=e,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._domElement&&(e?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(e){this._spherical.radius===e&&this._sphericalEnd.radius===e||(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(e){this._spherical.theta===e&&this._sphericalEnd.theta===e||(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(e){this._spherical.phi===e&&this._sphericalEnd.phi===e||(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0}set interactiveArea(e){this._interactiveArea.width=Ze(e.width,0,1),this._interactiveArea.height=Ze(e.height,0,1),this._interactiveArea.x=Ze(e.x,0,1-this._interactiveArea.width),this._interactiveArea.y=Ze(e.y,0,1-this._interactiveArea.height)}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}rotate(e,t,n=!1){return this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,n)}rotateAzimuthTo(e,t=!1){return this.rotateTo(e,this._sphericalEnd.phi,t)}rotatePolarTo(e,t=!1){return this.rotateTo(this._sphericalEnd.theta,e,t)}rotateTo(e,t,n=!1){this._isUserControllingRotate=!1;const s=Ze(e,this.minAzimuthAngle,this.maxAzimuthAngle),l=Ze(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=s,this._sphericalEnd.phi=l,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,n||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const h=!n||ne(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&ne(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(h)}dolly(e,t=!1){return this.dollyTo(this._sphericalEnd.radius-e,t)}dollyTo(e,t=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=Ei.NONE,this._changedDolly=0,this._dollyToNoClamp(Ze(e,this.minDistance,this.maxDistance),t)}_dollyToNoClamp(e,t=!1){const n=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const h=this._collisionTest(),c=ne(h,this._spherical.radius);if(!(n>e)&&c)return Promise.resolve();this._sphericalEnd.radius=Math.min(e,h)}else this._sphericalEnd.radius=e;this._needsUpdate=!0,t||(this._spherical.radius=this._sphericalEnd.radius);const l=!t||ne(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(l)}dollyInFixed(e,t=!1){this._targetEnd.add(this._getCameraDirection(dn).multiplyScalar(e)),t||this._target.copy(this._targetEnd);const n=!t||ne(this._target.x,this._targetEnd.x,this.restThreshold)&&ne(this._target.y,this._targetEnd.y,this.restThreshold)&&ne(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(n)}zoom(e,t=!1){return this.zoomTo(this._zoomEnd+e,t)}zoomTo(e,t=!1){this._isUserControllingZoom=!1,this._zoomEnd=Ze(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,t||(this._zoom=this._zoomEnd);const n=!t||ne(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(n)}pan(e,t,n=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(e,t,n)}truck(e,t,n=!1){this._camera.updateMatrix(),st.setFromMatrixColumn(this._camera.matrix,0),rt.setFromMatrixColumn(this._camera.matrix,1),st.multiplyScalar(e),rt.multiplyScalar(-t);const s=G.copy(st).add(rt),l=Q.copy(this._targetEnd).add(s);return this.moveTo(l.x,l.y,l.z,n)}forward(e,t=!1){G.setFromMatrixColumn(this._camera.matrix,0),G.crossVectors(this._camera.up,G),G.multiplyScalar(e);const n=Q.copy(this._targetEnd).add(G);return this.moveTo(n.x,n.y,n.z,t)}elevate(e,t=!1){return G.copy(this._camera.up).multiplyScalar(e),this.moveTo(this._targetEnd.x+G.x,this._targetEnd.y+G.y,this._targetEnd.z+G.z,t)}moveTo(e,t,n,s=!1){this._isUserControllingTruck=!1;const l=G.set(e,t,n).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,l,this.boundaryFriction),this._needsUpdate=!0,s||this._target.copy(this._targetEnd);const h=!s||ne(this._target.x,this._targetEnd.x,this.restThreshold)&&ne(this._target.y,this._targetEnd.y,this.restThreshold)&&ne(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(h)}lookInDirectionOf(e,t,n,s=!1){const c=G.set(e,t,n).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius).add(this._targetEnd);return this.setPosition(c.x,c.y,c.z,s)}fitToBox(e,t,{cover:n=!1,paddingLeft:s=0,paddingRight:l=0,paddingBottom:h=0,paddingTop:c=0}={}){const p=[],d=e.isBox3?Si.copy(e):Si.setFromObject(e);d.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const f=gl(this._sphericalEnd.theta,vl),_=gl(this._sphericalEnd.phi,vl);p.push(this.rotateTo(f,_,t));const g=G.setFromSpherical(this._sphericalEnd).normalize(),v=Cl.setFromUnitVectors(g,Mr),y=ne(Math.abs(g.y),1);y&&v.multiply(Dr.setFromAxisAngle(is,f)),v.multiply(this._yAxisUpSpaceInverse);const b=El.makeEmpty();Q.copy(d.min).applyQuaternion(v),b.expandByPoint(Q),Q.copy(d.min).setX(d.max.x).applyQuaternion(v),b.expandByPoint(Q),Q.copy(d.min).setY(d.max.y).applyQuaternion(v),b.expandByPoint(Q),Q.copy(d.max).setZ(d.min.z).applyQuaternion(v),b.expandByPoint(Q),Q.copy(d.min).setZ(d.max.z).applyQuaternion(v),b.expandByPoint(Q),Q.copy(d.max).setY(d.min.y).applyQuaternion(v),b.expandByPoint(Q),Q.copy(d.max).setX(d.min.x).applyQuaternion(v),b.expandByPoint(Q),Q.copy(d.max).applyQuaternion(v),b.expandByPoint(Q),b.min.x-=s,b.min.y-=h,b.max.x+=l,b.max.y+=c,v.setFromUnitVectors(Mr,g),y&&v.premultiply(Dr.invert()),v.premultiply(this._yAxisUpSpace);const x=b.getSize(G),w=b.getCenter(Q).applyQuaternion(v);if(Zt(this._camera)){const E=this.getDistanceToFitBox(x.x,x.y,x.z,n);p.push(this.moveTo(w.x,w.y,w.z,t)),p.push(this.dollyTo(E,t)),p.push(this.setFocalOffset(0,0,0,t))}else if(Ot(this._camera)){const E=this._camera,T=E.right-E.left,O=E.top-E.bottom,A=n?Math.max(T/x.x,O/x.y):Math.min(T/x.x,O/x.y);p.push(this.moveTo(w.x,w.y,w.z,t)),p.push(this.zoomTo(A,t)),p.push(this.setFocalOffset(0,0,0,t))}return Promise.all(p)}fitToSphere(e,t){const n=[],l="isObject3D"in e?Mn.createBoundingSphere(e,Rr):Rr.copy(e);if(n.push(this.moveTo(l.center.x,l.center.y,l.center.z,t)),Zt(this._camera)){const h=this.getDistanceToFitSphere(l.radius);n.push(this.dollyTo(h,t))}else if(Ot(this._camera)){const h=this._camera.right-this._camera.left,c=this._camera.top-this._camera.bottom,p=2*l.radius,d=Math.min(h/p,c/p);n.push(this.zoomTo(d,t))}return n.push(this.setFocalOffset(0,0,0,t)),Promise.all(n)}setLookAt(e,t,n,s,l,h,c=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=Ei.NONE,this._changedDolly=0;const p=Q.set(s,l,h),d=G.set(e,t,n);this._targetEnd.copy(p),this._sphericalEnd.setFromVector3(d.sub(p).applyQuaternion(this._yAxisUpSpace)),this._needsUpdate=!0,c||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const f=!c||ne(this._target.x,this._targetEnd.x,this.restThreshold)&&ne(this._target.y,this._targetEnd.y,this.restThreshold)&&ne(this._target.z,this._targetEnd.z,this.restThreshold)&&ne(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&ne(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&ne(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(f)}lerp(e,t,n,s=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=Ei.NONE,this._changedDolly=0;const l=G.set(...e.target);if("spherical"in e)Be.set(...e.spherical);else{const _=Q.set(...e.position);Be.setFromVector3(_.sub(l).applyQuaternion(this._yAxisUpSpace))}const h=Ci.set(...t.target);if("spherical"in t)Ti.set(...t.spherical);else{const _=Q.set(...t.position);Ti.setFromVector3(_.sub(h).applyQuaternion(this._yAxisUpSpace))}this._targetEnd.copy(l.lerp(h,n));const c=Ti.theta-Be.theta,p=Ti.phi-Be.phi,d=Ti.radius-Be.radius;this._sphericalEnd.set(Be.radius+d*n,Be.phi+p*n,Be.theta+c*n),this._needsUpdate=!0,s||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const f=!s||ne(this._target.x,this._targetEnd.x,this.restThreshold)&&ne(this._target.y,this._targetEnd.y,this.restThreshold)&&ne(this._target.z,this._targetEnd.z,this.restThreshold)&&ne(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&ne(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&ne(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(f)}lerpLookAt(e,t,n,s,l,h,c,p,d,f,_,g,v,y=!1){return this.lerp({position:[e,t,n],target:[s,l,h]},{position:[c,p,d],target:[f,_,g]},v,y)}setPosition(e,t,n,s=!1){return this.setLookAt(e,t,n,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,s)}setTarget(e,t,n,s=!1){const l=this.getPosition(G),h=this.setLookAt(l.x,l.y,l.z,e,t,n,s);return this._sphericalEnd.phi=Ze(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),h}setFocalOffset(e,t,n,s=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(e,t,n),this._needsUpdate=!0,s||this._focalOffset.copy(this._focalOffsetEnd);const l=!s||ne(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&ne(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&ne(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(l)}setOrbitPoint(e,t,n){this._camera.updateMatrixWorld(),st.setFromMatrixColumn(this._camera.matrixWorldInverse,0),rt.setFromMatrixColumn(this._camera.matrixWorldInverse,1),Xt.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const s=G.set(e,t,n),l=s.distanceTo(this._camera.position),h=s.sub(this._camera.position);st.multiplyScalar(h.x),rt.multiplyScalar(h.y),Xt.multiplyScalar(h.z),G.copy(st).add(rt).add(Xt),G.z=G.z+l,this.dollyTo(l,!1),this.setFocalOffset(-G.x,G.y,-G.z,!1),this.moveTo(e,t,n,!1)}setBoundary(e){if(!e){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(e,t,n,s){if(e===null){this._viewport=null;return}this._viewport=this._viewport||new F.Vector4,typeof e=="number"?this._viewport.set(e,t,n,s):this._viewport.copy(e)}getDistanceToFitBox(e,t,n,s=!1){if(Ar(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const l=e/t,h=this._camera.getEffectiveFOV()*hn,c=this._camera.aspect;return((s?l>c:l<c)?t:e/c)*.5/Math.tan(h*.5)+n*.5}getDistanceToFitSphere(e){if(Ar(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const t=this._camera.getEffectiveFOV()*hn,n=Math.atan(Math.tan(t*.5)*this._camera.aspect)*2,s=1<this._camera.aspect?t:n;return e/Math.sin(s*.5)}getTarget(e,t=!0){return(e&&e.isVector3?e:new F.Vector3).copy(t?this._targetEnd:this._target)}getPosition(e,t=!0){return(e&&e.isVector3?e:new F.Vector3).setFromSpherical(t?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(t?this._targetEnd:this._target)}getSpherical(e,t=!0){return(e||new F.Spherical).copy(t?this._sphericalEnd:this._spherical)}getFocalOffset(e,t=!0){return(e&&e.isVector3?e:new F.Vector3).copy(t?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){return this._sphericalEnd.theta=(this._sphericalEnd.theta%St+St)%St,this._sphericalEnd.theta>Math.PI&&(this._sphericalEnd.theta-=St),this._spherical.theta+=St*Math.round((this._sphericalEnd.theta-this._spherical.theta)/St),this}stop(){this._focalOffset.copy(this._focalOffsetEnd),this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd),this._zoom=this._zoomEnd}reset(e=!1){if(!ne(this._camera.up.x,this._cameraUp0.x)||!ne(this._camera.up.y,this._cameraUp0.y)||!ne(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const n=this.getPosition(G);this.updateCameraUp(),this.setPosition(n.x,n.y,n.z)}const t=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)];return Promise.all(t)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,is),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const e=G.subVectors(this._target,this._camera.position).normalize(),t=Q.crossVectors(e,this._camera.up);this._camera.up.crossVectors(t,e).normalize(),this._camera.updateMatrixWorld();const n=this.getPosition(G);this.updateCameraUp(),this.setPosition(n.x,n.y,n.z)}update(e){const t=this._sphericalEnd.theta-this._spherical.theta,n=this._sphericalEnd.phi-this._spherical.phi,s=this._sphericalEnd.radius-this._spherical.radius,l=yl.subVectors(this._targetEnd,this._target),h=wl.subVectors(this._focalOffsetEnd,this._focalOffset),c=this._zoomEnd-this._zoom;if(oe(t))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const _=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=es(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,_,1/0,e),this._needsUpdate=!0}if(oe(n))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const _=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=es(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,_,1/0,e),this._needsUpdate=!0}if(oe(s))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const _=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=es(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,_,this.maxSpeed,e),this._needsUpdate=!0}if(oe(l.x)&&oe(l.y)&&oe(l.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const _=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;bl(this._target,this._targetEnd,this._targetVelocity,_,this.maxSpeed,e,this._target),this._needsUpdate=!0}if(oe(h.x)&&oe(h.y)&&oe(h.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const _=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;bl(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,_,this.maxSpeed,e,this._focalOffset),this._needsUpdate=!0}if(oe(c))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const _=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=es(this._zoom,this._zoomEnd,this._zoomVelocity,_,1/0,e)}if(this.dollyToCursor){if(Zt(this._camera)&&this._changedDolly!==0){const _=this._spherical.radius-this._lastDistance,g=this._camera,v=this._getCameraDirection(dn),y=G.copy(v).cross(g.up).normalize();y.lengthSq()===0&&(y.x=1);const b=Q.crossVectors(y,v),x=this._sphericalEnd.radius*Math.tan(g.getEffectiveFOV()*hn*.5),E=(this._sphericalEnd.radius-_-this._sphericalEnd.radius)/this._sphericalEnd.radius,T=Ci.copy(this._targetEnd).add(y.multiplyScalar(this._dollyControlCoord.x*x*g.aspect)).add(b.multiplyScalar(this._dollyControlCoord.y*x)),O=G.copy(this._targetEnd).lerp(T,E),A=this._lastDollyDirection===Ei.IN&&this._spherical.radius<=this.minDistance,M=this._lastDollyDirection===Ei.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(A||M)){this._sphericalEnd.radius-=_,this._spherical.radius-=_;const D=Q.copy(v).multiplyScalar(-_);O.add(D)}this._boundary.clampPoint(O,O);const R=Q.subVectors(O,this._targetEnd);this._targetEnd.copy(O),this._target.add(R),this._changedDolly-=_,oe(this._changedDolly)&&(this._changedDolly=0)}else if(Ot(this._camera)&&this._changedZoom!==0){const _=this._zoom-this._lastZoom,g=this._camera,v=G.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(g.near+g.far)/(g.near-g.far)).unproject(g),y=Q.set(0,0,-1).applyQuaternion(g.quaternion),b=Ci.copy(v).add(y.multiplyScalar(-v.dot(g.up))),w=-(this._zoom-_-this._zoom)/this._zoom,E=this._getCameraDirection(dn),T=this._targetEnd.dot(E),O=G.copy(this._targetEnd).lerp(b,w),A=O.dot(E),M=E.multiplyScalar(A-T);O.sub(M),this._boundary.clampPoint(O,O);const R=Q.subVectors(O,this._targetEnd);this._targetEnd.copy(O),this._target.add(R),this._changedZoom-=_,oe(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const p=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,p),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!oe(this._focalOffset.x)||!oe(this._focalOffset.y)||!oe(this._focalOffset.z))&&(this._camera.matrix.compose(this._camera.position,this._camera.quaternion,this._camera.scale),st.setFromMatrixColumn(this._camera.matrix,0),rt.setFromMatrixColumn(this._camera.matrix,1),Xt.setFromMatrixColumn(this._camera.matrix,2),st.multiplyScalar(this._focalOffset.x),rt.multiplyScalar(-this._focalOffset.y),Xt.multiplyScalar(this._focalOffset.z),G.copy(st).add(rt).add(Xt),this._camera.position.add(G),this._camera.updateMatrixWorld()),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),G.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const f=this._needsUpdate;return f&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):f?(this.dispatchEvent({type:"update"}),oe(t,this.restThreshold)&&oe(n,this.restThreshold)&&oe(s,this.restThreshold)&&oe(l.x,this.restThreshold)&&oe(l.y,this.restThreshold)&&oe(l.z,this.restThreshold)&&oe(h.x,this.restThreshold)&&oe(h.y,this.restThreshold)&&oe(h.z,this.restThreshold)&&oe(c,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!f&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=f,this._needsUpdate=!1,f}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:cn(this.maxDistance),minZoom:this.minZoom,maxZoom:cn(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:cn(this.maxPolarAngle),minAzimuthAngle:cn(this.minAzimuthAngle),maxAzimuthAngle:cn(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,target:this._targetEnd.toArray(),position:G.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(e,t=!1){const n=JSON.parse(e);this.enabled=n.enabled,this.minDistance=n.minDistance,this.maxDistance=un(n.maxDistance),this.minZoom=n.minZoom,this.maxZoom=un(n.maxZoom),this.minPolarAngle=n.minPolarAngle,this.maxPolarAngle=un(n.maxPolarAngle),this.minAzimuthAngle=un(n.minAzimuthAngle),this.maxAzimuthAngle=un(n.maxAzimuthAngle),this.smoothTime=n.smoothTime,this.draggingSmoothTime=n.draggingSmoothTime,this.dollySpeed=n.dollySpeed,this.truckSpeed=n.truckSpeed,this.dollyToCursor=n.dollyToCursor,this._target0.fromArray(n.target0),this._position0.fromArray(n.position0),this._zoom0=n.zoom0,this._focalOffset0.fromArray(n.focalOffset0),this.moveTo(n.target[0],n.target[1],n.target[2],t),Be.setFromVector3(G.fromArray(n.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(Be.theta,Be.phi,t),this.dollyTo(Be.radius,t),this.zoomTo(n.zoom,t),this.setFocalOffset(n.focalOffset[0],n.focalOffset[1],n.focalOffset[2],t),this._needsUpdate=!0}connect(e){if(this._domElement){console.warn("camera-controls is already connected.");return}e.setAttribute("data-camera-controls-version",Cv),this._addAllEventListeners(e),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(e){return e.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(e){return this._getTargetDirection(e).negate()}_findPointerById(e){return this._activePointers.find(t=>t.pointerId===e)}_findPointerByMouseButton(e){return this._activePointers.find(t=>t.mouseButton===e)}_disposePointer(e){this._activePointers.splice(this._activePointers.indexOf(e),1)}_encloseToBoundary(e,t,n){const s=t.lengthSq();if(s===0)return e;const l=Q.copy(t).add(e),c=this._boundary.clampPoint(l,Ci).sub(l),p=c.lengthSq();if(p===0)return e.add(t);if(p===s)return e;if(n===0)return e.add(t).add(c);{const d=1+n*p/t.dot(c);return e.add(Q.copy(t).multiplyScalar(d)).add(c.multiplyScalar(1-n))}}_updateNearPlaneCorners(){if(Zt(this._camera)){const e=this._camera,t=e.near,n=e.getEffectiveFOV()*hn,s=Math.tan(n*.5)*t,l=s*e.aspect;this._nearPlaneCorners[0].set(-l,-s,0),this._nearPlaneCorners[1].set(l,-s,0),this._nearPlaneCorners[2].set(l,s,0),this._nearPlaneCorners[3].set(-l,s,0)}else if(Ot(this._camera)){const e=this._camera,t=1/e.zoom,n=e.left*t,s=e.right*t,l=e.top*t,h=e.bottom*t;this._nearPlaneCorners[0].set(n,l,0),this._nearPlaneCorners[1].set(s,l,0),this._nearPlaneCorners[2].set(s,h,0),this._nearPlaneCorners[3].set(n,h,0)}}_truckInternal=(e,t,n,s)=>{let l,h;if(Zt(this._camera)){const c=G.copy(this._camera.position).sub(this._target),p=this._camera.getEffectiveFOV()*hn,d=c.length()*Math.tan(p*.5);l=this.truckSpeed*e*d/this._elementRect.height,h=this.truckSpeed*t*d/this._elementRect.height}else if(Ot(this._camera)){const c=this._camera;l=this.truckSpeed*e*(c.right-c.left)/c.zoom/this._elementRect.width,h=this.truckSpeed*t*(c.top-c.bottom)/c.zoom/this._elementRect.height}else return;s?(n?this.setFocalOffset(this._focalOffsetEnd.x+l,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(l,0,!0),this.forward(-h,!0)):n?this.setFocalOffset(this._focalOffsetEnd.x+l,this._focalOffsetEnd.y+h,this._focalOffsetEnd.z,!0):this.truck(l,h,!0)};_rotateInternal=(e,t)=>{const n=St*this.azimuthRotateSpeed*e/this._elementRect.height,s=St*this.polarRotateSpeed*t/this._elementRect.height;this.rotate(n,s,!0)};_dollyInternal=(e,t,n)=>{const s=Math.pow(.95,-e*this.dollySpeed),l=this._sphericalEnd.radius,h=this._sphericalEnd.radius*s,c=Ze(h,this.minDistance,this.maxDistance),p=c-h;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(h,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(p,!0),this._dollyToNoClamp(c,!0)):this._dollyToNoClamp(c,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?h:c)-l,this._dollyControlCoord.set(t,n)),this._lastDollyDirection=Math.sign(-e)};_zoomInternal=(e,t,n)=>{const s=Math.pow(.95,e*this.dollySpeed),l=this._zoom,h=this._zoom*s;this.zoomTo(h,!0),this.dollyToCursor&&(this._changedZoom+=h-l,this._dollyControlCoord.set(t,n))};_collisionTest(){let e=1/0;if(!(this.colliderMeshes.length>=1)||Ar(this._camera,"_collisionTest"))return e;const n=this._getTargetDirection(dn);kr.lookAt(xl,n,this._camera.up);for(let s=0;s<4;s++){const l=Q.copy(this._nearPlaneCorners[s]);l.applyMatrix4(kr);const h=Ci.addVectors(this._target,l);ns.set(h,n),ns.far=this._spherical.radius+1;const c=ns.intersectObjects(this.colliderMeshes);c.length!==0&&c[0].distance<e&&(e=c[0].distance)}return e}_getClientRect(e){if(!this._domElement)return;const t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=t.width,e.height=t.height),e}_createOnRestPromise(e){return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(t=>{const n=()=>{this.removeEventListener("rest",n),t()};this.addEventListener("rest",n)}))}_addAllEventListeners(e){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(e){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(e){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(e,t=new F.Sphere){const n=t,s=n.center;Si.makeEmpty(),e.traverseVisible(h=>{h.isMesh&&Si.expandByObject(h)}),Si.getCenter(s);let l=0;return e.traverseVisible(h=>{if(!h.isMesh)return;const c=h;if(!c.geometry)return;const p=c.geometry.clone();p.applyMatrix4(c.matrixWorld);const f=p.attributes.position;for(let _=0,g=f.count;_<g;_++)G.fromBufferAttribute(f,_),l=Math.max(l,s.distanceToSquared(G))}),n.radius=Math.sqrt(l),n}}Mn.install({THREE:Up});const Sv=50,Pv=4/3,Ov=.1,Av=1e4,Mv=1,Rv=1;function Dv(){return new Ll(Sv,Pv,Ov,Av)}function kv(r,e){return new Mn(r,e)}function Lv(r=-10,e=10,t=10,n=-10,s=.1,l=1e3){return new Dl(r,e,t,n,s,l)}function Tl(){const r=new Ip(16777215,2236962,1.5),e=new Bp(16777215,2);return e.position.set(0,Mv,Rv),[r,e]}function Uv(){const r=new K_({luminanceThreshold:0,intensity:1.4,radius:1,mipmapBlur:!0,blendFunction:j.SCREEN}),e=new q_({density:1.5});return[r,e]}const Iv=32,Bv=-5,Nv=100,Fv=30,Vv=15,Sl=-8,Lr=new gv,zv=document.querySelector("#cover"),Pl=document.querySelector("#canvas"),Kh=new rm;document.querySelector("#stats").appendChild(Kh.dom);let Qt,Me,Pt,pn,Ol,Pi,fn,Jt,mn;const Wr={amount:5,xscale:100},Zr={loudness:0,perceptualSharpness:0,perceptualSpread:0,spectralFlatness:0,spectralKurtosis:0};hm(Wr,Zr);class Hv{init(){this.scene=new cs,this.signalScene=new cs,Pt=Dv(),Pt.position.set(0,Bv,Nv),Pt.lookAt(0,0,0),pn=Lv(-20,20,15,-15,.1,1e3),pn.position.set(Sl,0,10),pn.lookAt(Sl,0,0),Ol=new Kp,Me=new Np({canvas:Pl,antialias:!1,alpha:!0,powerPreference:"high-performance"}),Me.setPixelRatio(qr),fn=kv(Pt,Pl);const[e,t]=Tl();this.scene.add(e,t);const[n,s]=Tl();this.signalScene.add(n,s);const l=new Y_(this.scene,Pt),h=new J_(Pt,...Uv());Pi=new qm(Me),Pi.addPass(l,0),Pi.addPass(h,1),Qt=dv(av,Re),console.log(Qt.length*(Re/2)),fl("bone",Re).map(c=>new as().fromArray(c)),fl("viridis",Re/2).map(c=>new as().fromArray(c)),Jt=new B(new Sa(.5,.5,.5),new Pa,{capacity:Re,createEntities:!0,allowsEuler:!0}),Jt.addInstances(Re,c=>{Jt.setColorAt(c.id,16777215)}),this.signalScene.add(Jt),mn=new B(new Sa(.75,.75,.75),new Pa({color:16777215}),{capacity:Qt.length*(Re/2),allowsEuler:!0}),mn.addInstances(Qt.length*(Re/2)),this.scene.add(mn)}intro(){fn.rotateTo(Oa.degToRad(45),Oa.degToRad(55),!0),fn.dollyTo(40,!0),fn.truck(0,-30,!0),Yr.timeline().to("#cover",{duration:1,autoAlpha:0,ease:"power2.out"}).to("#cover",{duration:1,delay:1,autoAlpha:0,ease:"power2.out"})}render(){const e=Ol.getDelta();if(wv({renderer:Me,composer:Pi})){const{clientWidth:g,clientHeight:v}=Me.domElement;Pt.aspect=g/v,Pt.updateProjectionMatrix()}const t=Lr.features(cv);if(!t)return;const{amplitudeSpectrum:n}=t;Qt.pop(),Qt.unshift(n),Object.assign(Zr,mv(t));const{loudness:s,perceptualSharpness:l,spectralKurtosis:h,perceptualSpread:c}=Zr,[p]=Pi.passes[1].effects;p.intensity=ml(.5,2.5,s),p.radius=ml(.5,2,l),mn.updateInstances((g,v)=>{const y=fv(v),b=v%(Re/2),x=Qt[y][b];g.scale.set(4.2+x,4.2+h*1,4.2+c),g.position.set(pv(b,Wr.xscale),lv+x*(Wr.amount*s),hv-y*(uv*1)),g.opacity=Math.min(1,.1+x*2),mn.setColorAt(g.id,16711680)});const d=Lr.signal();d&&Jt&&Jt.updateInstances((g,v)=>{g.position.set(-10+Vv*v/Re,d[v]*Fv,0),g.rotation.y+=1}),fn.update(e);const{clientWidth:f,clientHeight:_}=Me.domElement;if(Me.setViewport(0,0,f,_),Me.setScissor(0,0,f,_),Pi.render(),Jt&&pn){const b=f-400-0,x=0;Me.setViewport(b,x,400,200),Me.setScissor(b,x,400,200),Me.setScissorTest(!0),Me.render(this.signalScene,pn),Me.setScissorTest(!1)}Kh.update()}run$(){Yr.timeline().to("#cover",{duration:2,autoAlpha:1,ease:"expo.inOut"});const e=bv(Iv);return Fp(Vp([xv(zv),zp(Lr.meydaPromise({fftSize:Re}))]).pipe(Hp({count:2,delay:1e3}),Gp(()=>{this.init(),yv(Me,this.render.bind(this),e),this.intro()}))).pipe(jp(t=>(console.error("Error:",t),Yp))).subscribe()}}document.addEventListener("DOMContentLoaded",()=>{new Hv().run$()});
