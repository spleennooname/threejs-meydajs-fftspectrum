import{g as bl,C as us,M as mn,D as Hr,R as Gr,F as jr,a as Mi,V as Ve,b as ep,S as _n,c as fe,A as fa,I as tp,d as Zs,B as Kr,e as ip,W as sp,N as Js,Q as xl,E as np,G as rp,U as yl,f as op,h as ap,i as lp,j as hp,k as cp,l as up,m as dp,n as It,o as xe,p as vn,q as si,r as Ee,s as pp,t as fp,u as mp,v as Bt,L as en,w as tn,O as wl,x as zs,y as Hs,z as _p,H as Ii,J as ie,K as Cl,P as El,T as Tl,X as Sl,Y as Pl,Z as vp,_ as ma,$ as Yr,a0 as gp,a1 as _a,a2 as bp,a3 as Ol,a4 as xp,a5 as yp,a6 as wp,a7 as Cp,a8 as Ep,a9 as Tp,aa as Sp,ab as Pp,ac as Op,ad as Ap,ae as va,af as ga,ag as ba,ah as Mp,ai as Rp,aj as Dp,ak as kp,al as Lp,am as Up,an as Ip}from"./vendor-C4MqieGJ.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const h of l.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function t(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerPolicy&&(l.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?l.credentials="include":n.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(n){if(n.ep)return;n.ep=!0;const l=t(n);fetch(n.href,l)}})();function ut(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function Al(r,e){r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.__proto__=e}var Ne={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},Ri={duration:.5,overwrite:!1,delay:0},$r,Ke=1e8,re=1/Ke,Pr=Math.PI*2,Bp=Pr/4,Fp=0,Ml=Math.sqrt,Np=Math.cos,Vp=Math.sin,ve=function(e){return typeof e=="string"},_e=function(e){return typeof e=="function"},ft=function(e){return typeof e=="number"},qr=function(e){return typeof e>"u"},mt=function(e){return typeof e=="object"},De=function(e){return e!==!1},Rl=function(){return typeof window<"u"},Gs=function(e){return _e(e)||ve(e)},Dl=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},we=Array.isArray,Or=/(?:-?\.?\d|\.)+/gi,kl=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,Ci=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,nr=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,Ll=/[+-]=-?[.\d]+/,Ul=/[^,'"\[\]\s]+/gi,zp=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,ce,rt,Ar,Wr,ze={},sn={},Il,Bl=function(e){return(sn=ni(e,ze))&&Qe},Zr=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},nn=function(e,t){return!t&&console.warn(e)},Fl=function(e,t){return e&&(ze[e]=t)&&sn&&(sn[e]=t)||ze},ms=function(){return 0},Xr={},Rt=[],Mr={},Nl,Be={},rr={},xa=30,Xs=[],Qr="",Jr=function(e){var t=e[0],s,n;if(mt(t)||_e(t)||(e=[e]),!(s=(t._gsap||{}).harness)){for(n=Xs.length;n--&&!Xs[n].targetTest(t););s=Xs[n]}for(n=e.length;n--;)e[n]&&(e[n]._gsap||(e[n]._gsap=new ah(e[n],s)))||e.splice(n,1);return e},Jt=function(e){return e._gsap||Jr(Ye(e))[0]._gsap},Vl=function(e,t,s){return(s=e[t])&&_e(s)?e[t]():qr(s)&&e.getAttribute&&e.getAttribute(t)||s},ke=function(e,t){return(e=e.split(",")).forEach(t)||e},de=function(e){return Math.round(e*1e5)/1e5||0},be=function(e){return Math.round(e*1e7)/1e7||0},Ti=function(e,t){var s=t.charAt(0),n=parseFloat(t.substr(2));return e=parseFloat(e),s==="+"?e+n:s==="-"?e-n:s==="*"?e*n:e/n},Hp=function(e,t){for(var s=t.length,n=0;e.indexOf(t[n])<0&&++n<s;);return n<s},rn=function(){var e=Rt.length,t=Rt.slice(0),s,n;for(Mr={},Rt.length=0,s=0;s<e;s++)n=t[s],n&&n._lazy&&(n.render(n._lazy[0],n._lazy[1],!0)._lazy=0)},zl=function(e,t,s,n){Rt.length&&rn(),e.render(t,s,n),Rt.length&&rn()},Hl=function(e){var t=parseFloat(e);return(t||t===0)&&(e+"").match(Ul).length<2?t:ve(e)?e.trim():e},Gl=function(e){return e},qe=function(e,t){for(var s in t)s in e||(e[s]=t[s]);return e},Gp=function(e){return function(t,s){for(var n in s)n in t||n==="duration"&&e||n==="ease"||(t[n]=s[n])}},ni=function(e,t){for(var s in t)e[s]=t[s];return e},ya=function r(e,t){for(var s in t)s!=="__proto__"&&s!=="constructor"&&s!=="prototype"&&(e[s]=mt(t[s])?r(e[s]||(e[s]={}),t[s]):t[s]);return e},on=function(e,t){var s={},n;for(n in e)n in t||(s[n]=e[n]);return s},ds=function(e){var t=e.parent||ce,s=e.keyframes?Gp(we(e.keyframes)):qe;if(De(e.inherit))for(;t;)s(e,t.vars.defaults),t=t.parent||t._dp;return e},jp=function(e,t){for(var s=e.length,n=s===t.length;n&&s--&&e[s]===t[s];);return s<0},jl=function(e,t,s,n,l){var h=e[n],c;if(l)for(c=t[l];h&&h[l]>c;)h=h._prev;return h?(t._next=h._next,h._next=t):(t._next=e[s],e[s]=t),t._next?t._next._prev=t:e[n]=t,t._prev=h,t.parent=t._dp=e,t},gn=function(e,t,s,n){s===void 0&&(s="_first"),n===void 0&&(n="_last");var l=t._prev,h=t._next;l?l._next=h:e[s]===t&&(e[s]=h),h?h._prev=l:e[n]===t&&(e[n]=l),t._next=t._prev=t.parent=null},dt=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove(e),e._act=0},ei=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var s=e;s;)s._dirty=1,s=s.parent;return e},Kp=function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e},Yp=function r(e){return!e||e._ts&&r(e.parent)},wa=function(e){return e._repeat?Di(e._tTime,e=e.duration()+e._rDelay)*e:0},Di=function(e,t){var s=Math.floor(e/=t);return e&&s===e?s-1:s},an=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},bn=function(e){return e._end=be(e._start+(e._tDur/Math.abs(e._ts||e._rts||re)||0))},eo=function(e,t){var s=e._dp;return s&&s.smoothChildTiming&&e._ts&&(e._start=be(s._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),bn(e),s._dirty||ei(s,e)),e},Kl=function(e,t){var s;if((t._time||t._initted&&!t._dur)&&(s=an(e.rawTime(),t),(!t._dur||Cs(0,t.totalDuration(),s)-t._tTime>re)&&t.render(s,!0)),ei(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(s=e;s._dp;)s.rawTime()>=0&&s.totalTime(s._tTime),s=s._dp;e._zTime=-re}},ot=function(e,t,s,n){return t.parent&&dt(t),t._start=be((ft(s)?s:s||e!==ce?je(e,s,t):e._time)+t._delay),t._end=be(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),jl(e,t,"_first","_last",e._sort?"_start":0),Rr(t)||(e._recent=t),n||Kl(e,t),e},Yl=function(e,t){return(ze.ScrollTrigger||Zr("scrollTrigger",t))&&ze.ScrollTrigger.create(t,e)},$l=function(e,t,s,n){if(io(e,t),!e._initted)return 1;if(!s&&e._pt&&(e._dur&&e.vars.lazy!==!1||!e._dur&&e.vars.lazy)&&Nl!==Fe.frame)return Rt.push(e),e._lazy=[t,n],1},$p=function r(e){var t=e.parent;return t&&t._ts&&t._initted&&!t._lock&&(t.rawTime()<0||r(t))},Rr=function(e){var t=e.data;return t==="isFromStart"||t==="isStart"},qp=function(e,t,s,n){var l=e.ratio,h=t<0||!t&&(!e._start&&$p(e)&&!(!e._initted&&Rr(e))||(e._ts<0||e._dp._ts<0)&&!Rr(e))?0:1,c=e._rDelay,p=0,d,f,_;if(c&&e._repeat&&(p=Cs(0,e._tDur,t),f=Di(p,c),e._yoyo&&f&1&&(h=1-h),f!==Di(e._tTime,c)&&(l=1-h,e.vars.repeatRefresh&&e._initted&&e.invalidate())),h!==l||n||e._zTime===re||!t&&e._zTime){if(!e._initted&&$l(e,t,n,s))return;for(_=e._zTime,e._zTime=t||(s?re:0),s||(s=t&&!_),e.ratio=h,e._from&&(h=1-h),e._time=0,e._tTime=p,d=e._pt;d;)d.r(h,d.d),d=d._next;e._startAt&&t<0&&e._startAt.render(t,!0,!0),e._onUpdate&&!s&&$e(e,"onUpdate"),p&&e._repeat&&!s&&e.parent&&$e(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===h&&(h&&dt(e,1),s||($e(e,h?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)},Wp=function(e,t,s){var n;if(s>t)for(n=e._first;n&&n._start<=s;){if(n.data==="isPause"&&n._start>t)return n;n=n._next}else for(n=e._last;n&&n._start>=s;){if(n.data==="isPause"&&n._start<t)return n;n=n._prev}},ki=function(e,t,s,n){var l=e._repeat,h=be(t)||0,c=e._tTime/e._tDur;return c&&!n&&(e._time*=h/e._dur),e._dur=h,e._tDur=l?l<0?1e10:be(h*(l+1)+e._rDelay*l):h,c>0&&!n?eo(e,e._tTime=e._tDur*c):e.parent&&bn(e),s||ei(e.parent,e),e},Ca=function(e){return e instanceof Re?ei(e):ki(e,e._dur)},Zp={_start:0,endTime:ms,totalDuration:ms},je=function r(e,t,s){var n=e.labels,l=e._recent||Zp,h=e.duration()>=Ke?l.endTime(!1):e._dur,c,p,d;return ve(t)&&(isNaN(t)||t in n)?(p=t.charAt(0),d=t.substr(-1)==="%",c=t.indexOf("="),p==="<"||p===">"?(c>=0&&(t=t.replace(/=/,"")),(p==="<"?l._start:l.endTime(l._repeat>=0))+(parseFloat(t.substr(1))||0)*(d?(c<0?l:s).totalDuration()/100:1)):c<0?(t in n||(n[t]=h),n[t]):(p=parseFloat(t.charAt(c-1)+t.substr(c+1)),d&&s&&(p=p/100*(we(s)?s[0]:s).totalDuration()),c>1?r(e,t.substr(0,c-1),s)+p:h+p)):t==null?h:+t},ps=function(e,t,s){var n=ft(t[1]),l=(n?2:1)+(e<2?0:1),h=t[l],c,p;if(n&&(h.duration=t[1]),h.parent=s,e){for(c=h,p=s;p&&!("immediateRender"in c);)c=p.vars.defaults||{},p=De(p.vars.inherit)&&p.parent;h.immediateRender=De(c.immediateRender),e<2?h.runBackwards=1:h.startAt=t[l-1]}return new me(t[0],h,t[l+1])},Ft=function(e,t){return e||e===0?t(e):t},Cs=function(e,t,s){return s<e?e:s>t?t:s},ye=function(e,t){return!ve(e)||!(t=zp.exec(e))?"":t[1]},Xp=function(e,t,s){return Ft(s,function(n){return Cs(e,t,n)})},Dr=[].slice,ql=function(e,t){return e&&mt(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&mt(e[0]))&&!e.nodeType&&e!==rt},Qp=function(e,t,s){return s===void 0&&(s=[]),e.forEach(function(n){var l;return ve(n)&&!t||ql(n,1)?(l=s).push.apply(l,Ye(n)):s.push(n)})||s},Ye=function(e,t,s){return ve(e)&&!s&&(Ar||!Li())?Dr.call((t||Wr).querySelectorAll(e),0):we(e)?Qp(e,s):ql(e)?Dr.call(e,0):e?[e]:[]},Jp=function(e){return e=Ye(e)[0]||nn("Invalid scope")||{},function(t){var s=e.current||e.nativeElement||e;return Ye(t,s.querySelectorAll?s:s===e?nn("Invalid scope")||Wr.createElement("div"):e)}},Wl=function(e){return e.sort(function(){return .5-Math.random()})},Zl=function(e){if(_e(e))return e;var t=mt(e)?e:{each:e},s=ti(t.ease),n=t.from||0,l=parseFloat(t.base)||0,h={},c=n>0&&n<1,p=isNaN(n)||c,d=t.axis,f=n,_=n;return ve(n)?f=_={center:.5,edges:.5,end:1}[n]||0:!c&&p&&(f=n[0],_=n[1]),function(g,v,y){var b=(y||t).length,x=h[b],w,C,T,O,A,M,R,D,k;if(!x){if(k=t.grid==="auto"?0:(t.grid||[1,Ke])[1],!k){for(R=-Ke;R<(R=y[k++].getBoundingClientRect().left)&&k<b;);k--}for(x=h[b]=[],w=p?Math.min(k,b)*f-.5:n%k,C=k===Ke?0:p?b*_/k-.5:n/k|0,R=0,D=Ke,M=0;M<b;M++)T=M%k-w,O=C-(M/k|0),x[M]=A=d?Math.abs(d==="y"?O:T):Ml(T*T+O*O),A>R&&(R=A),A<D&&(D=A);n==="random"&&Wl(x),x.max=R-D,x.min=D,x.v=b=(parseFloat(t.amount)||parseFloat(t.each)*(k>b?b-1:d?d==="y"?b/k:k:Math.max(k,b/k))||0)*(n==="edges"?-1:1),x.b=b<0?l-b:l,x.u=ye(t.amount||t.each)||0,s=s&&b<0?nh(s):s}return b=(x[g]-x.min)/x.max||0,be(x.b+(s?s(b):b)*x.v)+x.u}},kr=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(s){var n=Math.round(parseFloat(s)/e)*e*t;return(n-n%1)/t+(ft(s)?0:ye(s))}},Xl=function(e,t){var s=we(e),n,l;return!s&&mt(e)&&(n=s=e.radius||Ke,e.values?(e=Ye(e.values),(l=!ft(e[0]))&&(n*=n)):e=kr(e.increment)),Ft(t,s?_e(e)?function(h){return l=e(h),Math.abs(l-h)<=n?l:h}:function(h){for(var c=parseFloat(l?h.x:h),p=parseFloat(l?h.y:0),d=Ke,f=0,_=e.length,g,v;_--;)l?(g=e[_].x-c,v=e[_].y-p,g=g*g+v*v):g=Math.abs(e[_]-c),g<d&&(d=g,f=_);return f=!n||d<=n?e[f]:h,l||f===h||ft(h)?f:f+ye(h)}:kr(e))},Ql=function(e,t,s,n){return Ft(we(e)?!t:s===!0?!!(s=0):!n,function(){return we(e)?e[~~(Math.random()*e.length)]:(s=s||1e-5)&&(n=s<1?Math.pow(10,(s+"").length-2):1)&&Math.floor(Math.round((e-s/2+Math.random()*(t-e+s*.99))/s)*s*n)/n})},ef=function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return function(n){return t.reduce(function(l,h){return h(l)},n)}},tf=function(e,t){return function(s){return e(parseFloat(s))+(t||ye(s))}},sf=function(e,t,s){return eh(e,t,0,1,s)},Jl=function(e,t,s){return Ft(s,function(n){return e[~~t(n)]})},nf=function r(e,t,s){var n=t-e;return we(e)?Jl(e,r(0,e.length),t):Ft(s,function(l){return(n+(l-e)%n)%n+e})},rf=function r(e,t,s){var n=t-e,l=n*2;return we(e)?Jl(e,r(0,e.length-1),t):Ft(s,function(h){return h=(l+(h-e)%l)%l||0,e+(h>n?l-h:h)})},_s=function(e){for(var t=0,s="",n,l,h,c;~(n=e.indexOf("random(",t));)h=e.indexOf(")",n),c=e.charAt(n+7)==="[",l=e.substr(n+7,h-n-7).match(c?Ul:Or),s+=e.substr(t,n-t)+Ql(c?l:+l[0],c?0:+l[1],+l[2]||1e-5),t=h+1;return s+e.substr(t,e.length-t)},eh=function(e,t,s,n,l){var h=t-e,c=n-s;return Ft(l,function(p){return s+((p-e)/h*c||0)})},of=function r(e,t,s,n){var l=isNaN(e+t)?0:function(v){return(1-v)*e+v*t};if(!l){var h=ve(e),c={},p,d,f,_,g;if(s===!0&&(n=1)&&(s=null),h)e={p:e},t={p:t};else if(we(e)&&!we(t)){for(f=[],_=e.length,g=_-2,d=1;d<_;d++)f.push(r(e[d-1],e[d]));_--,l=function(y){y*=_;var b=Math.min(g,~~y);return f[b](y-b)},s=t}else n||(e=ni(we(e)?[]:{},e));if(!f){for(p in t)to.call(c,e,p,"get",t[p]);l=function(y){return ro(y,c)||(h?e.p:e)}}}return Ft(s,l)},Ea=function(e,t,s){var n=e.labels,l=Ke,h,c,p;for(h in n)c=n[h]-t,c<0==!!s&&c&&l>(c=Math.abs(c))&&(p=h,l=c);return p},$e=function(e,t,s){var n=e.vars,l=n[t],h,c;if(l)return h=n[t+"Params"],c=n.callbackScope||e,s&&Rt.length&&rn(),h?l.apply(c,h):l.call(c)},as=function(e){return dt(e),e.scrollTrigger&&e.scrollTrigger.kill(!1),e.progress()<1&&$e(e,"onInterrupt"),e},Ei,af=function(e){e=!e.name&&e.default||e;var t=e.name,s=_e(e),n=t&&!s&&e.init?function(){this._props=[]}:e,l={init:ms,render:ro,add:to,kill:Cf,modifier:wf,rawVars:0},h={targetTest:0,get:0,getSetter:no,aliases:{},register:0};if(Li(),e!==n){if(Be[t])return;qe(n,qe(on(e,l),h)),ni(n.prototype,ni(l,on(e,h))),Be[n.prop=t]=n,e.targetTest&&(Xs.push(n),Xr[t]=1),t=(t==="css"?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}Fl(t,n),e.register&&e.register(Qe,n,Le)},ne=255,ls={aqua:[0,ne,ne],lime:[0,ne,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,ne],navy:[0,0,128],white:[ne,ne,ne],olive:[128,128,0],yellow:[ne,ne,0],orange:[ne,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[ne,0,0],pink:[ne,192,203],cyan:[0,ne,ne],transparent:[ne,ne,ne,0]},or=function(e,t,s){return e+=e<0?1:e>1?-1:0,(e*6<1?t+(s-t)*e*6:e<.5?s:e*3<2?t+(s-t)*(2/3-e)*6:t)*ne+.5|0},th=function(e,t,s){var n=e?ft(e)?[e>>16,e>>8&ne,e&ne]:0:ls.black,l,h,c,p,d,f,_,g,v,y;if(!n){if(e.substr(-1)===","&&(e=e.substr(0,e.length-1)),ls[e])n=ls[e];else if(e.charAt(0)==="#"){if(e.length<6&&(l=e.charAt(1),h=e.charAt(2),c=e.charAt(3),e="#"+l+l+h+h+c+c+(e.length===5?e.charAt(4)+e.charAt(4):"")),e.length===9)return n=parseInt(e.substr(1,6),16),[n>>16,n>>8&ne,n&ne,parseInt(e.substr(7),16)/255];e=parseInt(e.substr(1),16),n=[e>>16,e>>8&ne,e&ne]}else if(e.substr(0,3)==="hsl"){if(n=y=e.match(Or),!t)p=+n[0]%360/360,d=+n[1]/100,f=+n[2]/100,h=f<=.5?f*(d+1):f+d-f*d,l=f*2-h,n.length>3&&(n[3]*=1),n[0]=or(p+1/3,l,h),n[1]=or(p,l,h),n[2]=or(p-1/3,l,h);else if(~e.indexOf("="))return n=e.match(kl),s&&n.length<4&&(n[3]=1),n}else n=e.match(Or)||ls.transparent;n=n.map(Number)}return t&&!y&&(l=n[0]/ne,h=n[1]/ne,c=n[2]/ne,_=Math.max(l,h,c),g=Math.min(l,h,c),f=(_+g)/2,_===g?p=d=0:(v=_-g,d=f>.5?v/(2-_-g):v/(_+g),p=_===l?(h-c)/v+(h<c?6:0):_===h?(c-l)/v+2:(l-h)/v+4,p*=60),n[0]=~~(p+.5),n[1]=~~(d*100+.5),n[2]=~~(f*100+.5)),s&&n.length<4&&(n[3]=1),n},ih=function(e){var t=[],s=[],n=-1;return e.split(Dt).forEach(function(l){var h=l.match(Ci)||[];t.push.apply(t,h),s.push(n+=h.length+1)}),t.c=s,t},Ta=function(e,t,s){var n="",l=(e+n).match(Dt),h=t?"hsla(":"rgba(",c=0,p,d,f,_;if(!l)return e;if(l=l.map(function(g){return(g=th(g,t,1))&&h+(t?g[0]+","+g[1]+"%,"+g[2]+"%,"+g[3]:g.join(","))+")"}),s&&(f=ih(e),p=s.c,p.join(n)!==f.c.join(n)))for(d=e.replace(Dt,"1").split(Ci),_=d.length-1;c<_;c++)n+=d[c]+(~p.indexOf(c)?l.shift()||h+"0,0,0,0)":(f.length?f:l.length?l:s).shift());if(!d)for(d=e.split(Dt),_=d.length-1;c<_;c++)n+=d[c]+l[c];return n+d[_]},Dt=(function(){var r="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",e;for(e in ls)r+="|"+e+"\\b";return new RegExp(r+")","gi")})(),lf=/hsl[a]?\(/,sh=function(e){var t=e.join(" "),s;if(Dt.lastIndex=0,Dt.test(t))return s=lf.test(t),e[1]=Ta(e[1],s),e[0]=Ta(e[0],s,ih(e[1])),!0},vs,Fe=(function(){var r=Date.now,e=500,t=33,s=r(),n=s,l=1e3/240,h=l,c=[],p,d,f,_,g,v,y=function b(x){var w=r()-n,C=x===!0,T,O,A,M;if(w>e&&(s+=w-t),n+=w,A=n-s,T=A-h,(T>0||C)&&(M=++_.frame,g=A-_.time*1e3,_.time=A=A/1e3,h+=T+(T>=l?4:l-T),O=1),C||(p=d(b)),O)for(v=0;v<c.length;v++)c[v](A,g,M,x)};return _={time:0,frame:0,tick:function(){y(!0)},deltaRatio:function(x){return g/(1e3/(x||60))},wake:function(){Il&&(!Ar&&Rl()&&(rt=Ar=window,Wr=rt.document||{},ze.gsap=Qe,(rt.gsapVersions||(rt.gsapVersions=[])).push(Qe.version),Bl(sn||rt.GreenSockGlobals||!rt.gsap&&rt||{}),f=rt.requestAnimationFrame),p&&_.sleep(),d=f||function(x){return setTimeout(x,h-_.time*1e3+1|0)},vs=1,y(2))},sleep:function(){(f?rt.cancelAnimationFrame:clearTimeout)(p),vs=0,d=ms},lagSmoothing:function(x,w){e=x||1/re,t=Math.min(w,e,0)},fps:function(x){l=1e3/(x||240),h=_.time*1e3+l},add:function(x,w,C){var T=w?function(O,A,M,R){x(O,A,M,R),_.remove(T)}:x;return _.remove(x),c[C?"unshift":"push"](T),Li(),T},remove:function(x,w){~(w=c.indexOf(x))&&c.splice(w,1)&&v>=w&&v--},_listeners:c},_})(),Li=function(){return!vs&&Fe.wake()},$={},hf=/^[\d.\-M][\d.\-,\s]/,cf=/["']/g,uf=function(e){for(var t={},s=e.substr(1,e.length-3).split(":"),n=s[0],l=1,h=s.length,c,p,d;l<h;l++)p=s[l],c=l!==h-1?p.lastIndexOf(","):p.length,d=p.substr(0,c),t[n]=isNaN(d)?d.replace(cf,"").trim():+d,n=p.substr(c+1).trim();return t},df=function(e){var t=e.indexOf("(")+1,s=e.indexOf(")"),n=e.indexOf("(",t);return e.substring(t,~n&&n<s?e.indexOf(")",s+1):s)},pf=function(e){var t=(e+"").split("("),s=$[t[0]];return s&&t.length>1&&s.config?s.config.apply(null,~e.indexOf("{")?[uf(t[1])]:df(e).split(",").map(Hl)):$._CE&&hf.test(e)?$._CE("",e):s},nh=function(e){return function(t){return 1-e(1-t)}},rh=function r(e,t){for(var s=e._first,n;s;)s instanceof Re?r(s,t):s.vars.yoyoEase&&(!s._yoyo||!s._repeat)&&s._yoyo!==t&&(s.timeline?r(s.timeline,t):(n=s._ease,s._ease=s._yEase,s._yEase=n,s._yoyo=t)),s=s._next},ti=function(e,t){return e&&(_e(e)?e:$[e]||pf(e))||t},oi=function(e,t,s,n){s===void 0&&(s=function(p){return 1-t(1-p)}),n===void 0&&(n=function(p){return p<.5?t(p*2)/2:1-t((1-p)*2)/2});var l={easeIn:t,easeOut:s,easeInOut:n},h;return ke(e,function(c){$[c]=ze[c]=l,$[h=c.toLowerCase()]=s;for(var p in l)$[h+(p==="easeIn"?".in":p==="easeOut"?".out":".inOut")]=$[c+"."+p]=l[p]}),l},oh=function(e){return function(t){return t<.5?(1-e(1-t*2))/2:.5+e((t-.5)*2)/2}},ar=function r(e,t,s){var n=t>=1?t:1,l=(s||(e?.3:.45))/(t<1?t:1),h=l/Pr*(Math.asin(1/n)||0),c=function(f){return f===1?1:n*Math.pow(2,-10*f)*Vp((f-h)*l)+1},p=e==="out"?c:e==="in"?function(d){return 1-c(1-d)}:oh(c);return l=Pr/l,p.config=function(d,f){return r(e,d,f)},p},lr=function r(e,t){t===void 0&&(t=1.70158);var s=function(h){return h?--h*h*((t+1)*h+t)+1:0},n=e==="out"?s:e==="in"?function(l){return 1-s(1-l)}:oh(s);return n.config=function(l){return r(e,l)},n};ke("Linear,Quad,Cubic,Quart,Quint,Strong",function(r,e){var t=e<5?e+1:e;oi(r+",Power"+(t-1),e?function(s){return Math.pow(s,t)}:function(s){return s},function(s){return 1-Math.pow(1-s,t)},function(s){return s<.5?Math.pow(s*2,t)/2:1-Math.pow((1-s)*2,t)/2})});$.Linear.easeNone=$.none=$.Linear.easeIn;oi("Elastic",ar("in"),ar("out"),ar());(function(r,e){var t=1/e,s=2*t,n=2.5*t,l=function(c){return c<t?r*c*c:c<s?r*Math.pow(c-1.5/e,2)+.75:c<n?r*(c-=2.25/e)*c+.9375:r*Math.pow(c-2.625/e,2)+.984375};oi("Bounce",function(h){return 1-l(1-h)},l)})(7.5625,2.75);oi("Expo",function(r){return r?Math.pow(2,10*(r-1)):0});oi("Circ",function(r){return-(Ml(1-r*r)-1)});oi("Sine",function(r){return r===1?1:-Np(r*Bp)+1});oi("Back",lr("in"),lr("out"),lr());$.SteppedEase=$.steps=ze.SteppedEase={config:function(e,t){e===void 0&&(e=1);var s=1/e,n=e+(t?0:1),l=t?1:0,h=1-re;return function(c){return((n*Cs(0,h,c)|0)+l)*s}}};Ri.ease=$["quad.out"];ke("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(r){return Qr+=r+","+r+"Params,"});var ah=function(e,t){this.id=Fp++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:Vl,this.set=t?t.getSetter:no},gs=(function(){function r(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,ki(this,+t.duration,1,1),this.data=t.data,vs||Fe.wake()}var e=r.prototype;return e.delay=function(s){return s||s===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+s-this._delay),this._delay=s,this):this._delay},e.duration=function(s){return arguments.length?this.totalDuration(this._repeat>0?s+(s+this._rDelay)*this._repeat:s):this.totalDuration()&&this._dur},e.totalDuration=function(s){return arguments.length?(this._dirty=0,ki(this,this._repeat<0?s:(s-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(s,n){if(Li(),!arguments.length)return this._tTime;var l=this._dp;if(l&&l.smoothChildTiming&&this._ts){for(eo(this,s),!l._dp||l.parent||Kl(l,this);l&&l.parent;)l.parent._time!==l._start+(l._ts>=0?l._tTime/l._ts:(l.totalDuration()-l._tTime)/-l._ts)&&l.totalTime(l._tTime,!0),l=l.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&s<this._tDur||this._ts<0&&s>0||!this._tDur&&!s)&&ot(this._dp,this,this._start-this._delay)}return(this._tTime!==s||!this._dur&&!n||this._initted&&Math.abs(this._zTime)===re||!s&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=s),zl(this,s,n)),this},e.time=function(s,n){return arguments.length?this.totalTime(Math.min(this.totalDuration(),s+wa(this))%(this._dur+this._rDelay)||(s?this._dur:0),n):this._time},e.totalProgress=function(s,n){return arguments.length?this.totalTime(this.totalDuration()*s,n):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.ratio},e.progress=function(s,n){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-s:s)+wa(this),n):this.duration()?Math.min(1,this._time/this._dur):this.ratio},e.iteration=function(s,n){var l=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(s-1)*l,n):this._repeat?Di(this._tTime,l)+1:1},e.timeScale=function(s){if(!arguments.length)return this._rts===-re?0:this._rts;if(this._rts===s)return this;var n=this.parent&&this._ts?an(this.parent._time,this):this._tTime;return this._rts=+s||0,this._ts=this._ps||s===-re?0:this._rts,this.totalTime(Cs(-this._delay,this._tDur,n),!0),bn(this),Kp(this)},e.paused=function(s){return arguments.length?(this._ps!==s&&(this._ps=s,s?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(Li(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==re&&(this._tTime-=re)))),this):this._ps},e.startTime=function(s){if(arguments.length){this._start=s;var n=this.parent||this._dp;return n&&(n._sort||!this.parent)&&ot(n,this,s-this._delay),this}return this._start},e.endTime=function(s){return this._start+(De(s)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(s){var n=this.parent||this._dp;return n?s&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?an(n.rawTime(s),this):this._tTime:this._tTime},e.globalTime=function(s){for(var n=this,l=arguments.length?s:n.rawTime();n;)l=n._start+l/(n._ts||1),n=n._dp;return l},e.repeat=function(s){return arguments.length?(this._repeat=s===1/0?-2:s,Ca(this)):this._repeat===-2?1/0:this._repeat},e.repeatDelay=function(s){if(arguments.length){var n=this._time;return this._rDelay=s,Ca(this),n?this.time(n):this}return this._rDelay},e.yoyo=function(s){return arguments.length?(this._yoyo=s,this):this._yoyo},e.seek=function(s,n){return this.totalTime(je(this,s),De(n))},e.restart=function(s,n){return this.play().totalTime(s?-this._delay:0,De(n))},e.play=function(s,n){return s!=null&&this.seek(s,n),this.reversed(!1).paused(!1)},e.reverse=function(s,n){return s!=null&&this.seek(s||this.totalDuration(),n),this.reversed(!0).paused(!1)},e.pause=function(s,n){return s!=null&&this.seek(s,n),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(s){return arguments.length?(!!s!==this.reversed()&&this.timeScale(-this._rts||(s?-re:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-re,this},e.isActive=function(){var s=this.parent||this._dp,n=this._start,l;return!!(!s||this._ts&&this._initted&&s.isActive()&&(l=s.rawTime(!0))>=n&&l<this.endTime(!0)-re)},e.eventCallback=function(s,n,l){var h=this.vars;return arguments.length>1?(n?(h[s]=n,l&&(h[s+"Params"]=l),s==="onUpdate"&&(this._onUpdate=n)):delete h[s],this):h[s]},e.then=function(s){var n=this;return new Promise(function(l){var h=_e(s)?s:Gl,c=function(){var d=n.then;n.then=null,_e(h)&&(h=h(n))&&(h.then||h===n)&&(n.then=d),l(h),n.then=d};n._initted&&n.totalProgress()===1&&n._ts>=0||!n._tTime&&n._ts<0?c():n._prom=c})},e.kill=function(){as(this)},r})();qe(gs.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-re,_prom:0,_ps:!1,_rts:1});var Re=(function(r){Al(e,r);function e(s,n){var l;return s===void 0&&(s={}),l=r.call(this,s)||this,l.labels={},l.smoothChildTiming=!!s.smoothChildTiming,l.autoRemoveChildren=!!s.autoRemoveChildren,l._sort=De(s.sortChildren),ce&&ot(s.parent||ce,ut(l),n),s.reversed&&l.reverse(),s.paused&&l.paused(!0),s.scrollTrigger&&Yl(ut(l),s.scrollTrigger),l}var t=e.prototype;return t.to=function(n,l,h){return ps(0,arguments,this),this},t.from=function(n,l,h){return ps(1,arguments,this),this},t.fromTo=function(n,l,h,c){return ps(2,arguments,this),this},t.set=function(n,l,h){return l.duration=0,l.parent=this,ds(l).repeatDelay||(l.repeat=0),l.immediateRender=!!l.immediateRender,new me(n,l,je(this,h),1),this},t.call=function(n,l,h){return ot(this,me.delayedCall(0,n,l),h)},t.staggerTo=function(n,l,h,c,p,d,f){return h.duration=l,h.stagger=h.stagger||c,h.onComplete=d,h.onCompleteParams=f,h.parent=this,new me(n,h,je(this,p)),this},t.staggerFrom=function(n,l,h,c,p,d,f){return h.runBackwards=1,ds(h).immediateRender=De(h.immediateRender),this.staggerTo(n,l,h,c,p,d,f)},t.staggerFromTo=function(n,l,h,c,p,d,f,_){return c.startAt=h,ds(c).immediateRender=De(c.immediateRender),this.staggerTo(n,l,c,p,d,f,_)},t.render=function(n,l,h){var c=this._time,p=this._dirty?this.totalDuration():this._tDur,d=this._dur,f=n<=0?0:be(n),_=this._zTime<0!=n<0&&(this._initted||!d),g,v,y,b,x,w,C,T,O,A,M,R;if(this!==ce&&f>p&&n>=0&&(f=p),f!==this._tTime||h||_){if(c!==this._time&&d&&(f+=this._time-c,n+=this._time-c),g=f,O=this._start,T=this._ts,w=!T,_&&(d||(c=this._zTime),(n||!l)&&(this._zTime=n)),this._repeat){if(M=this._yoyo,x=d+this._rDelay,this._repeat<-1&&n<0)return this.totalTime(x*100+n,l,h);if(g=be(f%x),f===p?(b=this._repeat,g=d):(b=~~(f/x),b&&b===f/x&&(g=d,b--),g>d&&(g=d)),A=Di(this._tTime,x),!c&&this._tTime&&A!==b&&(A=b),M&&b&1&&(g=d-g,R=1),b!==A&&!this._lock){var D=M&&A&1,k=D===(M&&b&1);if(b<A&&(D=!D),c=D?0:d,this._lock=1,this.render(c||(R?0:be(b*x)),l,!d)._lock=0,this._tTime=f,!l&&this.parent&&$e(this,"onRepeat"),this.vars.repeatRefresh&&!R&&(this.invalidate()._lock=1),c&&c!==this._time||w!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(d=this._dur,p=this._tDur,k&&(this._lock=2,c=D?d:-1e-4,this.render(c,!0),this.vars.repeatRefresh&&!R&&this.invalidate()),this._lock=0,!this._ts&&!w)return this;rh(this,R)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(C=Wp(this,be(c),be(g)),C&&(f-=g-(g=C._start))),this._tTime=f,this._time=g,this._act=!T,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=n,c=0),!c&&g&&!l&&($e(this,"onStart"),this._tTime!==f))return this;if(g>=c&&n>=0)for(v=this._first;v;){if(y=v._next,(v._act||g>=v._start)&&v._ts&&C!==v){if(v.parent!==this)return this.render(n,l,h);if(v.render(v._ts>0?(g-v._start)*v._ts:(v._dirty?v.totalDuration():v._tDur)+(g-v._start)*v._ts,l,h),g!==this._time||!this._ts&&!w){C=0,y&&(f+=this._zTime=-re);break}}v=y}else{v=this._last;for(var I=n<0?n:g;v;){if(y=v._prev,(v._act||I<=v._end)&&v._ts&&C!==v){if(v.parent!==this)return this.render(n,l,h);if(v.render(v._ts>0?(I-v._start)*v._ts:(v._dirty?v.totalDuration():v._tDur)+(I-v._start)*v._ts,l,h),g!==this._time||!this._ts&&!w){C=0,y&&(f+=this._zTime=I?-re:re);break}}v=y}}if(C&&!l&&(this.pause(),C.render(g>=c?0:-re)._zTime=g>=c?1:-1,this._ts))return this._start=O,bn(this),this.render(n,l,h);this._onUpdate&&!l&&$e(this,"onUpdate",!0),(f===p&&this._tTime>=this.totalDuration()||!f&&c)&&(O===this._start||Math.abs(T)!==Math.abs(this._ts))&&(this._lock||((n||!d)&&(f===p&&this._ts>0||!f&&this._ts<0)&&dt(this,1),!l&&!(n<0&&!c)&&(f||c||!p)&&($e(this,f===p&&n>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(f<p&&this.timeScale()>0)&&this._prom())))}return this},t.add=function(n,l){var h=this;if(ft(l)||(l=je(this,l,n)),!(n instanceof gs)){if(we(n))return n.forEach(function(c){return h.add(c,l)}),this;if(ve(n))return this.addLabel(n,l);if(_e(n))n=me.delayedCall(0,n);else return this}return this!==n?ot(this,n,l):this},t.getChildren=function(n,l,h,c){n===void 0&&(n=!0),l===void 0&&(l=!0),h===void 0&&(h=!0),c===void 0&&(c=-Ke);for(var p=[],d=this._first;d;)d._start>=c&&(d instanceof me?l&&p.push(d):(h&&p.push(d),n&&p.push.apply(p,d.getChildren(!0,l,h)))),d=d._next;return p},t.getById=function(n){for(var l=this.getChildren(1,1,1),h=l.length;h--;)if(l[h].vars.id===n)return l[h]},t.remove=function(n){return ve(n)?this.removeLabel(n):_e(n)?this.killTweensOf(n):(gn(this,n),n===this._recent&&(this._recent=this._last),ei(this))},t.totalTime=function(n,l){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=be(Fe.time-(this._ts>0?n/this._ts:(this.totalDuration()-n)/-this._ts))),r.prototype.totalTime.call(this,n,l),this._forcing=0,this):this._tTime},t.addLabel=function(n,l){return this.labels[n]=je(this,l),this},t.removeLabel=function(n){return delete this.labels[n],this},t.addPause=function(n,l,h){var c=me.delayedCall(0,l||ms,h);return c.data="isPause",this._hasPause=1,ot(this,c,je(this,n))},t.removePause=function(n){var l=this._first;for(n=je(this,n);l;)l._start===n&&l.data==="isPause"&&dt(l),l=l._next},t.killTweensOf=function(n,l,h){for(var c=this.getTweensOf(n,h),p=c.length;p--;)Pt!==c[p]&&c[p].kill(n,l);return this},t.getTweensOf=function(n,l){for(var h=[],c=Ye(n),p=this._first,d=ft(l),f;p;)p instanceof me?Hp(p._targets,c)&&(d?(!Pt||p._initted&&p._ts)&&p.globalTime(0)<=l&&p.globalTime(p.totalDuration())>l:!l||p.isActive())&&h.push(p):(f=p.getTweensOf(c,l)).length&&h.push.apply(h,f),p=p._next;return h},t.tweenTo=function(n,l){l=l||{};var h=this,c=je(h,n),p=l,d=p.startAt,f=p.onStart,_=p.onStartParams,g=p.immediateRender,v,y=me.to(h,qe({ease:l.ease||"none",lazy:!1,immediateRender:!1,time:c,overwrite:"auto",duration:l.duration||Math.abs((c-(d&&"time"in d?d.time:h._time))/h.timeScale())||re,onStart:function(){if(h.pause(),!v){var x=l.duration||Math.abs((c-(d&&"time"in d?d.time:h._time))/h.timeScale());y._dur!==x&&ki(y,x,0,1).render(y._time,!0,!0),v=1}f&&f.apply(y,_||[])}},l));return g?y.render(0):y},t.tweenFromTo=function(n,l,h){return this.tweenTo(l,qe({startAt:{time:je(this,n)}},h))},t.recent=function(){return this._recent},t.nextLabel=function(n){return n===void 0&&(n=this._time),Ea(this,je(this,n))},t.previousLabel=function(n){return n===void 0&&(n=this._time),Ea(this,je(this,n),1)},t.currentLabel=function(n){return arguments.length?this.seek(n,!0):this.previousLabel(this._time+re)},t.shiftChildren=function(n,l,h){h===void 0&&(h=0);for(var c=this._first,p=this.labels,d;c;)c._start>=h&&(c._start+=n,c._end+=n),c=c._next;if(l)for(d in p)p[d]>=h&&(p[d]+=n);return ei(this)},t.invalidate=function(){var n=this._first;for(this._lock=0;n;)n.invalidate(),n=n._next;return r.prototype.invalidate.call(this)},t.clear=function(n){n===void 0&&(n=!0);for(var l=this._first,h;l;)h=l._next,this.remove(l),l=h;return this._dp&&(this._time=this._tTime=this._pTime=0),n&&(this.labels={}),ei(this)},t.totalDuration=function(n){var l=0,h=this,c=h._last,p=Ke,d,f,_;if(arguments.length)return h.timeScale((h._repeat<0?h.duration():h.totalDuration())/(h.reversed()?-n:n));if(h._dirty){for(_=h.parent;c;)d=c._prev,c._dirty&&c.totalDuration(),f=c._start,f>p&&h._sort&&c._ts&&!h._lock?(h._lock=1,ot(h,c,f-c._delay,1)._lock=0):p=f,f<0&&c._ts&&(l-=f,(!_&&!h._dp||_&&_.smoothChildTiming)&&(h._start+=f/h._ts,h._time-=f,h._tTime-=f),h.shiftChildren(-f,!1,-1/0),p=0),c._end>l&&c._ts&&(l=c._end),c=d;ki(h,h===ce&&h._time>l?h._time:l,1,1),h._dirty=0}return h._tDur},e.updateRoot=function(n){if(ce._ts&&(zl(ce,an(n,ce)),Nl=Fe.frame),Fe.frame>=xa){xa+=Ne.autoSleep||120;var l=ce._first;if((!l||!l._ts)&&Ne.autoSleep&&Fe._listeners.length<2){for(;l&&!l._ts;)l=l._next;l||Fe.sleep()}}},e})(gs);qe(Re.prototype,{_lock:0,_hasPause:0,_forcing:0});var ff=function(e,t,s,n,l,h,c){var p=new Le(this._pt,e,t,0,1,ph,null,l),d=0,f=0,_,g,v,y,b,x,w,C;for(p.b=s,p.e=n,s+="",n+="",(w=~n.indexOf("random("))&&(n=_s(n)),h&&(C=[s,n],h(C,e,t),s=C[0],n=C[1]),g=s.match(nr)||[];_=nr.exec(n);)y=_[0],b=n.substring(d,_.index),v?v=(v+1)%5:b.substr(-5)==="rgba("&&(v=1),y!==g[f++]&&(x=parseFloat(g[f-1])||0,p._pt={_next:p._pt,p:b||f===1?b:",",s:x,c:y.charAt(1)==="="?Ti(x,y)-x:parseFloat(y)-x,m:v&&v<4?Math.round:0},d=nr.lastIndex);return p.c=d<n.length?n.substring(d,n.length):"",p.fp=c,(Ll.test(n)||w)&&(p.e=0),this._pt=p,p},to=function(e,t,s,n,l,h,c,p,d){_e(n)&&(n=n(l||0,e,h));var f=e[t],_=s!=="get"?s:_e(f)?d?e[t.indexOf("set")||!_e(e["get"+t.substr(3)])?t:"get"+t.substr(3)](d):e[t]():f,g=_e(f)?d?bf:uh:so,v;if(ve(n)&&(~n.indexOf("random(")&&(n=_s(n)),n.charAt(1)==="="&&(v=Ti(_,n)+(ye(_)||0),(v||v===0)&&(n=v))),_!==n||Lr)return!isNaN(_*n)&&n!==""?(v=new Le(this._pt,e,t,+_||0,n-(_||0),typeof f=="boolean"?yf:dh,0,g),d&&(v.fp=d),c&&v.modifier(c,this,e),this._pt=v):(!f&&!(t in e)&&Zr(t,n),ff.call(this,e,t,_,n,g,p||Ne.stringFilter,d))},mf=function(e,t,s,n,l){if(_e(e)&&(e=fs(e,l,t,s,n)),!mt(e)||e.style&&e.nodeType||we(e)||Dl(e))return ve(e)?fs(e,l,t,s,n):e;var h={},c;for(c in e)h[c]=fs(e[c],l,t,s,n);return h},lh=function(e,t,s,n,l,h){var c,p,d,f;if(Be[e]&&(c=new Be[e]).init(l,c.rawVars?t[e]:mf(t[e],n,l,h,s),s,n,h)!==!1&&(s._pt=p=new Le(s._pt,l,e,0,1,c.render,c,0,c.priority),s!==Ei))for(d=s._ptLookup[s._targets.indexOf(l)],f=c._props.length;f--;)d[c._props[f]]=p;return c},Pt,Lr,io=function r(e,t){var s=e.vars,n=s.ease,l=s.startAt,h=s.immediateRender,c=s.lazy,p=s.onUpdate,d=s.onUpdateParams,f=s.callbackScope,_=s.runBackwards,g=s.yoyoEase,v=s.keyframes,y=s.autoRevert,b=e._dur,x=e._startAt,w=e._targets,C=e.parent,T=C&&C.data==="nested"?C.parent._targets:w,O=e._overwrite==="auto"&&!$r,A=e.timeline,M,R,D,k,I,H,K,ee,q,z,U,ue,Te;if(A&&(!v||!n)&&(n="none"),e._ease=ti(n,Ri.ease),e._yEase=g?nh(ti(g===!0?n:g,Ri.ease)):0,g&&e._yoyo&&!e._repeat&&(g=e._yEase,e._yEase=e._ease,e._ease=g),e._from=!A&&!!s.runBackwards,!A||v&&!s.stagger){if(ee=w[0]?Jt(w[0]).harness:0,ue=ee&&s[ee.prop],M=on(s,Xr),x&&(dt(x.render(-1,!0)),x._lazy=0),l)if(dt(e._startAt=me.set(w,qe({data:"isStart",overwrite:!1,parent:C,immediateRender:!0,lazy:De(c),startAt:null,delay:0,onUpdate:p,onUpdateParams:d,callbackScope:f,stagger:0},l))),t<0&&!h&&!y&&e._startAt.render(-1,!0),h){if(t>0&&!y&&(e._startAt=0),b&&t<=0){t&&(e._zTime=t);return}}else y===!1&&(e._startAt=0);else if(_&&b){if(x)!y&&(e._startAt=0);else if(t&&(h=!1),D=qe({overwrite:!1,data:"isFromStart",lazy:h&&De(c),immediateRender:h,stagger:0,parent:C},M),ue&&(D[ee.prop]=ue),dt(e._startAt=me.set(w,D)),t<0&&e._startAt.render(-1,!0),e._zTime=t,!h)r(e._startAt,re);else if(!t)return}for(e._pt=e._ptCache=0,c=b&&De(c)||c&&!b,R=0;R<w.length;R++){if(I=w[R],K=I._gsap||Jr(w)[R]._gsap,e._ptLookup[R]=z={},Mr[K.id]&&Rt.length&&rn(),U=T===w?R:T.indexOf(I),ee&&(q=new ee).init(I,ue||M,e,U,T)!==!1&&(e._pt=k=new Le(e._pt,I,q.name,0,1,q.render,q,0,q.priority),q._props.forEach(function(Se){z[Se]=k}),q.priority&&(H=1)),!ee||ue)for(D in M)Be[D]&&(q=lh(D,M,e,U,I,T))?q.priority&&(H=1):z[D]=k=to.call(e,I,D,"get",M[D],U,T,0,s.stringFilter);e._op&&e._op[R]&&e.kill(I,e._op[R]),O&&e._pt&&(Pt=e,ce.killTweensOf(I,z,e.globalTime(t)),Te=!e.parent,Pt=0),e._pt&&c&&(Mr[K.id]=1)}H&&fh(e),e._onInit&&e._onInit(e)}e._onUpdate=p,e._initted=(!e._op||e._pt)&&!Te,v&&t<=0&&A.render(Ke,!0,!0)},_f=function(e,t,s,n,l,h,c){var p=(e._pt&&e._ptCache||(e._ptCache={}))[t],d,f,_;if(!p)for(p=e._ptCache[t]=[],f=e._ptLookup,_=e._targets.length;_--;){if(d=f[_][t],d&&d.d&&d.d._pt)for(d=d.d._pt;d&&d.p!==t;)d=d._next;if(!d)return Lr=1,e.vars[t]="+=0",io(e,c),Lr=0,1;p.push(d)}for(_=p.length;_--;)d=p[_],d.s=(n||n===0)&&!l?n:d.s+(n||0)+h*d.c,d.c=s-d.s,d.e&&(d.e=de(s)+ye(d.e)),d.b&&(d.b=d.s+ye(d.b))},vf=function(e,t){var s=e[0]?Jt(e[0]).harness:0,n=s&&s.aliases,l,h,c,p;if(!n)return t;l=ni({},t);for(h in n)if(h in l)for(p=n[h].split(","),c=p.length;c--;)l[p[c]]=l[h];return l},gf=function(e,t,s,n){var l=t.ease||n||"power1.inOut",h,c;if(we(t))c=s[e]||(s[e]=[]),t.forEach(function(p,d){return c.push({t:d/(t.length-1)*100,v:p,e:l})});else for(h in t)c=s[h]||(s[h]=[]),h==="ease"||c.push({t:parseFloat(e),v:t[h],e:l})},fs=function(e,t,s,n,l){return _e(e)?e.call(t,s,n,l):ve(e)&&~e.indexOf("random(")?_s(e):e},hh=Qr+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",ch={};ke(hh+",id,stagger,delay,duration,paused,scrollTrigger",function(r){return ch[r]=1});var me=(function(r){Al(e,r);function e(s,n,l,h){var c;typeof n=="number"&&(l.duration=n,n=l,l=null),c=r.call(this,h?n:ds(n))||this;var p=c.vars,d=p.duration,f=p.delay,_=p.immediateRender,g=p.stagger,v=p.overwrite,y=p.keyframes,b=p.defaults,x=p.scrollTrigger,w=p.yoyoEase,C=n.parent||ce,T=(we(s)||Dl(s)?ft(s[0]):"length"in n)?[s]:Ye(s),O,A,M,R,D,k,I,H;if(c._targets=T.length?Jr(T):nn("GSAP target "+s+" not found. https://greensock.com",!Ne.nullTargetWarn)||[],c._ptLookup=[],c._overwrite=v,y||g||Gs(d)||Gs(f)){if(n=c.vars,O=c.timeline=new Re({data:"nested",defaults:b||{}}),O.kill(),O.parent=O._dp=ut(c),O._start=0,g||Gs(d)||Gs(f)){if(R=T.length,I=g&&Zl(g),mt(g))for(D in g)~hh.indexOf(D)&&(H||(H={}),H[D]=g[D]);for(A=0;A<R;A++)M=on(n,ch),M.stagger=0,w&&(M.yoyoEase=w),H&&ni(M,H),k=T[A],M.duration=+fs(d,ut(c),A,k,T),M.delay=(+fs(f,ut(c),A,k,T)||0)-c._delay,!g&&R===1&&M.delay&&(c._delay=f=M.delay,c._start+=f,M.delay=0),O.to(k,M,I?I(A,k,T):0),O._ease=$.none;O.duration()?d=f=0:c.timeline=0}else if(y){ds(qe(O.vars.defaults,{ease:"none"})),O._ease=ti(y.ease||n.ease||"none");var K=0,ee,q,z;if(we(y))y.forEach(function(U){return O.to(T,U,">")});else{M={};for(D in y)D==="ease"||D==="easeEach"||gf(D,y[D],M,y.easeEach);for(D in M)for(ee=M[D].sort(function(U,ue){return U.t-ue.t}),K=0,A=0;A<ee.length;A++)q=ee[A],z={ease:q.e,duration:(q.t-(A?ee[A-1].t:0))/100*d},z[D]=q.v,O.to(T,z,K),K+=z.duration;O.duration()<d&&O.to({},{duration:d-O.duration()})}}d||c.duration(d=O.duration())}else c.timeline=0;return v===!0&&!$r&&(Pt=ut(c),ce.killTweensOf(T),Pt=0),ot(C,ut(c),l),n.reversed&&c.reverse(),n.paused&&c.paused(!0),(_||!d&&!y&&c._start===be(C._time)&&De(_)&&Yp(ut(c))&&C.data!=="nested")&&(c._tTime=-re,c.render(Math.max(0,-f))),x&&Yl(ut(c),x),c}var t=e.prototype;return t.render=function(n,l,h){var c=this._time,p=this._tDur,d=this._dur,f=n>p-re&&n>=0?p:n<re?0:n,_,g,v,y,b,x,w,C,T;if(!d)qp(this,n,l,h);else if(f!==this._tTime||!n||h||!this._initted&&this._tTime||this._startAt&&this._zTime<0!=n<0){if(_=f,C=this.timeline,this._repeat){if(y=d+this._rDelay,this._repeat<-1&&n<0)return this.totalTime(y*100+n,l,h);if(_=be(f%y),f===p?(v=this._repeat,_=d):(v=~~(f/y),v&&v===f/y&&(_=d,v--),_>d&&(_=d)),x=this._yoyo&&v&1,x&&(T=this._yEase,_=d-_),b=Di(this._tTime,y),_===c&&!h&&this._initted)return this._tTime=f,this;v!==b&&(C&&this._yEase&&rh(C,x),this.vars.repeatRefresh&&!x&&!this._lock&&(this._lock=h=1,this.render(be(y*v),!0).invalidate()._lock=0))}if(!this._initted){if($l(this,n<0?n:_,h,l))return this._tTime=0,this;if(c!==this._time)return this;if(d!==this._dur)return this.render(n,l,h)}if(this._tTime=f,this._time=_,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=w=(T||this._ease)(_/d),this._from&&(this.ratio=w=1-w),_&&!c&&!l&&($e(this,"onStart"),this._tTime!==f))return this;for(g=this._pt;g;)g.r(w,g.d),g=g._next;C&&C.render(n<0?n:!_&&x?-re:C._dur*C._ease(_/this._dur),l,h)||this._startAt&&(this._zTime=n),this._onUpdate&&!l&&(n<0&&this._startAt&&this._startAt.render(n,!0,h),$e(this,"onUpdate")),this._repeat&&v!==b&&this.vars.onRepeat&&!l&&this.parent&&$e(this,"onRepeat"),(f===this._tDur||!f)&&this._tTime===f&&(n<0&&this._startAt&&!this._onUpdate&&this._startAt.render(n,!0,!0),(n||!d)&&(f===this._tDur&&this._ts>0||!f&&this._ts<0)&&dt(this,1),!l&&!(n<0&&!c)&&(f||c)&&($e(this,f===p?"onComplete":"onReverseComplete",!0),this._prom&&!(f<p&&this.timeScale()>0)&&this._prom()))}return this},t.targets=function(){return this._targets},t.invalidate=function(){return this._pt=this._op=this._startAt=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(),r.prototype.invalidate.call(this)},t.resetTo=function(n,l,h,c){vs||Fe.wake(),this._ts||this.play();var p=Math.min(this._dur,(this._dp._time-this._start)*this._ts),d;return this._initted||io(this,p),d=this._ease(p/this._dur),_f(this,n,l,h,c,d,p)?this.resetTo(n,l,h,c):(eo(this,0),this.parent||jl(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},t.kill=function(n,l){if(l===void 0&&(l="all"),!n&&(!l||l==="all"))return this._lazy=this._pt=0,this.parent?as(this):this;if(this.timeline){var h=this.timeline.totalDuration();return this.timeline.killTweensOf(n,l,Pt&&Pt.vars.overwrite!==!0)._first||as(this),this.parent&&h!==this.timeline.totalDuration()&&ki(this,this._dur*this.timeline._tDur/h,0,1),this}var c=this._targets,p=n?Ye(n):c,d=this._ptLookup,f=this._pt,_,g,v,y,b,x,w;if((!l||l==="all")&&jp(c,p))return l==="all"&&(this._pt=0),as(this);for(_=this._op=this._op||[],l!=="all"&&(ve(l)&&(b={},ke(l,function(C){return b[C]=1}),l=b),l=vf(c,l)),w=c.length;w--;)if(~p.indexOf(c[w])){g=d[w],l==="all"?(_[w]=l,y=g,v={}):(v=_[w]=_[w]||{},y=l);for(b in y)x=g&&g[b],x&&((!("kill"in x.d)||x.d.kill(b)===!0)&&gn(this,x,"_pt"),delete g[b]),v!=="all"&&(v[b]=1)}return this._initted&&!this._pt&&f&&as(this),this},e.to=function(n,l){return new e(n,l,arguments[2])},e.from=function(n,l){return ps(1,arguments)},e.delayedCall=function(n,l,h,c){return new e(l,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:n,onComplete:l,onReverseComplete:l,onCompleteParams:h,onReverseCompleteParams:h,callbackScope:c})},e.fromTo=function(n,l,h){return ps(2,arguments)},e.set=function(n,l){return l.duration=0,l.repeatDelay||(l.repeat=0),new e(n,l)},e.killTweensOf=function(n,l,h){return ce.killTweensOf(n,l,h)},e})(gs);qe(me.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});ke("staggerTo,staggerFrom,staggerFromTo",function(r){me[r]=function(){var e=new Re,t=Dr.call(arguments,0);return t.splice(r==="staggerFromTo"?5:4,0,0),e[r].apply(e,t)}});var so=function(e,t,s){return e[t]=s},uh=function(e,t,s){return e[t](s)},bf=function(e,t,s,n){return e[t](n.fp,s)},xf=function(e,t,s){return e.setAttribute(t,s)},no=function(e,t){return _e(e[t])?uh:qr(e[t])&&e.setAttribute?xf:so},dh=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e6)/1e6,t)},yf=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},ph=function(e,t){var s=t._pt,n="";if(!e&&t.b)n=t.b;else if(e===1&&t.e)n=t.e;else{for(;s;)n=s.p+(s.m?s.m(s.s+s.c*e):Math.round((s.s+s.c*e)*1e4)/1e4)+n,s=s._next;n+=t.c}t.set(t.t,t.p,n,t)},ro=function(e,t){for(var s=t._pt;s;)s.r(e,s.d),s=s._next},wf=function(e,t,s,n){for(var l=this._pt,h;l;)h=l._next,l.p===n&&l.modifier(e,t,s),l=h},Cf=function(e){for(var t=this._pt,s,n;t;)n=t._next,t.p===e&&!t.op||t.op===e?gn(this,t,"_pt"):t.dep||(s=1),t=n;return!s},Ef=function(e,t,s,n){n.mSet(e,t,n.m.call(n.tween,s,n.mt),n)},fh=function(e){for(var t=e._pt,s,n,l,h;t;){for(s=t._next,n=l;n&&n.pr>t.pr;)n=n._next;(t._prev=n?n._prev:h)?t._prev._next=t:l=t,(t._next=n)?n._prev=t:h=t,t=s}e._pt=l},Le=(function(){function r(t,s,n,l,h,c,p,d,f){this.t=s,this.s=l,this.c=h,this.p=n,this.r=c||dh,this.d=p||this,this.set=d||so,this.pr=f||0,this._next=t,t&&(t._prev=this)}var e=r.prototype;return e.modifier=function(s,n,l){this.mSet=this.mSet||this.set,this.set=Ef,this.m=s,this.mt=l,this.tween=n},r})();ke(Qr+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(r){return Xr[r]=1});ze.TweenMax=ze.TweenLite=me;ze.TimelineLite=ze.TimelineMax=Re;ce=new Re({sortChildren:!1,defaults:Ri,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});Ne.stringFilter=sh;var ln={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];t.forEach(function(n){return af(n)})},timeline:function(e){return new Re(e)},getTweensOf:function(e,t){return ce.getTweensOf(e,t)},getProperty:function(e,t,s,n){ve(e)&&(e=Ye(e)[0]);var l=Jt(e||{}).get,h=s?Gl:Hl;return s==="native"&&(s=""),e&&(t?h((Be[t]&&Be[t].get||l)(e,t,s,n)):function(c,p,d){return h((Be[c]&&Be[c].get||l)(e,c,p,d))})},quickSetter:function(e,t,s){if(e=Ye(e),e.length>1){var n=e.map(function(f){return Qe.quickSetter(f,t,s)}),l=n.length;return function(f){for(var _=l;_--;)n[_](f)}}e=e[0]||{};var h=Be[t],c=Jt(e),p=c.harness&&(c.harness.aliases||{})[t]||t,d=h?function(f){var _=new h;Ei._pt=0,_.init(e,s?f+s:f,Ei,0,[e]),_.render(1,_),Ei._pt&&ro(1,Ei)}:c.set(e,p);return h?d:function(f){return d(e,p,s?f+s:f,c,1)}},quickTo:function(e,t,s){var n,l=Qe.to(e,ni((n={},n[t]="+=0.1",n.paused=!0,n),s||{})),h=function(p,d,f){return l.resetTo(t,p,d,f)};return h.tween=l,h},isTweening:function(e){return ce.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=ti(e.ease,Ri.ease)),ya(Ri,e||{})},config:function(e){return ya(Ne,e||{})},registerEffect:function(e){var t=e.name,s=e.effect,n=e.plugins,l=e.defaults,h=e.extendTimeline;(n||"").split(",").forEach(function(c){return c&&!Be[c]&&!ze[c]&&nn(t+" effect requires "+c+" plugin.")}),rr[t]=function(c,p,d){return s(Ye(c),qe(p||{},l),d)},h&&(Re.prototype[t]=function(c,p,d){return this.add(rr[t](c,mt(p)?p:(d=p)&&{},this),d)})},registerEase:function(e,t){$[e]=ti(t)},parseEase:function(e,t){return arguments.length?ti(e,t):$},getById:function(e){return ce.getById(e)},exportRoot:function(e,t){e===void 0&&(e={});var s=new Re(e),n,l;for(s.smoothChildTiming=De(e.smoothChildTiming),ce.remove(s),s._dp=0,s._time=s._tTime=ce._time,n=ce._first;n;)l=n._next,(t||!(!n._dur&&n instanceof me&&n.vars.onComplete===n._targets[0]))&&ot(s,n,n._start-n._delay),n=l;return ot(ce,s,0),s},utils:{wrap:nf,wrapYoyo:rf,distribute:Zl,random:Ql,snap:Xl,normalize:sf,getUnit:ye,clamp:Xp,splitColor:th,toArray:Ye,selector:Jp,mapRange:eh,pipe:ef,unitize:tf,interpolate:of,shuffle:Wl},install:Bl,effects:rr,ticker:Fe,updateRoot:Re.updateRoot,plugins:Be,globalTimeline:ce,core:{PropTween:Le,globals:Fl,Tween:me,Timeline:Re,Animation:gs,getCache:Jt,_removeLinkedListItem:gn,suppressOverwrites:function(e){return $r=e}}};ke("to,from,fromTo,delayedCall,set,killTweensOf",function(r){return ln[r]=me[r]});Fe.add(Re.updateRoot);Ei=ln.to({},{duration:0});var Tf=function(e,t){for(var s=e._pt;s&&s.p!==t&&s.op!==t&&s.fp!==t;)s=s._next;return s},Sf=function(e,t){var s=e._targets,n,l,h;for(n in t)for(l=s.length;l--;)h=e._ptLookup[l][n],h&&(h=h.d)&&(h._pt&&(h=Tf(h,n)),h&&h.modifier&&h.modifier(t[n],e,s[l],n))},hr=function(e,t){return{name:e,rawVars:1,init:function(n,l,h){h._onInit=function(c){var p,d;if(ve(l)&&(p={},ke(l,function(f){return p[f]=1}),l=p),t){p={};for(d in l)p[d]=t(l[d]);l=p}Sf(c,l)}}}},Qe=ln.registerPlugin({name:"attr",init:function(e,t,s,n,l){var h,c;for(h in t)c=this.add(e,"setAttribute",(e.getAttribute(h)||0)+"",t[h],n,l,0,0,h),c&&(c.op=h),this._props.push(h)}},{name:"endArray",init:function(e,t){for(var s=t.length;s--;)this.add(e,s,e[s]||0,t[s])}},hr("roundProps",kr),hr("modifiers"),hr("snap",Xl))||ln;me.version=Re.version=Qe.version="3.10.4";Il=1;Rl()&&Li();$.Power0;$.Power1;$.Power2;$.Power3;$.Power4;$.Linear;$.Quad;$.Cubic;$.Quart;$.Quint;$.Strong;$.Elastic;$.Back;$.SteppedEase;$.Bounce;$.Sine;$.Expo;$.Circ;var Sa,Ot,Si,oo,Qt,Pa,Pf=function(){return typeof window<"u"},kt={},Zt=180/Math.PI,Pi=Math.PI/180,vi=Math.atan2,Oa=1e8,mh=/([A-Z])/g,Of=/(left|right|width|margin|padding|x)/i,Af=/[\s,\(]\S/,At={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},_h=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},Mf=function(e,t){return t.set(t.t,t.p,e===1?t.e:Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},Rf=function(e,t){return t.set(t.t,t.p,e?Math.round((t.s+t.c*e)*1e4)/1e4+t.u:t.b,t)},Df=function(e,t){var s=t.s+t.c*e;t.set(t.t,t.p,~~(s+(s<0?-.5:.5))+t.u,t)},vh=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},gh=function(e,t){return t.set(t.t,t.p,e!==1?t.b:t.e,t)},kf=function(e,t,s){return e.style[t]=s},Lf=function(e,t,s){return e.style.setProperty(t,s)},Uf=function(e,t,s){return e._gsap[t]=s},If=function(e,t,s){return e._gsap.scaleX=e._gsap.scaleY=s},Bf=function(e,t,s,n,l){var h=e._gsap;h.scaleX=h.scaleY=s,h.renderTransform(l,h)},Ff=function(e,t,s,n,l){var h=e._gsap;h[t]=s,h.renderTransform(l,h)},ge="transform",Lt=ge+"Origin",bh,Ur=function(e,t){var s=Ot.createElementNS?Ot.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):Ot.createElement(e);return s.style?s:Ot.createElement(e)},pt=function r(e,t,s){var n=getComputedStyle(e);return n[t]||n.getPropertyValue(t.replace(mh,"-$1").toLowerCase())||n.getPropertyValue(t)||!s&&r(e,Ui(t)||t,1)||""},Aa="O,Moz,ms,Ms,Webkit".split(","),Ui=function(e,t,s){var n=t||Qt,l=n.style,h=5;if(e in l&&!s)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);h--&&!(Aa[h]+e in l););return h<0?null:(h===3?"ms":h>=0?Aa[h]:"")+e},Ir=function(){Pf()&&window.document&&(Sa=window,Ot=Sa.document,Si=Ot.documentElement,Qt=Ur("div")||{style:{}},Ur("div"),ge=Ui(ge),Lt=ge+"Origin",Qt.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",bh=!!Ui("perspective"),oo=1)},cr=function r(e){var t=Ur("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),s=this.parentNode,n=this.nextSibling,l=this.style.cssText,h;if(Si.appendChild(t),t.appendChild(this),this.style.display="block",e)try{h=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=r}catch{}else this._gsapBBox&&(h=this._gsapBBox());return s&&(n?s.insertBefore(this,n):s.appendChild(this)),Si.removeChild(t),this.style.cssText=l,h},Ma=function(e,t){for(var s=t.length;s--;)if(e.hasAttribute(t[s]))return e.getAttribute(t[s])},xh=function(e){var t;try{t=e.getBBox()}catch{t=cr.call(e,!0)}return t&&(t.width||t.height)||e.getBBox===cr||(t=cr.call(e,!0)),t&&!t.width&&!t.x&&!t.y?{x:+Ma(e,["x","cx","x1"])||0,y:+Ma(e,["y","cy","y1"])||0,width:0,height:0}:t},yh=function(e){return!!(e.getCTM&&(!e.parentNode||e.ownerSVGElement)&&xh(e))},bs=function(e,t){if(t){var s=e.style;t in kt&&t!==Lt&&(t=ge),s.removeProperty?((t.substr(0,2)==="ms"||t.substr(0,6)==="webkit")&&(t="-"+t),s.removeProperty(t.replace(mh,"-$1").toLowerCase())):s.removeAttribute(t)}},Mt=function(e,t,s,n,l,h){var c=new Le(e._pt,t,s,0,1,h?gh:vh);return e._pt=c,c.b=n,c.e=l,e._props.push(s),c},Ra={deg:1,rad:1,turn:1},Ut=function r(e,t,s,n){var l=parseFloat(s)||0,h=(s+"").trim().substr((l+"").length)||"px",c=Qt.style,p=Of.test(t),d=e.tagName.toLowerCase()==="svg",f=(d?"client":"offset")+(p?"Width":"Height"),_=100,g=n==="px",v=n==="%",y,b,x,w;return n===h||!l||Ra[n]||Ra[h]?l:(h!=="px"&&!g&&(l=r(e,t,s,"px")),w=e.getCTM&&yh(e),(v||h==="%")&&(kt[t]||~t.indexOf("adius"))?(y=w?e.getBBox()[p?"width":"height"]:e[f],de(v?l/y*_:l/100*y)):(c[p?"width":"height"]=_+(g?h:n),b=~t.indexOf("adius")||n==="em"&&e.appendChild&&!d?e:e.parentNode,w&&(b=(e.ownerSVGElement||{}).parentNode),(!b||b===Ot||!b.appendChild)&&(b=Ot.body),x=b._gsap,x&&v&&x.width&&p&&x.time===Fe.time?de(l/x.width*_):((v||h==="%")&&(c.position=pt(e,"position")),b===e&&(c.position="static"),b.appendChild(Qt),y=Qt[f],b.removeChild(Qt),c.position="absolute",p&&v&&(x=Jt(b),x.time=Fe.time,x.width=b[f]),de(g?y*l/_:y&&l?_/y*l:0))))},Xt=function(e,t,s,n){var l;return oo||Ir(),t in At&&t!=="transform"&&(t=At[t],~t.indexOf(",")&&(t=t.split(",")[0])),kt[t]&&t!=="transform"?(l=ys(e,n),l=t!=="transformOrigin"?l[t]:l.svg?l.origin:cn(pt(e,Lt))+" "+l.zOrigin+"px"):(l=e.style[t],(!l||l==="auto"||n||~(l+"").indexOf("calc("))&&(l=hn[t]&&hn[t](e,t,s)||pt(e,t)||Vl(e,t)||(t==="opacity"?1:0))),s&&!~(l+"").trim().indexOf(" ")?Ut(e,t,l,s)+s:l},Nf=function(e,t,s,n){if(!s||s==="none"){var l=Ui(t,e,1),h=l&&pt(e,l,1);h&&h!==s?(t=l,s=h):t==="borderColor"&&(s=pt(e,"borderTopColor"))}var c=new Le(this._pt,e.style,t,0,1,ph),p=0,d=0,f,_,g,v,y,b,x,w,C,T,O,A;if(c.b=s,c.e=n,s+="",n+="",n==="auto"&&(e.style[t]=n,n=pt(e,t)||n,e.style[t]=s),f=[s,n],sh(f),s=f[0],n=f[1],g=s.match(Ci)||[],A=n.match(Ci)||[],A.length){for(;_=Ci.exec(n);)x=_[0],C=n.substring(p,_.index),y?y=(y+1)%5:(C.substr(-5)==="rgba("||C.substr(-5)==="hsla(")&&(y=1),x!==(b=g[d++]||"")&&(v=parseFloat(b)||0,O=b.substr((v+"").length),x.charAt(1)==="="&&(x=Ti(v,x)+O),w=parseFloat(x),T=x.substr((w+"").length),p=Ci.lastIndex-T.length,T||(T=T||Ne.units[t]||O,p===n.length&&(n+=T,c.e+=T)),O!==T&&(v=Ut(e,t,b,T)||0),c._pt={_next:c._pt,p:C||d===1?C:",",s:v,c:w-v,m:y&&y<4||t==="zIndex"?Math.round:0});c.c=p<n.length?n.substring(p,n.length):""}else c.r=t==="display"&&n==="none"?gh:vh;return Ll.test(n)&&(c.e=0),this._pt=c,c},Da={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},Vf=function(e){var t=e.split(" "),s=t[0],n=t[1]||"50%";return(s==="top"||s==="bottom"||n==="left"||n==="right")&&(e=s,s=n,n=e),t[0]=Da[s]||s,t[1]=Da[n]||n,t.join(" ")},zf=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var s=t.t,n=s.style,l=t.u,h=s._gsap,c,p,d;if(l==="all"||l===!0)n.cssText="",p=1;else for(l=l.split(","),d=l.length;--d>-1;)c=l[d],kt[c]&&(p=1,c=c==="transformOrigin"?Lt:ge),bs(s,c);p&&(bs(s,ge),h&&(h.svg&&s.removeAttribute("transform"),ys(s,1),h.uncache=1))}},hn={clearProps:function(e,t,s,n,l){if(l.data!=="isFromStart"){var h=e._pt=new Le(e._pt,t,s,0,0,zf);return h.u=n,h.pr=-10,h.tween=l,e._props.push(s),1}}},xs=[1,0,0,1,0,0],wh={},Ch=function(e){return e==="matrix(1, 0, 0, 1, 0, 0)"||e==="none"||!e},ka=function(e){var t=pt(e,ge);return Ch(t)?xs:t.substr(7).match(kl).map(de)},ao=function(e,t){var s=e._gsap||Jt(e),n=e.style,l=ka(e),h,c,p,d;return s.svg&&e.getAttribute("transform")?(p=e.transform.baseVal.consolidate().matrix,l=[p.a,p.b,p.c,p.d,p.e,p.f],l.join(",")==="1,0,0,1,0,0"?xs:l):(l===xs&&!e.offsetParent&&e!==Si&&!s.svg&&(p=n.display,n.display="block",h=e.parentNode,(!h||!e.offsetParent)&&(d=1,c=e.nextSibling,Si.appendChild(e)),l=ka(e),p?n.display=p:bs(e,"display"),d&&(c?h.insertBefore(e,c):h?h.appendChild(e):Si.removeChild(e))),t&&l.length>6?[l[0],l[1],l[4],l[5],l[12],l[13]]:l)},Br=function(e,t,s,n,l,h){var c=e._gsap,p=l||ao(e,!0),d=c.xOrigin||0,f=c.yOrigin||0,_=c.xOffset||0,g=c.yOffset||0,v=p[0],y=p[1],b=p[2],x=p[3],w=p[4],C=p[5],T=t.split(" "),O=parseFloat(T[0])||0,A=parseFloat(T[1])||0,M,R,D,k;s?p!==xs&&(R=v*x-y*b)&&(D=O*(x/R)+A*(-b/R)+(b*C-x*w)/R,k=O*(-y/R)+A*(v/R)-(v*C-y*w)/R,O=D,A=k):(M=xh(e),O=M.x+(~T[0].indexOf("%")?O/100*M.width:O),A=M.y+(~(T[1]||T[0]).indexOf("%")?A/100*M.height:A)),n||n!==!1&&c.smooth?(w=O-d,C=A-f,c.xOffset=_+(w*v+C*b)-w,c.yOffset=g+(w*y+C*x)-C):c.xOffset=c.yOffset=0,c.xOrigin=O,c.yOrigin=A,c.smooth=!!n,c.origin=t,c.originIsAbsolute=!!s,e.style[Lt]="0px 0px",h&&(Mt(h,c,"xOrigin",d,O),Mt(h,c,"yOrigin",f,A),Mt(h,c,"xOffset",_,c.xOffset),Mt(h,c,"yOffset",g,c.yOffset)),e.setAttribute("data-svg-origin",O+" "+A)},ys=function(e,t){var s=e._gsap||new ah(e);if("x"in s&&!t&&!s.uncache)return s;var n=e.style,l=s.scaleX<0,h="px",c="deg",p=pt(e,Lt)||"0",d,f,_,g,v,y,b,x,w,C,T,O,A,M,R,D,k,I,H,K,ee,q,z,U,ue,Te,Se,pe,Ce,W,Z,lt;return d=f=_=y=b=x=w=C=T=0,g=v=1,s.svg=!!(e.getCTM&&yh(e)),M=ao(e,s.svg),s.svg&&(U=(!s.uncache||p==="0px 0px")&&!t&&e.getAttribute("data-svg-origin"),Br(e,U||p,!!U||s.originIsAbsolute,s.smooth!==!1,M)),O=s.xOrigin||0,A=s.yOrigin||0,M!==xs&&(I=M[0],H=M[1],K=M[2],ee=M[3],d=q=M[4],f=z=M[5],M.length===6?(g=Math.sqrt(I*I+H*H),v=Math.sqrt(ee*ee+K*K),y=I||H?vi(H,I)*Zt:0,w=K||ee?vi(K,ee)*Zt+y:0,w&&(v*=Math.abs(Math.cos(w*Pi))),s.svg&&(d-=O-(O*I+A*K),f-=A-(O*H+A*ee))):(lt=M[6],W=M[7],Se=M[8],pe=M[9],Ce=M[10],Z=M[11],d=M[12],f=M[13],_=M[14],R=vi(lt,Ce),b=R*Zt,R&&(D=Math.cos(-R),k=Math.sin(-R),U=q*D+Se*k,ue=z*D+pe*k,Te=lt*D+Ce*k,Se=q*-k+Se*D,pe=z*-k+pe*D,Ce=lt*-k+Ce*D,Z=W*-k+Z*D,q=U,z=ue,lt=Te),R=vi(-K,Ce),x=R*Zt,R&&(D=Math.cos(-R),k=Math.sin(-R),U=I*D-Se*k,ue=H*D-pe*k,Te=K*D-Ce*k,Z=ee*k+Z*D,I=U,H=ue,K=Te),R=vi(H,I),y=R*Zt,R&&(D=Math.cos(R),k=Math.sin(R),U=I*D+H*k,ue=q*D+z*k,H=H*D-I*k,z=z*D-q*k,I=U,q=ue),b&&Math.abs(b)+Math.abs(y)>359.9&&(b=y=0,x=180-x),g=de(Math.sqrt(I*I+H*H+K*K)),v=de(Math.sqrt(z*z+lt*lt)),R=vi(q,z),w=Math.abs(R)>2e-4?R*Zt:0,T=Z?1/(Z<0?-Z:Z):0),s.svg&&(U=e.getAttribute("transform"),s.forceCSS=e.setAttribute("transform","")||!Ch(pt(e,ge)),U&&e.setAttribute("transform",U))),Math.abs(w)>90&&Math.abs(w)<270&&(l?(g*=-1,w+=y<=0?180:-180,y+=y<=0?180:-180):(v*=-1,w+=w<=0?180:-180)),t=t||s.uncache,s.x=d-((s.xPercent=d&&(!t&&s.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-d)?-50:0)))?e.offsetWidth*s.xPercent/100:0)+h,s.y=f-((s.yPercent=f&&(!t&&s.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-f)?-50:0)))?e.offsetHeight*s.yPercent/100:0)+h,s.z=_+h,s.scaleX=de(g),s.scaleY=de(v),s.rotation=de(y)+c,s.rotationX=de(b)+c,s.rotationY=de(x)+c,s.skewX=w+c,s.skewY=C+c,s.transformPerspective=T+h,(s.zOrigin=parseFloat(p.split(" ")[2])||0)&&(n[Lt]=cn(p)),s.xOffset=s.yOffset=0,s.force3D=Ne.force3D,s.renderTransform=s.svg?Gf:bh?Eh:Hf,s.uncache=0,s},cn=function(e){return(e=e.split(" "))[0]+" "+e[1]},ur=function(e,t,s){var n=ye(t);return de(parseFloat(t)+parseFloat(Ut(e,"x",s+"px",n)))+n},Hf=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,Eh(e,t)},Kt="0deg",is="0px",Yt=") ",Eh=function(e,t){var s=t||this,n=s.xPercent,l=s.yPercent,h=s.x,c=s.y,p=s.z,d=s.rotation,f=s.rotationY,_=s.rotationX,g=s.skewX,v=s.skewY,y=s.scaleX,b=s.scaleY,x=s.transformPerspective,w=s.force3D,C=s.target,T=s.zOrigin,O="",A=w==="auto"&&e&&e!==1||w===!0;if(T&&(_!==Kt||f!==Kt)){var M=parseFloat(f)*Pi,R=Math.sin(M),D=Math.cos(M),k;M=parseFloat(_)*Pi,k=Math.cos(M),h=ur(C,h,R*k*-T),c=ur(C,c,-Math.sin(M)*-T),p=ur(C,p,D*k*-T+T)}x!==is&&(O+="perspective("+x+Yt),(n||l)&&(O+="translate("+n+"%, "+l+"%) "),(A||h!==is||c!==is||p!==is)&&(O+=p!==is||A?"translate3d("+h+", "+c+", "+p+") ":"translate("+h+", "+c+Yt),d!==Kt&&(O+="rotate("+d+Yt),f!==Kt&&(O+="rotateY("+f+Yt),_!==Kt&&(O+="rotateX("+_+Yt),(g!==Kt||v!==Kt)&&(O+="skew("+g+", "+v+Yt),(y!==1||b!==1)&&(O+="scale("+y+", "+b+Yt),C.style[ge]=O||"translate(0, 0)"},Gf=function(e,t){var s=t||this,n=s.xPercent,l=s.yPercent,h=s.x,c=s.y,p=s.rotation,d=s.skewX,f=s.skewY,_=s.scaleX,g=s.scaleY,v=s.target,y=s.xOrigin,b=s.yOrigin,x=s.xOffset,w=s.yOffset,C=s.forceCSS,T=parseFloat(h),O=parseFloat(c),A,M,R,D,k;p=parseFloat(p),d=parseFloat(d),f=parseFloat(f),f&&(f=parseFloat(f),d+=f,p+=f),p||d?(p*=Pi,d*=Pi,A=Math.cos(p)*_,M=Math.sin(p)*_,R=Math.sin(p-d)*-g,D=Math.cos(p-d)*g,d&&(f*=Pi,k=Math.tan(d-f),k=Math.sqrt(1+k*k),R*=k,D*=k,f&&(k=Math.tan(f),k=Math.sqrt(1+k*k),A*=k,M*=k)),A=de(A),M=de(M),R=de(R),D=de(D)):(A=_,D=g,M=R=0),(T&&!~(h+"").indexOf("px")||O&&!~(c+"").indexOf("px"))&&(T=Ut(v,"x",h,"px"),O=Ut(v,"y",c,"px")),(y||b||x||w)&&(T=de(T+y-(y*A+b*R)+x),O=de(O+b-(y*M+b*D)+w)),(n||l)&&(k=v.getBBox(),T=de(T+n/100*k.width),O=de(O+l/100*k.height)),k="matrix("+A+","+M+","+R+","+D+","+T+","+O+")",v.setAttribute("transform",k),C&&(v.style[ge]=k)},jf=function(e,t,s,n,l){var h=360,c=ve(l),p=parseFloat(l)*(c&&~l.indexOf("rad")?Zt:1),d=p-n,f=n+d+"deg",_,g;return c&&(_=l.split("_")[1],_==="short"&&(d%=h,d!==d%(h/2)&&(d+=d<0?h:-h)),_==="cw"&&d<0?d=(d+h*Oa)%h-~~(d/h)*h:_==="ccw"&&d>0&&(d=(d-h*Oa)%h-~~(d/h)*h)),e._pt=g=new Le(e._pt,t,s,n,d,Mf),g.e=f,g.u="deg",e._props.push(s),g},La=function(e,t){for(var s in t)e[s]=t[s];return e},Kf=function(e,t,s){var n=La({},s._gsap),l="perspective,force3D,transformOrigin,svgOrigin",h=s.style,c,p,d,f,_,g,v,y;n.svg?(d=s.getAttribute("transform"),s.setAttribute("transform",""),h[ge]=t,c=ys(s,1),bs(s,ge),s.setAttribute("transform",d)):(d=getComputedStyle(s)[ge],h[ge]=t,c=ys(s,1),h[ge]=d);for(p in kt)d=n[p],f=c[p],d!==f&&l.indexOf(p)<0&&(v=ye(d),y=ye(f),_=v!==y?Ut(s,p,d,y):parseFloat(d),g=parseFloat(f),e._pt=new Le(e._pt,c,p,_,g-_,_h),e._pt.u=y||0,e._props.push(p));La(c,n)};ke("padding,margin,Width,Radius",function(r,e){var t="Top",s="Right",n="Bottom",l="Left",h=(e<3?[t,s,n,l]:[t+l,t+s,n+s,n+l]).map(function(c){return e<2?r+c:"border"+c+r});hn[e>1?"border"+r:r]=function(c,p,d,f,_){var g,v;if(arguments.length<4)return g=h.map(function(y){return Xt(c,y,d)}),v=g.join(" "),v.split(g[0]).length===5?g[0]:v;g=(f+"").split(" "),v={},h.forEach(function(y,b){return v[y]=g[b]=g[b]||g[(b-1)/2|0]}),c.init(p,v,_)}});var Th={name:"css",register:Ir,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,s,n,l){var h=this._props,c=e.style,p=s.vars.startAt,d,f,_,g,v,y,b,x,w,C,T,O,A,M,R;oo||Ir();for(b in t)if(b!=="autoRound"&&(f=t[b],!(Be[b]&&lh(b,t,s,n,e,l)))){if(v=typeof f,y=hn[b],v==="function"&&(f=f.call(s,n,e,l),v=typeof f),v==="string"&&~f.indexOf("random(")&&(f=_s(f)),y)y(this,e,b,f,s)&&(R=1);else if(b.substr(0,2)==="--")d=(getComputedStyle(e).getPropertyValue(b)+"").trim(),f+="",Dt.lastIndex=0,Dt.test(d)||(x=ye(d),w=ye(f)),w?x!==w&&(d=Ut(e,b,d,w)+w):x&&(f+=x),this.add(c,"setProperty",d,f,n,l,0,0,b),h.push(b);else if(v!=="undefined"){if(p&&b in p?(d=typeof p[b]=="function"?p[b].call(s,n,e,l):p[b],ve(d)&&~d.indexOf("random(")&&(d=_s(d)),ye(d+"")||(d+=Ne.units[b]||ye(Xt(e,b))||""),(d+"").charAt(1)==="="&&(d=Xt(e,b))):d=Xt(e,b),g=parseFloat(d),C=v==="string"&&f.charAt(1)==="="&&f.substr(0,2),C&&(f=f.substr(2)),_=parseFloat(f),b in At&&(b==="autoAlpha"&&(g===1&&Xt(e,"visibility")==="hidden"&&_&&(g=0),Mt(this,c,"visibility",g?"inherit":"hidden",_?"inherit":"hidden",!_)),b!=="scale"&&b!=="transform"&&(b=At[b],~b.indexOf(",")&&(b=b.split(",")[0]))),T=b in kt,T){if(O||(A=e._gsap,A.renderTransform&&!t.parseTransform||ys(e,t.parseTransform),M=t.smoothOrigin!==!1&&A.smooth,O=this._pt=new Le(this._pt,c,ge,0,1,A.renderTransform,A,0,-1),O.dep=1),b==="scale")this._pt=new Le(this._pt,A,"scaleY",A.scaleY,(C?Ti(A.scaleY,C+_):_)-A.scaleY||0),h.push("scaleY",b),b+="X";else if(b==="transformOrigin"){f=Vf(f),A.svg?Br(e,f,0,M,0,this):(w=parseFloat(f.split(" ")[2])||0,w!==A.zOrigin&&Mt(this,A,"zOrigin",A.zOrigin,w),Mt(this,c,b,cn(d),cn(f)));continue}else if(b==="svgOrigin"){Br(e,f,1,M,0,this);continue}else if(b in wh){jf(this,A,b,g,C?Ti(g,C+f):f);continue}else if(b==="smoothOrigin"){Mt(this,A,"smooth",A.smooth,f);continue}else if(b==="force3D"){A[b]=f;continue}else if(b==="transform"){Kf(this,f,e);continue}}else b in c||(b=Ui(b)||b);if(T||(_||_===0)&&(g||g===0)&&!Af.test(f)&&b in c)x=(d+"").substr((g+"").length),_||(_=0),w=ye(f)||(b in Ne.units?Ne.units[b]:x),x!==w&&(g=Ut(e,b,d,w)),this._pt=new Le(this._pt,T?A:c,b,g,(C?Ti(g,C+_):_)-g,!T&&(w==="px"||b==="zIndex")&&t.autoRound!==!1?Df:_h),this._pt.u=w||0,x!==w&&w!=="%"&&(this._pt.b=d,this._pt.r=Rf);else if(b in c)Nf.call(this,e,b,d,C?C+f:f);else if(b in e)this.add(e,b,d||e[b],C?C+f:f,n,l);else{Zr(b,f);continue}h.push(b)}}R&&fh(this)},get:Xt,aliases:At,getSetter:function(e,t,s){var n=At[t];return n&&n.indexOf(",")<0&&(t=n),t in kt&&t!==Lt&&(e._gsap.x||Xt(e,"x"))?s&&Pa===s?t==="scale"?If:Uf:(Pa=s||{})&&(t==="scale"?Bf:Ff):e.style&&!qr(e.style[t])?kf:~t.indexOf("-")?Lf:no(e,t)},core:{_removeProperty:bs,_getMatrix:ao}};Qe.utils.checkPrefix=Ui;(function(r,e,t,s){var n=ke(r+","+e+","+t,function(l){kt[l]=1});ke(e,function(l){Ne.units[l]="deg",wh[l]=1}),At[n[13]]=r+","+e,ke(s,function(l){var h=l.split(":");At[h[1]]=n[h[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");ke("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(r){Ne.units[r]="px"});Qe.registerPlugin(Th);var Fr=Qe.registerPlugin(Th)||Qe;Fr.core.Tween;var Qs={exports:{}},Yf=Qs.exports,Ua;function $f(){return Ua||(Ua=1,(function(r,e){(function(t,s){r.exports=s()})(Yf,function(){var t=function(){function s(v){return h.appendChild(v.dom),v}function n(v){for(var y=0;y<h.children.length;y++)h.children[y].style.display=y===v?"block":"none";l=v}var l=0,h=document.createElement("div");h.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",h.addEventListener("click",function(v){v.preventDefault(),n(++l%h.children.length)},!1);var c=(performance||Date).now(),p=c,d=0,f=s(new t.Panel("FPS","#0ff","#002")),_=s(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var g=s(new t.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:h,addPanel:s,showPanel:n,begin:function(){c=(performance||Date).now()},end:function(){d++;var v=(performance||Date).now();if(_.update(v-c,200),v>p+1e3&&(f.update(1e3*d/(v-p),100),p=v,d=0,g)){var y=performance.memory;g.update(y.usedJSHeapSize/1048576,y.jsHeapSizeLimit/1048576)}return v},update:function(){c=this.end()},domElement:h,setMode:n}};return t.Panel=function(s,n,l){var h=1/0,c=0,p=Math.round,d=p(window.devicePixelRatio||1),f=80*d,_=48*d,g=3*d,v=2*d,y=3*d,b=15*d,x=74*d,w=30*d,C=document.createElement("canvas");C.width=f,C.height=_,C.style.cssText="width:80px;height:48px";var T=C.getContext("2d");return T.font="bold "+9*d+"px Helvetica,Arial,sans-serif",T.textBaseline="top",T.fillStyle=l,T.fillRect(0,0,f,_),T.fillStyle=n,T.fillText(s,g,v),T.fillRect(y,b,x,w),T.fillStyle=l,T.globalAlpha=.9,T.fillRect(y,b,x,w),{dom:C,update:function(O,A){h=Math.min(h,O),c=Math.max(c,O),T.fillStyle=l,T.globalAlpha=1,T.fillRect(0,0,f,b),T.fillStyle=n,T.fillText(p(O)+" "+s+" ("+p(h)+"-"+p(c)+")",g,v),T.drawImage(C,y+d,b,x-d,w,y,b,x-d,w),T.fillRect(y+x-d,b,d,w),T.fillStyle=l,T.globalAlpha=.9,T.fillRect(y+x-d,b,d,p((1-O/A)*w))}}},t})})(Qs)),Qs.exports}var qf=$f();const Wf=bl(qf);var hs={exports:{}};var Zf=hs.exports,Ia;function Xf(){return Ia||(Ia=1,(function(r,e){(function(t,s){s(e)})(Zf,(function(t){class s{constructor(i){const[o,u]=i.split("-"),m=o.split(".");this.major=parseInt(m[0],10),this.minor=parseInt(m[1],10),this.patch=parseInt(m[2],10),this.prerelease=u??null}toString(){const i=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[i,this.prerelease].join("-"):i}}class n{constructor(i){this.controller_=i}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(i){this.controller_.viewProps.set("disabled",i)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(i){this.controller_.viewProps.set("hidden",i)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class l{constructor(i){this.target=i}}class h extends l{constructor(i,o,u,m){super(i),this.value=o,this.presetKey=u,this.last=m??!0}}class c extends l{constructor(i,o,u){super(i),this.value=o,this.presetKey=u}}class p extends l{constructor(i,o){super(i),this.expanded=o}}function d(a){return a}function f(a){return a==null}function _(a,i){if(a.length!==i.length)return!1;for(let o=0;o<a.length;o++)if(a[o]!==i[o])return!1;return!0}const g={alreadydisposed:()=>"View has been already disposed",invalidparams:a=>`Invalid parameters for '${a.name}'`,nomatchingcontroller:a=>`No matching controller for '${a.key}'`,nomatchingview:a=>`No matching view for '${JSON.stringify(a.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:a=>`Property '${a.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class v{constructor(i){var o;this.message=(o=g[i.type](i.context))!==null&&o!==void 0?o:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=i.type}static alreadyDisposed(){return new v({type:"alreadydisposed"})}static notBindable(){return new v({type:"notbindable"})}static propertyNotFound(i){return new v({type:"propertynotfound",context:{name:i}})}static shouldNeverHappen(){return new v({type:"shouldneverhappen"})}}class y{constructor(i,o,u){this.obj_=i,this.key_=o,this.presetKey_=u??o}static isBindable(i){return!(i===null||typeof i!="object")}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(i){this.obj_[this.key_]=i}writeProperty(i,o){const u=this.read();if(!y.isBindable(u))throw v.notBindable();if(!(i in u))throw v.propertyNotFound(i);u[i]=o}}class b extends n{get label(){return this.controller_.props.get("label")}set label(i){this.controller_.props.set("label",i)}get title(){var i;return(i=this.controller_.valueController.props.get("title"))!==null&&i!==void 0?i:""}set title(i){this.controller_.valueController.props.set("title",i)}on(i,o){const u=o.bind(this);return this.controller_.valueController.emitter.on(i,()=>{u(new l(this))}),this}}class x{constructor(){this.observers_={}}on(i,o){let u=this.observers_[i];return u||(u=this.observers_[i]=[]),u.push({handler:o}),this}off(i,o){const u=this.observers_[i];return u&&(this.observers_[i]=u.filter(m=>m.handler!==o)),this}emit(i,o){const u=this.observers_[i];u&&u.forEach(m=>{m.handler(o)})}}const w="tp";function C(a){return(o,u)=>[w,"-",a,"v",o?`_${o}`:"",u?`-${u}`:""].join("")}function T(a,i){return o=>i(a(o))}function O(a){return a.rawValue}function A(a,i){a.emitter.on("change",T(O,i)),i(a.rawValue)}function M(a,i,o){A(a.value(i),o)}function R(a,i,o){o?a.classList.add(i):a.classList.remove(i)}function D(a,i){return o=>{R(a,i,o)}}function k(a,i){A(a,o=>{i.textContent=o??""})}const I=C("btn");class H{constructor(i,o){this.element=i.createElement("div"),this.element.classList.add(I()),o.viewProps.bindClassModifiers(this.element);const u=i.createElement("button");u.classList.add(I("b")),o.viewProps.bindDisabled(u),this.element.appendChild(u),this.buttonElement=u;const m=i.createElement("div");m.classList.add(I("t")),k(o.props.value("title"),m),this.buttonElement.appendChild(m)}}class K{constructor(i,o){this.emitter=new x,this.onClick_=this.onClick_.bind(this),this.props=o.props,this.viewProps=o.viewProps,this.view=new H(i,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class ee{constructor(i,o){var u;this.constraint_=o?.constraint,this.equals_=(u=o?.equals)!==null&&u!==void 0?u:((m,E)=>m===E),this.emitter=new x,this.rawValue_=i}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(i){this.setRawValue(i,{forceEmit:!1,last:!0})}setRawValue(i,o){const u=o??{forceEmit:!1,last:!0},m=this.constraint_?this.constraint_.constrain(i):i;this.equals_(this.rawValue_,m)&&!u.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=m,this.emitter.emit("change",{options:u,rawValue:m,sender:this}))}}class q{constructor(i){this.emitter=new x,this.value_=i}get rawValue(){return this.value_}set rawValue(i){this.setRawValue(i,{forceEmit:!1,last:!0})}setRawValue(i,o){const u=o??{forceEmit:!1,last:!0};this.value_===i&&!u.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=i,this.emitter.emit("change",{options:u,rawValue:this.value_,sender:this}))}}function z(a,i){const o=i?.constraint,u=i?.equals;return!o&&!u?new q(a):new ee(a,i)}class U{constructor(i){this.emitter=new x,this.valMap_=i;for(const o in this.valMap_)this.valMap_[o].emitter.on("change",()=>{this.emitter.emit("change",{key:o,sender:this})})}static createCore(i){return Object.keys(i).reduce((u,m)=>Object.assign(u,{[m]:z(i[m])}),{})}static fromObject(i){const o=this.createCore(i);return new U(o)}get(i){return this.valMap_[i].rawValue}set(i,o){this.valMap_[i].rawValue=o}value(i){return this.valMap_[i]}}function ue(a,i){const u=Object.keys(i).reduce((m,E)=>{if(m===void 0)return;const S=i[E],L=S(a[E]);return L.succeeded?Object.assign(Object.assign({},m),{[E]:L.value}):void 0},{});return u}function Te(a,i){return a.reduce((o,u)=>{if(o===void 0)return;const m=i(u);if(!(!m.succeeded||m.value===void 0))return[...o,m.value]},[])}function Se(a){return a===null?!1:typeof a=="object"}function pe(a){return i=>o=>{if(!i&&o===void 0)return{succeeded:!1,value:void 0};if(i&&o===void 0)return{succeeded:!0,value:void 0};const u=a(o);return u!==void 0?{succeeded:!0,value:u}:{succeeded:!1,value:void 0}}}function Ce(a){return{custom:i=>pe(i)(a),boolean:pe(i=>typeof i=="boolean"?i:void 0)(a),number:pe(i=>typeof i=="number"?i:void 0)(a),string:pe(i=>typeof i=="string"?i:void 0)(a),function:pe(i=>typeof i=="function"?i:void 0)(a),constant:i=>pe(o=>o===i?i:void 0)(a),raw:pe(i=>i)(a),object:i=>pe(o=>{if(Se(o))return ue(o,i)})(a),array:i=>pe(o=>{if(Array.isArray(o))return Te(o,i)})(a)}}const W={optional:Ce(!0),required:Ce(!1)};function Z(a,i){const o=W.required.object(i)(a);return o.succeeded?o.value:void 0}function lt(a){return a&&a.parentElement&&a.parentElement.removeChild(a),null}function Ih(){return["veryfirst","first","last","verylast"]}const uo=C(""),po={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class Bi{constructor(i){this.parent_=null,this.blade=i.blade,this.view=i.view,this.viewProps=i.viewProps;const o=this.view.element;this.blade.value("positions").emitter.on("change",()=>{Ih().forEach(u=>{o.classList.remove(uo(void 0,po[u]))}),this.blade.get("positions").forEach(u=>{o.classList.add(uo(void 0,po[u]))})}),this.viewProps.handleDispose(()=>{lt(o)})}get parent(){return this.parent_}}const et="http://www.w3.org/2000/svg";function Ts(a){a.offsetHeight}function Bh(a,i){const o=a.style.transition;a.style.transition="none",i(),a.style.transition=o}function wn(a){return a.ontouchstart!==void 0}function Fh(){return new Function("return this")()}function Nh(){return Fh().document}function Vh(a){const i=a.ownerDocument.defaultView;return i&&"document"in i?a.getContext("2d"):null}const zh={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Ss(a,i){const o=a.createElementNS(et,"svg");return o.innerHTML=zh[i],o}function fo(a,i,o){a.insertBefore(i,a.children[o])}function mo(a){a.parentElement&&a.parentElement.removeChild(a)}function _o(a){for(;a.children.length>0;)a.removeChild(a.children[0])}function Hh(a){for(;a.childNodes.length>0;)a.removeChild(a.childNodes[0])}function vo(a){return a.relatedTarget?a.relatedTarget:"explicitOriginalTarget"in a?a.explicitOriginalTarget:null}const Fi=C("lbl");function Gh(a,i){const o=a.createDocumentFragment();return i.split(`
`).map(m=>a.createTextNode(m)).forEach((m,E)=>{E>0&&o.appendChild(a.createElement("br")),o.appendChild(m)}),o}class go{constructor(i,o){this.element=i.createElement("div"),this.element.classList.add(Fi()),o.viewProps.bindClassModifiers(this.element);const u=i.createElement("div");u.classList.add(Fi("l")),M(o.props,"label",E=>{f(E)?this.element.classList.add(Fi(void 0,"nol")):(this.element.classList.remove(Fi(void 0,"nol")),Hh(u),u.appendChild(Gh(i,E)))}),this.element.appendChild(u),this.labelElement=u;const m=i.createElement("div");m.classList.add(Fi("v")),this.element.appendChild(m),this.valueElement=m}}class Ps extends Bi{constructor(i,o){const u=o.valueController.viewProps;super(Object.assign(Object.assign({},o),{view:new go(i,{props:o.props,viewProps:u}),viewProps:u})),this.props=o.props,this.valueController=o.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const jh={id:"button",type:"blade",accept(a){const i=W,o=Z(a,{title:i.required.string,view:i.required.constant("button"),label:i.optional.string});return o?{params:o}:null},controller(a){return new Ps(a.document,{blade:a.blade,props:U.fromObject({label:a.params.label}),valueController:new K(a.document,{props:U.fromObject({title:a.params.title}),viewProps:a.viewProps})})},api(a){return!(a.controller instanceof Ps)||!(a.controller.valueController instanceof K)?null:new b(a.controller)}};class ai extends Bi{constructor(i){super(i),this.value=i.value}}function Ni(){return new U({positions:z([],{equals:_})})}class Vi extends U{constructor(i){super(i)}static create(i){const o={completed:!0,expanded:i,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},u=U.createCore(o);return new Vi(u)}get styleExpanded(){var i;return(i=this.get("temporaryExpanded"))!==null&&i!==void 0?i:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const i=this.get("expandedHeight");return this.get("shouldFixHeight")&&!f(i)?`${i}px`:"auto"}bindExpandedClass(i,o){const u=()=>{this.styleExpanded?i.classList.add(o):i.classList.remove(o)};M(this,"expanded",u),M(this,"temporaryExpanded",u)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function Kh(a,i){let o=0;return Bh(i,()=>{a.set("expandedHeight",null),a.set("temporaryExpanded",!0),Ts(i),o=i.clientHeight,a.set("temporaryExpanded",null),Ts(i)}),o}function bo(a,i){i.style.height=a.styleHeight}function Cn(a,i){a.value("expanded").emitter.on("beforechange",()=>{a.set("completed",!1),f(a.get("expandedHeight"))&&a.set("expandedHeight",Kh(a,i)),a.set("shouldFixHeight",!0),Ts(i)}),a.emitter.on("change",()=>{bo(a,i)}),bo(a,i),i.addEventListener("transitionend",o=>{o.propertyName==="height"&&a.cleanUpTransition()})}class En extends n{constructor(i,o){super(i),this.rackApi_=o}}function Yh(a,i){return a.addBlade(Object.assign(Object.assign({},i),{view:"button"}))}function $h(a,i){return a.addBlade(Object.assign(Object.assign({},i),{view:"folder"}))}function qh(a,i){const o=i||{};return a.addBlade(Object.assign(Object.assign({},o),{view:"separator"}))}function Wh(a,i){return a.addBlade(Object.assign(Object.assign({},i),{view:"tab"}))}class Tn{constructor(i){this.emitter=new x,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=i}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(i){for(const o of this.allItems())if(i(o))return o;return null}includes(i){return this.cache_.has(i)}add(i,o){if(this.includes(i))throw v.shouldNeverHappen();const u=o!==void 0?o:this.items_.length;this.items_.splice(u,0,i),this.cache_.add(i);const m=this.extract_(i);m&&(m.emitter.on("add",this.onSubListAdd_),m.emitter.on("remove",this.onSubListRemove_),m.allItems().forEach(E=>{this.cache_.add(E)})),this.emitter.emit("add",{index:u,item:i,root:this,target:this})}remove(i){const o=this.items_.indexOf(i);if(o<0)return;this.items_.splice(o,1),this.cache_.delete(i);const u=this.extract_(i);u&&(u.emitter.off("add",this.onSubListAdd_),u.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:o,item:i,root:this,target:this})}onSubListAdd_(i){this.cache_.add(i.item),this.emitter.emit("add",{index:i.index,item:i.item,root:this,target:i.target})}onSubListRemove_(i){this.cache_.delete(i.item),this.emitter.emit("remove",{index:i.index,item:i.item,root:this,target:i.target})}}class Sn extends n{constructor(i){super(i),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new x,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(i){this.controller_.props.set("label",i)}on(i,o){const u=o.bind(this);return this.emitter_.on(i,m=>{u(m.event)}),this}refresh(){this.controller_.binding.read()}onBindingChange_(i){const o=i.sender.target.read();this.emitter_.emit("change",{event:new h(this,o,this.controller_.binding.target.presetKey,i.options.last)})}}class tt extends Ps{constructor(i,o){super(i,o),this.binding=o.binding}}class Pn extends n{constructor(i){super(i),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new x,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(i){this.controller_.props.set("label",i)}on(i,o){const u=o.bind(this);return this.emitter_.on(i,m=>{u(m.event)}),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(i){const o=i.sender.target.read();this.emitter_.emit("update",{event:new c(this,o,this.controller_.binding.target.presetKey)})}}class _t extends Ps{constructor(i,o){super(i,o),this.binding=o.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function Zh(a){return a instanceof Os?a.apiSet_:a instanceof En?a.rackApi_.apiSet_:null}function zi(a,i){const o=a.find(u=>u.controller_===i);if(!o)throw v.shouldNeverHappen();return o}function xo(a,i,o){if(!y.isBindable(a))throw v.notBindable();return new y(a,i,o)}class Os extends n{constructor(i,o){super(i),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new x,this.apiSet_=new Tn(Zh),this.pool_=o;const u=this.controller_.rack;u.emitter.on("add",this.onRackAdd_),u.emitter.on("remove",this.onRackRemove_),u.emitter.on("inputchange",this.onRackInputChange_),u.emitter.on("monitorupdate",this.onRackMonitorUpdate_),u.children.forEach(m=>{this.setUpApi_(m)})}get children(){return this.controller_.rack.children.map(i=>zi(this.apiSet_,i))}addInput(i,o,u){const m=u||{},E=this.controller_.view.element.ownerDocument,S=this.pool_.createInput(E,xo(i,o,m.presetKey),m),L=new Sn(S);return this.add(L,m.index)}addMonitor(i,o,u){const m=u||{},E=this.controller_.view.element.ownerDocument,S=this.pool_.createMonitor(E,xo(i,o),m),L=new Pn(S);return this.add(L,m.index)}addFolder(i){return $h(this,i)}addButton(i){return Yh(this,i)}addSeparator(i){return qh(this,i)}addTab(i){return Wh(this,i)}add(i,o){this.controller_.rack.add(i.controller_,o);const u=this.apiSet_.find(m=>m.controller_===i.controller_);return u&&this.apiSet_.remove(u),this.apiSet_.add(i),i}remove(i){this.controller_.rack.remove(i.controller_)}addBlade(i){const o=this.controller_.view.element.ownerDocument,u=this.pool_.createBlade(o,i),m=this.pool_.createBladeApi(u);return this.add(m,i.index)}on(i,o){const u=o.bind(this);return this.emitter_.on(i,m=>{u(m.event)}),this}setUpApi_(i){this.apiSet_.find(u=>u.controller_===i)||this.apiSet_.add(this.pool_.createBladeApi(i))}onRackAdd_(i){this.setUpApi_(i.bladeController)}onRackRemove_(i){if(i.isRoot){const o=zi(this.apiSet_,i.bladeController);this.apiSet_.remove(o)}}onRackInputChange_(i){const o=i.bladeController;if(o instanceof tt){const u=zi(this.apiSet_,o),m=o.binding;this.emitter_.emit("change",{event:new h(u,m.target.read(),m.target.presetKey,i.options.last)})}else if(o instanceof ai){const u=zi(this.apiSet_,o);this.emitter_.emit("change",{event:new h(u,o.value.rawValue,void 0,i.options.last)})}}onRackMonitorUpdate_(i){if(!(i.bladeController instanceof _t))throw v.shouldNeverHappen();const o=zi(this.apiSet_,i.bladeController),u=i.bladeController.binding;this.emitter_.emit("update",{event:new c(o,u.target.read(),u.target.presetKey)})}}class On extends En{constructor(i,o){super(i,new Os(i.rackController,o)),this.emitter_=new x,this.controller_.foldable.value("expanded").emitter.on("change",u=>{this.emitter_.emit("fold",{event:new p(this,u.sender.rawValue)})}),this.rackApi_.on("change",u=>{this.emitter_.emit("change",{event:u})}),this.rackApi_.on("update",u=>{this.emitter_.emit("update",{event:u})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(i){this.controller_.foldable.set("expanded",i)}get title(){return this.controller_.props.get("title")}set title(i){this.controller_.props.set("title",i)}get children(){return this.rackApi_.children}addInput(i,o,u){return this.rackApi_.addInput(i,o,u)}addMonitor(i,o,u){return this.rackApi_.addMonitor(i,o,u)}addFolder(i){return this.rackApi_.addFolder(i)}addButton(i){return this.rackApi_.addButton(i)}addSeparator(i){return this.rackApi_.addSeparator(i)}addTab(i){return this.rackApi_.addTab(i)}add(i,o){return this.rackApi_.add(i,o)}remove(i){this.rackApi_.remove(i)}addBlade(i){return this.rackApi_.addBlade(i)}on(i,o){const u=o.bind(this);return this.emitter_.on(i,m=>{u(m.event)}),this}}class An extends Bi{constructor(i){super({blade:i.blade,view:i.view,viewProps:i.rackController.viewProps}),this.rackController=i.rackController}}class Xh{constructor(i,o){const u=C(o.viewName);this.element=i.createElement("div"),this.element.classList.add(u()),o.viewProps.bindClassModifiers(this.element)}}function Qh(a,i){for(let o=0;o<a.length;o++){const u=a[o];if(u instanceof tt&&u.binding===i)return u}return null}function Jh(a,i){for(let o=0;o<a.length;o++){const u=a[o];if(u instanceof _t&&u.binding===i)return u}return null}function ec(a,i){for(let o=0;o<a.length;o++){const u=a[o];if(u instanceof ai&&u.value===i)return u}return null}function Mn(a){return a instanceof Hi?a.rack:a instanceof An?a.rackController.rack:null}function tc(a){const i=Mn(a);return i?i.bcSet_:null}class ic{constructor(i){var o;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new x,this.blade_=i??null,(o=this.blade_)===null||o===void 0||o.value("positions").emitter.on("change",this.onBladePositionsChange_),this.bcSet_=new Tn(tc),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(i,o){i.parent&&i.parent.remove(i),i.parent_=this,this.bcSet_.add(i,o)}remove(i){i.parent_=null,this.bcSet_.remove(i)}find(i){return this.bcSet_.allItems().filter(o=>o instanceof i)}onSetAdd_(i){this.updatePositions_();const o=i.target===i.root;if(this.emitter.emit("add",{bladeController:i.item,index:i.index,isRoot:o,sender:this}),!o)return;const u=i.item;if(u.viewProps.emitter.on("change",this.onChildViewPropsChange_),u.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),u.viewProps.handleDispose(this.onChildDispose_),u instanceof tt)u.binding.emitter.on("change",this.onChildInputChange_);else if(u instanceof _t)u.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(u instanceof ai)u.value.emitter.on("change",this.onChildValueChange_);else{const m=Mn(u);if(m){const E=m.emitter;E.on("layout",this.onDescendantLayout_),E.on("inputchange",this.onDescendantInputChange_),E.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(i){this.updatePositions_();const o=i.target===i.root;if(this.emitter.emit("remove",{bladeController:i.item,isRoot:o,sender:this}),!o)return;const u=i.item;if(u instanceof tt)u.binding.emitter.off("change",this.onChildInputChange_);else if(u instanceof _t)u.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(u instanceof ai)u.value.emitter.off("change",this.onChildValueChange_);else{const m=Mn(u);if(m){const E=m.emitter;E.off("layout",this.onDescendantLayout_),E.off("inputchange",this.onDescendantInputChange_),E.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const i=this.bcSet_.items.filter(m=>!m.viewProps.get("hidden")),o=i[0],u=i[i.length-1];this.bcSet_.items.forEach(m=>{const E=[];m===o&&(E.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&E.push("veryfirst")),m===u&&(E.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&E.push("verylast")),m.blade.set("positions",E)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(i){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(o=>o.viewProps.get("disposed")).forEach(o=>{this.bcSet_.remove(o)})}onChildInputChange_(i){const o=Qh(this.find(tt),i.sender);if(!o)throw v.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:o,options:i.options,sender:this})}onChildMonitorUpdate_(i){const o=Jh(this.find(_t),i.sender);if(!o)throw v.shouldNeverHappen();this.emitter.emit("monitorupdate",{bladeController:o,sender:this})}onChildValueChange_(i){const o=ec(this.find(ai),i.sender);if(!o)throw v.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:o,options:i.options,sender:this})}onDescendantLayout_(i){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(i){this.emitter.emit("inputchange",{bladeController:i.bladeController,options:i.options,sender:this})}onDescendantMonitorUpdate_(i){this.emitter.emit("monitorupdate",{bladeController:i.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class Hi extends Bi{constructor(i,o){super(Object.assign(Object.assign({},o),{view:new Xh(i,{viewName:"brk",viewProps:o.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const u=new ic(o.root?void 0:o.blade);u.emitter.on("add",this.onRackAdd_),u.emitter.on("remove",this.onRackRemove_),this.rack=u,this.viewProps.handleDispose(()=>{for(let m=this.rack.children.length-1;m>=0;m--)this.rack.children[m].viewProps.set("disposed",!0)})}onRackAdd_(i){i.isRoot&&fo(this.view.element,i.bladeController.view.element,i.index)}onRackRemove_(i){i.isRoot&&mo(i.bladeController.view.element)}}const yo=C("cnt");class sc{constructor(i,o){this.className_=C(o.viewName||"fld"),this.element=i.createElement("div"),this.element.classList.add(this.className_(),yo()),o.viewProps.bindClassModifiers(this.element),this.foldable_=o.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),M(this.foldable_,"completed",D(this.element,this.className_(void 0,"cpl")));const u=i.createElement("button");u.classList.add(this.className_("b")),M(o.props,"title",L=>{f(L)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),o.viewProps.bindDisabled(u),this.element.appendChild(u),this.buttonElement=u;const m=i.createElement("div");m.classList.add(this.className_("t")),k(o.props.value("title"),m),this.buttonElement.appendChild(m),this.titleElement=m;const E=i.createElement("div");E.classList.add(this.className_("m")),this.buttonElement.appendChild(E);const S=o.containerElement;S.classList.add(this.className_("c")),this.element.appendChild(S),this.containerElement=S}}class Rn extends An{constructor(i,o){var u;const m=Vi.create((u=o.expanded)!==null&&u!==void 0?u:!0),E=new Hi(i,{blade:o.blade,root:o.root,viewProps:o.viewProps});super(Object.assign(Object.assign({},o),{rackController:E,view:new sc(i,{containerElement:E.view.element,foldable:m,props:o.props,viewName:o.root?"rot":void 0,viewProps:o.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=o.props,this.foldable=m,Cn(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const nc={id:"folder",type:"blade",accept(a){const i=W,o=Z(a,{title:i.required.string,view:i.required.constant("folder"),expanded:i.optional.boolean});return o?{params:o}:null},controller(a){return new Rn(a.document,{blade:a.blade,expanded:a.params.expanded,props:U.fromObject({title:a.params.title}),viewProps:a.viewProps})},api(a){return a.controller instanceof Rn?new On(a.controller,a.pool):null}};class li extends ai{constructor(i,o){const u=o.valueController.viewProps;super(Object.assign(Object.assign({},o),{value:o.valueController.value,view:new go(i,{props:o.props,viewProps:u}),viewProps:u})),this.props=o.props,this.valueController=o.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class wo extends n{}const Co=C("spr");class rc{constructor(i,o){this.element=i.createElement("div"),this.element.classList.add(Co()),o.viewProps.bindClassModifiers(this.element);const u=i.createElement("hr");u.classList.add(Co("r")),this.element.appendChild(u)}}class Eo extends Bi{constructor(i,o){super(Object.assign(Object.assign({},o),{view:new rc(i,{viewProps:o.viewProps})}))}}const oc={id:"separator",type:"blade",accept(a){const o=Z(a,{view:W.required.constant("separator")});return o?{params:o}:null},controller(a){return new Eo(a.document,{blade:a.blade,viewProps:a.viewProps})},api(a){return a.controller instanceof Eo?new wo(a.controller):null}},ac=C("");function To(a,i){return D(a,ac(void 0,i))}class vt extends U{constructor(i){super(i)}static create(i){var o,u;const m=i??{},E={disabled:(o=m.disabled)!==null&&o!==void 0?o:!1,disposed:!1,hidden:(u=m.hidden)!==null&&u!==void 0?u:!1},S=U.createCore(E);return new vt(S)}bindClassModifiers(i){M(this,"disabled",To(i,"disabled")),M(this,"hidden",To(i,"hidden"))}bindDisabled(i){M(this,"disabled",o=>{i.disabled=o})}bindTabIndex(i){M(this,"disabled",o=>{i.tabIndex=o?-1:0})}handleDispose(i){this.value("disposed").emitter.on("change",o=>{o&&i()})}}const Gi=C("tbi");class lc{constructor(i,o){this.element=i.createElement("div"),this.element.classList.add(Gi()),o.viewProps.bindClassModifiers(this.element),M(o.props,"selected",E=>{E?this.element.classList.add(Gi(void 0,"sel")):this.element.classList.remove(Gi(void 0,"sel"))});const u=i.createElement("button");u.classList.add(Gi("b")),o.viewProps.bindDisabled(u),this.element.appendChild(u),this.buttonElement=u;const m=i.createElement("div");m.classList.add(Gi("t")),k(o.props.value("title"),m),this.buttonElement.appendChild(m),this.titleElement=m}}class hc{constructor(i,o){this.emitter=new x,this.onClick_=this.onClick_.bind(this),this.props=o.props,this.viewProps=o.viewProps,this.view=new lc(i,{props:o.props,viewProps:o.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class So{constructor(i,o){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new hc(i,{props:o.itemProps,viewProps:vt.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new Hi(i,{blade:Ni(),viewProps:vt.create()}),this.props=o.props,M(this.props,"selected",u=>{this.itemController.props.set("selected",u),this.contentController.viewProps.set("hidden",!u)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class Po{constructor(i,o){this.controller_=i,this.rackApi_=o}get title(){var i;return(i=this.controller_.itemController.props.get("title"))!==null&&i!==void 0?i:""}set title(i){this.controller_.itemController.props.set("title",i)}get selected(){return this.controller_.props.get("selected")}set selected(i){this.controller_.props.set("selected",i)}get children(){return this.rackApi_.children}addButton(i){return this.rackApi_.addButton(i)}addFolder(i){return this.rackApi_.addFolder(i)}addSeparator(i){return this.rackApi_.addSeparator(i)}addTab(i){return this.rackApi_.addTab(i)}add(i,o){this.rackApi_.add(i,o)}remove(i){this.rackApi_.remove(i)}addInput(i,o,u){return this.rackApi_.addInput(i,o,u)}addMonitor(i,o,u){return this.rackApi_.addMonitor(i,o,u)}addBlade(i){return this.rackApi_.addBlade(i)}}class Oo extends En{constructor(i,o){super(i,new Os(i.rackController,o)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.emitter_=new x,this.pageApiMap_=new Map,this.rackApi_.on("change",u=>{this.emitter_.emit("change",{event:u})}),this.rackApi_.on("update",u=>{this.emitter_.emit("update",{event:u})}),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach(u=>{this.setUpPageApi_(u)})}get pages(){return this.controller_.pageSet.items.map(i=>{const o=this.pageApiMap_.get(i);if(!o)throw v.shouldNeverHappen();return o})}addPage(i){const o=this.controller_.view.element.ownerDocument,u=new So(o,{itemProps:U.fromObject({selected:!1,title:i.title}),props:U.fromObject({selected:!1})});this.controller_.add(u,i.index);const m=this.pageApiMap_.get(u);if(!m)throw v.shouldNeverHappen();return m}removePage(i){this.controller_.remove(i)}on(i,o){const u=o.bind(this);return this.emitter_.on(i,m=>{u(m.event)}),this}setUpPageApi_(i){const o=this.rackApi_.apiSet_.find(m=>m.controller_===i.contentController);if(!o)throw v.shouldNeverHappen();const u=new Po(i,o);this.pageApiMap_.set(i,u)}onPageAdd_(i){this.setUpPageApi_(i.item)}onPageRemove_(i){if(!this.pageApiMap_.get(i.item))throw v.shouldNeverHappen();this.pageApiMap_.delete(i.item)}}const As=C("tab");class cc{constructor(i,o){this.element=i.createElement("div"),this.element.classList.add(As(),yo()),o.viewProps.bindClassModifiers(this.element),A(o.empty,D(this.element,As(void 0,"nop")));const u=i.createElement("div");u.classList.add(As("i")),this.element.appendChild(u),this.itemsElement=u;const m=o.contentsElement;m.classList.add(As("c")),this.element.appendChild(m),this.contentsElement=m}}class Ao extends An{constructor(i,o){const u=new Hi(i,{blade:o.blade,viewProps:o.viewProps}),m=z(!0);super({blade:o.blade,rackController:u,view:new cc(i,{contentsElement:u.view.element,empty:m,viewProps:o.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onPageSelectedChange_=this.onPageSelectedChange_.bind(this),this.pageSet_=new Tn(()=>null),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.empty_=m,this.applyPages_()}get pageSet(){return this.pageSet_}add(i,o){this.pageSet_.add(i,o??this.pageSet_.items.length)}remove(i){this.pageSet_.remove(this.pageSet_.items[i])}applyPages_(){this.keepSelection_(),this.empty_.rawValue=this.pageSet_.items.length===0}onPageAdd_(i){const o=i.item;fo(this.view.itemsElement,o.itemController.view.element,i.index),this.rackController.rack.add(o.contentController,i.index),o.props.value("selected").emitter.on("change",this.onPageSelectedChange_),this.applyPages_()}onPageRemove_(i){const o=i.item;mo(o.itemController.view.element),this.rackController.rack.remove(o.contentController),o.props.value("selected").emitter.off("change",this.onPageSelectedChange_),this.applyPages_()}keepSelection_(){if(this.pageSet_.items.length===0)return;const i=this.pageSet_.items.findIndex(o=>o.props.get("selected"));i<0?this.pageSet_.items.forEach((o,u)=>{o.props.set("selected",u===0)}):this.pageSet_.items.forEach((o,u)=>{o.props.set("selected",u===i)})}onPageSelectedChange_(i){if(i.rawValue){const o=this.pageSet_.items.findIndex(u=>u.props.value("selected")===i.sender);this.pageSet_.items.forEach((u,m)=>{u.props.set("selected",m===o)})}else this.keepSelection_()}}const Mo={id:"tab",type:"blade",accept(a){const i=W,o=Z(a,{pages:i.required.array(i.required.object({title:i.required.string})),view:i.required.constant("tab")});return!o||o.pages.length===0?null:{params:o}},controller(a){const i=new Ao(a.document,{blade:a.blade,viewProps:a.viewProps});return a.params.pages.forEach(o=>{const u=new So(a.document,{itemProps:U.fromObject({selected:!1,title:o.title}),props:U.fromObject({selected:!1})});i.add(u)}),i},api(a){return a.controller instanceof Ao?new Oo(a.controller,a.pool):null}};function uc(a,i){const o=a.accept(i.params);if(!o)return null;const u=W.optional.boolean(i.params.disabled).value,m=W.optional.boolean(i.params.hidden).value;return a.controller({blade:Ni(),document:i.document,params:Object.assign(Object.assign({},o.params),{disabled:u,hidden:m}),viewProps:vt.create({disabled:u,hidden:m})})}class dc{constructor(){this.disabled=!1,this.emitter=new x}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class pc{constructor(i,o){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=i,this.emitter=new x,this.interval_=o,this.setTimer_()}get disabled(){return this.disabled_}set disabled(i){this.disabled_=i,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const i=this.doc_.defaultView;i&&i.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const i=this.doc_.defaultView;i&&(this.timerId_=i.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class Nt{constructor(i){this.constraints=i}constrain(i){return this.constraints.reduce((o,u)=>u.constrain(o),i)}}function it(a,i){if(a instanceof i)return a;if(a instanceof Nt){const o=a.constraints.reduce((u,m)=>u||(m instanceof i?m:null),null);if(o)return o}return null}class ji{constructor(i){this.options=i}constrain(i){const o=this.options;return o.length===0||o.filter(m=>m.value===i).length>0?i:o[0].value}}class Ue{constructor(i){this.maxValue=i.max,this.minValue=i.min}constrain(i){let o=i;return f(this.minValue)||(o=Math.max(o,this.minValue)),f(this.maxValue)||(o=Math.min(o,this.maxValue)),o}}class Vt{constructor(i){this.step=i}constrain(i){return(i<0?-Math.round(-i/this.step):Math.round(i/this.step))*this.step}}const Dn=C("lst");class fc{constructor(i,o){this.onValueChange_=this.onValueChange_.bind(this),this.props_=o.props,this.element=i.createElement("div"),this.element.classList.add(Dn()),o.viewProps.bindClassModifiers(this.element);const u=i.createElement("select");u.classList.add(Dn("s")),M(this.props_,"options",E=>{_o(u),E.forEach((S,L)=>{const F=i.createElement("option");F.dataset.index=String(L),F.textContent=S.text,F.value=String(S.value),u.appendChild(F)})}),o.viewProps.bindDisabled(u),this.element.appendChild(u),this.selectElement=u;const m=i.createElement("div");m.classList.add(Dn("m")),m.appendChild(Ss(i,"dropdown")),this.element.appendChild(m),o.value.emitter.on("change",this.onValueChange_),this.value_=o.value,this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class Ki{constructor(i,o){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=o.props,this.value=o.value,this.viewProps=o.viewProps,this.view=new fc(i,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(i){const u=i.currentTarget.selectedOptions.item(0);if(!u)return;const m=Number(u.dataset.index);this.value.rawValue=this.props.get("options")[m].value}}const Ro=C("pop");class mc{constructor(i,o){this.element=i.createElement("div"),this.element.classList.add(Ro()),o.viewProps.bindClassModifiers(this.element),A(o.shows,D(this.element,Ro(void 0,"v")))}}class Do{constructor(i,o){this.shows=z(!1),this.viewProps=o.viewProps,this.view=new mc(i,{shows:this.shows,viewProps:this.viewProps})}}const ko=C("txt");class _c{constructor(i,o){this.onChange_=this.onChange_.bind(this),this.element=i.createElement("div"),this.element.classList.add(ko()),o.viewProps.bindClassModifiers(this.element),this.props_=o.props,this.props_.emitter.on("change",this.onChange_);const u=i.createElement("input");u.classList.add(ko("i")),u.type="text",o.viewProps.bindDisabled(u),this.element.appendChild(u),this.inputElement=u,o.value.emitter.on("change",this.onChange_),this.value_=o.value,this.refresh()}refresh(){const i=this.props_.get("formatter");this.inputElement.value=i(this.value_.rawValue)}onChange_(){this.refresh()}}class Ms{constructor(i,o){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=o.parser,this.props=o.props,this.value=o.value,this.viewProps=o.viewProps,this.view=new _c(i,{props:o.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(i){const u=i.currentTarget.value,m=this.parser_(u);f(m)||(this.value.rawValue=m),this.view.refresh()}}function vc(a){return String(a)}function Lo(a){return a==="false"?!1:!!a}function Uo(a){return vc(a)}class gc{constructor(i){this.text=i}evaluate(){return Number(this.text)}toString(){return this.text}}const bc={"**":(a,i)=>Math.pow(a,i),"*":(a,i)=>a*i,"/":(a,i)=>a/i,"%":(a,i)=>a%i,"+":(a,i)=>a+i,"-":(a,i)=>a-i,"<<":(a,i)=>a<<i,">>":(a,i)=>a>>i,">>>":(a,i)=>a>>>i,"&":(a,i)=>a&i,"^":(a,i)=>a^i,"|":(a,i)=>a|i};class xc{constructor(i,o,u){this.left=o,this.operator=i,this.right=u}evaluate(){const i=bc[this.operator];if(!i)throw new Error(`unexpected binary operator: '${this.operator}`);return i(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const yc={"+":a=>a,"-":a=>-a,"~":a=>~a};class wc{constructor(i,o){this.operator=i,this.expression=o}evaluate(){const i=yc[this.operator];if(!i)throw new Error(`unexpected unary operator: '${this.operator}`);return i(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function kn(a){return(i,o)=>{for(let u=0;u<a.length;u++){const m=a[u](i,o);if(m!=="")return m}return""}}function Yi(a,i){var o;const u=a.substr(i).match(/^\s+/);return(o=u&&u[0])!==null&&o!==void 0?o:""}function Cc(a,i){const o=a.substr(i,1);return o.match(/^[1-9]$/)?o:""}function $i(a,i){var o;const u=a.substr(i).match(/^[0-9]+/);return(o=u&&u[0])!==null&&o!==void 0?o:""}function Ec(a,i){const o=$i(a,i);if(o!=="")return o;const u=a.substr(i,1);if(i+=1,u!=="-"&&u!=="+")return"";const m=$i(a,i);return m===""?"":u+m}function Ln(a,i){const o=a.substr(i,1);if(i+=1,o.toLowerCase()!=="e")return"";const u=Ec(a,i);return u===""?"":o+u}function Io(a,i){const o=a.substr(i,1);if(o==="0")return o;const u=Cc(a,i);return i+=u.length,u===""?"":u+$i(a,i)}function Tc(a,i){const o=Io(a,i);if(i+=o.length,o==="")return"";const u=a.substr(i,1);if(i+=u.length,u!==".")return"";const m=$i(a,i);return i+=m.length,o+u+m+Ln(a,i)}function Sc(a,i){const o=a.substr(i,1);if(i+=o.length,o!==".")return"";const u=$i(a,i);return i+=u.length,u===""?"":o+u+Ln(a,i)}function Pc(a,i){const o=Io(a,i);return i+=o.length,o===""?"":o+Ln(a,i)}const Oc=kn([Tc,Sc,Pc]);function Ac(a,i){var o;const u=a.substr(i).match(/^[01]+/);return(o=u&&u[0])!==null&&o!==void 0?o:""}function Mc(a,i){const o=a.substr(i,2);if(i+=o.length,o.toLowerCase()!=="0b")return"";const u=Ac(a,i);return u===""?"":o+u}function Rc(a,i){var o;const u=a.substr(i).match(/^[0-7]+/);return(o=u&&u[0])!==null&&o!==void 0?o:""}function Dc(a,i){const o=a.substr(i,2);if(i+=o.length,o.toLowerCase()!=="0o")return"";const u=Rc(a,i);return u===""?"":o+u}function kc(a,i){var o;const u=a.substr(i).match(/^[0-9a-f]+/i);return(o=u&&u[0])!==null&&o!==void 0?o:""}function Lc(a,i){const o=a.substr(i,2);if(i+=o.length,o.toLowerCase()!=="0x")return"";const u=kc(a,i);return u===""?"":o+u}const Uc=kn([Mc,Dc,Lc]),Ic=kn([Uc,Oc]);function Bc(a,i){const o=Ic(a,i);return i+=o.length,o===""?null:{evaluable:new gc(o),cursor:i}}function Fc(a,i){const o=a.substr(i,1);if(i+=o.length,o!=="(")return null;const u=Fo(a,i);if(!u)return null;i=u.cursor,i+=Yi(a,i).length;const m=a.substr(i,1);return i+=m.length,m!==")"?null:{evaluable:u.evaluable,cursor:i}}function Nc(a,i){return Bc(a,i)||Fc(a,i)}function Bo(a,i){const o=Nc(a,i);if(o)return o;const u=a.substr(i,1);if(i+=u.length,u!=="+"&&u!=="-"&&u!=="~")return null;const m=Bo(a,i);return m?(i=m.cursor,{cursor:i,evaluable:new wc(u,m.evaluable)}):null}function Vc(a,i,o){o+=Yi(i,o).length;const u=a.filter(m=>i.startsWith(m,o))[0];return u?(o+=u.length,o+=Yi(i,o).length,{cursor:o,operator:u}):null}function zc(a,i){return(o,u)=>{const m=a(o,u);if(!m)return null;u=m.cursor;let E=m.evaluable;for(;;){const S=Vc(i,o,u);if(!S)break;u=S.cursor;const L=a(o,u);if(!L)return null;u=L.cursor,E=new xc(S.operator,E,L.evaluable)}return E?{cursor:u,evaluable:E}:null}}const Hc=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((a,i)=>zc(a,i),Bo);function Fo(a,i){return i+=Yi(a,i).length,Hc(a,i)}function Gc(a){const i=Fo(a,0);return!i||i.cursor+Yi(a,i.cursor).length!==a.length?null:i.evaluable}function ht(a){var i;const o=Gc(a);return(i=o?.evaluate())!==null&&i!==void 0?i:null}function No(a){if(typeof a=="number")return a;if(typeof a=="string"){const i=ht(a);if(!f(i))return i}return 0}function jc(a){return String(a)}function Pe(a){return i=>i.toFixed(Math.max(Math.min(a,20),0))}const Kc=Pe(0);function Rs(a){return Kc(a)+"%"}function Vo(a){return String(a)}function Un(a){return a}function zo(a,i){for(;a.length<i;)a.push(void 0)}function Yc(a){const i=[];return zo(i,a),z(i)}function $c(a){const i=a.indexOf(void 0);return i<0?a:a.slice(0,i)}function qc(a,i){const o=[...$c(a),i];return o.length>a.length?o.splice(0,o.length-a.length):zo(o,a.length),o}function qi({primary:a,secondary:i,forward:o,backward:u}){let m=!1;function E(S){m||(m=!0,S(),m=!1)}a.emitter.on("change",S=>{E(()=>{i.setRawValue(o(a,i),S.options)})}),i.emitter.on("change",S=>{E(()=>{a.setRawValue(u(a,i),S.options)}),E(()=>{i.setRawValue(o(a,i),S.options)})}),E(()=>{i.setRawValue(o(a,i),{forceEmit:!1,last:!0})})}function Oe(a,i){const o=a*(i.altKey?.1:1)*(i.shiftKey?10:1);return i.upKey?+o:i.downKey?-o:0}function Wi(a){return{altKey:a.altKey,downKey:a.key==="ArrowDown",shiftKey:a.shiftKey,upKey:a.key==="ArrowUp"}}function ct(a){return{altKey:a.altKey,downKey:a.key==="ArrowLeft",shiftKey:a.shiftKey,upKey:a.key==="ArrowRight"}}function Wc(a){return a==="ArrowUp"||a==="ArrowDown"}function Ho(a){return Wc(a)||a==="ArrowLeft"||a==="ArrowRight"}function In(a,i){const o=i.ownerDocument.defaultView,u=i.getBoundingClientRect();return{x:a.pageX-((o&&o.scrollX||0)+u.left),y:a.pageY-((o&&o.scrollY||0)+u.top)}}class zt{constructor(i){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=i,this.emitter=new x,i.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),i.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),i.addEventListener("touchend",this.onTouchEnd_),i.addEventListener("mousedown",this.onMouseDown_)}computePosition_(i){const o=this.elem_.getBoundingClientRect();return{bounds:{width:o.width,height:o.height},point:i?{x:i.x,y:i.y}:null}}onMouseDown_(i){var o;i.preventDefault(),(o=i.currentTarget)===null||o===void 0||o.focus();const u=this.elem_.ownerDocument;u.addEventListener("mousemove",this.onDocumentMouseMove_),u.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:i.altKey,data:this.computePosition_(In(i,this.elem_)),sender:this,shiftKey:i.shiftKey})}onDocumentMouseMove_(i){this.emitter.emit("move",{altKey:i.altKey,data:this.computePosition_(In(i,this.elem_)),sender:this,shiftKey:i.shiftKey})}onDocumentMouseUp_(i){const o=this.elem_.ownerDocument;o.removeEventListener("mousemove",this.onDocumentMouseMove_),o.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:i.altKey,data:this.computePosition_(In(i,this.elem_)),sender:this,shiftKey:i.shiftKey})}onTouchStart_(i){i.preventDefault();const o=i.targetTouches.item(0),u=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:i.altKey,data:this.computePosition_(o?{x:o.clientX-u.left,y:o.clientY-u.top}:void 0),sender:this,shiftKey:i.shiftKey}),this.lastTouch_=o}onTouchMove_(i){const o=i.targetTouches.item(0),u=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:i.altKey,data:this.computePosition_(o?{x:o.clientX-u.left,y:o.clientY-u.top}:void 0),sender:this,shiftKey:i.shiftKey}),this.lastTouch_=o}onTouchEnd_(i){var o;const u=(o=i.targetTouches.item(0))!==null&&o!==void 0?o:this.lastTouch_,m=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:i.altKey,data:this.computePosition_(u?{x:u.clientX-m.left,y:u.clientY-m.top}:void 0),sender:this,shiftKey:i.shiftKey})}}function le(a,i,o,u,m){const E=(a-i)/(o-i);return u+E*(m-u)}function Go(a){return String(a.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function ae(a,i,o){return Math.min(Math.max(a,i),o)}function Bn(a,i){return(a%i+i)%i}const He=C("txt");class Zc{constructor(i,o){this.onChange_=this.onChange_.bind(this),this.props_=o.props,this.props_.emitter.on("change",this.onChange_),this.element=i.createElement("div"),this.element.classList.add(He(),He(void 0,"num")),o.arrayPosition&&this.element.classList.add(He(void 0,o.arrayPosition)),o.viewProps.bindClassModifiers(this.element);const u=i.createElement("input");u.classList.add(He("i")),u.type="text",o.viewProps.bindDisabled(u),this.element.appendChild(u),this.inputElement=u,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=o.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(He()),this.inputElement.classList.add(He("i"));const m=i.createElement("div");m.classList.add(He("k")),this.element.appendChild(m),this.knobElement=m;const E=i.createElementNS(et,"svg");E.classList.add(He("g")),this.knobElement.appendChild(E);const S=i.createElementNS(et,"path");S.classList.add(He("gb")),E.appendChild(S),this.guideBodyElem_=S;const L=i.createElementNS(et,"path");L.classList.add(He("gh")),E.appendChild(L),this.guideHeadElem_=L;const F=i.createElement("div");F.classList.add(C("tt")()),this.knobElement.appendChild(F),this.tooltipElem_=F,o.value.emitter.on("change",this.onChange_),this.value=o.value,this.refresh()}onDraggingChange_(i){if(i.rawValue===null){this.element.classList.remove(He(void 0,"drg"));return}this.element.classList.add(He(void 0,"drg"));const o=i.rawValue/this.props_.get("draggingScale"),u=o+(o>0?-1:o<0?1:0),m=ae(-u,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${u+m},0 L${u},4 L${u+m},8`,`M ${o},-1 L${o},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${o},4`);const E=this.props_.get("formatter");this.tooltipElem_.textContent=E(this.value.rawValue),this.tooltipElem_.style.left=`${o}px`}refresh(){const i=this.props_.get("formatter");this.inputElement.value=i(this.value.rawValue)}onChange_(){this.refresh()}}class Zi{constructor(i,o){this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=o.baseStep,this.parser_=o.parser,this.props=o.props,this.value=o.value,this.viewProps=o.viewProps,this.dragging_=z(null),this.view=new Zc(i,{arrayPosition:o.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const u=new zt(this.view.knobElement);u.emitter.on("down",this.onPointerDown_),u.emitter.on("move",this.onPointerMove_),u.emitter.on("up",this.onPointerUp_)}onInputChange_(i){const u=i.currentTarget.value,m=this.parser_(u);f(m)||(this.value.rawValue=m),this.view.refresh()}onInputKeyDown_(i){const o=Oe(this.baseStep_,Wi(i));o!==0&&this.value.setRawValue(this.value.rawValue+o,{forceEmit:!1,last:!1})}onInputKeyUp_(i){Oe(this.baseStep_,Wi(i))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(i){if(!i.point)return null;const o=i.point.x-i.bounds.width/2;return this.originRawValue_+o*this.props.get("draggingScale")}onPointerMove_(i){const o=this.computeDraggingValue_(i.data);o!==null&&(this.value.setRawValue(o,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(i){const o=this.computeDraggingValue_(i.data);o!==null&&(this.value.setRawValue(o,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const Fn=C("sld");class Xc{constructor(i,o){this.onChange_=this.onChange_.bind(this),this.props_=o.props,this.props_.emitter.on("change",this.onChange_),this.element=i.createElement("div"),this.element.classList.add(Fn()),o.viewProps.bindClassModifiers(this.element);const u=i.createElement("div");u.classList.add(Fn("t")),o.viewProps.bindTabIndex(u),this.element.appendChild(u),this.trackElement=u;const m=i.createElement("div");m.classList.add(Fn("k")),this.trackElement.appendChild(m),this.knobElement=m,o.value.emitter.on("change",this.onChange_),this.value=o.value,this.update_()}update_(){const i=ae(le(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${i}%`}onChange_(){this.update_()}}class Qc{constructor(i,o){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=o.baseStep,this.value=o.value,this.viewProps=o.viewProps,this.props=o.props,this.view=new Xc(i,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new zt(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(i,o){i.point&&this.value.setRawValue(le(ae(i.point.x,0,i.bounds.width),0,i.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),o)}onPointerDownOrMove_(i){this.handlePointerEvent_(i.data,{forceEmit:!1,last:!1})}onPointerUp_(i){this.handlePointerEvent_(i.data,{forceEmit:!0,last:!0})}onKeyDown_(i){const o=Oe(this.baseStep_,ct(i));o!==0&&this.value.setRawValue(this.value.rawValue+o,{forceEmit:!1,last:!1})}onKeyUp_(i){Oe(this.baseStep_,ct(i))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Nn=C("sldtxt");class Jc{constructor(i,o){this.element=i.createElement("div"),this.element.classList.add(Nn());const u=i.createElement("div");u.classList.add(Nn("s")),this.sliderView_=o.sliderView,u.appendChild(this.sliderView_.element),this.element.appendChild(u);const m=i.createElement("div");m.classList.add(Nn("t")),this.textView_=o.textView,m.appendChild(this.textView_.element),this.element.appendChild(m)}}class Vn{constructor(i,o){this.value=o.value,this.viewProps=o.viewProps,this.sliderC_=new Qc(i,{baseStep:o.baseStep,props:o.sliderProps,value:o.value,viewProps:this.viewProps}),this.textC_=new Zi(i,{baseStep:o.baseStep,parser:o.parser,props:o.textProps,value:o.value,viewProps:o.viewProps}),this.view=new Jc(i,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function Xi(a,i){a.write(i)}function Ds(a){const i=W;if(Array.isArray(a))return i.required.array(i.required.object({text:i.required.string,value:i.required.raw}))(a).value;if(typeof a=="object")return i.required.raw(a).value}function jo(a){if(a==="inline"||a==="popup")return a}function gt(a){const i=W;return i.required.object({max:i.optional.number,min:i.optional.number,step:i.optional.number})(a).value}function Ko(a){if(Array.isArray(a))return a;const i=[];return Object.keys(a).forEach(o=>{i.push({text:o,value:a[o]})}),i}function zn(a){return f(a)?null:new ji(Ko(a))}function Hn(a){const i=a?it(a,ji):null;return i?i.options:null}function eu(a){const i=a?it(a,Vt):null;return i?i.step:null}function ks(a,i){const o=a&&it(a,Vt);return o?Go(o.step):Math.max(Go(i),2)}function hi(a){const i=eu(a);return i??1}function ci(a,i){var o;const u=a&&it(a,Vt),m=Math.abs((o=u?.step)!==null&&o!==void 0?o:i);return m===0?.1:Math.pow(10,Math.floor(Math.log10(m))-1)}const Ls=C("ckb");class tu{constructor(i,o){this.onValueChange_=this.onValueChange_.bind(this),this.element=i.createElement("div"),this.element.classList.add(Ls()),o.viewProps.bindClassModifiers(this.element);const u=i.createElement("label");u.classList.add(Ls("l")),this.element.appendChild(u);const m=i.createElement("input");m.classList.add(Ls("i")),m.type="checkbox",u.appendChild(m),this.inputElement=m,o.viewProps.bindDisabled(this.inputElement);const E=i.createElement("div");E.classList.add(Ls("w")),u.appendChild(E);const S=Ss(i,"check");E.appendChild(S),o.value.emitter.on("change",this.onValueChange_),this.value=o.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class iu{constructor(i,o){this.onInputChange_=this.onInputChange_.bind(this),this.value=o.value,this.viewProps=o.viewProps,this.view=new tu(i,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(i){const o=i.currentTarget;this.value.rawValue=o.checked}}function su(a){const i=[],o=zn(a.options);return o&&i.push(o),new Nt(i)}const nu={id:"input-bool",type:"input",accept:(a,i)=>{if(typeof a!="boolean")return null;const u=Z(i,{options:W.optional.custom(Ds)});return u?{initialValue:a,params:u}:null},binding:{reader:a=>Lo,constraint:a=>su(a.params),writer:a=>Xi},controller:a=>{var i;const o=a.document,u=a.value,m=a.constraint;return m&&it(m,ji)?new Ki(o,{props:U.fromObject({options:(i=Hn(m))!==null&&i!==void 0?i:[]}),value:u,viewProps:a.viewProps}):new iu(o,{value:u,viewProps:a.viewProps})}},Ht=C("col");class ru{constructor(i,o){this.element=i.createElement("div"),this.element.classList.add(Ht()),o.foldable.bindExpandedClass(this.element,Ht(void 0,"expanded")),M(o.foldable,"completed",D(this.element,Ht(void 0,"cpl")));const u=i.createElement("div");u.classList.add(Ht("h")),this.element.appendChild(u);const m=i.createElement("div");m.classList.add(Ht("s")),u.appendChild(m),this.swatchElement=m;const E=i.createElement("div");if(E.classList.add(Ht("t")),u.appendChild(E),this.textElement=E,o.pickerLayout==="inline"){const S=i.createElement("div");S.classList.add(Ht("p")),this.element.appendChild(S),this.pickerElement=S}else this.pickerElement=null}}function ou(a,i,o){const u=ae(a/255,0,1),m=ae(i/255,0,1),E=ae(o/255,0,1),S=Math.max(u,m,E),L=Math.min(u,m,E),F=S-L;let V=0,X=0;const te=(L+S)/2;return F!==0&&(X=F/(1-Math.abs(S+L-1)),u===S?V=(m-E)/F:m===S?V=2+(E-u)/F:V=4+(u-m)/F,V=V/6+(V<0?1:0)),[V*360,X*100,te*100]}function au(a,i,o){const u=(a%360+360)%360,m=ae(i/100,0,1),E=ae(o/100,0,1),S=(1-Math.abs(2*E-1))*m,L=S*(1-Math.abs(u/60%2-1)),F=E-S/2;let V,X,te;return u>=0&&u<60?[V,X,te]=[S,L,0]:u>=60&&u<120?[V,X,te]=[L,S,0]:u>=120&&u<180?[V,X,te]=[0,S,L]:u>=180&&u<240?[V,X,te]=[0,L,S]:u>=240&&u<300?[V,X,te]=[L,0,S]:[V,X,te]=[S,0,L],[(V+F)*255,(X+F)*255,(te+F)*255]}function lu(a,i,o){const u=ae(a/255,0,1),m=ae(i/255,0,1),E=ae(o/255,0,1),S=Math.max(u,m,E),L=Math.min(u,m,E),F=S-L;let V;F===0?V=0:S===u?V=60*(((m-E)/F%6+6)%6):S===m?V=60*((E-u)/F+2):V=60*((u-m)/F+4);const X=S===0?0:F/S,te=S;return[V,X*100,te*100]}function Yo(a,i,o){const u=Bn(a,360),m=ae(i/100,0,1),E=ae(o/100,0,1),S=E*m,L=S*(1-Math.abs(u/60%2-1)),F=E-S;let V,X,te;return u>=0&&u<60?[V,X,te]=[S,L,0]:u>=60&&u<120?[V,X,te]=[L,S,0]:u>=120&&u<180?[V,X,te]=[0,S,L]:u>=180&&u<240?[V,X,te]=[0,L,S]:u>=240&&u<300?[V,X,te]=[L,0,S]:[V,X,te]=[S,0,L],[(V+F)*255,(X+F)*255,(te+F)*255]}function hu(a,i,o){const u=o+i*(100-Math.abs(2*o-100))/200;return[a,u!==0?i*(100-Math.abs(2*o-100))/u:0,o+i*(100-Math.abs(2*o-100))/200]}function cu(a,i,o){const u=100-Math.abs(o*(200-i)/100-100);return[a,u!==0?i*o/u:0,o*(200-i)/200]}function ui(a){return[a[0],a[1],a[2]]}function $o(a,i){return[a[0],a[1],a[2],i]}const uu={hsl:{hsl:(a,i,o)=>[a,i,o],hsv:hu,rgb:au},hsv:{hsl:cu,hsv:(a,i,o)=>[a,i,o],rgb:Yo},rgb:{hsl:ou,hsv:lu,rgb:(a,i,o)=>[a,i,o]}};function du(a,i,o){return uu[i][o](...a)}const pu={hsl:a=>{var i;return[Bn(a[0],360),ae(a[1],0,100),ae(a[2],0,100),ae((i=a[3])!==null&&i!==void 0?i:1,0,1)]},hsv:a=>{var i;return[Bn(a[0],360),ae(a[1],0,100),ae(a[2],0,100),ae((i=a[3])!==null&&i!==void 0?i:1,0,1)]},rgb:a=>{var i;return[ae(a[0],0,255),ae(a[1],0,255),ae(a[2],0,255),ae((i=a[3])!==null&&i!==void 0?i:1,0,1)]}};function Us(a,i){return typeof a!="object"||f(a)?!1:i in a&&typeof a[i]=="number"}class Y{constructor(i,o){this.mode_=o,this.comps_=pu[o](i)}static black(){return new Y([0,0,0],"rgb")}static fromObject(i){const o="a"in i?[i.r,i.g,i.b,i.a]:[i.r,i.g,i.b];return new Y(o,"rgb")}static toRgbaObject(i){return i.toRgbaObject()}static isRgbColorObject(i){return Us(i,"r")&&Us(i,"g")&&Us(i,"b")}static isRgbaColorObject(i){return this.isRgbColorObject(i)&&Us(i,"a")}static isColorObject(i){return this.isRgbColorObject(i)}static equals(i,o){if(i.mode_!==o.mode_)return!1;const u=i.comps_,m=o.comps_;for(let E=0;E<u.length;E++)if(u[E]!==m[E])return!1;return!0}get mode(){return this.mode_}getComponents(i){return $o(du(ui(this.comps_),this.mode_,i||this.mode_),this.comps_[3])}toRgbaObject(){const i=this.getComponents("rgb");return{r:i[0],g:i[1],b:i[2],a:i[3]}}}const bt=C("colp");class fu{constructor(i,o){this.alphaViews_=null,this.element=i.createElement("div"),this.element.classList.add(bt());const u=i.createElement("div");u.classList.add(bt("hsv"));const m=i.createElement("div");m.classList.add(bt("sv")),this.svPaletteView_=o.svPaletteView,m.appendChild(this.svPaletteView_.element),u.appendChild(m);const E=i.createElement("div");E.classList.add(bt("h")),this.hPaletteView_=o.hPaletteView,E.appendChild(this.hPaletteView_.element),u.appendChild(E),this.element.appendChild(u);const S=i.createElement("div");if(S.classList.add(bt("rgb")),this.textView_=o.textView,S.appendChild(this.textView_.element),this.element.appendChild(S),o.alphaViews){this.alphaViews_={palette:o.alphaViews.palette,text:o.alphaViews.text};const L=i.createElement("div");L.classList.add(bt("a"));const F=i.createElement("div");F.classList.add(bt("ap")),F.appendChild(this.alphaViews_.palette.element),L.appendChild(F);const V=i.createElement("div");V.classList.add(bt("at")),V.appendChild(this.alphaViews_.text.element),L.appendChild(V),this.element.appendChild(L)}}get allFocusableElements(){const i=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(o=>o.inputElement)];return this.alphaViews_&&i.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),i}}function Gn(a){const i=W;return Z(a,{alpha:i.optional.boolean,expanded:i.optional.boolean,picker:i.optional.custom(jo)})}function Gt(a){return a?.1:1}function Ge(a,i){const o=a.match(/^(.+)%$/);return Math.min(o?parseFloat(o[1])*.01*i:parseFloat(a),i)}const mu={deg:a=>a,grad:a=>a*360/400,rad:a=>a*360/(2*Math.PI),turn:a=>a*360};function qo(a){const i=a.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!i)return parseFloat(a);const o=parseFloat(i[1]),u=i[2];return mu[u](o)}const jn={"func.rgb":a=>{const i=a.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!i)return null;const o=[Ge(i[1],255),Ge(i[2],255),Ge(i[3],255)];return isNaN(o[0])||isNaN(o[1])||isNaN(o[2])?null:new Y(o,"rgb")},"func.rgba":a=>{const i=a.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!i)return null;const o=[Ge(i[1],255),Ge(i[2],255),Ge(i[3],255),Ge(i[4],1)];return isNaN(o[0])||isNaN(o[1])||isNaN(o[2])||isNaN(o[3])?null:new Y(o,"rgb")},"func.hsl":a=>{const i=a.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!i)return null;const o=[qo(i[1]),Ge(i[2],100),Ge(i[3],100)];return isNaN(o[0])||isNaN(o[1])||isNaN(o[2])?null:new Y(o,"hsl")},"func.hsla":a=>{const i=a.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!i)return null;const o=[qo(i[1]),Ge(i[2],100),Ge(i[3],100),Ge(i[4],1)];return isNaN(o[0])||isNaN(o[1])||isNaN(o[2])||isNaN(o[3])?null:new Y(o,"hsl")},"hex.rgb":a=>{const i=a.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(i)return new Y([parseInt(i[1]+i[1],16),parseInt(i[2]+i[2],16),parseInt(i[3]+i[3],16)],"rgb");const o=a.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return o?new Y([parseInt(o[1],16),parseInt(o[2],16),parseInt(o[3],16)],"rgb"):null},"hex.rgba":a=>{const i=a.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(i)return new Y([parseInt(i[1]+i[1],16),parseInt(i[2]+i[2],16),parseInt(i[3]+i[3],16),le(parseInt(i[4]+i[4],16),0,255,0,1)],"rgb");const o=a.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return o?new Y([parseInt(o[1],16),parseInt(o[2],16),parseInt(o[3],16),le(parseInt(o[4],16),0,255,0,1)],"rgb"):null}};function Is(a){return Object.keys(jn).reduce((o,u)=>{if(o)return o;const m=jn[u];return m(a)?u:null},null)}const Bs=a=>{const i=Is(a);return i?jn[i](a):null};function _u(a){return a==="func.hsla"||a==="func.rgba"||a==="hex.rgba"}function vu(a){if(typeof a=="string"){const i=Bs(a);if(i)return i}return Y.black()}function Wo(a){const i=ae(Math.floor(a),0,255).toString(16);return i.length===1?`0${i}`:i}function Kn(a,i="#"){const o=ui(a.getComponents("rgb")).map(Wo).join("");return`${i}${o}`}function Fs(a,i="#"){const o=a.getComponents("rgb"),u=[o[0],o[1],o[2],o[3]*255].map(Wo).join("");return`${i}${u}`}function Zo(a){const i=Pe(0);return`rgb(${ui(a.getComponents("rgb")).map(u=>i(u)).join(", ")})`}function Ns(a){const i=Pe(2),o=Pe(0);return`rgba(${a.getComponents("rgb").map((m,E)=>(E===3?i:o)(m)).join(", ")})`}function gu(a){const i=[Pe(0),Rs,Rs];return`hsl(${ui(a.getComponents("hsl")).map((u,m)=>i[m](u)).join(", ")})`}function bu(a){const i=[Pe(0),Rs,Rs,Pe(2)];return`hsla(${a.getComponents("hsl").map((u,m)=>i[m](u)).join(", ")})`}const xu={"func.hsl":gu,"func.hsla":bu,"func.rgb":Zo,"func.rgba":Ns,"hex.rgb":Kn,"hex.rgba":Fs};function Xo(a){return xu[a]}const Qi=C("apl");class yu{constructor(i,o){this.onValueChange_=this.onValueChange_.bind(this),this.value=o.value,this.value.emitter.on("change",this.onValueChange_),this.element=i.createElement("div"),this.element.classList.add(Qi()),o.viewProps.bindTabIndex(this.element);const u=i.createElement("div");u.classList.add(Qi("b")),this.element.appendChild(u);const m=i.createElement("div");m.classList.add(Qi("c")),u.appendChild(m),this.colorElem_=m;const E=i.createElement("div");E.classList.add(Qi("m")),this.element.appendChild(E),this.markerElem_=E;const S=i.createElement("div");S.classList.add(Qi("p")),this.markerElem_.appendChild(S),this.previewElem_=S,this.update_()}update_(){const i=this.value.rawValue,o=i.getComponents("rgb"),u=new Y([o[0],o[1],o[2],0],"rgb"),m=new Y([o[0],o[1],o[2],255],"rgb"),E=["to right",Ns(u),Ns(m)];this.colorElem_.style.background=`linear-gradient(${E.join(",")})`,this.previewElem_.style.backgroundColor=Ns(i);const S=le(o[3],0,1,0,100);this.markerElem_.style.left=`${S}%`}onValueChange_(){this.update_()}}class wu{constructor(i,o){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=o.value,this.viewProps=o.viewProps,this.view=new yu(i,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new zt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(i,o){if(!i.point)return;const u=i.point.x/i.bounds.width,m=this.value.rawValue,[E,S,L]=m.getComponents("hsv");this.value.setRawValue(new Y([E,S,L,u],"hsv"),o)}onPointerDown_(i){this.handlePointerEvent_(i.data,{forceEmit:!1,last:!1})}onPointerMove_(i){this.handlePointerEvent_(i.data,{forceEmit:!1,last:!1})}onPointerUp_(i){this.handlePointerEvent_(i.data,{forceEmit:!0,last:!0})}onKeyDown_(i){const o=Oe(Gt(!0),ct(i));if(o===0)return;const u=this.value.rawValue,[m,E,S,L]=u.getComponents("hsv");this.value.setRawValue(new Y([m,E,S,L+o],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(i){Oe(Gt(!0),ct(i))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const di=C("coltxt");function Cu(a){const i=a.createElement("select"),o=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}];return i.appendChild(o.reduce((u,m)=>{const E=a.createElement("option");return E.textContent=m.text,E.value=m.value,u.appendChild(E),u},a.createDocumentFragment())),i}class Eu{constructor(i,o){this.element=i.createElement("div"),this.element.classList.add(di());const u=i.createElement("div");u.classList.add(di("m")),this.modeElem_=Cu(i),this.modeElem_.classList.add(di("ms")),u.appendChild(this.modeSelectElement);const m=i.createElement("div");m.classList.add(di("mm")),m.appendChild(Ss(i,"dropdown")),u.appendChild(m),this.element.appendChild(u);const E=i.createElement("div");E.classList.add(di("w")),this.element.appendChild(E),this.textsElem_=E,this.textViews_=o.textViews,this.applyTextViews_(),A(o.colorMode,S=>{this.modeElem_.value=S})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(i){this.textViews_=i,this.applyTextViews_()}applyTextViews_(){_o(this.textsElem_);const i=this.element.ownerDocument;this.textViews_.forEach(o=>{const u=i.createElement("div");u.classList.add(di("c")),u.appendChild(o.element),this.textsElem_.appendChild(u)})}}const Tu=Pe(0),Su={rgb:()=>new Ue({min:0,max:255}),hsl:a=>a===0?new Ue({min:0,max:360}):new Ue({min:0,max:100}),hsv:a=>a===0?new Ue({min:0,max:360}):new Ue({min:0,max:100})};function Yn(a,i,o){return new Zi(a,{arrayPosition:o===0?"fst":o===2?"lst":"mid",baseStep:Gt(!1),parser:i.parser,props:U.fromObject({draggingScale:1,formatter:Tu}),value:z(0,{constraint:Su[i.colorMode](o)}),viewProps:i.viewProps})}class Pu{constructor(i,o){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.parser_=o.parser,this.value=o.value,this.viewProps=o.viewProps,this.colorMode=z(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(i),this.view=new Eu(i,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(i){const o={colorMode:this.colorMode.rawValue,parser:this.parser_,viewProps:this.viewProps},u=[Yn(i,o,0),Yn(i,o,1),Yn(i,o,2)];return u.forEach((m,E)=>{qi({primary:this.value,secondary:m.value,forward:S=>S.rawValue.getComponents(this.colorMode.rawValue)[E],backward:(S,L)=>{const F=this.colorMode.rawValue,V=S.rawValue.getComponents(F);return V[E]=L.rawValue,new Y($o(ui(V),V[3]),F)}})}),u}onModeSelectChange_(i){const o=i.currentTarget;this.colorMode.rawValue=o.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const $n=C("hpl");class Ou{constructor(i,o){this.onValueChange_=this.onValueChange_.bind(this),this.value=o.value,this.value.emitter.on("change",this.onValueChange_),this.element=i.createElement("div"),this.element.classList.add($n()),o.viewProps.bindTabIndex(this.element);const u=i.createElement("div");u.classList.add($n("c")),this.element.appendChild(u);const m=i.createElement("div");m.classList.add($n("m")),this.element.appendChild(m),this.markerElem_=m,this.update_()}update_(){const i=this.value.rawValue,[o]=i.getComponents("hsv");this.markerElem_.style.backgroundColor=Zo(new Y([o,100,100],"hsv"));const u=le(o,0,360,0,100);this.markerElem_.style.left=`${u}%`}onValueChange_(){this.update_()}}class Au{constructor(i,o){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=o.value,this.viewProps=o.viewProps,this.view=new Ou(i,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new zt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(i,o){if(!i.point)return;const u=le(ae(i.point.x,0,i.bounds.width),0,i.bounds.width,0,359),m=this.value.rawValue,[,E,S,L]=m.getComponents("hsv");this.value.setRawValue(new Y([u,E,S,L],"hsv"),o)}onPointerDown_(i){this.handlePointerEvent_(i.data,{forceEmit:!1,last:!1})}onPointerMove_(i){this.handlePointerEvent_(i.data,{forceEmit:!1,last:!1})}onPointerUp_(i){this.handlePointerEvent_(i.data,{forceEmit:!0,last:!0})}onKeyDown_(i){const o=Oe(Gt(!1),ct(i));if(o===0)return;const u=this.value.rawValue,[m,E,S,L]=u.getComponents("hsv");this.value.setRawValue(new Y([m+o,E,S,L],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(i){Oe(Gt(!1),ct(i))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const qn=C("svp"),Qo=64;class Mu{constructor(i,o){this.onValueChange_=this.onValueChange_.bind(this),this.value=o.value,this.value.emitter.on("change",this.onValueChange_),this.element=i.createElement("div"),this.element.classList.add(qn()),o.viewProps.bindTabIndex(this.element);const u=i.createElement("canvas");u.height=Qo,u.width=Qo,u.classList.add(qn("c")),this.element.appendChild(u),this.canvasElement=u;const m=i.createElement("div");m.classList.add(qn("m")),this.element.appendChild(m),this.markerElem_=m,this.update_()}update_(){const i=Vh(this.canvasElement);if(!i)return;const u=this.value.rawValue.getComponents("hsv"),m=this.canvasElement.width,E=this.canvasElement.height,S=i.getImageData(0,0,m,E),L=S.data;for(let X=0;X<E;X++)for(let te=0;te<m;te++){const jt=le(te,0,m,0,100),es=le(X,0,E,100,0),ts=Yo(u[0],jt,es),_i=(X*m+te)*4;L[_i]=ts[0],L[_i+1]=ts[1],L[_i+2]=ts[2],L[_i+3]=255}i.putImageData(S,0,0);const F=le(u[1],0,100,0,100);this.markerElem_.style.left=`${F}%`;const V=le(u[2],0,100,100,0);this.markerElem_.style.top=`${V}%`}onValueChange_(){this.update_()}}class Ru{constructor(i,o){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=o.value,this.viewProps=o.viewProps,this.view=new Mu(i,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new zt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(i,o){if(!i.point)return;const u=le(i.point.x,0,i.bounds.width,0,100),m=le(i.point.y,0,i.bounds.height,100,0),[E,,,S]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new Y([E,u,m,S],"hsv"),o)}onPointerDown_(i){this.handlePointerEvent_(i.data,{forceEmit:!1,last:!1})}onPointerMove_(i){this.handlePointerEvent_(i.data,{forceEmit:!1,last:!1})}onPointerUp_(i){this.handlePointerEvent_(i.data,{forceEmit:!0,last:!0})}onKeyDown_(i){Ho(i.key)&&i.preventDefault();const[o,u,m,E]=this.value.rawValue.getComponents("hsv"),S=Gt(!1),L=Oe(S,ct(i)),F=Oe(S,Wi(i));L===0&&F===0||this.value.setRawValue(new Y([o,u+L,m+F,E],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(i){const o=Gt(!1),u=Oe(o,ct(i)),m=Oe(o,Wi(i));u===0&&m===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Du{constructor(i,o){this.value=o.value,this.viewProps=o.viewProps,this.hPaletteC_=new Au(i,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new Ru(i,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=o.supportsAlpha?{palette:new wu(i,{value:this.value,viewProps:this.viewProps}),text:new Zi(i,{parser:ht,baseStep:.1,props:U.fromObject({draggingScale:.01,formatter:Pe(2)}),value:z(0,{constraint:new Ue({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&qi({primary:this.value,secondary:this.alphaIcs_.text.value,forward:u=>u.rawValue.getComponents()[3],backward:(u,m)=>{const E=u.rawValue.getComponents();return E[3]=m.rawValue,new Y(E,u.rawValue.mode)}}),this.textC_=new Pu(i,{parser:ht,value:this.value,viewProps:this.viewProps}),this.view=new fu(i,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:o.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view})}get textController(){return this.textC_}}const Wn=C("colsw");class ku{constructor(i,o){this.onValueChange_=this.onValueChange_.bind(this),o.value.emitter.on("change",this.onValueChange_),this.value=o.value,this.element=i.createElement("div"),this.element.classList.add(Wn()),o.viewProps.bindClassModifiers(this.element);const u=i.createElement("div");u.classList.add(Wn("sw")),this.element.appendChild(u),this.swatchElem_=u;const m=i.createElement("button");m.classList.add(Wn("b")),o.viewProps.bindDisabled(m),this.element.appendChild(m),this.buttonElement=m,this.update_()}update_(){const i=this.value.rawValue;this.swatchElem_.style.backgroundColor=Fs(i)}onValueChange_(){this.update_()}}class Lu{constructor(i,o){this.value=o.value,this.viewProps=o.viewProps,this.view=new ku(i,{value:this.value,viewProps:this.viewProps})}}class Zn{constructor(i,o){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=o.value,this.viewProps=o.viewProps,this.foldable_=Vi.create(o.expanded),this.swatchC_=new Lu(i,{value:this.value,viewProps:this.viewProps});const u=this.swatchC_.view.buttonElement;u.addEventListener("blur",this.onButtonBlur_),u.addEventListener("click",this.onButtonClick_),this.textC_=new Ms(i,{parser:o.parser,props:U.fromObject({formatter:o.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new ru(i,{foldable:this.foldable_,pickerLayout:o.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=o.pickerLayout==="popup"?new Do(i,{viewProps:this.viewProps}):null;const m=new Du(i,{supportsAlpha:o.supportsAlpha,value:this.value,viewProps:this.viewProps});m.view.allFocusableElements.forEach(E=>{E.addEventListener("blur",this.onPopupChildBlur_),E.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=m,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(m.view.element),qi({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:E=>E.rawValue,backward:(E,S)=>S.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Cn(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(i){if(!this.popC_)return;const o=this.view.element,u=i.relatedTarget;(!u||!o.contains(u))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(i){if(!this.popC_)return;const o=this.popC_.view.element,u=vo(i);u&&o.contains(u)||u&&u===this.swatchC_.view.buttonElement&&!wn(o.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(i){this.popC_?i.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&i.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function Uu(a){return Y.isColorObject(a)?Y.fromObject(a):Y.black()}function Iu(a){return ui(a.getComponents("rgb")).reduce((i,o)=>i<<8|Math.floor(o)&255,0)}function Bu(a){return a.getComponents("rgb").reduce((i,o,u)=>{const m=Math.floor(u===3?o*255:o)&255;return i<<8|m},0)>>>0}function Fu(a){return new Y([a>>16&255,a>>8&255,a&255],"rgb")}function Nu(a){return new Y([a>>24&255,a>>16&255,a>>8&255,le(a&255,0,255,0,1)],"rgb")}function Vu(a){return typeof a!="number"?Y.black():Fu(a)}function zu(a){return typeof a!="number"?Y.black():Nu(a)}function Hu(a){const i=Xo(a);return(o,u)=>{Xi(o,i(u))}}function Gu(a){const i=a?Bu:Iu;return(o,u)=>{Xi(o,i(u))}}function ju(a,i){const o=i.toRgbaObject();a.writeProperty("r",o.r),a.writeProperty("g",o.g),a.writeProperty("b",o.b),a.writeProperty("a",o.a)}function Ku(a,i){const o=i.toRgbaObject();a.writeProperty("r",o.r),a.writeProperty("g",o.g),a.writeProperty("b",o.b)}function Yu(a){return a?ju:Ku}function Xn(a){return"alpha"in a&&a.alpha===!0}function $u(a){return a?i=>Fs(i,"0x"):i=>Kn(i,"0x")}const qu={id:"input-color-number",type:"input",accept:(a,i)=>{if(typeof a!="number"||!("view"in i)||i.view!=="color")return null;const o=Gn(i);return o?{initialValue:a,params:o}:null},binding:{reader:a=>Xn(a.params)?zu:Vu,equals:Y.equals,writer:a=>Gu(Xn(a.params))},controller:a=>{const i=Xn(a.params),o="expanded"in a.params?a.params.expanded:void 0,u="picker"in a.params?a.params.picker:void 0;return new Zn(a.document,{expanded:o??!1,formatter:$u(i),parser:Bs,pickerLayout:u??"popup",supportsAlpha:i,value:a.value,viewProps:a.viewProps})}};function Wu(a){return Y.isRgbaColorObject(a)}const Zu={id:"input-color-object",type:"input",accept:(a,i)=>{if(!Y.isColorObject(a))return null;const o=Gn(i);return o?{initialValue:a,params:o}:null},binding:{reader:a=>Uu,equals:Y.equals,writer:a=>Yu(Wu(a.initialValue))},controller:a=>{const i=Y.isRgbaColorObject(a.initialValue),o="expanded"in a.params?a.params.expanded:void 0,u="picker"in a.params?a.params.picker:void 0,m=i?Fs:Kn;return new Zn(a.document,{expanded:o??!1,formatter:m,parser:Bs,pickerLayout:u??"popup",supportsAlpha:i,value:a.value,viewProps:a.viewProps})}},Xu={id:"input-color-string",type:"input",accept:(a,i)=>{if(typeof a!="string"||"view"in i&&i.view==="text"||!Is(a))return null;const u=Gn(i);return u?{initialValue:a,params:u}:null},binding:{reader:a=>vu,equals:Y.equals,writer:a=>{const i=Is(a.initialValue);if(!i)throw v.shouldNeverHappen();return Hu(i)}},controller:a=>{const i=Is(a.initialValue);if(!i)throw v.shouldNeverHappen();const o=Xo(i),u="expanded"in a.params?a.params.expanded:void 0,m="picker"in a.params?a.params.picker:void 0;return new Zn(a.document,{expanded:u??!1,formatter:o,parser:Bs,pickerLayout:m??"popup",supportsAlpha:_u(i),value:a.value,viewProps:a.viewProps})}};class xt{constructor(i){this.components=i.components,this.asm_=i.assembly}constrain(i){const o=this.asm_.toComponents(i).map((u,m)=>{var E,S;return(S=(E=this.components[m])===null||E===void 0?void 0:E.constrain(u))!==null&&S!==void 0?S:u});return this.asm_.fromComponents(o)}}const Jo=C("pndtxt");class Qu{constructor(i,o){this.textViews=o.textViews,this.element=i.createElement("div"),this.element.classList.add(Jo()),this.textViews.forEach(u=>{const m=i.createElement("div");m.classList.add(Jo("a")),m.appendChild(u.element),this.element.appendChild(m)})}}function Ju(a,i,o){return new Zi(a,{arrayPosition:o===0?"fst":o===i.axes.length-1?"lst":"mid",baseStep:i.axes[o].baseStep,parser:i.parser,props:i.axes[o].textProps,value:z(0,{constraint:i.axes[o].constraint}),viewProps:i.viewProps})}class Qn{constructor(i,o){this.value=o.value,this.viewProps=o.viewProps,this.acs_=o.axes.map((u,m)=>Ju(i,o,m)),this.acs_.forEach((u,m)=>{qi({primary:this.value,secondary:u.value,forward:E=>o.assembly.toComponents(E.rawValue)[m],backward:(E,S)=>{const L=o.assembly.toComponents(E.rawValue);return L[m]=S.rawValue,o.assembly.fromComponents(L)}})}),this.view=new Qu(i,{textViews:this.acs_.map(u=>u.view)})}}function ed(a){return"step"in a&&!f(a.step)?new Vt(a.step):null}function td(a){return"max"in a&&!f(a.max)||"min"in a&&!f(a.min)?new Ue({max:a.max,min:a.min}):null}function id(a){const i=[],o=ed(a);o&&i.push(o);const u=td(a);u&&i.push(u);const m=zn(a.options);return m&&i.push(m),new Nt(i)}function sd(a){const i=a?it(a,Ue):null;return i?[i.minValue,i.maxValue]:[void 0,void 0]}function nd(a){const[i,o]=sd(a);return[i??0,o??100]}const rd={id:"input-number",type:"input",accept:(a,i)=>{if(typeof a!="number")return null;const o=W,u=Z(i,{format:o.optional.function,max:o.optional.number,min:o.optional.number,options:o.optional.custom(Ds),step:o.optional.number});return u?{initialValue:a,params:u}:null},binding:{reader:a=>No,constraint:a=>id(a.params),writer:a=>Xi},controller:a=>{var i,o;const u=a.value,m=a.constraint;if(m&&it(m,ji))return new Ki(a.document,{props:U.fromObject({options:(i=Hn(m))!==null&&i!==void 0?i:[]}),value:u,viewProps:a.viewProps});const E=(o="format"in a.params?a.params.format:void 0)!==null&&o!==void 0?o:Pe(ks(m,u.rawValue));if(m&&it(m,Ue)){const[S,L]=nd(m);return new Vn(a.document,{baseStep:hi(m),parser:ht,sliderProps:U.fromObject({maxValue:L,minValue:S}),textProps:U.fromObject({draggingScale:ci(m,u.rawValue),formatter:E}),value:u,viewProps:a.viewProps})}return new Zi(a.document,{baseStep:hi(m),parser:ht,props:U.fromObject({draggingScale:ci(m,u.rawValue),formatter:E}),value:u,viewProps:a.viewProps})}};class yt{constructor(i=0,o=0){this.x=i,this.y=o}getComponents(){return[this.x,this.y]}static isObject(i){if(f(i))return!1;const o=i.x,u=i.y;return!(typeof o!="number"||typeof u!="number")}static equals(i,o){return i.x===o.x&&i.y===o.y}toObject(){return{x:this.x,y:this.y}}}const ea={toComponents:a=>a.getComponents(),fromComponents:a=>new yt(...a)},pi=C("p2d");class od{constructor(i,o){this.element=i.createElement("div"),this.element.classList.add(pi()),o.viewProps.bindClassModifiers(this.element),A(o.expanded,D(this.element,pi(void 0,"expanded")));const u=i.createElement("div");u.classList.add(pi("h")),this.element.appendChild(u);const m=i.createElement("button");m.classList.add(pi("b")),m.appendChild(Ss(i,"p2dpad")),o.viewProps.bindDisabled(m),u.appendChild(m),this.buttonElement=m;const E=i.createElement("div");if(E.classList.add(pi("t")),u.appendChild(E),this.textElement=E,o.pickerLayout==="inline"){const S=i.createElement("div");S.classList.add(pi("p")),this.element.appendChild(S),this.pickerElement=S}else this.pickerElement=null}}const wt=C("p2dp");class ad{constructor(i,o){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=o.invertsY,this.maxValue_=o.maxValue,this.element=i.createElement("div"),this.element.classList.add(wt()),o.layout==="popup"&&this.element.classList.add(wt(void 0,"p"));const u=i.createElement("div");u.classList.add(wt("p")),o.viewProps.bindTabIndex(u),this.element.appendChild(u),this.padElement=u;const m=i.createElementNS(et,"svg");m.classList.add(wt("g")),this.padElement.appendChild(m),this.svgElem_=m;const E=i.createElementNS(et,"line");E.classList.add(wt("ax")),E.setAttributeNS(null,"x1","0"),E.setAttributeNS(null,"y1","50%"),E.setAttributeNS(null,"x2","100%"),E.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(E);const S=i.createElementNS(et,"line");S.classList.add(wt("ax")),S.setAttributeNS(null,"x1","50%"),S.setAttributeNS(null,"y1","0"),S.setAttributeNS(null,"x2","50%"),S.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(S);const L=i.createElementNS(et,"line");L.classList.add(wt("l")),L.setAttributeNS(null,"x1","50%"),L.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(L),this.lineElem_=L;const F=i.createElement("div");F.classList.add(wt("m")),this.padElement.appendChild(F),this.markerElem_=F,o.value.emitter.on("change",this.onValueChange_),this.value=o.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[i,o]=this.value.rawValue.getComponents(),u=this.maxValue_,m=le(i,-u,+u,0,100),E=le(o,-u,+u,0,100),S=this.invertsY_?100-E:E;this.lineElem_.setAttributeNS(null,"x2",`${m}%`),this.lineElem_.setAttributeNS(null,"y2",`${S}%`),this.markerElem_.style.left=`${m}%`,this.markerElem_.style.top=`${S}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function ta(a,i,o){return[Oe(i[0],ct(a)),Oe(i[1],Wi(a))*(o?1:-1)]}class ld{constructor(i,o){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=o.value,this.viewProps=o.viewProps,this.baseSteps_=o.baseSteps,this.maxValue_=o.maxValue,this.invertsY_=o.invertsY,this.view=new ad(i,{invertsY:this.invertsY_,layout:o.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new zt(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(i,o){if(!i.point)return;const u=this.maxValue_,m=le(i.point.x,0,i.bounds.width,-u,+u),E=le(this.invertsY_?i.bounds.height-i.point.y:i.point.y,0,i.bounds.height,-u,+u);this.value.setRawValue(new yt(m,E),o)}onPointerDown_(i){this.handlePointerEvent_(i.data,{forceEmit:!1,last:!1})}onPointerMove_(i){this.handlePointerEvent_(i.data,{forceEmit:!1,last:!1})}onPointerUp_(i){this.handlePointerEvent_(i.data,{forceEmit:!0,last:!0})}onPadKeyDown_(i){Ho(i.key)&&i.preventDefault();const[o,u]=ta(i,this.baseSteps_,this.invertsY_);o===0&&u===0||this.value.setRawValue(new yt(this.value.rawValue.x+o,this.value.rawValue.y+u),{forceEmit:!1,last:!1})}onPadKeyUp_(i){const[o,u]=ta(i,this.baseSteps_,this.invertsY_);o===0&&u===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class hd{constructor(i,o){var u,m;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=o.value,this.viewProps=o.viewProps,this.foldable_=Vi.create(o.expanded),this.popC_=o.pickerLayout==="popup"?new Do(i,{viewProps:this.viewProps}):null;const E=new ld(i,{baseSteps:[o.axes[0].baseStep,o.axes[1].baseStep],invertsY:o.invertsY,layout:o.pickerLayout,maxValue:o.maxValue,value:this.value,viewProps:this.viewProps});E.view.allFocusableElements.forEach(S=>{S.addEventListener("blur",this.onPopupChildBlur_),S.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=E,this.textC_=new Qn(i,{assembly:ea,axes:o.axes,parser:o.parser,value:this.value,viewProps:this.viewProps}),this.view=new od(i,{expanded:this.foldable_.value("expanded"),pickerLayout:o.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(u=this.view.buttonElement)===null||u===void 0||u.addEventListener("blur",this.onPadButtonBlur_),(m=this.view.buttonElement)===null||m===void 0||m.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),qi({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:S=>S.rawValue,backward:(S,L)=>L.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Cn(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(i){if(!this.popC_)return;const o=this.view.element,u=i.relatedTarget;(!u||!o.contains(u))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(i){if(!this.popC_)return;const o=this.popC_.view.element,u=vo(i);u&&o.contains(u)||u&&u===this.view.buttonElement&&!wn(o.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(i){this.popC_?i.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&i.key==="Escape"&&this.view.buttonElement.focus()}}function cd(a){return yt.isObject(a)?new yt(a.x,a.y):new yt}function ud(a,i){a.writeProperty("x",i.x),a.writeProperty("y",i.y)}function ia(a){if(!a)return;const i=[];return f(a.step)||i.push(new Vt(a.step)),(!f(a.max)||!f(a.min))&&i.push(new Ue({max:a.max,min:a.min})),new Nt(i)}function dd(a){return new xt({assembly:ea,components:[ia("x"in a?a.x:void 0),ia("y"in a?a.y:void 0)]})}function sa(a,i){const o=a&&it(a,Ue);if(o)return Math.max(Math.abs(o.minValue||0),Math.abs(o.maxValue||0));const u=hi(a);return Math.max(Math.abs(u)*10,Math.abs(i)*10)}function pd(a,i){const o=i instanceof xt?i.components[0]:void 0,u=i instanceof xt?i.components[1]:void 0,m=sa(o,a.x),E=sa(u,a.y);return Math.max(m,E)}function na(a,i){return{baseStep:hi(i),constraint:i,textProps:U.fromObject({draggingScale:ci(i,a),formatter:Pe(ks(i,a))})}}function fd(a){if(!("y"in a))return!1;const i=a.y;return i&&"inverted"in i?!!i.inverted:!1}const md={id:"input-point2d",type:"input",accept:(a,i)=>{if(!yt.isObject(a))return null;const o=W,u=Z(i,{expanded:o.optional.boolean,picker:o.optional.custom(jo),x:o.optional.custom(gt),y:o.optional.object({inverted:o.optional.boolean,max:o.optional.number,min:o.optional.number,step:o.optional.number})});return u?{initialValue:a,params:u}:null},binding:{reader:a=>cd,constraint:a=>dd(a.params),equals:yt.equals,writer:a=>ud},controller:a=>{const i=a.document,o=a.value,u=a.constraint;if(!(u instanceof xt))throw v.shouldNeverHappen();const m="expanded"in a.params?a.params.expanded:void 0,E="picker"in a.params?a.params.picker:void 0;return new hd(i,{axes:[na(o.rawValue.x,u.components[0]),na(o.rawValue.y,u.components[1])],expanded:m??!1,invertsY:fd(a.params),maxValue:pd(o.rawValue,u),parser:ht,pickerLayout:E??"popup",value:o,viewProps:a.viewProps})}};class fi{constructor(i=0,o=0,u=0){this.x=i,this.y=o,this.z=u}getComponents(){return[this.x,this.y,this.z]}static isObject(i){if(f(i))return!1;const o=i.x,u=i.y,m=i.z;return!(typeof o!="number"||typeof u!="number"||typeof m!="number")}static equals(i,o){return i.x===o.x&&i.y===o.y&&i.z===o.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const ra={toComponents:a=>a.getComponents(),fromComponents:a=>new fi(...a)};function _d(a){return fi.isObject(a)?new fi(a.x,a.y,a.z):new fi}function vd(a,i){a.writeProperty("x",i.x),a.writeProperty("y",i.y),a.writeProperty("z",i.z)}function Jn(a){if(!a)return;const i=[];return f(a.step)||i.push(new Vt(a.step)),(!f(a.max)||!f(a.min))&&i.push(new Ue({max:a.max,min:a.min})),new Nt(i)}function gd(a){return new xt({assembly:ra,components:[Jn("x"in a?a.x:void 0),Jn("y"in a?a.y:void 0),Jn("z"in a?a.z:void 0)]})}function er(a,i){return{baseStep:hi(i),constraint:i,textProps:U.fromObject({draggingScale:ci(i,a),formatter:Pe(ks(i,a))})}}const bd={id:"input-point3d",type:"input",accept:(a,i)=>{if(!fi.isObject(a))return null;const o=W,u=Z(i,{x:o.optional.custom(gt),y:o.optional.custom(gt),z:o.optional.custom(gt)});return u?{initialValue:a,params:u}:null},binding:{reader:a=>_d,constraint:a=>gd(a.params),equals:fi.equals,writer:a=>vd},controller:a=>{const i=a.value,o=a.constraint;if(!(o instanceof xt))throw v.shouldNeverHappen();return new Qn(a.document,{assembly:ra,axes:[er(i.rawValue.x,o.components[0]),er(i.rawValue.y,o.components[1]),er(i.rawValue.z,o.components[2])],parser:ht,value:i,viewProps:a.viewProps})}};class mi{constructor(i=0,o=0,u=0,m=0){this.x=i,this.y=o,this.z=u,this.w=m}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(i){if(f(i))return!1;const o=i.x,u=i.y,m=i.z,E=i.w;return!(typeof o!="number"||typeof u!="number"||typeof m!="number"||typeof E!="number")}static equals(i,o){return i.x===o.x&&i.y===o.y&&i.z===o.z&&i.w===o.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const oa={toComponents:a=>a.getComponents(),fromComponents:a=>new mi(...a)};function xd(a){return mi.isObject(a)?new mi(a.x,a.y,a.z,a.w):new mi}function yd(a,i){a.writeProperty("x",i.x),a.writeProperty("y",i.y),a.writeProperty("z",i.z),a.writeProperty("w",i.w)}function Vs(a){if(!a)return;const i=[];return f(a.step)||i.push(new Vt(a.step)),(!f(a.max)||!f(a.min))&&i.push(new Ue({max:a.max,min:a.min})),new Nt(i)}function wd(a){return new xt({assembly:oa,components:[Vs("x"in a?a.x:void 0),Vs("y"in a?a.y:void 0),Vs("z"in a?a.z:void 0),Vs("w"in a?a.w:void 0)]})}function Cd(a,i){return{baseStep:hi(i),constraint:i,textProps:U.fromObject({draggingScale:ci(i,a),formatter:Pe(ks(i,a))})}}const Ed={id:"input-point4d",type:"input",accept:(a,i)=>{if(!mi.isObject(a))return null;const o=W,u=Z(i,{x:o.optional.custom(gt),y:o.optional.custom(gt),z:o.optional.custom(gt),w:o.optional.custom(gt)});return u?{initialValue:a,params:u}:null},binding:{reader:a=>xd,constraint:a=>wd(a.params),equals:mi.equals,writer:a=>yd},controller:a=>{const i=a.value,o=a.constraint;if(!(o instanceof xt))throw v.shouldNeverHappen();return new Qn(a.document,{assembly:oa,axes:i.rawValue.getComponents().map((u,m)=>Cd(u,o.components[m])),parser:ht,value:i,viewProps:a.viewProps})}};function Td(a){const i=[],o=zn(a.options);return o&&i.push(o),new Nt(i)}const Sd={id:"input-string",type:"input",accept:(a,i)=>{if(typeof a!="string")return null;const u=Z(i,{options:W.optional.custom(Ds)});return u?{initialValue:a,params:u}:null},binding:{reader:a=>Vo,constraint:a=>Td(a.params),writer:a=>Xi},controller:a=>{var i;const o=a.document,u=a.value,m=a.constraint;return m&&it(m,ji)?new Ki(o,{props:U.fromObject({options:(i=Hn(m))!==null&&i!==void 0?i:[]}),value:u,viewProps:a.viewProps}):new Ms(o,{parser:E=>E,props:U.fromObject({formatter:Un}),value:u,viewProps:a.viewProps})}},Ji={monitor:{defaultInterval:200,defaultLineCount:3}},aa=C("mll");class Pd{constructor(i,o){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=o.formatter,this.element=i.createElement("div"),this.element.classList.add(aa()),o.viewProps.bindClassModifiers(this.element);const u=i.createElement("textarea");u.classList.add(aa("i")),u.style.height=`calc(var(--bld-us) * ${o.lineCount})`,u.readOnly=!0,o.viewProps.bindDisabled(u),this.element.appendChild(u),this.textareaElem_=u,o.value.emitter.on("change",this.onValueUpdate_),this.value=o.value,this.update_()}update_(){const i=this.textareaElem_,o=i.scrollTop===i.scrollHeight-i.clientHeight,u=[];this.value.rawValue.forEach(m=>{m!==void 0&&u.push(this.formatter_(m))}),i.textContent=u.join(`
`),o&&(i.scrollTop=i.scrollHeight)}onValueUpdate_(){this.update_()}}class tr{constructor(i,o){this.value=o.value,this.viewProps=o.viewProps,this.view=new Pd(i,{formatter:o.formatter,lineCount:o.lineCount,value:this.value,viewProps:this.viewProps})}}const la=C("sgl");class Od{constructor(i,o){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=o.formatter,this.element=i.createElement("div"),this.element.classList.add(la()),o.viewProps.bindClassModifiers(this.element);const u=i.createElement("input");u.classList.add(la("i")),u.readOnly=!0,u.type="text",o.viewProps.bindDisabled(u),this.element.appendChild(u),this.inputElement=u,o.value.emitter.on("change",this.onValueUpdate_),this.value=o.value,this.update_()}update_(){const i=this.value.rawValue,o=i[i.length-1];this.inputElement.value=o!==void 0?this.formatter_(o):""}onValueUpdate_(){this.update_()}}class ir{constructor(i,o){this.value=o.value,this.viewProps=o.viewProps,this.view=new Od(i,{formatter:o.formatter,value:this.value,viewProps:this.viewProps})}}const Ad={id:"monitor-bool",type:"monitor",accept:(a,i)=>{if(typeof a!="boolean")return null;const u=Z(i,{lineCount:W.optional.number});return u?{initialValue:a,params:u}:null},binding:{reader:a=>Lo},controller:a=>{var i;return a.value.rawValue.length===1?new ir(a.document,{formatter:Uo,value:a.value,viewProps:a.viewProps}):new tr(a.document,{formatter:Uo,lineCount:(i=a.params.lineCount)!==null&&i!==void 0?i:Ji.monitor.defaultLineCount,value:a.value,viewProps:a.viewProps})}};class Md{constructor(){this.emitter=new x,this.index_=-1}get index(){return this.index_}set index(i){this.index_!==i&&(this.index_=i,this.emitter.emit("change",{index:i,sender:this}))}}const Ct=C("grl");class Rd{constructor(i,o){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=i.createElement("div"),this.element.classList.add(Ct()),o.viewProps.bindClassModifiers(this.element),this.formatter_=o.formatter,this.minValue_=o.minValue,this.maxValue_=o.maxValue,this.cursor_=o.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const u=i.createElementNS(et,"svg");u.classList.add(Ct("g")),u.style.height=`calc(var(--bld-us) * ${o.lineCount})`,this.element.appendChild(u),this.svgElem_=u;const m=i.createElementNS(et,"polyline");this.svgElem_.appendChild(m),this.lineElem_=m;const E=i.createElement("div");E.classList.add(Ct("t"),C("tt")()),this.element.appendChild(E),this.tooltipElem_=E,o.value.emitter.on("change",this.onValueUpdate_),this.value=o.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const i=this.svgElem_.getBoundingClientRect(),o=this.value.rawValue.length-1,u=this.minValue_,m=this.maxValue_,E=[];this.value.rawValue.forEach((X,te)=>{if(X===void 0)return;const jt=le(te,0,o,0,i.width),es=le(X,u,m,i.height,0);E.push([jt,es].join(","))}),this.lineElem_.setAttributeNS(null,"points",E.join(" "));const S=this.tooltipElem_,L=this.value.rawValue[this.cursor_.index];if(L===void 0){S.classList.remove(Ct("t","a"));return}const F=le(this.cursor_.index,0,o,0,i.width),V=le(L,u,m,i.height,0);S.style.left=`${F}px`,S.style.top=`${V}px`,S.textContent=`${this.formatter_(L)}`,S.classList.contains(Ct("t","a"))||(S.classList.add(Ct("t","a"),Ct("t","in")),Ts(S),S.classList.remove(Ct("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class Dd{constructor(i,o){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.value=o.value,this.viewProps=o.viewProps,this.cursor_=new Md,this.view=new Rd(i,{cursor:this.cursor_,formatter:o.formatter,lineCount:o.lineCount,maxValue:o.maxValue,minValue:o.minValue,value:this.value,viewProps:this.viewProps}),!wn(i))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const u=new zt(this.view.element);u.emitter.on("down",this.onGraphPointerDown_),u.emitter.on("move",this.onGraphPointerMove_),u.emitter.on("up",this.onGraphPointerUp_)}}onGraphMouseLeave_(){this.cursor_.index=-1}onGraphMouseMove_(i){const o=this.view.element.getBoundingClientRect();this.cursor_.index=Math.floor(le(i.offsetX,0,o.width,0,this.value.rawValue.length))}onGraphPointerDown_(i){this.onGraphPointerMove_(i)}onGraphPointerMove_(i){if(!i.data.point){this.cursor_.index=-1;return}this.cursor_.index=Math.floor(le(i.data.point.x,0,i.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.index=-1}}function sr(a){return"format"in a&&!f(a.format)?a.format:Pe(2)}function kd(a){var i;return a.value.rawValue.length===1?new ir(a.document,{formatter:sr(a.params),value:a.value,viewProps:a.viewProps}):new tr(a.document,{formatter:sr(a.params),lineCount:(i=a.params.lineCount)!==null&&i!==void 0?i:Ji.monitor.defaultLineCount,value:a.value,viewProps:a.viewProps})}function Ld(a){var i,o,u;return new Dd(a.document,{formatter:sr(a.params),lineCount:(i=a.params.lineCount)!==null&&i!==void 0?i:Ji.monitor.defaultLineCount,maxValue:(o="max"in a.params?a.params.max:null)!==null&&o!==void 0?o:100,minValue:(u="min"in a.params?a.params.min:null)!==null&&u!==void 0?u:0,value:a.value,viewProps:a.viewProps})}function ha(a){return"view"in a&&a.view==="graph"}const Ud={id:"monitor-number",type:"monitor",accept:(a,i)=>{if(typeof a!="number")return null;const o=W,u=Z(i,{format:o.optional.function,lineCount:o.optional.number,max:o.optional.number,min:o.optional.number,view:o.optional.string});return u?{initialValue:a,params:u}:null},binding:{defaultBufferSize:a=>ha(a)?64:1,reader:a=>No},controller:a=>ha(a.params)?Ld(a):kd(a)},Id={id:"monitor-string",type:"monitor",accept:(a,i)=>{if(typeof a!="string")return null;const o=W,u=Z(i,{lineCount:o.optional.number,multiline:o.optional.boolean});return u?{initialValue:a,params:u}:null},binding:{reader:a=>Vo},controller:a=>{var i;const o=a.value;return o.rawValue.length>1||"multiline"in a.params&&a.params.multiline?new tr(a.document,{formatter:Un,lineCount:(i=a.params.lineCount)!==null&&i!==void 0?i:Ji.monitor.defaultLineCount,value:o,viewProps:a.viewProps}):new ir(a.document,{formatter:Un,value:o,viewProps:a.viewProps})}};class Bd{constructor(i){this.onValueChange_=this.onValueChange_.bind(this),this.reader=i.reader,this.writer=i.writer,this.emitter=new x,this.value=i.value,this.value.emitter.on("change",this.onValueChange_),this.target=i.target,this.read()}read(){const i=this.target.read();i!==void 0&&(this.value.rawValue=this.reader(i))}write_(i){this.writer(this.target,i)}onValueChange_(i){this.write_(i.rawValue),this.emitter.emit("change",{options:i.options,rawValue:i.rawValue,sender:this})}}function Fd(a,i){const o=a.accept(i.target.read(),i.params);if(f(o))return null;const u=W,m={target:i.target,initialValue:o.initialValue,params:o.params},E=a.binding.reader(m),S=a.binding.constraint?a.binding.constraint(m):void 0,L=z(E(o.initialValue),{constraint:S,equals:a.binding.equals}),F=new Bd({reader:E,target:i.target,value:L,writer:a.binding.writer(m)}),V=u.optional.boolean(i.params.disabled).value,X=u.optional.boolean(i.params.hidden).value,te=a.controller({constraint:S,document:i.document,initialValue:o.initialValue,params:o.params,value:F.value,viewProps:vt.create({disabled:V,hidden:X})}),jt=u.optional.string(i.params.label).value;return new tt(i.document,{binding:F,blade:Ni(),props:U.fromObject({label:jt||i.target.key}),valueController:te})}class Nd{constructor(i){this.onTick_=this.onTick_.bind(this),this.reader_=i.reader,this.target=i.target,this.emitter=new x,this.value=i.value,this.ticker=i.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const i=this.target.read();if(i===void 0)return;const o=this.value.rawValue,u=this.reader_(i);this.value.rawValue=qc(o,u),this.emitter.emit("update",{rawValue:u,sender:this})}onTick_(i){this.read()}}function Vd(a,i){return i===0?new dc:new pc(a,i??Ji.monitor.defaultInterval)}function zd(a,i){var o,u,m;const E=W,S=a.accept(i.target.read(),i.params);if(f(S))return null;const L={target:i.target,initialValue:S.initialValue,params:S.params},F=a.binding.reader(L),V=(u=(o=E.optional.number(i.params.bufferSize).value)!==null&&o!==void 0?o:a.binding.defaultBufferSize&&a.binding.defaultBufferSize(S.params))!==null&&u!==void 0?u:1,X=E.optional.number(i.params.interval).value,te=new Nd({reader:F,target:i.target,ticker:Vd(i.document,X),value:Yc(V)}),jt=E.optional.boolean(i.params.disabled).value,es=E.optional.boolean(i.params.hidden).value,ts=a.controller({document:i.document,params:S.params,value:te.value,viewProps:vt.create({disabled:jt,hidden:es})}),_i=(m=E.optional.string(i.params.label).value)!==null&&m!==void 0?m:i.target.key;return new _t(i.document,{binding:te,blade:Ni(),props:U.fromObject({label:_i}),valueController:ts})}class Hd{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(i){i.type==="blade"?this.pluginsMap_.blades.unshift(i):i.type==="input"?this.pluginsMap_.inputs.unshift(i):i.type==="monitor"&&this.pluginsMap_.monitors.unshift(i)}createInput(i,o,u){const m=o.read();if(f(m))throw new v({context:{key:o.key},type:"nomatchingcontroller"});const E=this.pluginsMap_.inputs.reduce((S,L)=>S||Fd(L,{document:i,target:o,params:u}),null);if(E)return E;throw new v({context:{key:o.key},type:"nomatchingcontroller"})}createMonitor(i,o,u){const m=this.pluginsMap_.monitors.reduce((E,S)=>E||zd(S,{document:i,params:u,target:o}),null);if(m)return m;throw new v({context:{key:o.key},type:"nomatchingcontroller"})}createBlade(i,o){const u=this.pluginsMap_.blades.reduce((m,E)=>m||uc(E,{document:i,params:o}),null);if(!u)throw new v({type:"nomatchingview",context:{params:o}});return u}createBladeApi(i){if(i instanceof tt)return new Sn(i);if(i instanceof _t)return new Pn(i);if(i instanceof Hi)return new Os(i,this);const o=this.pluginsMap_.blades.reduce((u,m)=>u||m.api({controller:i,pool:this}),null);if(!o)throw v.shouldNeverHappen();return o}}function Gd(){const a=new Hd;return[md,bd,Ed,Sd,rd,Xu,Zu,qu,nu,Ad,Id,Ud,jh,nc,oc,Mo].forEach(i=>{a.register(i)}),a}class ca extends n{constructor(i){super(i),this.emitter_=new x,this.controller_.valueController.value.emitter.on("change",o=>{this.emitter_.emit("change",{event:new h(this,o.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(i){this.controller_.props.set("label",i)}get options(){return this.controller_.valueController.props.get("options")}set options(i){this.controller_.valueController.props.set("options",i)}get value(){return this.controller_.valueController.value.rawValue}set value(i){this.controller_.valueController.value.rawValue=i}on(i,o){const u=o.bind(this);return this.emitter_.on(i,m=>{u(m.event)}),this}}class ua extends n{constructor(i){super(i),this.emitter_=new x,this.controller_.valueController.value.emitter.on("change",o=>{this.emitter_.emit("change",{event:new h(this,o.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(i){this.controller_.props.set("label",i)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(i){this.controller_.valueController.sliderController.props.set("maxValue",i)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(i){this.controller_.valueController.sliderController.props.set("minValue",i)}get value(){return this.controller_.valueController.value.rawValue}set value(i){this.controller_.valueController.value.rawValue=i}on(i,o){const u=o.bind(this);return this.emitter_.on(i,m=>{u(m.event)}),this}}class da extends n{constructor(i){super(i),this.emitter_=new x,this.controller_.valueController.value.emitter.on("change",o=>{this.emitter_.emit("change",{event:new h(this,o.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(i){this.controller_.props.set("label",i)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(i){this.controller_.valueController.props.set("formatter",i)}get value(){return this.controller_.valueController.value.rawValue}set value(i){this.controller_.valueController.value.rawValue=i}on(i,o){const u=o.bind(this);return this.emitter_.on(i,m=>{u(m.event)}),this}}const jd=(function(){return{id:"list",type:"blade",accept(a){const i=W,o=Z(a,{options:i.required.custom(Ds),value:i.required.raw,view:i.required.constant("list"),label:i.optional.string});return o?{params:o}:null},controller(a){const i=new Ki(a.document,{props:U.fromObject({options:Ko(a.params.options)}),value:z(a.params.value),viewProps:a.viewProps});return new li(a.document,{blade:a.blade,props:U.fromObject({label:a.params.label}),valueController:i})},api(a){return!(a.controller instanceof li)||!(a.controller.valueController instanceof Ki)?null:new ca(a.controller)}}})();function Kd(a){return a.reduce((i,o)=>Object.assign(i,{[o.presetKey]:o.read()}),{})}function Yd(a,i){a.forEach(o=>{const u=i[o.presetKey];u!==void 0&&o.write(u)})}class $d extends On{constructor(i,o){super(i,o)}get element(){return this.controller_.view.element}importPreset(i){const o=this.controller_.rackController.rack.find(tt).map(u=>u.binding.target);Yd(o,i),this.refresh()}exportPreset(){const i=this.controller_.rackController.rack.find(tt).map(o=>o.binding.target);return Kd(i)}refresh(){this.controller_.rackController.rack.find(tt).forEach(i=>{i.binding.read()}),this.controller_.rackController.rack.find(_t).forEach(i=>{i.binding.read()})}}class qd extends Rn{constructor(i,o){super(i,{expanded:o.expanded,blade:o.blade,props:o.props,root:!0,viewProps:o.viewProps})}}const Wd={id:"slider",type:"blade",accept(a){const i=W,o=Z(a,{max:i.required.number,min:i.required.number,view:i.required.constant("slider"),format:i.optional.function,label:i.optional.string,value:i.optional.number});return o?{params:o}:null},controller(a){var i,o;const u=(i=a.params.value)!==null&&i!==void 0?i:0,m=new Vn(a.document,{baseStep:1,parser:ht,sliderProps:U.fromObject({maxValue:a.params.max,minValue:a.params.min}),textProps:U.fromObject({draggingScale:ci(void 0,u),formatter:(o=a.params.format)!==null&&o!==void 0?o:jc}),value:z(u),viewProps:a.viewProps});return new li(a.document,{blade:a.blade,props:U.fromObject({label:a.params.label}),valueController:m})},api(a){return!(a.controller instanceof li)||!(a.controller.valueController instanceof Vn)?null:new ua(a.controller)}},Zd=(function(){return{id:"text",type:"blade",accept(a){const i=W,o=Z(a,{parse:i.required.function,value:i.required.raw,view:i.required.constant("text"),format:i.optional.function,label:i.optional.string});return o?{params:o}:null},controller(a){var i;const o=new Ms(a.document,{parser:a.params.parse,props:U.fromObject({formatter:(i=a.params.format)!==null&&i!==void 0?i:(u=>String(u))}),value:z(a.params.value),viewProps:a.viewProps});return new li(a.document,{blade:a.blade,props:U.fromObject({label:a.params.label}),valueController:o})},api(a){return!(a.controller instanceof li)||!(a.controller.valueController instanceof Ms)?null:new da(a.controller)}}})();function Xd(a){const i=a.createElement("div");return i.classList.add(C("dfw")()),a.body&&a.body.appendChild(i),i}function pa(a,i,o){if(a.querySelector(`style[data-tp-style=${i}]`))return;const u=a.createElement("style");u.dataset.tpStyle=i,u.textContent=o,a.head.appendChild(u)}class Qd extends $d{constructor(i){var o;const u=i||{},m=(o=u.document)!==null&&o!==void 0?o:Nh(),E=Gd(),S=new qd(m,{expanded:u.expanded,blade:Ni(),props:U.fromObject({title:u.title}),viewProps:vt.create()});super(S,E),this.pool_=E,this.containerElem_=u.container||Xd(m),this.containerElem_.appendChild(this.element),this.doc_=m,this.usesDefaultWrapper_=!u.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw v.alreadyDisposed();return this.doc_}dispose(){const i=this.containerElem_;if(!i)throw v.alreadyDisposed();if(this.usesDefaultWrapper_){const o=i.parentElement;o&&o.removeChild(i)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(i){("plugin"in i?[i.plugin]:"plugins"in i?i.plugins:[]).forEach(u=>{this.pool_.register(u),this.embedPluginStyle_(u)})}embedPluginStyle_(i){i.css&&pa(this.document,`plugin-${i.id}`,i.css)}setUpDefaultPlugins_(){pa(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor transparent;scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:transparent}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:transparent solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, #28292e);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, #adafb8);--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, #28292e);--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, #bbbcc4);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, #bbbcc4);--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_i,.tp-fldv_c>.tp-tabv>.tp-tabv_i{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a:before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_c{border-left:var(--cnt-bg) solid 4px}.tp-fldv_b:hover+.tp-fldv_c{border-left-color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_c{border-left-color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_c{border-left-color:var(--cnt-bg-a)}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv.tp-v-disabled{opacity:.5}.tp-tabv_i{align-items:flex-end;display:flex;overflow:hidden}.tp-tabv.tp-tabv-nop .tp-tabv_i{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_i::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{border-left:var(--cnt-bg) solid 4px;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p)}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:-2px;position:absolute;width:2px}.tp-tbiv_b{background-color:var(--cnt-bg);display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);width:100%}.tp-tbiv_b:hover{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active{background-color:var(--cnt-bg-a)}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) transparent transparent transparent;border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c,.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_i{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach(i=>{this.embedPluginStyle_(i)}),this.registerPlugin({plugins:[Wd,jd,Mo,Zd]})}}const Jd=new s("3.0.8");t.BladeApi=n,t.ButtonApi=b,t.FolderApi=On,t.InputBindingApi=Sn,t.ListApi=ca,t.MonitorBindingApi=Pn,t.Pane=Qd,t.SeparatorApi=wo,t.SliderApi=ua,t.TabApi=Oo,t.TabPageApi=Po,t.TextApi=da,t.TpChangeEvent=h,t.VERSION=Jd,Object.defineProperty(t,"__esModule",{value:!0})}))})(hs,hs.exports)),hs.exports}var Qf=Xf();function Jf(r,e){const t=new Qf.Pane({title:"controls",expanded:!0});t.addInput(r,"amount",{min:1,max:6}),t.addInput(r,"xscale",{min:30,max:500});const s=t.addFolder({title:"audio",expanded:!0});return s.addMonitor(e,"loudness",{view:"graph",min:0,max:1}),s.addMonitor(e,"perceptualSpread",{view:"graph",min:0,max:1}),s.addMonitor(e,"perceptualSharpness",{view:"graph",min:0,max:1}),s.addMonitor(e,"spectralFlatness",{view:"graph",min:0,max:1}),s.addMonitor(e,"spectralKurtosis",{view:"graph",min:0,max:1}),t}function dr(r,e,t){t[0]=r[0]>e[0]?e[0]:r[0],t[1]=r[1]<e[1]?e[1]:r[1],t[2]=r[2]>e[2]?e[2]:r[2],t[3]=r[3]<e[3]?e[3]:r[3],t[4]=r[4]>e[4]?e[4]:r[4],t[5]=r[5]<e[5]?e[5]:r[5]}function em(r,e,t){let s=!1;const n=r[0]>e[0]?e[0]:r[0],l=r[1]<e[1]?e[1]:r[1],h=r[2]>e[2]?e[2]:r[2],c=r[3]<e[3]?e[3]:r[3],p=r[4]>e[4]?e[4]:r[4],d=r[5]<e[5]?e[5]:r[5];return t[0]>n&&(t[0]=n,s=!0),t[1]<l&&(t[1]=l,s=!0),t[2]>h&&(t[2]=h,s=!0),t[3]<c&&(t[3]=c,s=!0),t[4]>p&&(t[4]=p,s=!0),t[5]<d&&(t[5]=d,s=!0),s}function tm(r,e){return!(e[0]>r[0]||e[1]<r[1]||e[2]>r[2]||e[3]<r[3]||e[4]>r[4]||e[5]<r[5])}function im(r,e){let t=!1;return e[0]>r[0]&&(e[0]=r[0],t=!0),e[1]<r[1]&&(e[1]=r[1],t=!0),e[2]>r[2]&&(e[2]=r[2],t=!0),e[3]<r[3]&&(e[3]=r[3],t=!0),e[4]>r[4]&&(e[4]=r[4],t=!0),e[5]<r[5]&&(e[5]=r[5],t=!0),t}function js(r,e){r[0]-=e,r[1]+=e,r[2]-=e,r[3]+=e,r[4]-=e,r[5]+=e}function gi(r){const e=r[1]-r[0],t=r[3]-r[2],s=r[5]-r[4];return 2*(e*t+t*s+s*e)}function $t(r,e){const t=r[0]>e[0]?e[0]:r[0],s=r[1]<e[1]?e[1]:r[1],n=r[2]>e[2]?e[2]:r[2],l=r[3]<e[3]?e[3]:r[3],h=r[4]>e[4]?e[4]:r[4],c=r[5]<e[5]?e[5]:r[5],p=s-t,d=l-n,f=c-h;return 2*(p*d+d*f+f*p)}function sm(r){const e=r[1]-r[0],t=r[3]-r[2],s=r[5]-r[4];return e>t?e>s?0:2:t>s?1:2}function cs(r,e){const t=r[0]-e[0],s=e[0]-r[1];let n=t>s?t:s;n<0&&(n=0);const l=r[2]-e[1],h=e[1]-r[3];let c=l>h?l:h;c<0&&(c=0);const p=r[4]-e[2],d=e[2]-r[5];let f=p>d?p:d;return f<0&&(f=0),n*n+c*c+f*f}function nm(r,e){let t,s,n,l,h,c;const p=r[0]-e[0],d=e[0]-r[1];p>d?(t=p,s=d):(t=d,s=p),t<0&&(t=0);const f=r[2]-e[1],_=e[1]-r[3];f>_?(n=f,l=_):(n=_,l=f),n<0&&(n=0);const g=r[4]-e[2],v=e[2]-r[5];return g>v?(h=g,c=v):(h=v,c=g),h<0&&(h=0),{min:t*t+n*n+h*h,max:s*s+l*l+c*c}}class rm{constructor(){this.array=[]}clear(){this.array=[]}push(e){const t=this.array,s=e.inheritedCost,n=t.length>6?t.length-6:0;let l;for(l=t.length-1;l>=n&&!(s<=t[l].inheritedCost);l--);l>t.length-7&&t.splice(l+1,0,e)}pop(){return this.array.pop()}}class om{constructor(e=!1){this.root=null,this._sortedList=new rm,this.count=0,this.highPrecision=e,this._typeArray=e?Float64Array:Float32Array}createFromArray(e,t,s,n=0){const l=t.length,h=this._typeArray;h!==(t[0].BYTES_PER_ELEMENT===4?Float32Array:Float64Array)&&console.warn("Different precision.");const c=new h(6);let p,d;this.root=f(0,l,null);function f(y,b,x){if(b===1){const O=t[y];n>0&&js(O,n);const A={box:O,object:e[y],parent:x};return s&&s(A),A}const w=_(y,b);g();let C=v(y,b);(C===y||C===y+b)&&(C=y+(b>>1));const T={box:w,parent:x};return T.left=f(y,C-y,T),T.right=f(C,b-C+y,T),T}function _(y,b){const x=new h(6),w=y+b;x[0]=1/0,x[1]=-1/0,x[2]=1/0,x[3]=-1/0,x[4]=1/0,x[5]=-1/0,c[0]=1/0,c[1]=-1/0,c[2]=1/0,c[3]=-1/0,c[4]=1/0,c[5]=-1/0;for(let C=y;C<w;C++){const T=t[C],O=T[0],A=T[1],M=T[2],R=T[3],D=T[4],k=T[5];x[0]>O&&(x[0]=O),x[1]<A&&(x[1]=A),x[2]>M&&(x[2]=M),x[3]<R&&(x[3]=R),x[4]>D&&(x[4]=D),x[5]<k&&(x[5]=k);const I=(A+O)*.5,H=(R+M)*.5,K=(k+D)*.5;c[0]>I&&(c[0]=I),c[1]<I&&(c[1]=I),c[2]>H&&(c[2]=H),c[3]<H&&(c[3]=H),c[4]>K&&(c[4]=K),c[5]<K&&(c[5]=K)}return x[0]-=n,x[1]+=n,x[2]-=n,x[3]+=n,x[4]-=n,x[5]+=n,x}function g(){p=sm(c)*2,d=(c[p]+c[p+1])*.5}function v(y,b){let x=y,w=y+b-1;for(;x<=w;){const C=t[x];if((C[p+1]+C[p])*.5>=d)for(;;){const T=t[w];if((T[p+1]+T[p])*.5<d){const O=e[x];e[x]=e[w],e[w]=O;const A=t[x];t[x]=t[w],t[w]=A,w--;break}if(w--,w<=x)return x}x++}return x}}insert(e,t,s){s>0&&js(t,s);const n=this.createLeafNode(e,t);return this.root===null?this.root=n:this.insertLeaf(n),this.count++,n}insertRange(e,t,s,n){console.warn("Method not optimized yet. It just calls 'insert' N times.");const l=e.length,h=s>0?s:s?null:0;for(let c=0;c<l;c++){const p=this.insert(e[c],t[c],h??s[c]);n&&n(p)}}move(e,t){if(!e.parent||tm(e.box,e.parent.box)){t>0&&js(e.box,t);return}t>0&&js(e.box,t);const s=this.delete(e);this.insertLeaf(e,s),this.count++}delete(e){const t=e.parent;if(t===null)return this.root=null,null;const s=t.parent,n=t.left===e?t.right:t.left;return n.parent=s,e.parent=null,s===null?(this.root=n,t):(s.left===t?s.left=n:s.right=n,this.refit(s),this.count--,t)}clear(){this.root=null}insertLeaf(e,t){const s=this.findBestSibling(e.box),n=s.parent;t===void 0?t=this.createInternalNode(n,s,e):(t.parent=n,t.left=s,t.right=e),s.parent=t,e.parent=t,n===null?this.root=t:n.left===s?n.left=t:n.right=t,this.refitAndRotate(e,s)}createLeafNode(e,t){return{box:t,object:e,parent:null}}createInternalNode(e,t,s){return{parent:e,left:t,right:s,box:new this._typeArray(6)}}findBestSibling(e){const t=this.root;let s=t,n=$t(e,t.box);const l=gi(e);if(t.object!==void 0)return t;const h=this._sortedList;h.clear();let c={node:t,inheritedCost:n-gi(t.box)};do{const{node:p,inheritedCost:d}=c;if(l+d>=n)break;const f=p.left,_=p.right,g=$t(e,f.box)+d,v=g-gi(f.box),y=$t(e,_.box)+d,b=y-gi(_.box);if(g>y?n>y&&(s=_,n=y):n>g&&(s=f,n=g),b>v){if(l+v>=n||(f.object===void 0&&h.push({node:f,inheritedCost:v}),l+b>=n))continue;_.object===void 0&&h.push({node:_,inheritedCost:b})}else{if(l+b>=n||(_.object===void 0&&h.push({node:_,inheritedCost:b}),l+v>=n))continue;f.object===void 0&&h.push({node:f,inheritedCost:v})}}while(c=h.pop());return s}refit(e){for(dr(e.left.box,e.right.box,e.box);e=e.parent;)if(!em(e.left.box,e.right.box,e.box))return}refitAndRotate(e,t){const s=e.box;e=e.parent;const n=e.box;for(dr(s,t.box,n);e=e.parent;){const l=e.box;if(!im(s,l))return;const h=e.left,c=e.right,p=h.box,d=c.box;let f=null,_=null,g=0;if(c.object===void 0){const v=c.left,y=c.right,b=gi(c.box),x=b-$t(p,v.box),w=b-$t(p,y.box);x>w?x>0&&(f=h,_=y,g=x):w>0&&(f=h,_=v,g=w)}if(h.object===void 0){const v=h.left,y=h.right,b=gi(h.box),x=b-$t(d,v.box),w=b-$t(d,y.box);x>w?x>g&&(f=c,_=y):w>g&&(f=c,_=v)}f!==null&&this.swap(f,_)}}swap(e,t){const s=e.parent,n=t.parent,l=n.box;s.left===e?s.left=t:s.right=t,n.left===t?n.left=e:n.right=e,e.parent=n,t.parent=s,dr(n.left.box,n.right.box,l)}}const lo=0,am=1;class lm{constructor(e,t){this.coordinateSystem=t,this.array=e?new Float64Array(24):new Float32Array(24)}setFromProjectionMatrix(e){if(this.updatePlane(0,e[3]+e[0],e[7]+e[4],e[11]+e[8],e[15]+e[12]),this.updatePlane(1,e[3]-e[0],e[7]-e[4],e[11]-e[8],e[15]-e[12]),this.updatePlane(2,e[3]-e[1],e[7]-e[5],e[11]-e[9],e[15]-e[13]),this.updatePlane(3,e[3]+e[1],e[7]+e[5],e[11]+e[9],e[15]+e[13]),this.updatePlane(4,e[3]-e[2],e[7]-e[6],e[11]-e[10],e[15]-e[14]),this.coordinateSystem===lo)this.updatePlane(5,e[3]+e[2],e[7]+e[6],e[11]+e[10],e[15]+e[14]);else if(this.coordinateSystem===am)this.updatePlane(5,e[2],e[6],e[10],e[14]);else throw new Error("Invalid coordinate system: "+this.coordinateSystem);return this}updatePlane(e,t,s,n,l){const h=this.array,c=e*4,p=Math.sqrt(t*t+s*s+n*n);h[c+0]=t/p,h[c+1]=s/p,h[c+2]=n/p,h[c+3]=l/p}intersectsBoxMask(e,t){const s=this.array;let n,l,h,c,p,d;for(let f=0;f<6;f++){if(!(t&32>>f))continue;const _=f*4,g=s[_+0],v=s[_+1],y=s[_+2],b=s[_+3];if(g>0?(n=e[1],c=e[0]):(n=e[0],c=e[1]),v>0?(l=e[3],p=e[2]):(l=e[2],p=e[3]),y>0?(h=e[5],d=e[4]):(h=e[4],d=e[5]),g*n+v*l+y*h<-b)return-1;g*c+v*p+y*d>-b&&(t^=32>>f)}return t}isIntersected(e,t){const s=this.array;for(let n=0;n<6;n++){if(!(t&32>>n))continue;const l=n*4,h=s[l+0],c=s[l+1],p=s[l+2],d=s[l+3],f=h>0?e[1]:e[0],_=c>0?e[3]:e[2],g=p>0?e[5]:e[4];if(h*f+c*_+p*g<-d)return!1}return!0}isIntersectedMargin(e,t,s){if(t===0)return!0;const n=this.array;for(let l=0;l<6;l++){if(!(t&32>>l))continue;const h=l*4,c=n[h+0],p=n[h+1],d=n[h+2],f=n[h+3],_=c>0?e[1]-s:e[0]+s,g=p>0?e[3]-s:e[2]+s,v=d>0?e[5]-s:e[4]+s;if(c*_+p*g+d*v<-f)return!1}return!0}}function Ba(r,e,t,s,n,l){let h=s[0],c=e[0],p=t[0],d=(r[h]-c)*p,f=(r[h^1]-c)*p,_=d>0?d:0,g=f<1/0?f:1/0;return h=s[1],c=e[1],p=t[1],d=(r[h+2]-c)*p,d>g||(f=(r[h^3]-c)*p,_>f)||(_=d>_?d:_,g=f<g?f:g,h=s[2],c=e[2],p=t[2],d=(r[h+4]-c)*p,d>g)||(f=(r[h^5]-c)*p,_>f)?!1:(_=d>_?d:_,g=f<g?f:g,_<=l&&g>=n)}function Fa(r,e){return r[1]>=e[0]&&e[1]>=r[0]&&r[3]>=e[2]&&e[3]>=r[2]&&r[5]>=e[4]&&e[5]>=r[4]}function hm(r,e,t){return cs(t,r)<=e*e}class cm{constructor(e,t=lo){this._sign=new Uint8Array(3),this.builder=e;const s=e.highPrecision;this.frustum=new lm(s,t),this._dirInv=s?new Float64Array(3):new Float32Array(3)}get root(){return this.builder.root}createFromArray(e,t,s,n){e?.length>0&&this.builder.createFromArray(e,t,s,n)}insert(e,t,s){return this.builder.insert(e,t,s)}insertRange(e,t,s,n){e?.length>0&&this.builder.insertRange(e,t,s,n)}move(e,t){this.builder.move(e,t)}delete(e){return this.builder.delete(e)}clear(){this.builder.clear()}traverse(e){if(this.root===null)return;t(this.root,0);function t(s,n){if(s.object!==void 0){e(s,n);return}e(s,n)||(t(s.left,n+1),t(s.right,n+1))}}intersectsRay(e,t,s,n=0,l=1/0){if(this.root===null)return!1;const h=this._dirInv,c=this._sign;return h[0]=1/e[0],h[1]=1/e[1],h[2]=1/e[2],c[0]=h[0]<0?1:0,c[1]=h[1]<0?1:0,c[2]=h[2]<0?1:0,p(this.root);function p(d){return Ba(d.box,t,h,c,n,l)?d.object!==void 0?s(d.object):p(d.left)||p(d.right):!1}}intersectsBox(e,t){if(this.root===null)return!1;return s(this.root);function s(n){return Fa(e,n.box)?n.object!==void 0?t(n.object):s(n.left)||s(n.right):!1}}intersectsSphere(e,t,s){if(this.root===null)return!1;return n(this.root);function n(l){return hm(e,t,l.box)?l.object!==void 0?s(l.object):n(l.left)||n(l.right):!1}}isNodeIntersected(e,t){const s=e.box;let n;for(;n=e.parent;){const h=n.left===e?n.right:n.left;if(l(h))return!0;e=n}return!1;function l(h){return Fa(s,h.box)?h.object!==void 0?t(h.object):l(h.left)||l(h.right):!1}}rayIntersections(e,t,s,n=0,l=1/0){if(this.root===null)return;const h=this._dirInv,c=this._sign;h[0]=1/e[0],h[1]=1/e[1],h[2]=1/e[2],c[0]=h[0]<0?1:0,c[1]=h[1]<0?1:0,c[2]=h[2]<0?1:0,p(this.root);function p(d){if(Ba(d.box,t,h,c,n,l)){if(d.object!==void 0){s(d.object);return}p(d.left),p(d.right)}}}frustumCulling(e,t){if(this.root===null)return;const s=this.frustum.setFromProjectionMatrix(e);n(this.root,63);function n(h,c){if(h.object!==void 0){s.isIntersected(h.box,c)&&t(h,s,c);return}if(c=s.intersectsBoxMask(h.box,c),!(c<0)){if(c===0){l(h.left),l(h.right);return}n(h.left,c),n(h.right,c)}}function l(h){if(h.object!==void 0){t(h,s,0);return}l(h.left),l(h.right)}}frustumCullingLOD(e,t,s,n){if(this.root===null)return;const l=this.frustum.setFromProjectionMatrix(e);h(this.root,63,null);function h(d,f,_){const g=d.box;if(_===null&&(_=p(g)),d.object!==void 0){l.isIntersected(g,f)&&n(d,_,l,f);return}if(f=l.intersectsBoxMask(g,f),!(f<0)){if(f===0){c(d.left,_),c(d.right,_);return}h(d.left,f,_),h(d.right,f,_)}}function c(d,f){if(f===null&&(f=p(d.box)),d.object!==void 0){n(d,f,l,0);return}c(d.left,f),c(d.right,f)}function p(d){const{min:f,max:_}=nm(d,t);for(let g=s.length-1;g>0;g--)if(_>=s[g])return f>=s[g]?g:null;return 0}}closestPointToPoint(e,t){if(this.root===null)return;let s=1/0;return n(this.root),Math.sqrt(s);function n(l){if(l.object!==void 0){if(t){const p=t(l.object)??cs(l.box,e);p<s&&(s=p)}else s=cs(l.box,e);return}const h=cs(l.left.box,e),c=cs(l.right.box,e);h<c?h<s&&(n(l.left),c<s&&n(l.right)):c<s&&(n(l.right),h<s&&n(l.left))}}}function Na(r,e){return e[0]=r.x,e[1]=r.y,e[2]=r.z,e}function Va(r,e){const t=r.min,s=r.max;return e[0]=t.x,e[1]=s.x,e[2]=t.y,e[3]=s.y,e[4]=t.z,e[5]=s.z,e}class Sh{constructor(e,t,s){if(this.isInstanceEntity=!0,this.position=new Ve,this.scale=new Ve(1,1,1),this.quaternion=new xl,this.id=t,this.owner=e,s){const n=this.quaternion,l=this.rotation=new np;l._onChange(()=>n.setFromEuler(l,!1)),n._onChange(()=>l.setFromQuaternion(n,void 0,!1))}}get visible(){return this.owner.getVisibilityAt(this.id)}set visible(e){this.owner.setVisibilityAt(this.id,e)}get active(){return this.owner.getActiveAt(this.id)}set active(e){this.owner.setActiveAt(this.id,e)}get color(){return this.owner.getColorAt(this.id)}set color(e){this.owner.setColorAt(this.id,e)}get opacity(){return this.owner.getOpacityAt(this.id)}set opacity(e){this.owner.setOpacityAt(this.id,e)}get morph(){return this.owner.getMorphAt(this.id)}set morph(e){this.owner.setMorphAt(this.id,e)}get matrix(){return this.owner.getMatrixAt(this.id)}get matrixWorld(){return this.matrix.premultiply(this.owner.matrixWorld)}setMatrixIdentity(){const e=this.owner,t=e.matricesTexture._data,s=this.id,n=s*16;t[n+0]=1,t[n+1]=0,t[n+2]=0,t[n+3]=0,t[n+4]=0,t[n+5]=1,t[n+6]=0,t[n+7]=0,t[n+8]=0,t[n+9]=0,t[n+10]=1,t[n+11]=0,t[n+12]=0,t[n+13]=0,t[n+14]=0,t[n+15]=1,e.matricesTexture.enqueueUpdate(s)}updateMatrix(){const e=this.owner,t=this.position,s=this.quaternion,n=this.scale,l=e.matricesTexture._data,h=this.id,c=h*16,p=s._x,d=s._y,f=s._z,_=s._w,g=p+p,v=d+d,y=f+f,b=p*g,x=p*v,w=p*y,C=d*v,T=d*y,O=f*y,A=_*g,M=_*v,R=_*y,D=n.x,k=n.y,I=n.z;l[c+0]=(1-(C+O))*D,l[c+1]=(x+R)*D,l[c+2]=(w-M)*D,l[c+3]=0,l[c+4]=(x-R)*k,l[c+5]=(1-(b+O))*k,l[c+6]=(T+A)*k,l[c+7]=0,l[c+8]=(w+M)*I,l[c+9]=(T-A)*I,l[c+10]=(1-(b+C))*I,l[c+11]=0,l[c+12]=t.x,l[c+13]=t.y,l[c+14]=t.z,l[c+15]=1,e.matricesTexture.enqueueUpdate(h),e.bvh&&e.autoUpdateBVH&&e.bvh.move(h)}updateMatrixPosition(){const e=this.owner,t=this.position,s=e.matricesTexture._data,n=this.id,l=n*16;s[l+12]=t.x,s[l+13]=t.y,s[l+14]=t.z,e.matricesTexture.enqueueUpdate(n),e.bvh&&e.autoUpdateBVH&&e.bvh.move(n)}getUniform(e,t){return this.owner.getUniformAt(this.id,e,t)}updateBones(e=!0,t){this.owner.setBonesAt(this.id,e,t)}setUniform(e,t){this.owner.setUniformAt(this.id,e,t)}copyTo(e){e.position.copy(this.position),e.scale.copy(this.scale),e.quaternion.copy(this.quaternion),this.rotation&&e.rotation.copy(this.rotation)}applyMatrix4(e){return this.matrix.premultiply(e).decompose(this.position,this.quaternion,this.scale),this}applyQuaternion(e){return this.quaternion.premultiply(e),this}rotateOnAxis(e,t){return Ks.setFromAxisAngle(e,t),this.quaternion.multiply(Ks),this}rotateOnWorldAxis(e,t){return Ks.setFromAxisAngle(e,t),this.quaternion.premultiply(Ks),this}rotateX(e){return this.rotateOnAxis(Ha,e)}rotateY(e){return this.rotateOnAxis(Ga,e)}rotateZ(e){return this.rotateOnAxis(ja,e)}translateOnAxis(e,t){return za.copy(e).applyQuaternion(this.quaternion),this.position.add(za.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Ha,e)}translateY(e){return this.translateOnAxis(Ga,e)}translateZ(e){return this.translateOnAxis(ja,e)}remove(){return this.owner.removeInstances(this.id),this}}const Ks=new xl,za=new Ve,Ha=new Ve(1,0,0),Ga=new Ve(0,1,0),ja=new Ve(0,0,1);class um{constructor(e,t=0,s=!1,n=!0){this.nodesMap=new Map,this.LODsMap=new Map,this._geoBoundingSphere=null,this._sphereTarget=null,this.target=e,this.accurateCulling=n,this._margin=t;const l=e._geometry;if(l.boundingBox||l.computeBoundingBox(),this.geoBoundingBox=l.boundingBox,s){l.boundingSphere||l.computeBoundingSphere();const h=l.boundingSphere.center;h.x===0&&h.y===0&&h.z===0?(this._geoBoundingSphere=l.boundingSphere,this._sphereTarget={centerX:0,centerY:0,centerZ:0,maxScale:0}):(console.warn('"getBoxFromSphere" is ignored because geometry is not centered.'),s=!1)}this.bvh=new cm(new om,lo),this._origin=new Float32Array(3),this._dir=new Float32Array(3),this._cameraPos=new Float32Array(3),this._getBoxFromSphere=s}create(){const e=this.target._instancesCount,t=this.target._instancesArrayCount,s=new Array(e),n=new Uint32Array(e);let l=0;this.clear();for(let h=0;h<t;h++)this.target.getActiveAt(h)&&(s[l]=this.getBox(h,new Float32Array(6)),n[l]=h,l++);this.bvh.createFromArray(n,s,h=>{this.nodesMap.set(h.object,h)},this._margin)}insert(e){const t=this.bvh.insert(e,this.getBox(e,new Float32Array(6)),this._margin);this.nodesMap.set(e,t)}insertRange(e){const t=e.length,s=new Array(t);for(let n=0;n<t;n++)s[n]=this.getBox(e[n],new Float32Array(6));this.bvh.insertRange(e,s,this._margin,n=>{this.nodesMap.set(n.object,n)})}move(e){const t=this.nodesMap.get(e);t&&(this.getBox(e,t.box),this.bvh.move(t,this._margin))}delete(e){const t=this.nodesMap.get(e);t&&(this.bvh.delete(t),this.nodesMap.delete(e))}clear(){this.bvh.clear(),this.nodesMap.clear()}frustumCulling(e,t){this._margin>0&&this.accurateCulling?this.bvh.frustumCulling(e.elements,(s,n,l)=>{n.isIntersectedMargin(s.box,l,this._margin)&&t(s)}):this.bvh.frustumCulling(e.elements,t)}frustumCullingLOD(e,t,s,n){this.LODsMap.has(s)||this.LODsMap.set(s,new Float32Array(s.length));const l=this.LODsMap.get(s);for(let c=0;c<s.length;c++)l[c]=s[c].distance;const h=this._cameraPos;h[0]=t.x,h[1]=t.y,h[2]=t.z,this._margin>0&&this.accurateCulling?this.bvh.frustumCullingLOD(e.elements,h,l,(c,p,d,f)=>{d.isIntersectedMargin(c.box,f,this._margin)&&n(c,p)}):this.bvh.frustumCullingLOD(e.elements,h,l,n)}raycast(e,t){const s=e.ray,n=this._origin,l=this._dir;Na(s.origin,n),Na(s.direction,l),this.bvh.rayIntersections(l,n,t,e.near,e.far)}intersectBox(e,t){this._boxArray||(this._boxArray=new Float32Array(6));const s=this._boxArray;return Va(e,s),this.bvh.intersectsBox(s,t)}getBox(e,t){if(this._getBoxFromSphere){const s=this.target.matricesTexture._data,{centerX:n,centerY:l,centerZ:h,maxScale:c}=this.getSphereFromMatrix_centeredGeometry(e,s,this._sphereTarget),p=this._geoBoundingSphere.radius*c;t[0]=n-p,t[1]=n+p,t[2]=l-p,t[3]=l+p,t[4]=h-p,t[5]=h+p}else Ka.copy(this.geoBoundingBox).applyMatrix4(this.target.getMatrixAt(e)),Va(Ka,t);return t}getSphereFromMatrix_centeredGeometry(e,t,s){const n=e*16,l=t[n+0],h=t[n+1],c=t[n+2],p=t[n+4],d=t[n+5],f=t[n+6],_=t[n+8],g=t[n+9],v=t[n+10],y=l*l+h*h+c*c,b=p*p+d*d+f*f,x=_*_+g*g+v*v;return s.maxScale=Math.sqrt(Math.max(y,b,x)),s.centerX=t[n+12],s.centerY=t[n+13],s.centerZ=t[n+14],s}}const Ka=new Kr;class dm extends rp{constructor(e,t,s,n,l,h=1){const c=e.createBuffer();super(c,t,s,n,l.length/s),this.isGLInstancedBufferAttribute=!0,this._needsUpdate=!1,this.isInstancedBufferAttribute=!0,this.meshPerAttribute=h,this.array=l,this._cacheArray=l,e.bindBuffer(e.ARRAY_BUFFER,c),e.bufferData(e.ARRAY_BUFFER,l,e.DYNAMIC_DRAW)}update(e,t){if(!this._needsUpdate||t===0)return;const s=e.getContext();s.bindBuffer(s.ARRAY_BUFFER,this.buffer),this.array===this._cacheArray?s.bufferSubData(s.ARRAY_BUFFER,0,this.array,0,t):(s.bufferData(s.ARRAY_BUFFER,this.array,s.DYNAMIC_DRAW),this._cacheArray=this.array),this._needsUpdate=!1}clone(){return this}}let xn=null,un=null;const pr={};function pm(r){var e;return((e=un.get(r))==null?void 0:e())??xn(r)}function fm(r){if(un.has(r))return;const e={};un.set(r,()=>{if(r.isMeshDistanceMaterial){const t=xn(r);e.light=t.light}return e})}function mm(r,e,t){const s=e.properties;xn=s.get;const n=`${!!r.colorsTexture}_${r._useOpacity}_${!!r.boneTexture}_${!!r.uniformsTexture}`;pr[n]??(pr[n]=new WeakMap),un=pr[n],s.get=pm,fm(t)}function _m(r){r.properties.get=xn}function Ph(r,e){return Math.max(e,Math.ceil(Math.sqrt(r/e))*e)}function vm(r,e,t,s){e===3&&(console.warn('"channels" cannot be 3. Set to 4. More info: https://github.com/mrdoob/three.js/pull/23228'),e=4);const n=Ph(s,t),l=new r(n*n*e),h=r.name.includes("Float"),c=r.name.includes("Uint"),p=h?jr:c?yl:op;let d;switch(e){case 1:d=h?Gr:up;break;case 2:d=h?hp:cp;break;case 4:d=h?ap:lp;break}return{array:l,size:n,type:p,format:d}}class dn extends Hr{constructor(e,t,s,n,l,h){t===3&&(t=4);const{array:c,format:p,size:d,type:f}=vm(e,t,s,n);super(c,d,d,p,f),this.partialUpdate=!0,this.maxUpdateCalls=1/0,this._utils=null,this._needsUpdate=!0,this._lastWidth=-1,this._data=c,this._channels=t,this._pixelsPerInstance=s,this._stride=s*t,this._rowToUpdate=new Array(d),this._uniformMap=l,this._fetchUniformsInFragmentShader=h,this.needsUpdate=!0}resize(e){const t=Ph(e,this._pixelsPerInstance);if(t===this.image.width)return;const s=this._data,n=this._channels;this._rowToUpdate.length=t;const l=s.constructor,h=new l(t*t*n),c=Math.min(s.length,h.length);h.set(new l(s.buffer,0,c)),this.dispose(),this.image={data:h,height:t,width:t},this._data=h}enqueueUpdate(e){if(this._needsUpdate=!0,!this.partialUpdate)return;const t=this.image.width/this._pixelsPerInstance,s=Math.floor(e/t);this._rowToUpdate[s]=!0}bindToProgram(e,t,s,n,l){if(!n[l])return;n[l].value=this;const h=this.getSlot(s,l);if(h===void 0)return;const c=e.properties.get(this);e.state.bindTexture(t.TEXTURE_2D,c.__webglTexture,t.TEXTURE0+h)}update(e,t,s){const n=e.properties.get(this),l=n.__version!==this.version;if(!this._needsUpdate&&!l)return;const h=this._lastWidth!==this.image.width;if(!n.__webglTexture||h)e.initTexture(this);else{const c=this.getSlot(t,s)??e.capabilities.maxTextures-1;this.partialUpdate?this.updatePartial(n,e,c):this.updateFull(n,e,c),n.__version=this.version}this._lastWidth=this.image.width,this._needsUpdate=!1}getSlot(e,t){var s;return(s=e[t])==null?void 0:s.cache[0]}updateFull(e,t,s){this.updateRows(e,t,[{row:0,count:this.image.height}],s)}updatePartial(e,t,s){const n=this.getUpdateRowsInfo();n.length!==0&&(n.length>this.maxUpdateCalls?this.updateFull(e,t,s):this.updateRows(e,t,n,s),this._rowToUpdate.fill(!1))}getUpdateRowsInfo(){const e=this._rowToUpdate,t=[];for(let s=0,n=e.length;s<n;s++)if(e[s]){const l=s;for(;s<n&&e[s];s++);t.push({row:l,count:s-l})}return t}updateRows(e,t,s,n){var l;const h=t.getContext();this._utils??(this._utils=new sp(h,t.extensions,t.capabilities));const c=this._utils.convert(this.format),p=this._utils.convert(this.type),{data:d,width:f}=this.image,_=this._channels;t.state.activeTexture(h.TEXTURE0+n),t.state.bindTexture(h.TEXTURE_2D,e.__webglTexture,h.TEXTURE0+n);const g=Zs.getPrimaries(Zs.workingColorSpace),v=this.colorSpace===Js?null:Zs.getPrimaries(this.colorSpace),y=this.colorSpace===Js||g===v?h.NONE:h.BROWSER_DEFAULT_WEBGL;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,this.flipY),h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),h.pixelStorei(h.UNPACK_ALIGNMENT,this.unpackAlignment),h.pixelStorei(h.UNPACK_COLORSPACE_CONVERSION_WEBGL,y);for(const{count:b,row:x}of s)h.texSubImage2D(h.TEXTURE_2D,0,0,x,f,b,c,p,d,x*f*_);(l=this.onUpdate)==null||l.call(this,this)}setUniformAt(e,t,s){const{offset:n,size:l}=this._uniformMap.get(t),h=this._stride;l===1?this._data[e*h+n]=s:s.toArray(this._data,e*h+n)}getUniformAt(e,t,s){const{offset:n,size:l}=this._uniformMap.get(t),h=this._stride;return l===1?this._data[e*h+n]:s.fromArray(this._data,e*h+n)}getUniformsGLSL(e,t,s){const n=this.getUniformsVertexGLSL(e,t,s),l=this.getUniformsFragmentGLSL(e,t,s);return{vertex:n,fragment:l}}getUniformsVertexGLSL(e,t,s){if(this._fetchUniformsInFragmentShader)return`
        flat varying ${s} ez_v${t}; 
        void main() {
          ez_v${t} = ${t};`;const n=this.texelsFetchGLSL(e,t),l=this.getFromTexelsGLSL(),{assignVarying:h,declareVarying:c}=this.getVarying();return`
      uniform highp sampler2D ${e};  
      ${c}
      void main() {
        ${n}
        ${l}
        ${h}`}getUniformsFragmentGLSL(e,t,s){if(!this._fetchUniformsInFragmentShader){const{declareVarying:h,getVarying:c}=this.getVarying();return`
      ${h}
      void main() {
        ${c}`}const n=this.texelsFetchGLSL(e,`ez_v${t}`),l=this.getFromTexelsGLSL();return`
      uniform highp sampler2D ${e};  
      flat varying ${s} ez_v${t};
      void main() {
        ${n}
        ${l}`}texelsFetchGLSL(e,t){const s=this._pixelsPerInstance;let n=`
      int size = textureSize(${e}, 0).x;
      int j = int(${t}) * ${s};
      int x = j % size;
      int y = j / size;
    `;for(let l=0;l<s;l++)n+=`vec4 ez_texel${l} = texelFetch(${e}, ivec2(x + ${l}, y), 0);
`;return n}getFromTexelsGLSL(){const e=this._uniformMap;let t="";for(const[s,{type:n,offset:l,size:h}]of e){const c=Math.floor(l/this._channels);if(n==="mat3")t+=`mat3 ${s} = mat3(ez_texel${c}.rgb, vec3(ez_texel${c}.a, ez_texel${c+1}.rg), vec3(ez_texel${c+1}.ba, ez_texel${c+2}.r));
`;else if(n==="mat4")t+=`mat4 ${s} = mat4(ez_texel${c}, ez_texel${c+1}, ez_texel${c+2}, ez_texel${c+3});
`;else{const p=this.getUniformComponents(l,h);t+=`${n} ${s} = ez_texel${c}.${p};
`}}return t}getVarying(){const e=this._uniformMap;let t="",s="",n="";for(const[l,{type:h}]of e)t+=`flat varying ${h} ez_v${l};
`,s+=`ez_v${l} = ${l};
`,n+=`${h} ${l} = ez_v${l};
`;return{declareVarying:t,assignVarying:s,getVarying:n}}getUniformComponents(e,t){const s=e%this._channels;let n="";for(let l=0;l<t;l++)n+=gm[s+l];return n}copy(e){return super.copy(e),this.partialUpdate=e.partialUpdate,this.maxUpdateCalls=e.maxUpdateCalls,this._channels=e._channels,this._pixelsPerInstance=e._pixelsPerInstance,this._stride=e._stride,this._rowToUpdate=e._rowToUpdate,this._uniformMap=e._uniformMap,this._fetchUniformsInFragmentShader=e._fetchUniformsInFragmentShader,this}}const gm=["r","g","b","a"];class B extends mn{constructor(e,t,s={},n){if(!e)throw new Error('"geometry" is mandatory.');if(!t)throw new Error('"material" is mandatory.');const{allowsEuler:l,renderer:h,createEntities:c}=s;super(e,null),this.type="InstancedMesh2",this.isInstancedMesh2=!0,this.instances=null,this.instanceIndex=null,this.colorsTexture=null,this.morphTexture=null,this.boneTexture=null,this.uniformsTexture=null,this.boundingBox=null,this.boundingSphere=null,this.bvh=null,this.customSort=null,this.raycastOnlyFrustum=!1,this.LODinfo=null,this.autoUpdate=!0,this.bindMode=fa,this.bindMatrix=null,this.bindMatrixInverse=null,this.skeleton=null,this.autoUpdateBVH=!0,this.onFrustumEnter=null,this._renderer=null,this._instancesCount=0,this._instancesArrayCount=0,this._perObjectFrustumCulled=!0,this._sortObjects=!1,this._indexArrayNeedsUpdate=!1,this._useOpacity=!1,this._currentMaterial=null,this._customProgramCacheKeyBase=null,this._onBeforeCompileBase=null,this._freeIds=[],this.isInstancedMesh=!0,this.instanceMatrix=new tp(new Float32Array(0),16),this.instanceColor=null,this._customProgramCacheKey=()=>`ez_${!!this.colorsTexture}_${this._useOpacity}_${!!this.boneTexture}_${!!this.uniformsTexture}_${this._customProgramCacheKeyBase.call(this._currentMaterial)}`,this._onBeforeCompile=(d,f)=>{if(this._onBeforeCompileBase&&this._onBeforeCompileBase.call(this._currentMaterial,d,f),d.defines??(d.defines={}),d.defines.USE_INSTANCING_INDIRECT="",d.uniforms.matricesTexture={value:this.matricesTexture},this.uniformsTexture){d.uniforms.uniformsTexture={value:this.uniformsTexture};const{vertex:_,fragment:g}=this.uniformsTexture.getUniformsGLSL("uniformsTexture","instanceIndex","uint");d.vertexShader=d.vertexShader.replace("void main() {",_),d.fragmentShader=d.fragmentShader.replace("void main() {",g)}this.colorsTexture&&d.fragmentShader.includes("#include <color_pars_fragment>")&&(d.defines.USE_INSTANCING_COLOR_INDIRECT="",d.uniforms.colorsTexture={value:this.colorsTexture},d.vertexShader=d.vertexShader.replace("<color_vertex>","<instanced_color_vertex>"),d.vertexColors&&(d.defines.USE_VERTEX_COLOR=""),this._useOpacity?d.defines.USE_COLOR_ALPHA="":d.defines.USE_COLOR=""),this.boneTexture&&(d.defines.USE_SKINNING="",d.defines.USE_INSTANCING_SKINNING="",d.uniforms.bindMatrix={value:this.bindMatrix},d.uniforms.bindMatrixInverse={value:this.bindMatrixInverse},d.uniforms.bonesPerInstance={value:this.skeleton.bones.length},d.uniforms.boneTexture={value:this.boneTexture})};const p=s.capacity>0?s.capacity:bm;this._renderer=h,this._capacity=p,this._parentLOD=n,this._geometry=e,this.material=t,this._allowsEuler=l??!1,this._tempInstance=new Sh(this,-1,l),this.availabilityArray=n?.availabilityArray??new Array(p*2),this._createEntities=c,this.initLastRenderInfo(),this.initIndexAttribute(),this.initMatricesTexture()}get capacity(){return this._capacity}get instancesCount(){return this._instancesCount}get perObjectFrustumCulled(){return this._perObjectFrustumCulled}set perObjectFrustumCulled(e){this._perObjectFrustumCulled=e,this._indexArrayNeedsUpdate=!0}get sortObjects(){return this._sortObjects}set sortObjects(e){this._sortObjects=e,this._indexArrayNeedsUpdate=!0}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.patchGeometry(e)}onBeforeShadow(e,t,s,n,l,h,c){this.patchMaterial(e,h),this.updateTextures(e,h);const p=e.info.render.frame;this.instanceIndex&&this.autoUpdate&&!this.frustumCullingAlreadyPerformed(p,s,n)&&this.performFrustumCulling(n,s),this.count!==0&&(this.instanceIndex.update(this._renderer,this.count),this.bindTextures(e,h))}onBeforeRender(e,t,s,n,l,h){if(this.patchMaterial(e,l),this.updateTextures(e,l),!this.instanceIndex){this._renderer=e;return}const c=e.info.render.frame;this.autoUpdate&&!this.frustumCullingAlreadyPerformed(c,s,null)&&this.performFrustumCulling(s),this.count!==0&&(this.instanceIndex.update(this._renderer,this.count),this.bindTextures(e,l))}onAfterShadow(e,t,s,n,l,h,c){this.unpatchMaterial(e,h)}onAfterRender(e,t,s,n,l,h){this.unpatchMaterial(e,l),!(this.instanceIndex||h&&!this.isLastGroup(h.materialIndex))&&this.initIndexAttribute()}updateTextures(e,t){var s,n,l;const h=e.properties.get(t);this.matricesTexture.update(e,h,"matricesTexture"),(s=this.colorsTexture)==null||s.update(e,h,"colorsTexture"),(n=this.uniformsTexture)==null||n.update(e,h,"uniformsTexture"),(l=this.boneTexture)==null||l.update(e,h,"boneTexture")}bindTextures(e,t){var s,n,l;const h=e.properties.get(t),c=h.uniforms;if(!c)return;const p=h.currentProgram,d=p?.program;if(!d)return;const f=e.getContext(),_=p.getUniforms().map,g=f.getParameter(f.CURRENT_PROGRAM);e.state.useProgram(d),this.matricesTexture.bindToProgram(e,f,_,c,"matricesTexture"),(s=this.colorsTexture)==null||s.bindToProgram(e,f,_,c,"colorsTexture"),(n=this.uniformsTexture)==null||n.bindToProgram(e,f,_,c,"uniformsTexture"),(l=this.boneTexture)==null||l.bindToProgram(e,f,_,c,"boneTexture"),e.state.useProgram(g)}isLastGroup(e){const t=this.material;for(let s=t.length-1;s>=e;s--)if(t[s].visible)return s===e}initIndexAttribute(){if(!this._renderer){this.count=0;return}const e=this._renderer.getContext(),t=this._capacity,s=new Uint32Array(t);for(let n=0;n<t;n++)s[n]=n;this.instanceIndex=new dm(e,e.UNSIGNED_INT,1,4,s),this._geometry.setAttribute("instanceIndex",this.instanceIndex)}initLastRenderInfo(){this._parentLOD||(this._lastRenderInfo={frame:-1,camera:null,shadowCamera:null})}initMatricesTexture(){this._parentLOD||(this.matricesTexture=new dn(Float32Array,4,4,this._capacity))}initColorsTexture(){this._parentLOD||(this.colorsTexture=new dn(Float32Array,4,1,this._capacity),this.colorsTexture.colorSpace=Zs.workingColorSpace,this.colorsTexture._data.fill(1),this.materialsNeedsUpdate())}materialsNeedsUpdate(){if(this.material.isMaterial){this.material.needsUpdate=!0;return}for(const e of this.material)e.needsUpdate=!0}patchGeometry(e){const t=e.getAttribute("instanceIndex");if(t){if(t===this.instanceIndex)return;console.warn("The geometry has been cloned because it was already used."),e=e.clone(),e.deleteAttribute("instanceIndex")}this.instanceIndex&&e.setAttribute("instanceIndex",this.instanceIndex)}patchMaterial(e,t){this._currentMaterial=t,this._customProgramCacheKeyBase=t.customProgramCacheKey,this._onBeforeCompileBase=t.onBeforeCompile,t.customProgramCacheKey=this._customProgramCacheKey,t.onBeforeCompile=this._onBeforeCompile,mm(this,e,t)}unpatchMaterial(e,t){this._currentMaterial=null,_m(e),t.onBeforeCompile=this._onBeforeCompileBase,t.customProgramCacheKey=this._customProgramCacheKeyBase,this._onBeforeCompileBase=null,this._customProgramCacheKeyBase=null}computeBVH(e={}){this.bvh||(this.bvh=new um(this,e.margin,e.getBBoxFromBSphere,e.accurateCulling)),this.bvh.clear(),this.bvh.create()}disposeBVH(){this.bvh=null}setMatrixAt(e,t){if(t.toArray(this.matricesTexture._data,e*16),this.instances){const s=this.instances[e];t.decompose(s.position,s.quaternion,s.scale)}this.matricesTexture.enqueueUpdate(e),this.bvh&&this.autoUpdateBVH&&this.bvh.move(e)}getMatrixAt(e,t=xm){return t.fromArray(this.matricesTexture._data,e*16)}getPositionAt(e,t=ym){const s=e*16,n=this.matricesTexture._data;return t.x=n[s+12],t.y=n[s+13],t.z=n[s+14],t}getPositionAndMaxScaleOnAxisAt(e,t){const s=e*16,n=this.matricesTexture._data,l=n[s+0],h=n[s+1],c=n[s+2],p=l*l+h*h+c*c,d=n[s+4],f=n[s+5],_=n[s+6],g=d*d+f*f+_*_,v=n[s+8],y=n[s+9],b=n[s+10],x=v*v+y*y+b*b;return t.x=n[s+12],t.y=n[s+13],t.z=n[s+14],Math.sqrt(Math.max(p,g,x))}applyMatrixAtToSphere(e,t,s,n){const l=e*16,h=this.matricesTexture._data,c=h[l+0],p=h[l+1],d=h[l+2],f=h[l+3],_=h[l+4],g=h[l+5],v=h[l+6],y=h[l+7],b=h[l+8],x=h[l+9],w=h[l+10],C=h[l+11],T=h[l+12],O=h[l+13],A=h[l+14],M=h[l+15],R=t.center,D=s.x,k=s.y,I=s.z,H=1/(f*D+y*k+C*I+M);R.x=(c*D+_*k+b*I+T)*H,R.y=(p*D+g*k+x*I+O)*H,R.z=(d*D+v*k+w*I+A)*H;const K=c*c+p*p+d*d,ee=_*_+g*g+v*v,q=b*b+x*x+w*w;t.radius=n*Math.sqrt(Math.max(K,ee,q))}setVisibilityAt(e,t){this.availabilityArray[e*2]=t,this._indexArrayNeedsUpdate=!0}getVisibilityAt(e){return this.availabilityArray[e*2]}setActiveAt(e,t){this.availabilityArray[e*2+1]=t,this._indexArrayNeedsUpdate=!0}getActiveAt(e){return this.availabilityArray[e*2+1]}getActiveAndVisibilityAt(e){const t=e*2,s=this.availabilityArray;return s[t]&&s[t+1]}setActiveAndVisibilityAt(e,t){const s=e*2,n=this.availabilityArray;n[s]=t,n[s+1]=t,this._indexArrayNeedsUpdate=!0}setColorAt(e,t){this.colorsTexture===null&&this.initColorsTexture(),t.isColor?t.toArray(this.colorsTexture._data,e*4):qa.set(t).toArray(this.colorsTexture._data,e*4),this.colorsTexture.enqueueUpdate(e)}getColorAt(e,t=qa){return t.fromArray(this.colorsTexture._data,e*4)}setOpacityAt(e,t){this._useOpacity||(this.colorsTexture===null?this.initColorsTexture():this.materialsNeedsUpdate(),this._useOpacity=!0),this.colorsTexture._data[e*4+3]=t,this.colorsTexture.enqueueUpdate(e)}getOpacityAt(e){return this._useOpacity?this.colorsTexture._data[e*4+3]:1}copyTo(e,t){this.getMatrixAt(e,t.matrix).decompose(t.position,t.quaternion,t.scale)}computeBoundingBox(){const e=this._geometry,t=this._instancesArrayCount;this.boundingBox??(this.boundingBox=new Kr),e.boundingBox===null&&e.computeBoundingBox();const s=e.boundingBox,n=this.boundingBox;n.makeEmpty();for(let l=0;l<t;l++)this.getActiveAt(l)&&(Ya.copy(s).applyMatrix4(this.getMatrixAt(l)),n.union(Ya))}computeBoundingSphere(){const e=this._geometry,t=this._instancesArrayCount;this.boundingSphere??(this.boundingSphere=new _n),e.boundingSphere===null&&e.computeBoundingSphere();const s=e.boundingSphere,n=this.boundingSphere;n.makeEmpty();for(let l=0;l<t;l++)this.getActiveAt(l)&&($a.copy(s).applyMatrix4(this.getMatrixAt(l)),n.union($a))}clone(e){const t={capacity:this._capacity,renderer:this._renderer,allowsEuler:this._allowsEuler,createEntities:this._createEntities};return new this.constructor(this.geometry,this.material,t).copy(this,e)}copy(e,t){return super.copy(e,t),this.count=e._capacity,this._instancesCount=e._instancesCount,this._instancesArrayCount=e._instancesArrayCount,this._capacity=e._capacity,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this.matricesTexture=e.matricesTexture.clone(),this.matricesTexture.image.data=this.matricesTexture.image.data.slice(),e.colorsTexture!==null&&(this.colorsTexture=e.colorsTexture.clone(),this.colorsTexture.image.data=this.colorsTexture.image.data.slice()),e.uniformsTexture!==null&&(this.uniformsTexture=e.uniformsTexture.clone(),this.uniformsTexture.image.data=this.uniformsTexture.image.data.slice()),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone(),this.morphTexture.image.data=this.morphTexture.image.data.slice()),e.boneTexture!==null&&(this.boneTexture=e.boneTexture.clone(),this.boneTexture.image.data=this.boneTexture.image.data.slice()),this}dispose(){var e,t,s,n;this.dispatchEvent({type:"dispose"}),this.matricesTexture.dispose(),(e=this.colorsTexture)==null||e.dispose(),(t=this.morphTexture)==null||t.dispose(),(s=this.boneTexture)==null||s.dispose(),(n=this.uniformsTexture)==null||n.dispose()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMatrixInverse&&(this.bindMode===fa?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===ip?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("Unrecognized bindMode: "+this.bindMode))}}const bm=1e3,Ya=new Kr,$a=new _n,xm=new Mi,qa=new us,ym=new Ve;B.prototype.resizeBuffers=function(r){var e;const t=this._capacity;this._capacity=r;const s=Math.min(r,t);if(this.instanceIndex){const n=new Uint32Array(r);n.set(new Uint32Array(this.instanceIndex.array.buffer,0,s)),this.instanceIndex.array=n}if(this.LODinfo){for(const n of this.LODinfo.objects)if(n._capacity=r,n.instanceIndex){const l=new Uint32Array(r);l.set(new Uint32Array(n.instanceIndex.array.buffer,0,s)),n.instanceIndex.array=l}}if(this.availabilityArray.length=r*2,this.matricesTexture.resize(r),this.colorsTexture&&(this.colorsTexture.resize(r),r>t&&this.colorsTexture._data.fill(1,t*4)),this.morphTexture){const n=this.morphTexture.image.data,l=n.length/t;this.morphTexture.dispose(),this.morphTexture=new Hr(new Float32Array(l*r),l,r,Gr,jr),this.morphTexture.image.data.set(n)}return(e=this.uniformsTexture)==null||e.resize(r),this};B.prototype.setInstancesArrayCount=function(r){if(r<this._instancesArrayCount){const t=this.bvh;if(t)for(let s=this._instancesArrayCount-1;s>=r;s--)this.getActiveAt(s)&&t.delete(s);this._instancesArrayCount=r;return}if(r>this._capacity){let t=this._capacity+(this._capacity>>1)+512;for(;t<r;)t+=(t>>1)+512;this.resizeBuffers(t)}const e=this._instancesArrayCount;this._instancesArrayCount=r,this._createEntities&&this.createEntities(e)};function Oh(r,e){return r.depth-e.depth}function Ah(r,e){return e.depth-r.depth}class wm{constructor(){this.array=[],this.pool=[]}push(e,t){const s=this.pool,n=this.array,l=n.length;l>=s.length&&s.push({depth:null,index:null,depthSort:null});const h=s[l];h.depth=e,h.index=t,n.push(h)}reset(){this.array.length=0}}const pn=new dp,Xe=new wm,ri=new Mi,Oi=new Mi,yn=new Ve,Es=new Ve,Ai=new Ve,Cm=new Ve,Ze=new _n;B.prototype.performFrustumCulling=function(r,e=r){const t=this._parentLOD??this,s=t.LODinfo;let n;if(s){n=r!==e?s.shadowRender??s.render:s.render;for(const l of s.objects)l.count=0}else t.count=0;t._instancesArrayCount!==0&&(n?.levels.length>0?t.frustumCullingLOD(n,r,e):t.frustumCulling(r))};B.prototype.frustumCullingAlreadyPerformed=function(r,e,t){const s=this._lastRenderInfo;return s.frame===r&&s.camera===e&&s.shadowCamera===t?!0:(s.frame=r,s.camera=e,s.shadowCamera=t,!1)};B.prototype.frustumCulling=function(r){var e;const t=this._sortObjects,s=this._perObjectFrustumCulled,n=this.instanceIndex.array;if(this.instanceIndex._needsUpdate=!0,!s&&!t){this.updateIndexArray();return}if(t&&(Oi.copy(this.matrixWorld).invert(),Es.setFromMatrixPosition(r.matrixWorld).applyMatrix4(Oi),yn.set(0,0,-1).transformDirection(r.matrixWorld).transformDirection(Oi)),s?(ri.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse).multiply(this.matrixWorld),this.bvh?this.BVHCulling(r):this.linearCulling(r)):this.updateRenderList(),t){const l=this.customSort;l===null?Xe.array.sort((e=this.material)!=null&&e.transparent?Ah:Oh):l(Xe.array);const h=Xe.array,c=h.length;for(let p=0;p<c;p++)n[p]=h[p].index;this.count=c,Xe.reset()}};B.prototype.updateIndexArray=function(){if(!this._indexArrayNeedsUpdate)return;const r=this.instanceIndex.array,e=this._instancesArrayCount;let t=0;for(let s=0;s<e;s++)this.getActiveAndVisibilityAt(s)&&(r[t++]=s);this.count=t,this._indexArrayNeedsUpdate=!1};B.prototype.updateRenderList=function(){const r=this._instancesArrayCount;for(let e=0;e<r;e++)if(this.getActiveAndVisibilityAt(e)){const t=this.getPositionAt(e).sub(Es).dot(yn);Xe.push(t,e)}};B.prototype.BVHCulling=function(r){const e=this.instanceIndex.array,t=this._instancesArrayCount,s=this._sortObjects,n=this.onFrustumEnter;let l=0;this.bvh.frustumCulling(ri,h=>{const c=h.object;if(c<t&&this.getVisibilityAt(c)&&(!n||n(c,r)))if(s){const p=this.getPositionAt(c).sub(Es).dot(yn);Xe.push(p,c)}else e[l++]=c}),this.count=l};B.prototype.linearCulling=function(r){const e=this.instanceIndex.array;this.geometry.boundingSphere||this.geometry.computeBoundingSphere();const t=this._geometry.boundingSphere,s=t.radius,n=t.center,l=this._instancesArrayCount,h=n.x===0&&n.y===0&&n.z===0,c=this._sortObjects,p=this.onFrustumEnter;let d=0;pn.setFromProjectionMatrix(ri);for(let f=0;f<l;f++)if(this.getActiveAndVisibilityAt(f)){if(h){const _=this.getPositionAndMaxScaleOnAxisAt(f,Ze.center);Ze.radius=s*_}else this.applyMatrixAtToSphere(f,Ze,n,s);if(pn.intersectsSphere(Ze)&&(!p||p(f,r)))if(c){const _=Cm.subVectors(Ze.center,Es).dot(yn);Xe.push(_,f)}else e[d++]=f}this.count=d};B.prototype.frustumCullingLOD=function(r,e,t){var s,n;const{count:l,levels:h}=r,c=e===t&&this._sortObjects;for(let d=0;d<h.length;d++)l[d]=0,h[d].object.instanceIndex&&(h[d].object.instanceIndex._needsUpdate=!0);ri.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse).multiply(this.matrixWorld),Oi.copy(this.matrixWorld).invert(),Es.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Oi),Ai.setFromMatrixPosition(t.matrixWorld).applyMatrix4(Oi);const p=r.levels.map(d=>d.object.instanceIndex.array);if(this.bvh?this.BVHCullingLOD(r,p,c,e,t):this.linearCullingLOD(r,p,c,e,t),c){const d=this.customSort,f=Xe.array;let _=0,g=h[1].distance;d===null?f.sort((s=h[0].object.material)!=null&&s.transparent?Ah:Oh):d(f);for(let v=0,y=f.length;v<y;v++){const b=f[v];b.depth>g&&(_++,g=((n=h[_+1])==null?void 0:n.distance)??1/0),p[_][l[_]++]=b.index}Xe.reset()}for(let d=0;d<h.length;d++){const f=h[d].object;f.count=l[d]}};B.prototype.BVHCullingLOD=function(r,e,t,s,n){const{count:l,levels:h}=r,c=this._instancesArrayCount,p=this.onFrustumEnter;t?this.bvh.frustumCulling(ri,d=>{const f=d.object;if(f<c&&this.getVisibilityAt(f)&&(!p||p(f,s,n))){const _=this.getPositionAt(f).distanceToSquared(Ai);Xe.push(_,f)}}):this.bvh.frustumCullingLOD(ri,Ai,h,(d,f)=>{const _=d.object;if(_<c&&this.getVisibilityAt(_)){if(f===null){const g=this.getPositionAt(_).distanceToSquared(Ai);f=this.getObjectLODIndexForDistance(h,g)}(!p||p(_,s,n,f))&&(e[f][l[f]++]=_)}})};B.prototype.linearCullingLOD=function(r,e,t,s,n){const{count:l,levels:h}=r;this.geometry.boundingSphere||this.geometry.computeBoundingSphere();const c=this._geometry.boundingSphere,p=c.radius,d=c.center,f=this._instancesArrayCount,_=d.x===0&&d.y===0&&d.z===0,g=this.onFrustumEnter;pn.setFromProjectionMatrix(ri);for(let v=0;v<f;v++)if(this.getActiveAndVisibilityAt(v)){if(_){const y=this.getPositionAndMaxScaleOnAxisAt(v,Ze.center);Ze.radius=p*y}else this.applyMatrixAtToSphere(v,Ze,d,p);if(pn.intersectsSphere(Ze))if(t){if(!g||g(v,s,n))continue;const y=Ze.center.distanceToSquared(Ai);Xe.push(y,v)}else{const y=Ze.center.distanceToSquared(Ai),b=this.getObjectLODIndexForDistance(h,y);(!g||g(v,s,n,b))&&(e[b][l[b]++]=v)}}};B.prototype.clearTempInstance=function(r){const e=this._tempInstance;return e.id=r,this.clearInstance(e)};B.prototype.clearTempInstancePosition=function(r){const e=this._tempInstance;return e.id=r,e.position.set(0,0,0),e};B.prototype.clearInstance=function(r){return r.position.set(0,0,0),r.scale.set(1,1,1),r.quaternion.identity(),r};B.prototype.updateInstances=function(r){const e=this._instancesArrayCount,t=this.instances;for(let s=0;s<e;s++){if(!this.getActiveAt(s))continue;const n=t?t[s]:this.clearTempInstance(s);r(n,s),n.updateMatrix()}return this};B.prototype.updateInstancesPosition=function(r){const e=this._instancesArrayCount,t=this.instances;for(let s=0;s<e;s++){if(!this.getActiveAt(s))continue;const n=t?t[s]:this.clearTempInstancePosition(s);r(n,s),n.updateMatrixPosition()}return this};B.prototype.createEntities=function(r){const e=this._instancesArrayCount;if(!this.instances)this.instances=new Array(e);else if(this.instances.length<e)this.instances.length=e;else return this;const t=this.instances;for(let s=r;s<e;s++)t[s]||(t[s]=new Sh(this,s,this._allowsEuler));return this};B.prototype.addInstances=function(r,e){!e&&this.bvh&&console.warn("InstancedMesh2: if `computeBVH()` has already been called, it is better to valorize the instances in the `onCreation` callback for better performance.");const t=this._freeIds;if(t.length>0){let l=-1;const h=Math.min(t.length,r),c=t.length-h;for(let p=t.length-1;p>=c;p--){const d=t[p];d>l&&(l=d),this.addInstance(d,e)}t.length-=h,r-=h,this._instancesArrayCount=Math.max(l+1,this._instancesArrayCount)}const s=this._instancesArrayCount,n=s+r;this.setInstancesArrayCount(n);for(let l=s;l<n;l++)this.addInstance(l,e);return this};B.prototype.addInstance=function(r,e){var t;this._instancesCount++,this.setActiveAndVisibilityAt(r,!0);const s=this.instances?this.clearInstance(this.instances[r]):this.clearTempInstance(r);e?(e(s,r),s.updateMatrix()):s.setMatrixIdentity(),(t=this.bvh)==null||t.insert(r)};B.prototype.removeInstances=function(...r){const e=this._freeIds,t=this.bvh;for(const s of r)s<this._instancesArrayCount&&this.getActiveAt(s)&&(this.setActiveAt(s,!1),e.push(s),t?.delete(s),this._instancesCount--);for(let s=this._instancesArrayCount-1;s>=0&&!this.getActiveAt(s);s--)this._instancesArrayCount--;return this};B.prototype.clearInstances=function(){var r;if(this._instancesCount=0,this._instancesArrayCount=0,this._freeIds.length=0,(r=this.bvh)==null||r.clear(),this.LODinfo)for(const e of this.LODinfo.objects)e.count=0;return this};B.prototype.getObjectLODIndexForDistance=function(r,e){for(let t=r.length-1;t>0;t--){const s=r[t],n=s.distance-s.distance*s.hysteresis;if(e>=n)return t}return 0};B.prototype.setFirstLODDistance=function(r){if(this._parentLOD)throw new Error("Cannot create LOD for this InstancedMesh2.");return this.LODinfo||(this.LODinfo={render:null,shadowRender:null,objects:[this]}),this.LODinfo.render||(this.LODinfo.render={levels:[{distance:r,hysteresis:0,object:this}],count:[0]}),this};B.prototype.addLOD=function(r,e,t=0,s=0){var n;if(this._parentLOD)throw new Error("Cannot create LOD for this InstancedMesh2.");if(!((n=this.LODinfo)!=null&&n.render)&&t===0)throw new Error('Cannot set distance to 0 for the first LOD. Call "setFirstLODDistance" method before use "addLOD".');return this.setFirstLODDistance(0),this.addLevel(this.LODinfo.render,r,e,t,s),this};B.prototype.addShadowLOD=function(r,e=0,t=0){if(this._parentLOD)throw new Error("Cannot create LOD for this InstancedMesh2.");this.LODinfo||(this.LODinfo={render:null,shadowRender:null,objects:[this]}),this.LODinfo.shadowRender||(this.LODinfo.shadowRender={levels:[],count:[]});const s=this.addLevel(this.LODinfo.shadowRender,r,null,e,t);return s.castShadow=!0,this.castShadow=!0,this};B.prototype.addLevel=function(r,e,t,s,n){const l=this.LODinfo.objects,h=r.levels;let c,p;s=s**2;const d=l.findIndex(f=>f.geometry===e);if(d===-1){const f={capacity:this._capacity,renderer:this._renderer};p=new B(e,t??new It,f,this),p.frustumCulled=!1,this.patchLevel(p),l.push(p),this.add(p)}else p=l[d],t&&(p.material=t);for(c=0;c<h.length&&!(s<h[c].distance);c++);return h.splice(c,0,{distance:s,hysteresis:n,object:p}),r.count.push(0),p};B.prototype.updateLevel=function(r,e,t,s){if(!r)throw new Error("Render list is invalid.");const n=r.levels[e];if(!n)throw new Error("Cannot update an empty LOD.");if(t!=null&&!Number.isNaN(t)){const l=t**2;n.distance=l}return s!=null&&!Number.isNaN(s)&&(n.hysteresis=s),this};B.prototype.updateLOD=function(r,e,t){var s;const n=(s=this==null?void 0:this.LODinfo)==null?void 0:s.render;if(r===0)throw new Error("Cannot change distance for LOD0. It is the main mesh and must stay at 0.");return this.updateLevel(n,r,e,t)};B.prototype.updateShadowLOD=function(r,e,t){var s;return this.updateLevel((s=this.LODinfo)==null?void 0:s.shadowRender,r,e,t)};B.prototype.updateAllLevels=function(r,e,t){var s;if(!(r!=null&&r.levels))throw new Error("Invalid LOD list.");const n=r.levels,l=((s=this.LODinfo)==null?void 0:s.render)===r,h=l?1:0;l&&(n[0].distance=0);const c=e?.length>0;let p=[];c&&(p=l&&e[0]===0?e.slice(1,Math.min(n.length,e.length)):e.slice(0,Math.min(n.length-h,e.length)),p.every((f,_)=>{if(_>0&&f<=p[_-1])throw new Error(`LOD distances must be strictly increasing: d[${_-1}]=${p[_-1]} < d[${_}]=${f}`);return!0}));const d=c?p.length:n.length-h;for(let f=0;f<d;f++){const _=c?p[f]:void 0,g=Array.isArray(t)?t[f]:t;this.updateLevel(r,h+f,_,g)}return this};B.prototype.updateAllLOD=function(r,e){var t;return this.updateAllLevels((t=this.LODinfo)==null?void 0:t.render,r,e)};B.prototype.updateAllShadowLOD=function(r,e){var t;return this.updateAllLevels((t=this.LODinfo)==null?void 0:t.shadowRender,r,e)};B.prototype.disposeLOD=function(r){r.geometry.dispose();const e=r.material;if(Array.isArray(e))for(const t of e)t.dispose();else e.dispose()};B.prototype.removeLOD=function(r,e=!0){var t,s,n,l,h,c;const p=this.LODinfo,d=p?.render;if(!(d!=null&&d.levels))throw new Error("Invalid LOD list.");const f=d.levels.length;if(r<0||r>=f)throw new Error("Level index OOB");if(f>1&&r===0)throw new Error("Cannot remove LOD0 while others exist");const[_]=d.levels.splice(r,1);(s=(t=d.count)==null?void 0:t.splice)==null||s.call(t,r,1),d.levels.length<=1&&(p.render=null);const g=_.object,v=(n=this.LODinfo)==null?void 0:n.shadowRender;if(v!=null&&v.levels&&r<v.levels.length&&(v.levels.splice(r,1),(h=(l=v.count)==null?void 0:l.splice)==null||h.call(l,r,1),v.levels.length===0&&(this.LODinfo.shadowRender=null)),e&&g!==this)try{this.remove(g);const y=((c=p.objects)==null?void 0:c.indexOf(g))??-1;y!==-1&&p.objects.splice(y,1),this.disposeLOD(g)}catch(y){console.error(y)}return this};B.prototype.patchLevel=function(r){Object.defineProperty(r,"renderOrder",{get(){return this._parentLOD.renderOrder}}),Object.defineProperty(r,"_lastRenderInfo",{get(){return this._parentLOD._lastRenderInfo}}),Object.defineProperty(r,"matricesTexture",{get(){return this._parentLOD.matricesTexture}}),Object.defineProperty(r,"colorsTexture",{get(){return this._parentLOD.colorsTexture}}),Object.defineProperty(r,"uniformsTexture",{get(){return this._parentLOD.uniformsTexture}}),Object.defineProperty(r,"morphTexture",{get(){return this._parentLOD.morphTexture}}),Object.defineProperty(r,"boneTexture",{get(){return this._parentLOD.boneTexture}}),Object.defineProperty(r,"skeleton",{get(){return this._parentLOD.skeleton}}),Object.defineProperty(r,"bindMatrixInverse",{get(){return this._parentLOD.bindMatrixInverse}}),Object.defineProperty(r,"bindMatrix",{get(){return this._parentLOD.bindMatrix}})};const Em=new mn;B.prototype.getMorphAt=function(r,e=Em){const t=e.morphTargetInfluences,s=this.morphTexture.source.data.data,n=t.length+1,l=r*n+1;for(let h=0;h<t.length;h++)t[h]=s[l+h];return e};B.prototype.setMorphAt=function(r,e){const t=e.morphTargetInfluences,s=t.length+1;this.morphTexture===null&&!this._parentLOD&&(this.morphTexture=new Hr(new Float32Array(s*this._capacity),s,this._capacity,Gr,jr));const n=this.morphTexture.source.data.data;let l=0;for(const p of t)l+=p;const h=this._geometry.morphTargetsRelative?1:1-l,c=s*r;n[c]=h,n.set(t,c+1),this.morphTexture.needsUpdate=!0};const fr=[],fn=new mn,Tm=new ep,Wa=new Ve,Za=new Ve,Xa=new Mi,Qa=new _n;B.prototype.raycast=function(r,e){if(this._parentLOD||!this.material||this._instancesArrayCount===0||!this.instanceIndex)return;fn.geometry=this._geometry,fn.material=this.material;const t=r.ray,s=r.near,n=r.far;Xa.copy(this.matrixWorld).invert(),Za.setFromMatrixScale(this.matrixWorld),Wa.copy(r.ray.direction).multiply(Za);const l=Wa.length();r.ray=Tm.copy(r.ray).applyMatrix4(Xa),r.near/=l,r.far/=l,this.raycastInstances(r,e),r.ray=t,r.near=s,r.far=n};B.prototype.raycastInstances=function(r,e){if(this.bvh)this.bvh.raycast(r,t=>this.checkObjectIntersection(r,t,e));else{if(this.boundingSphere===null&&this.computeBoundingSphere(),Qa.copy(this.boundingSphere),!r.ray.intersectsSphere(Qa))return;const t=this.instanceIndex.array,s=this.raycastOnlyFrustum&&this._perObjectFrustumCulled?this.count:this._instancesArrayCount;for(let n=0;n<s;n++)this.checkObjectIntersection(r,t[n],e)}};B.prototype.checkObjectIntersection=function(r,e,t){if(!(e>this._instancesArrayCount||!this.getActiveAndVisibilityAt(e))){this.getMatrixAt(e,fn.matrixWorld),fn.raycast(r,fr);for(const s of fr)s.instanceId=e,s.object=this,t.push(s);fr.length=0}};B.prototype.initSkeleton=function(r,e=!0){if(r&&this.skeleton!==r&&!this._parentLOD){const t=r.bones;if(this.skeleton=r,this.bindMatrix=new Mi,this.bindMatrixInverse=new Mi,this.boneTexture=new dn(Float32Array,4,4*t.length,this._capacity),e)for(const s of t)s.matrixAutoUpdate=!1,s.matrixWorldAutoUpdate=!1;this.materialsNeedsUpdate()}};B.prototype.setBonesAt=function(r,e=!0,t){const s=this.skeleton;if(!s)throw new Error('"setBonesAt" cannot be called before "initSkeleton"');const n=s.bones,l=s.boneInverses;for(let h=0,c=n.length;h<c;h++){const p=n[h];e&&(t!=null&&t.has(p.name)||p.updateMatrix(),p.matrixWorld.multiplyMatrices(p.parent.matrixWorld,p.matrix)),this.multiplyBoneMatricesAt(r,h,p.matrixWorld,l[h])}this.boneTexture.enqueueUpdate(r)};B.prototype.multiplyBoneMatricesAt=function(r,e,t,s){const n=(r*this.skeleton.bones.length+e)*16,l=t.elements,h=s.elements,c=this.boneTexture._data,p=l[0],d=l[4],f=l[8],_=l[12],g=l[1],v=l[5],y=l[9],b=l[13],x=l[2],w=l[6],C=l[10],T=l[14],O=l[3],A=l[7],M=l[11],R=l[15],D=h[0],k=h[4],I=h[8],H=h[12],K=h[1],ee=h[5],q=h[9],z=h[13],U=h[2],ue=h[6],Te=h[10],Se=h[14],pe=h[3],Ce=h[7],W=h[11],Z=h[15];c[n+0]=p*D+d*K+f*U+_*pe,c[n+4]=p*k+d*ee+f*ue+_*Ce,c[n+8]=p*I+d*q+f*Te+_*W,c[n+12]=p*H+d*z+f*Se+_*Z,c[n+1]=g*D+v*K+y*U+b*pe,c[n+5]=g*k+v*ee+y*ue+b*Ce,c[n+9]=g*I+v*q+y*Te+b*W,c[n+13]=g*H+v*z+y*Se+b*Z,c[n+2]=x*D+w*K+C*U+T*pe,c[n+6]=x*k+w*ee+C*ue+T*Ce,c[n+10]=x*I+w*q+C*Te+T*W,c[n+14]=x*H+w*z+C*Se+T*Z,c[n+3]=O*D+A*K+M*U+R*pe,c[n+7]=O*k+A*ee+M*ue+R*Ce,c[n+11]=O*I+A*q+M*Te+R*W,c[n+15]=O*H+A*z+M*Se+R*Z};B.prototype.getUniformAt=function(r,e,t){if(!this.uniformsTexture)throw new Error(`Before get/set uniform, it's necessary to use "initUniformsPerInstance".`);return this.uniformsTexture.getUniformAt(r,e,t)};B.prototype.setUniformAt=function(r,e,t){if(!this.uniformsTexture)throw new Error(`Before get/set uniform, it's necessary to use "initUniformsPerInstance".`);this.uniformsTexture.setUniformAt(r,e,t),this.uniformsTexture.enqueueUpdate(r)};B.prototype.initUniformsPerInstance=function(r){if(!this._parentLOD){const{channels:e,pixelsPerInstance:t,uniformMap:s,fetchInFragmentShader:n}=this.getUniformSchemaResult(r);this.uniformsTexture=new dn(Float32Array,e,t,this._capacity,s,n),this.materialsNeedsUpdate()}};B.prototype.getUniformSchemaResult=function(r){let e=0;const t=new Map,s=[],n=r.vertex??{},l=r.fragment??{};let h=!0;for(const d in n){const f=n[d],_=this.getUniformSize(f);e+=_,s.push({name:d,type:f,size:_}),h=!1}for(const d in l)if(!n[d]){const f=l[d],_=this.getUniformSize(f);e+=_,s.push({name:d,type:f,size:_})}s.sort((d,f)=>f.size-d.size);const c=[];for(const{name:d,size:f,type:_}of s){const g=this.getUniformOffset(f,c);t.set(d,{offset:g,size:f,type:_})}const p=Math.ceil(e/4);return{channels:Math.min(e,4),pixelsPerInstance:p,uniformMap:t,fetchInFragmentShader:h}};B.prototype.getUniformOffset=function(r,e){if(r<4){for(let s=0;s<e.length;s++)if(e[s]+r<=4){const n=s*4+e[s];return e[s]+=r,n}}const t=e.length*4;for(;r>0;r-=4)e.push(r);return t};B.prototype.getUniformSize=function(r){switch(r){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;case"mat3":return 9;case"mat4":return 16;default:throw new Error(`Invalid uniform type: ${r}`)}};var Sm=`#ifdef USE_INSTANCING_INDIRECT\r
  attribute uint instanceIndex;\r
  uniform highp sampler2D matricesTexture;  

  mat4 getInstancedMatrix() {\r
    int size = textureSize( matricesTexture, 0 ).x;\r
    int j = int( instanceIndex ) * 4;\r
    int x = j % size;\r
    int y = j / size;\r
    vec4 v1 = texelFetch( matricesTexture, ivec2( x, y ), 0 );\r
    vec4 v2 = texelFetch( matricesTexture, ivec2( x + 1, y ), 0 );\r
    vec4 v3 = texelFetch( matricesTexture, ivec2( x + 2, y ), 0 );\r
    vec4 v4 = texelFetch( matricesTexture, ivec2( x + 3, y ), 0 );\r
    return mat4( v1, v2, v3, v4 );\r
  }\r
#endif`,Pm=`#ifdef USE_INSTANCING_COLOR_INDIRECT\r
  uniform highp sampler2D colorsTexture;

  #ifdef USE_COLOR_ALPHA\r
    vec4 getColorTexture() {\r
      int size = textureSize( colorsTexture, 0 ).x;\r
      int j = int( instanceIndex );\r
      int x = j % size;\r
      int y = j / size;\r
      return texelFetch( colorsTexture, ivec2( x, y ), 0 );\r
    }\r
  #else\r
    vec3 getColorTexture() {\r
      int size = textureSize( colorsTexture, 0 ).x;\r
      int j = int( instanceIndex );\r
      int x = j % size;\r
      int y = j / size;\r
      return texelFetch( colorsTexture, ivec2( x, y ), 0 ).rgb;\r
    }\r
  #endif\r
#endif`,Om=`#ifdef USE_INSTANCING_INDIRECT\r
  mat4 instanceMatrix = getInstancedMatrix();

  #ifdef USE_INSTANCING_COLOR_INDIRECT\r
    vColor *= getColorTexture();\r
  #endif\r
#endif`,Am=`#ifdef USE_INSTANCING_COLOR_INDIRECT\r
  #ifdef USE_VERTEX_COLOR\r
    vColor = color;\r
  #else\r
    #ifdef USE_COLOR_ALPHA\r
      vColor = vec4( 1.0 );\r
    #else\r
      vColor = vec3( 1.0 );\r
    #endif\r
  #endif\r
#endif`,Mm=`#ifdef USE_SKINNING\r
  uniform mat4 bindMatrix;\r
  uniform mat4 bindMatrixInverse;\r
  uniform highp sampler2D boneTexture;

  #ifdef USE_INSTANCING_SKINNING\r
    uniform int bonesPerInstance;\r
  #endif

  mat4 getBoneMatrix( const in float i ) {\r
    int size = textureSize( boneTexture, 0 ).x;

    #ifdef USE_INSTANCING_SKINNING\r
      int j = ( bonesPerInstance * int( instanceIndex ) + int( i ) ) * 4;\r
    #else\r
      int j = int( i ) * 4;\r
    #endif

    int x = j % size;\r
    int y = j / size;\r
    vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\r
    vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\r
    vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\r
    vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\r
    return mat4( v1, v2, v3, v4 );\r
  }\r
#endif`;fe.instanced_pars_vertex=Sm;fe.instanced_color_pars_vertex=Pm;fe.instanced_vertex=Om;fe.instanced_color_vertex=Am;function ho(r){return r.replace("#ifdef USE_INSTANCING","#if defined USE_INSTANCING || defined USE_INSTANCING_INDIRECT")}fe.project_vertex=ho(fe.project_vertex);fe.worldpos_vertex=ho(fe.worldpos_vertex);fe.defaultnormal_vertex=ho(fe.defaultnormal_vertex);fe.batching_pars_vertex=fe.batching_pars_vertex.concat(`
#include <instanced_pars_vertex>`);fe.color_pars_vertex=fe.color_pars_vertex.concat(`
#include <instanced_color_pars_vertex>`);fe.batching_vertex=fe.batching_vertex.concat(`
#include <instanced_vertex>`);fe.skinning_pars_vertex=Mm;fe.morphinstance_vertex&&(fe.morphinstance_vertex=fe.morphinstance_vertex.replaceAll("gl_InstanceID","instanceIndex"));var mr=1/1e3,Rm=1e3,Dm=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(r){typeof document<"u"&&document.hidden!==void 0&&(r?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=r)}get delta(){return this._delta*mr}get fixedDelta(){return this._fixedDelta*mr}set fixedDelta(r){this._fixedDelta=r*Rm}get elapsed(){return this._elapsed*mr}update(r){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(r!==void 0?r:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}getDelta(){return this.delta}getElapsed(){return this.elapsed}handleEvent(r){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},km=(()=>{const r=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),e=new Float32Array([0,0,2,0,0,2]),t=new vp;return t.setAttribute("position",new ma(r,3)),t.setAttribute("uv",new ma(e,2)),t})(),Je=class Nr{static get fullscreenGeometry(){return km}constructor(e="Pass",t=new tn,s=new wl){this.name=e,this.renderer=null,this.scene=t,this.camera=s,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){const t=this.fullscreenMaterial;t!==null&&(t.needsUpdate=!0),this.rtt=!e}}set mainScene(e){}set mainCamera(e){}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;t!==null?t.material=e:(t=new mn(Nr.fullscreenGeometry,e),t.frustumCulled=!1,this.scene===null&&(this.scene=new tn),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,t=vn){}render(e,t,s,n,l){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,s){}dispose(){for(const e of Object.keys(this)){const t=this[e];(t instanceof Bt||t instanceof Sl||t instanceof Pl||t instanceof Nr)&&this[e].dispose()}this.fullscreenMaterial!==null&&this.fullscreenMaterial.dispose()}},Lm=class extends Je{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(r,e,t,s,n){const l=r.state.buffers.stencil;l.setLocked(!1),l.setTest(!1)}},Um=`#ifdef COLOR_WRITE
#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#endif
#ifdef DEPTH_WRITE
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}
#endif
#ifdef USE_WEIGHTS
uniform vec4 channelWeights;
#endif
uniform float opacity;varying vec2 vUv;void main(){
#ifdef COLOR_WRITE
vec4 texel=texture2D(inputBuffer,vUv);
#ifdef USE_WEIGHTS
texel*=channelWeights;
#endif
gl_FragColor=opacity*texel;
#ifdef COLOR_SPACE_CONVERSION
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
#else
gl_FragColor=vec4(0.0);
#endif
#ifdef DEPTH_WRITE
gl_FragDepth=readDepth(vUv);
#endif
}`,Mh="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",Rh=class extends It{constructor(){super({name:"CopyMaterial",defines:{DEPTH_PACKING:"0",COLOR_WRITE:"1"},uniforms:{inputBuffer:new ie(null),depthBuffer:new ie(null),channelWeights:new ie(null),opacity:new ie(1)},blending:Ii,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Um,vertexShader:Mh}),this.depthFunc=gp}get inputBuffer(){return this.uniforms.inputBuffer.value}set inputBuffer(r){const e=r!==null;this.colorWrite!==e&&(e?this.defines.COLOR_WRITE=!0:delete this.defines.COLOR_WRITE,this.colorWrite=e,this.needsUpdate=!0),this.uniforms.inputBuffer.value=r}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(r){const e=r!==null;this.depthWrite!==e&&(e?this.defines.DEPTH_WRITE=!0:delete this.defines.DEPTH_WRITE,this.depthTest=e,this.depthWrite=e,this.needsUpdate=!0),this.uniforms.depthBuffer.value=r}set depthPacking(r){this.defines.DEPTH_PACKING=r.toFixed(0),this.needsUpdate=!0}get channelWeights(){return this.uniforms.channelWeights.value}set channelWeights(r){r!==null?(this.defines.USE_WEIGHTS="1",this.uniforms.channelWeights.value=r):delete this.defines.USE_WEIGHTS,this.needsUpdate=!0}setInputBuffer(r){this.uniforms.inputBuffer.value=r}getOpacity(r){return this.uniforms.opacity.value}setOpacity(r){this.uniforms.opacity.value=r}},Im=class extends Je{constructor(r,e=!0){super("CopyPass"),this.fullscreenMaterial=new Rh,this.needsSwap=!1,this.renderTarget=r,r===void 0&&(this.renderTarget=new Bt(1,1,{minFilter:en,magFilter:en,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=e}get resize(){return this.autoResize}set resize(r){this.autoResize=r}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(r){this.autoResize=r}render(r,e,t,s,n){this.fullscreenMaterial.inputBuffer=e.texture,r.setRenderTarget(this.renderToScreen?null:this.renderTarget),r.render(this.scene,this.camera)}setSize(r,e){this.autoResize&&this.renderTarget.setSize(r,e)}initialize(r,e,t){t!==void 0&&(this.renderTarget.texture.type=t,t!==si?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":r!==null&&r.outputColorSpace===xe&&(this.renderTarget.texture.colorSpace=xe))}},Ja=new us,Dh=class extends Je{constructor(r=!0,e=!0,t=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=r,this.depth=e,this.stencil=t,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(r,e,t){this.color=r,this.depth=e,this.stencil=t}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(r){this.overrideClearColor=r}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(r){this.overrideClearAlpha=r}render(r,e,t,s,n){const l=this.overrideClearColor,h=this.overrideClearAlpha,c=r.getClearAlpha(),p=l!==null,d=h>=0;p?(r.getClearColor(Ja),r.setClearColor(l,d?h:c)):d&&r.setClearAlpha(h),r.setRenderTarget(this.renderToScreen?null:e),r.clear(this.color,this.depth,this.stencil),p?r.setClearColor(Ja,c):d&&r.setClearAlpha(c)}},Bm=class extends Je{constructor(r,e){super("MaskPass",r,e),this.needsSwap=!1,this.clearPass=new Dh(!1,!1,!0),this.inverse=!1}set mainScene(r){this.scene=r}set mainCamera(r){this.camera=r}get inverted(){return this.inverse}set inverted(r){this.inverse=r}get clear(){return this.clearPass.enabled}set clear(r){this.clearPass.enabled=r}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(r){this.inverted=r}render(r,e,t,s,n){const l=r.getContext(),h=r.state.buffers,c=this.scene,p=this.camera,d=this.clearPass,f=this.inverted?0:1,_=1-f;h.color.setMask(!1),h.depth.setMask(!1),h.color.setLocked(!0),h.depth.setLocked(!0),h.stencil.setTest(!0),h.stencil.setOp(l.REPLACE,l.REPLACE,l.REPLACE),h.stencil.setFunc(l.ALWAYS,f,4294967295),h.stencil.setClear(_),h.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?d.render(r,null):(d.render(r,e),d.render(r,t))),this.renderToScreen?(r.setRenderTarget(null),r.render(c,p)):(r.setRenderTarget(e),r.render(c,p),r.setRenderTarget(t),r.render(c,p)),h.color.setLocked(!1),h.depth.setLocked(!1),h.stencil.setLocked(!1),h.stencil.setFunc(l.EQUAL,1,4294967295),h.stencil.setOp(l.KEEP,l.KEEP,l.KEEP),h.stencil.setLocked(!0)}},Fm=class{constructor(r=null,{depthBuffer:e=!0,stencilBuffer:t=!1,multisampling:s=0,frameBufferType:n}={}){this.renderer=null,this.inputBuffer=this.createBuffer(e,t,n,s),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new Im,this.depthTexture=null,this.passes=[],this.timer=new Dm,this.autoRenderToScreen=!0,this.setRenderer(r)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(r){const e=this.inputBuffer,t=this.multisampling;t>0&&r>0?(this.inputBuffer.samples=r,this.outputBuffer.samples=r,this.inputBuffer.dispose(),this.outputBuffer.dispose()):t!==r&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(e.depthBuffer,e.stencilBuffer,e.texture.type,r),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(r){if(this.renderer=r,r!==null){const e=r.getSize(new Ee),t=r.getContext().getContextAttributes().alpha,s=this.inputBuffer.texture.type;s===si&&r.outputColorSpace===xe&&(this.inputBuffer.texture.colorSpace=xe,this.outputBuffer.texture.colorSpace=xe,this.inputBuffer.dispose(),this.outputBuffer.dispose()),r.autoClear=!1,this.setSize(e.width,e.height);for(const n of this.passes)n.initialize(r,t,s)}}replaceRenderer(r,e=!0){const t=this.renderer,s=t.domElement.parentNode;return this.setRenderer(r),e&&s!==null&&(s.removeChild(t.domElement),s.appendChild(r.domElement)),t}createDepthTexture(){const r=this.depthTexture=new pp;return this.inputBuffer.depthTexture=r,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(r.format=fp,r.type=mp):r.type=yl,r}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const r of this.passes)r.setDepthTexture(null)}}createBuffer(r,e,t,s){const n=this.renderer,l=n===null?new Ee:n.getDrawingBufferSize(new Ee),h={minFilter:en,magFilter:en,stencilBuffer:e,depthBuffer:r,type:t},c=new Bt(l.width,l.height,h);return s>0&&(c.samples=s),t===si&&n!==null&&n.outputColorSpace===xe&&(c.texture.colorSpace=xe),c.texture.name="EffectComposer.Buffer",c.texture.generateMipmaps=!1,c}setMainScene(r){for(const e of this.passes)e.mainScene=r}setMainCamera(r){for(const e of this.passes)e.mainCamera=r}addPass(r,e){const t=this.passes,s=this.renderer,n=s.getDrawingBufferSize(new Ee),l=s.getContext().getContextAttributes().alpha,h=this.inputBuffer.texture.type;if(r.setRenderer(s),r.setSize(n.width,n.height),r.initialize(s,l,h),this.autoRenderToScreen&&(t.length>0&&(t[t.length-1].renderToScreen=!1),r.renderToScreen&&(this.autoRenderToScreen=!1)),e!==void 0?t.splice(e,0,r):t.push(r),this.autoRenderToScreen&&(t[t.length-1].renderToScreen=!0),r.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const c=this.createDepthTexture();for(r of t)r.setDepthTexture(c)}else r.setDepthTexture(this.depthTexture)}removePass(r){const e=this.passes,t=e.indexOf(r);if(t!==-1&&e.splice(t,1).length>0){if(this.depthTexture!==null){const l=(c,p)=>c||p.needsDepthTexture;e.reduce(l,!1)||(r.getDepthTexture()===this.depthTexture&&r.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&t===e.length&&(r.renderToScreen=!1,e.length>0&&(e[e.length-1].renderToScreen=!0))}}removeAllPasses(){const r=this.passes;this.deleteDepthTexture(),r.length>0&&(this.autoRenderToScreen&&(r[r.length-1].renderToScreen=!1),this.passes=[])}render(r){const e=this.renderer,t=this.copyPass;let s=this.inputBuffer,n=this.outputBuffer,l=!1,h,c,p;r===void 0&&(this.timer.update(),r=this.timer.getDelta());for(const d of this.passes)d.enabled&&(d.render(e,s,n,r,l),d.needsSwap&&(l&&(t.renderToScreen=d.renderToScreen,h=e.getContext(),c=e.state.buffers.stencil,c.setFunc(h.NOTEQUAL,1,4294967295),t.render(e,s,n,r,l),c.setFunc(h.EQUAL,1,4294967295)),p=s,s=n,n=p),d instanceof Bm?l=!0:d instanceof Lm&&(l=!1))}setSize(r,e,t){const s=this.renderer,n=s.getSize(new Ee);(r===void 0||e===void 0)&&(r=n.width,e=n.height),(n.width!==r||n.height!==e)&&s.setSize(r,e,t);const l=s.getDrawingBufferSize(new Ee);this.inputBuffer.setSize(l.width,l.height),this.outputBuffer.setSize(l.width,l.height);for(const h of this.passes)h.setSize(l.width,l.height)}reset(){this.dispose(),this.autoRenderToScreen=!0}dispose(){for(const r of this.passes)r.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose(),Je.fullscreenGeometry.dispose()}},ii={NONE:0,DEPTH:1,CONVOLUTION:2},J={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},Nm=class{constructor(){this.shaderParts=new Map([[J.FRAGMENT_HEAD,null],[J.FRAGMENT_MAIN_UV,null],[J.FRAGMENT_MAIN_IMAGE,null],[J.VERTEX_HEAD,null],[J.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=ii.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=Tl}},_r=!1,el=class{constructor(r=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(r),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let t;if(e.material.flatShading)switch(e.material.side){case Hs:t=this.materialsFlatShadedDoubleSide;break;case zs:t=this.materialsFlatShadedBackSide;break;default:t=this.materialsFlatShaded;break}else switch(e.material.side){case Hs:t=this.materialsDoubleSide;break;case zs:t=this.materialsBackSide;break;default:t=this.materials;break}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=t[2]:e.isInstancedMesh?e.material=t[1]:e.material=t[0],++this.meshCount}}}cloneMaterial(r){if(!(r instanceof It))return r.clone();const e=r.uniforms,t=new Map;for(const n in e){const l=e[n].value;l.isRenderTargetTexture&&(e[n].value=null,t.set(n,l))}const s=r.clone();for(const n of t)e[n[0]].value=n[1],s.uniforms[n[0]].value=n[1];return s}setMaterial(r){if(this.disposeMaterials(),this.material=r,r!==null){const e=this.materials=[this.cloneMaterial(r),this.cloneMaterial(r),this.cloneMaterial(r)];for(const t of e)t.uniforms=Object.assign({},r.uniforms),t.side=_p;e[2].skinning=!0,this.materialsBackSide=e.map(t=>{const s=this.cloneMaterial(t);return s.uniforms=Object.assign({},r.uniforms),s.side=zs,s}),this.materialsDoubleSide=e.map(t=>{const s=this.cloneMaterial(t);return s.uniforms=Object.assign({},r.uniforms),s.side=Hs,s}),this.materialsFlatShaded=e.map(t=>{const s=this.cloneMaterial(t);return s.uniforms=Object.assign({},r.uniforms),s.flatShading=!0,s}),this.materialsFlatShadedBackSide=e.map(t=>{const s=this.cloneMaterial(t);return s.uniforms=Object.assign({},r.uniforms),s.flatShading=!0,s.side=zs,s}),this.materialsFlatShadedDoubleSide=e.map(t=>{const s=this.cloneMaterial(t);return s.uniforms=Object.assign({},r.uniforms),s.flatShading=!0,s.side=Hs,s})}}render(r,e,t){const s=r.shadowMap.enabled;if(r.shadowMap.enabled=!1,_r){const n=this.originalMaterials;this.meshCount=0,e.traverse(this.replaceMaterial),r.render(e,t);for(const l of n)l[0].material=l[1];this.meshCount!==n.size&&n.clear()}else{const n=e.overrideMaterial;e.overrideMaterial=this.material,r.render(e,t),e.overrideMaterial=n}r.shadowMap.enabled=s}disposeMaterials(){if(this.material!==null){const r=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const e of r)e.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return _r}static set workaroundEnabled(r){_r=r}},Et=-1,at=class extends Yr{constructor(r,e=Et,t=Et,s=1){super(),this.resizable=r,this.baseSize=new Ee(1,1),this.preferredSize=new Ee(e,t),this.target=this.preferredSize,this.s=s,this.effectiveSize=new Ee,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const r=this.baseSize,e=this.preferredSize,t=this.effectiveSize,s=this.scale;e.width!==Et?t.width=e.width:e.height!==Et?t.width=Math.round(e.height*(r.width/Math.max(r.height,1))):t.width=Math.round(r.width*s),e.height!==Et?t.height=e.height:e.width!==Et?t.height=Math.round(e.width/Math.max(r.width/Math.max(r.height,1),1)):t.height=Math.round(r.height*s)}get width(){return this.effectiveSize.width}set width(r){this.preferredWidth=r}get height(){return this.effectiveSize.height}set height(r){this.preferredHeight=r}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(r){this.s!==r&&(this.s=r,this.preferredSize.setScalar(Et),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(r){this.scale=r}get baseWidth(){return this.baseSize.width}set baseWidth(r){this.baseSize.width!==r&&(this.baseSize.width=r,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(r){this.baseWidth=r}get baseHeight(){return this.baseSize.height}set baseHeight(r){this.baseSize.height!==r&&(this.baseSize.height=r,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(r){this.baseHeight=r}setBaseSize(r,e){(this.baseSize.width!==r||this.baseSize.height!==e)&&(this.baseSize.set(r,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(r){this.preferredSize.width!==r&&(this.preferredSize.width=r,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(r){this.preferredWidth=r}get preferredHeight(){return this.preferredSize.height}set preferredHeight(r){this.preferredSize.height!==r&&(this.preferredSize.height=r,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(r){this.preferredHeight=r}setPreferredSize(r,e){(this.preferredSize.width!==r||this.preferredSize.height!==e)&&(this.preferredSize.set(r,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(r){this.s=r.scale,this.baseSize.set(r.baseWidth,r.baseHeight),this.preferredSize.set(r.preferredWidth,r.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return Et}},j={ADD:0,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},Vm="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb+y.rgb,y.a),y.a*opacity);}",zm="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4((x.rgb+y.rgb)*0.5,y.a),y.a*opacity);}",Hm="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.xy,xHSL.z));return mix(x,vec4(z,y.a),y.a*opacity);}",Gm="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=x.rgb,b=y.rgb;vec3 z=mix(step(0.0,b)*(1.0-min(vec3(1.0),(1.0-a)/b)),vec3(1.0),step(1.0,a));return mix(x,vec4(z,y.a),y.a*opacity);}",jm="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=x.rgb,b=y.rgb;vec3 z=step(0.0,a)*mix(min(vec3(1.0),a/max(1.0-b,1e-9)),vec3(1.0),step(1.0,b));return mix(x,vec4(z,y.a),y.a*opacity);}",Km="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(min(x.rgb,y.rgb),y.a),y.a*opacity);}",Ym="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(abs(x.rgb-y.rgb),y.a),y.a*opacity);}",$m="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb/max(y.rgb,1e-12),y.a),y.a*opacity);}",qm="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4((x.rgb+y.rgb-2.0*x.rgb*y.rgb),y.a),y.a*opacity);}",Wm="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=min(x.rgb,1.0);vec3 b=min(y.rgb,1.0);vec3 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,b));return mix(x,vec4(z,y.a),y.a*opacity);}",Zm="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(step(1.0,x.rgb+y.rgb),y.a),y.a*opacity);}",Xm="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.x,xHSL.yz));return mix(x,vec4(z,y.a),y.a*opacity);}",Qm="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(1.0-y.rgb,y.a),y.a*opacity);}",Jm="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(y.rgb*(1.0-x.rgb),y.a),y.a*opacity);}",e_="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(max(x.rgb,y.rgb),y.a),y.a*opacity);}",t_="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(clamp(y.rgb+x.rgb-1.0,0.0,1.0),y.a),y.a*opacity);}",i_="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(min(x.rgb+y.rgb,1.0),y.a),y.a*opacity);}",s_="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(clamp(2.0*y.rgb+x.rgb-1.0,0.0,1.0),y.a),y.a*opacity);}",n_="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.xy,yHSL.z));return mix(x,vec4(z,y.a),y.a*opacity);}",r_="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb*y.rgb,y.a),y.a*opacity);}",o_="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(1.0-abs(1.0-x.rgb-y.rgb),y.a),y.a*opacity);}",a_="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,y.a*opacity);}",l_="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 z=mix(2.0*y.rgb*x.rgb,1.0-2.0*(1.0-y.rgb)*(1.0-x.rgb),step(0.5,x.rgb));return mix(x,vec4(z,y.a),y.a*opacity);}",h_="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 y2=2.0*y.rgb;vec3 z=mix(mix(y2,x.rgb,step(0.5*x.rgb,y.rgb)),max(y2-1.0,vec3(0.0)),step(x.rgb,y2-1.0));return mix(x,vec4(z,y.a),y.a*opacity);}",c_="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 z=mix(min(x.rgb*x.rgb/max(1.0-y.rgb,1e-12),1.0),y.rgb,step(1.0,y.rgb));return mix(x,vec4(z,y.a),y.a*opacity);}",u_="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.x,yHSL.y,xHSL.z));return mix(x,vec4(z,y.a),y.a*opacity);}",d_="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb+y.rgb-min(x.rgb*y.rgb,1.0),y.a),y.a*opacity);}",p_="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=x.rgb;vec3 b=y.rgb;vec3 y2=2.0*b;vec3 w=step(0.5,b);vec3 c=a-(1.0-y2)*a*(1.0-a);vec3 d=mix(a+(y2-1.0)*(sqrt(a)-a),a+(y2-1.0)*a*((16.0*a-12.0)*a+3.0),w*(1.0-step(0.25,a)));vec3 z=mix(c,d,w);return mix(x,vec4(z,y.a),y.a*opacity);}",f_="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}",m_="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(max(x.rgb+y.rgb-1.0,0.0),y.a),y.a*opacity);}",__="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 z=mix(max(1.0-min((1.0-x.rgb)/(2.0*y.rgb),1.0),0.0),min(x.rgb/(2.0*(1.0-y.rgb)),1.0),step(0.5,y.rgb));return mix(x,vec4(z,y.a),y.a*opacity);}",v_=new Map([[j.ADD,Vm],[j.AVERAGE,zm],[j.COLOR,Hm],[j.COLOR_BURN,Gm],[j.COLOR_DODGE,jm],[j.DARKEN,Km],[j.DIFFERENCE,Ym],[j.DIVIDE,$m],[j.DST,null],[j.EXCLUSION,qm],[j.HARD_LIGHT,Wm],[j.HARD_MIX,Zm],[j.HUE,Xm],[j.INVERT,Qm],[j.INVERT_RGB,Jm],[j.LIGHTEN,e_],[j.LINEAR_BURN,t_],[j.LINEAR_DODGE,i_],[j.LINEAR_LIGHT,s_],[j.LUMINOSITY,n_],[j.MULTIPLY,r_],[j.NEGATION,o_],[j.NORMAL,a_],[j.OVERLAY,l_],[j.PIN_LIGHT,h_],[j.REFLECT,c_],[j.SATURATION,u_],[j.SCREEN,d_],[j.SOFT_LIGHT,p_],[j.SRC,f_],[j.SUBTRACT,m_],[j.VIVID_LIGHT,__]]),g_=class extends Yr{constructor(r,e=1){super(),this._blendFunction=r,this.opacity=new ie(e)}getOpacity(){return this.opacity.value}setOpacity(r){this.opacity.value=r}get blendFunction(){return this._blendFunction}set blendFunction(r){this._blendFunction=r,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(r){this.blendFunction=r}getShaderCode(){return v_.get(this.blendFunction)}},kh=class extends Yr{constructor(r,e,{attributes:t=ii.NONE,blendFunction:s=j.NORMAL,defines:n=new Map,uniforms:l=new Map,extensions:h=null,vertexShader:c=null}={}){super(),this.name=r,this.renderer=null,this.attributes=t,this.fragmentShader=e,this.vertexShader=c,this.defines=n,this.uniforms=l,this.extensions=h,this.blendMode=new g_(s),this.blendMode.addEventListener("change",p=>this.setChanged()),this._inputColorSpace=Tl,this._outputColorSpace=Js}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(r){this._inputColorSpace=r,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(r){this._outputColorSpace=r,this.setChanged()}set mainScene(r){}set mainCamera(r){}getName(){return this.name}setRenderer(r){this.renderer=r}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(r){this.attributes=r,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(r){this.fragmentShader=r,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(r){this.vertexShader=r,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(r,e=vn){}update(r,e,t){}setSize(r,e){}initialize(r,e,t){}dispose(){for(const r of Object.keys(this)){const e=this[r];(e instanceof Bt||e instanceof Sl||e instanceof Pl||e instanceof Je)&&this[r].dispose()}}},co={MEDIUM:2,LARGE:3},b_=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,x_="uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",y_=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],w_=class extends It{constructor(r=new _a){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new ie(null),texelSize:new ie(new _a),scale:new ie(1),kernel:new ie(0)},blending:Ii,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:b_,vertexShader:x_}),this.setTexelSize(r.x,r.y),this.kernelSize=co.MEDIUM}set inputBuffer(r){this.uniforms.inputBuffer.value=r}setInputBuffer(r){this.inputBuffer=r}get kernelSequence(){return y_[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(r){this.uniforms.scale.value=r}getScale(){return this.uniforms.scale.value}setScale(r){this.uniforms.scale.value=r}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(r){this.uniforms.kernel.value=r}setKernel(r){this.kernel=r}setTexelSize(r,e){this.uniforms.texelSize.value.set(r,e,r*.5,e*.5)}setSize(r,e){const t=1/r,s=1/e;this.uniforms.texelSize.value.set(t,s,t*.5,s*.5)}},C_=class extends Je{constructor({kernelSize:r=co.MEDIUM,resolutionScale:e=.5,width:t=at.AUTO_SIZE,height:s=at.AUTO_SIZE,resolutionX:n=t,resolutionY:l=s}={}){super("KawaseBlurPass"),this.renderTargetA=new Bt(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const h=this.resolution=new at(this,n,l,e);h.addEventListener("change",c=>this.setSize(h.baseWidth,h.baseHeight)),this._blurMaterial=new w_,this._blurMaterial.kernelSize=r,this.copyMaterial=new Rh}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(r){this._blurMaterial=r}get dithering(){return this.copyMaterial.dithering}set dithering(r){this.copyMaterial.dithering=r}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(r){this.blurMaterial.kernelSize=r}get width(){return this.resolution.width}set width(r){this.resolution.preferredWidth=r}get height(){return this.resolution.height}set height(r){this.resolution.preferredHeight=r}get scale(){return this.blurMaterial.scale}set scale(r){this.blurMaterial.scale=r}getScale(){return this.blurMaterial.scale}setScale(r){this.blurMaterial.scale=r}getKernelSize(){return this.kernelSize}setKernelSize(r){this.kernelSize=r}getResolutionScale(){return this.resolution.scale}setResolutionScale(r){this.resolution.scale=r}render(r,e,t,s,n){const l=this.scene,h=this.camera,c=this.renderTargetA,p=this.renderTargetB,d=this.blurMaterial,f=d.kernelSequence;let _=e;this.fullscreenMaterial=d;for(let g=0,v=f.length;g<v;++g){const y=(g&1)===0?c:p;d.kernel=f[g],d.inputBuffer=_.texture,r.setRenderTarget(y),r.render(l,h),_=y}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=_.texture,r.setRenderTarget(this.renderToScreen?null:t),r.render(l,h)}setSize(r,e){const t=this.resolution;t.setBaseSize(r,e);const s=t.width,n=t.height;this.renderTargetA.setSize(s,n),this.renderTargetB.setSize(s,n),this.blurMaterial.setSize(r,e)}initialize(r,e,t){t!==void 0&&(this.renderTargetA.texture.type=t,this.renderTargetB.texture.type=t,t!==si?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):r!==null&&r.outputColorSpace===xe&&(this.renderTargetA.texture.colorSpace=xe,this.renderTargetB.texture.colorSpace=xe))}static get AUTO_SIZE(){return at.AUTO_SIZE}},E_=`#include <common>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);float mask=1.0;
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);mask=low*high;
#elif defined(THRESHOLD)
mask=smoothstep(threshold,threshold+smoothing,l);
#endif
#ifdef COLOR
gl_FragColor=texel*mask;
#else
gl_FragColor=vec4(l*mask);
#endif
}`,T_=class extends It{constructor(r=!1,e=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:Cl.replace(/\D+/g,"")},uniforms:{inputBuffer:new ie(null),threshold:new ie(0),smoothing:new ie(1),range:new ie(null)},blending:Ii,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:E_,vertexShader:Mh}),this.colorOutput=r,this.luminanceRange=e}set inputBuffer(r){this.uniforms.inputBuffer.value=r}setInputBuffer(r){this.uniforms.inputBuffer.value=r}get threshold(){return this.uniforms.threshold.value}set threshold(r){this.smoothing>0||r>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=r}getThreshold(){return this.threshold}setThreshold(r){this.threshold=r}get smoothing(){return this.uniforms.smoothing.value}set smoothing(r){this.threshold>0||r>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=r}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(r){this.smoothing=r}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(r){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(r){r?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(r){return this.colorOutput}setColorOutputEnabled(r){this.colorOutput=r}get useRange(){return this.luminanceRange!==null}set useRange(r){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(r){r!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=r,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(r){this.luminanceRange=r}},S_=class extends Je{constructor({renderTarget:r,luminanceRange:e,colorOutput:t,resolutionScale:s=1,width:n=at.AUTO_SIZE,height:l=at.AUTO_SIZE,resolutionX:h=n,resolutionY:c=l}={}){super("LuminancePass"),this.fullscreenMaterial=new T_(t,e),this.needsSwap=!1,this.renderTarget=r,this.renderTarget===void 0&&(this.renderTarget=new Bt(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target");const p=this.resolution=new at(this,h,c,s);p.addEventListener("change",d=>this.setSize(p.baseWidth,p.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(r,e,t,s,n){const l=this.fullscreenMaterial;l.inputBuffer=e.texture,r.setRenderTarget(this.renderToScreen?null:this.renderTarget),r.render(this.scene,this.camera)}setSize(r,e){const t=this.resolution;t.setBaseSize(r,e),this.renderTarget.setSize(t.width,t.height)}initialize(r,e,t){t!==void 0&&t!==si&&(this.renderTarget.texture.type=t,this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},P_=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#define WEIGHT_INNER 0.125
#define WEIGHT_OUTER 0.0555555
varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;float clampToBorder(const in vec2 uv){return float(uv.s>=0.0&&uv.s<=1.0&&uv.t>=0.0&&uv.t<=1.0);}void main(){vec4 c=vec4(0.0);vec4 w=WEIGHT_INNER*vec4(clampToBorder(vUv00),clampToBorder(vUv01),clampToBorder(vUv02),clampToBorder(vUv03));c+=w.x*texture2D(inputBuffer,vUv00);c+=w.y*texture2D(inputBuffer,vUv01);c+=w.z*texture2D(inputBuffer,vUv02);c+=w.w*texture2D(inputBuffer,vUv03);w=WEIGHT_OUTER*vec4(clampToBorder(vUv04),clampToBorder(vUv05),clampToBorder(vUv06),clampToBorder(vUv07));c+=w.x*texture2D(inputBuffer,vUv04);c+=w.y*texture2D(inputBuffer,vUv05);c+=w.z*texture2D(inputBuffer,vUv06);c+=w.w*texture2D(inputBuffer,vUv07);w=WEIGHT_OUTER*vec4(clampToBorder(vUv08),clampToBorder(vUv09),clampToBorder(vUv10),clampToBorder(vUv11));c+=w.x*texture2D(inputBuffer,vUv08);c+=w.y*texture2D(inputBuffer,vUv09);c+=w.z*texture2D(inputBuffer,vUv10);c+=w.w*texture2D(inputBuffer,vUv11);c+=WEIGHT_OUTER*texture2D(inputBuffer,vUv);gl_FragColor=c;
#include <colorspace_fragment>
}`,O_="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;void main(){vUv=position.xy*0.5+0.5;vUv00=vUv+texelSize*vec2(-1.0,1.0);vUv01=vUv+texelSize*vec2(1.0,1.0);vUv02=vUv+texelSize*vec2(-1.0,-1.0);vUv03=vUv+texelSize*vec2(1.0,-1.0);vUv04=vUv+texelSize*vec2(-2.0,2.0);vUv05=vUv+texelSize*vec2(0.0,2.0);vUv06=vUv+texelSize*vec2(2.0,2.0);vUv07=vUv+texelSize*vec2(-2.0,0.0);vUv08=vUv+texelSize*vec2(2.0,0.0);vUv09=vUv+texelSize*vec2(-2.0,-2.0);vUv10=vUv+texelSize*vec2(0.0,-2.0);vUv11=vUv+texelSize*vec2(2.0,-2.0);gl_Position=vec4(position.xy,1.0,1.0);}",A_=class extends It{constructor(){super({name:"DownsamplingMaterial",uniforms:{inputBuffer:new ie(null),texelSize:new ie(new Ee)},blending:Ii,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:P_,vertexShader:O_})}set inputBuffer(r){this.uniforms.inputBuffer.value=r}setSize(r,e){this.uniforms.texelSize.value.set(1/r,1/e)}},M_=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;uniform mediump sampler2D supportBuffer;
#else
uniform lowp sampler2D inputBuffer;uniform lowp sampler2D supportBuffer;
#endif
uniform float radius;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vec4 c=vec4(0.0);c+=texture2D(inputBuffer,vUv0)*0.0625;c+=texture2D(inputBuffer,vUv1)*0.125;c+=texture2D(inputBuffer,vUv2)*0.0625;c+=texture2D(inputBuffer,vUv3)*0.125;c+=texture2D(inputBuffer,vUv)*0.25;c+=texture2D(inputBuffer,vUv4)*0.125;c+=texture2D(inputBuffer,vUv5)*0.0625;c+=texture2D(inputBuffer,vUv6)*0.125;c+=texture2D(inputBuffer,vUv7)*0.0625;vec4 baseColor=texture2D(supportBuffer,vUv);gl_FragColor=mix(baseColor,c,radius);
#include <colorspace_fragment>
}`,R_="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,1.0);vUv1=vUv+texelSize*vec2(0.0,1.0);vUv2=vUv+texelSize*vec2(1.0,1.0);vUv3=vUv+texelSize*vec2(-1.0,0.0);vUv4=vUv+texelSize*vec2(1.0,0.0);vUv5=vUv+texelSize*vec2(-1.0,-1.0);vUv6=vUv+texelSize*vec2(0.0,-1.0);vUv7=vUv+texelSize*vec2(1.0,-1.0);gl_Position=vec4(position.xy,1.0,1.0);}",D_=class extends It{constructor(){super({name:"UpsamplingMaterial",uniforms:{inputBuffer:new ie(null),supportBuffer:new ie(null),texelSize:new ie(new Ee),radius:new ie(.85)},blending:Ii,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:M_,vertexShader:R_})}set inputBuffer(r){this.uniforms.inputBuffer.value=r}set supportBuffer(r){this.uniforms.supportBuffer.value=r}get radius(){return this.uniforms.radius.value}set radius(r){this.uniforms.radius.value=r}setSize(r,e){this.uniforms.texelSize.value.set(1/r,1/e)}},k_=class extends Je{constructor(){super("MipmapBlurPass"),this.needsSwap=!1,this.renderTarget=new Bt(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Upsampling.Mipmap0",this.downsamplingMipmaps=[],this.upsamplingMipmaps=[],this.downsamplingMaterial=new A_,this.upsamplingMaterial=new D_,this.resolution=new Ee}get texture(){return this.renderTarget.texture}get levels(){return this.downsamplingMipmaps.length}set levels(r){if(this.levels!==r){const e=this.renderTarget;this.dispose(),this.downsamplingMipmaps=[],this.upsamplingMipmaps=[];for(let t=0;t<r;++t){const s=e.clone();s.texture.name="Downsampling.Mipmap"+t,this.downsamplingMipmaps.push(s)}this.upsamplingMipmaps.push(e);for(let t=1,s=r-1;t<s;++t){const n=e.clone();n.texture.name="Upsampling.Mipmap"+t,this.upsamplingMipmaps.push(n)}this.setSize(this.resolution.x,this.resolution.y)}}get radius(){return this.upsamplingMaterial.radius}set radius(r){this.upsamplingMaterial.radius=r}render(r,e,t,s,n){const{scene:l,camera:h}=this,{downsamplingMaterial:c,upsamplingMaterial:p}=this,{downsamplingMipmaps:d,upsamplingMipmaps:f}=this;let _=e;this.fullscreenMaterial=c;for(let g=0,v=d.length;g<v;++g){const y=d[g];c.setSize(_.width,_.height),c.inputBuffer=_.texture,r.setRenderTarget(y),r.render(l,h),_=y}this.fullscreenMaterial=p;for(let g=f.length-1;g>=0;--g){const v=f[g];p.setSize(_.width,_.height),p.inputBuffer=_.texture,p.supportBuffer=d[g].texture,r.setRenderTarget(v),r.render(l,h),_=v}}setSize(r,e){const t=this.resolution;t.set(r,e);let s=t.width,n=t.height;for(let l=0,h=this.downsamplingMipmaps.length;l<h;++l)s=Math.round(s*.5),n=Math.round(n*.5),this.downsamplingMipmaps[l].setSize(s,n),l<this.upsamplingMipmaps.length&&this.upsamplingMipmaps[l].setSize(s,n)}initialize(r,e,t){if(t!==void 0){const s=this.downsamplingMipmaps.concat(this.upsamplingMipmaps);for(const n of s)n.texture.type=t;if(t!==si)this.downsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.upsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1";else if(r!==null&&r.outputColorSpace===xe)for(const n of s)n.texture.colorSpace=xe}}dispose(){super.dispose();for(const r of this.downsamplingMipmaps.concat(this.upsamplingMipmaps))r.dispose()}},L_=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 texel=texture2D(map,uv);outputColor=vec4(texel.rgb*intensity,max(inputColor.a,texel.a));}`,U_=class extends kh{constructor({blendFunction:r=j.SCREEN,luminanceThreshold:e=1,luminanceSmoothing:t=.03,mipmapBlur:s=!0,intensity:n=1,radius:l=.85,levels:h=8,kernelSize:c=co.LARGE,resolutionScale:p=.5,width:d=at.AUTO_SIZE,height:f=at.AUTO_SIZE,resolutionX:_=d,resolutionY:g=f}={}){super("BloomEffect",L_,{blendFunction:r,uniforms:new Map([["map",new ie(null)],["intensity",new ie(n)]])}),this.renderTarget=new Bt(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.blurPass=new C_({kernelSize:c}),this.luminancePass=new S_({colorOutput:!0}),this.luminanceMaterial.threshold=e,this.luminanceMaterial.smoothing=t,this.mipmapBlurPass=new k_,this.mipmapBlurPass.enabled=s,this.mipmapBlurPass.radius=l,this.mipmapBlurPass.levels=h,this.uniforms.get("map").value=s?this.mipmapBlurPass.texture:this.renderTarget.texture;const v=this.resolution=new at(this,_,g,p);v.addEventListener("change",y=>this.setSize(v.baseWidth,v.baseHeight))}get texture(){return this.mipmapBlurPass.enabled?this.mipmapBlurPass.texture:this.renderTarget.texture}getTexture(){return this.texture}getResolution(){return this.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(r){this.resolution.preferredWidth=r}get height(){return this.resolution.height}set height(r){this.resolution.preferredHeight=r}get dithering(){return this.blurPass.dithering}set dithering(r){this.blurPass.dithering=r}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(r){this.blurPass.kernelSize=r}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(r){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(r){this.uniforms.get("intensity").value=r}getIntensity(){return this.intensity}setIntensity(r){this.intensity=r}getResolutionScale(){return this.resolution.scale}setResolutionScale(r){this.resolution.scale=r}update(r,e,t){const s=this.renderTarget,n=this.luminancePass;n.enabled?(n.render(r,e),this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(r,n.renderTarget):this.blurPass.render(r,n.renderTarget,s)):this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(r,e):this.blurPass.render(r,e,s)}setSize(r,e){const t=this.resolution;t.setBaseSize(r,e),this.renderTarget.setSize(t.width,t.height),this.blurPass.resolution.copy(t),this.luminancePass.setSize(r,e),this.mipmapBlurPass.setSize(r,e)}initialize(r,e,t){this.blurPass.initialize(r,e,t),this.luminancePass.initialize(r,e,t),this.mipmapBlurPass.initialize(r,e,t),t!==void 0&&(this.renderTarget.texture.type=t,r!==null&&r.outputColorSpace===xe&&(this.renderTarget.texture.colorSpace=xe))}},I_=class extends Je{constructor(r,e,t=null){super("RenderPass",r,e),this.needsSwap=!1,this.clearPass=new Dh,this.overrideMaterialManager=t===null?null:new el(t),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(r){this.scene=r}set mainCamera(r){this.camera=r}get renderToScreen(){return super.renderToScreen}set renderToScreen(r){super.renderToScreen=r,this.clearPass.renderToScreen=r}get overrideMaterial(){const r=this.overrideMaterialManager;return r!==null?r.material:null}set overrideMaterial(r){const e=this.overrideMaterialManager;r!==null?e!==null?e.setMaterial(r):this.overrideMaterialManager=new el(r):e!==null&&(e.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(r){this.overrideMaterial=r}get clear(){return this.clearPass.enabled}set clear(r){this.clearPass.enabled=r}getSelection(){return this.selection}setSelection(r){this.selection=r}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(r){this.ignoreBackground=r}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(r){this.skipShadowMapUpdate=r}getClearPass(){return this.clearPass}render(r,e,t,s,n){const l=this.scene,h=this.camera,c=this.selection,p=h.layers.mask,d=l.background,f=r.shadowMap.autoUpdate,_=this.renderToScreen?null:e;c!==null&&h.layers.set(c.getLayer()),this.skipShadowMapUpdate&&(r.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(l.background=null),this.clearPass.enabled&&this.clearPass.render(r,e),r.setRenderTarget(_),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(r,l,h):r.render(l,h),h.layers.mask=p,l.background=d,r.shadowMap.autoUpdate=f}},B_=`uniform float count;
#ifdef SCROLL
uniform float scrollSpeed;
#endif
void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){float y=uv.y;
#ifdef SCROLL
y+=time*scrollSpeed;
#endif
vec2 sl=vec2(sin(y*count),cos(y*count));outputColor=vec4(sl.xyx,inputColor.a);}`,F_=class extends kh{constructor({blendFunction:r=j.OVERLAY,density:e=1.25,scrollSpeed:t=0}={}){super("ScanlineEffect",B_,{blendFunction:r,uniforms:new Map([["count",new ie(0)],["scrollSpeed",new ie(0)]])}),this.resolution=new Ee,this.d=e,this.scrollSpeed=t}get density(){return this.d}set density(r){this.d=r,this.setSize(this.resolution.width,this.resolution.height)}getDensity(){return this.density}setDensity(r){this.density=r}get scrollSpeed(){return this.uniforms.get("scrollSpeed").value}set scrollSpeed(r){this.uniforms.get("scrollSpeed").value=r,r===0?this.defines.delete("SCROLL")&&this.setChanged():this.defines.has("SCROLL")||(this.defines.set("SCROLL","1"),this.setChanged())}setSize(r,e){this.resolution.set(r,e),this.uniforms.get("count").value=Math.round(e*this.density)}},N_=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
float depth=unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
float depth=texture2D(depthBuffer,uv).r;
#endif
#if defined(USE_LOGARITHMIC_DEPTH_BUFFER) || defined(LOG_DEPTH)
float d=pow(2.0,depth*log2(cameraFar+1.0))-1.0;float a=cameraFar/(cameraFar-cameraNear);float b=cameraFar*cameraNear/(cameraNear-cameraFar);depth=a+b/d;
#elif defined(USE_REVERSED_DEPTH_BUFFER)
depth=1.0-depth;
#endif
return depth;}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,V_="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",z_=class extends It{constructor(r,e,t,s,n=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:Cl.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new ie(null),depthBuffer:new ie(null),resolution:new ie(new Ee),texelSize:new ie(new Ee),cameraNear:new ie(.3),cameraFar:new ie(1e3),aspect:new ie(1),time:new ie(0)},blending:Ii,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:n}),r&&this.setShaderParts(r),e&&this.setDefines(e),t&&this.setUniforms(t),this.copyCameraSettings(s)}set inputBuffer(r){this.uniforms.inputBuffer.value=r}setInputBuffer(r){this.uniforms.inputBuffer.value=r}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(r){this.uniforms.depthBuffer.value=r}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(r){this.defines.DEPTH_PACKING=r.toFixed(0),this.needsUpdate=!0}setDepthBuffer(r,e=vn){this.depthBuffer=r,this.depthPacking=e}setShaderData(r){this.setShaderParts(r.shaderParts),this.setDefines(r.defines),this.setUniforms(r.uniforms),this.setExtensions(r.extensions)}setShaderParts(r){return this.fragmentShader=N_.replace(J.FRAGMENT_HEAD,r.get(J.FRAGMENT_HEAD)||"").replace(J.FRAGMENT_MAIN_UV,r.get(J.FRAGMENT_MAIN_UV)||"").replace(J.FRAGMENT_MAIN_IMAGE,r.get(J.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=V_.replace(J.VERTEX_HEAD,r.get(J.VERTEX_HEAD)||"").replace(J.VERTEX_MAIN_SUPPORT,r.get(J.VERTEX_MAIN_SUPPORT)||""),this.needsUpdate=!0,this}setDefines(r){for(const e of r.entries())this.defines[e[0]]=e[1];return this.needsUpdate=!0,this}setUniforms(r){for(const e of r.entries())this.uniforms[e[0]]=e[1];return this}setExtensions(r){this.extensions={};for(const e of r)this.extensions[e]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(r){this.encodeOutput!==r&&(r?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(r){return this.encodeOutput}setOutputEncodingEnabled(r){this.encodeOutput=r}get time(){return this.uniforms.time.value}set time(r){this.uniforms.time.value=r}setDeltaTime(r){this.uniforms.time.value+=r}adoptCameraSettings(r){this.copyCameraSettings(r)}copyCameraSettings(r){r&&(this.uniforms.cameraNear.value=r.near,this.uniforms.cameraFar.value=r.far,r instanceof El?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(r,e){const t=this.uniforms;t.resolution.value.set(r,e),t.texelSize.value.set(1/r,1/e),t.aspect.value=r/e}static get Section(){return J}};function tl(r,e,t){for(const s of e){const n="$1"+r+s.charAt(0).toUpperCase()+s.slice(1),l=new RegExp("([^\\.])(\\b"+s+"\\b)","g");for(const h of t.entries())h[1]!==null&&t.set(h[0],h[1].replace(l,n))}}function H_(r,e,t){let s=e.getFragmentShader(),n=e.getVertexShader();const l=s!==void 0&&/mainImage/.test(s),h=s!==void 0&&/mainUv/.test(s);if(t.attributes|=e.getAttributes(),s===void 0)throw new Error(`Missing fragment shader (${e.name})`);if(h&&(t.attributes&ii.CONVOLUTION)!==0)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${e.name})`);if(!l&&!h)throw new Error(`Could not find mainImage or mainUv function (${e.name})`);{const c=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,p=t.shaderParts;let d=p.get(J.FRAGMENT_HEAD)||"",f=p.get(J.FRAGMENT_MAIN_UV)||"",_=p.get(J.FRAGMENT_MAIN_IMAGE)||"",g=p.get(J.VERTEX_HEAD)||"",v=p.get(J.VERTEX_MAIN_SUPPORT)||"";const y=new Set,b=new Set;if(h&&(f+=`	${r}MainUv(UV);
`,t.uvTransformation=!0),n!==null&&/mainSupport/.test(n)){const C=/mainSupport *\([\w\s]*?uv\s*?\)/.test(n);v+=`	${r}MainSupport(`,v+=C?`vUv);
`:`);
`;for(const T of n.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const O of T[1].split(/\s*,\s*/))t.varyings.add(O),y.add(O),b.add(O);for(const T of n.matchAll(c))b.add(T[1])}for(const C of s.matchAll(c))b.add(C[1]);for(const C of e.defines.keys())b.add(C.replace(/\([\w\s,]*\)/g,""));for(const C of e.uniforms.keys())b.add(C);b.delete("while"),b.delete("for"),b.delete("if"),e.uniforms.forEach((C,T)=>t.uniforms.set(r+T.charAt(0).toUpperCase()+T.slice(1),C)),e.defines.forEach((C,T)=>t.defines.set(r+T.charAt(0).toUpperCase()+T.slice(1),C));const x=new Map([["fragment",s],["vertex",n]]);tl(r,b,t.defines),tl(r,b,x),s=x.get("fragment"),n=x.get("vertex");const w=e.blendMode;if(t.blendModes.set(w.blendFunction,w),l){e.inputColorSpace!==null&&e.inputColorSpace!==t.colorSpace&&(_+=e.inputColorSpace===xe?`color0 = sRGBTransferOETF(color0);
	`:`color0 = sRGBToLinear(color0);
	`),e.outputColorSpace!==Js?t.colorSpace=e.outputColorSpace:e.inputColorSpace!==null&&(t.colorSpace=e.inputColorSpace);const C=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;_+=`${r}MainImage(color0, UV, `,(t.attributes&ii.DEPTH)!==0&&C.test(s)&&(_+="depth, ",t.readDepth=!0),_+=`color1);
	`;const T=r+"BlendOpacity";t.uniforms.set(T,w.opacity),_+=`color0 = blend${w.blendFunction}(color0, color1, ${T});

	`,d+=`uniform float ${T};

`}if(d+=s+`
`,n!==null&&(g+=n+`
`),p.set(J.FRAGMENT_HEAD,d),p.set(J.FRAGMENT_MAIN_UV,f),p.set(J.FRAGMENT_MAIN_IMAGE,_),p.set(J.VERTEX_HEAD,g),p.set(J.VERTEX_MAIN_SUPPORT,v),e.extensions!==null)for(const C of e.extensions)t.extensions.add(C)}}var G_=class extends Je{constructor(r,...e){super("EffectPass"),this.fullscreenMaterial=new z_(null,null,null,r),this.listener=t=>this.handleEvent(t),this.effects=[],this.setEffects(e),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(r){for(const e of this.effects)e.mainScene=r}set mainCamera(r){this.fullscreenMaterial.copyCameraSettings(r);for(const e of this.effects)e.mainCamera=r}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(r){this.fullscreenMaterial.encodeOutput=r}get dithering(){return this.fullscreenMaterial.dithering}set dithering(r){const e=this.fullscreenMaterial;e.dithering=r,e.needsUpdate=!0}setEffects(r){for(const e of this.effects)e.removeEventListener("change",this.listener);this.effects=r.sort((e,t)=>t.attributes-e.attributes);for(const e of this.effects)e.addEventListener("change",this.listener)}updateMaterial(){const r=new Nm;let e=0;for(const h of this.effects)if(h.blendMode.blendFunction===j.DST)r.attributes|=h.getAttributes()&ii.DEPTH;else{if((r.attributes&h.getAttributes()&ii.CONVOLUTION)!==0)throw new Error(`Convolution effects cannot be merged (${h.name})`);H_("e"+e++,h,r)}let t=r.shaderParts.get(J.FRAGMENT_HEAD),s=r.shaderParts.get(J.FRAGMENT_MAIN_IMAGE),n=r.shaderParts.get(J.FRAGMENT_MAIN_UV);const l=/\bblend\b/g;for(const h of r.blendModes.values())t+=h.getShaderCode().replace(l,`blend${h.blendFunction}`)+`
`;(r.attributes&ii.DEPTH)!==0?(r.readDepth&&(s=`float depth = readDepth(UV);

	`+s),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,r.colorSpace===xe&&(s+=`color0 = sRGBToLinear(color0);
	`),r.uvTransformation?(n=`vec2 transformedUv = vUv;
`+n,r.defines.set("UV","transformedUv")):r.defines.set("UV","vUv"),r.shaderParts.set(J.FRAGMENT_HEAD,t),r.shaderParts.set(J.FRAGMENT_MAIN_IMAGE,s),r.shaderParts.set(J.FRAGMENT_MAIN_UV,n);for(const[h,c]of r.shaderParts)c!==null&&r.shaderParts.set(h,c.trim().replace(/^#/,`
#`));this.skipRendering=e===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(r)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(r,e=vn){this.fullscreenMaterial.depthBuffer=r,this.fullscreenMaterial.depthPacking=e;for(const t of this.effects)t.setDepthTexture(r,e)}render(r,e,t,s,n){for(const l of this.effects)l.update(r,e,s);if(!this.skipRendering||this.renderToScreen){const l=this.fullscreenMaterial;l.inputBuffer=e.texture,l.time+=s*this.timeScale,r.setRenderTarget(this.renderToScreen?null:t),r.render(this.scene,this.camera)}}setSize(r,e){this.fullscreenMaterial.setSize(r,e);for(const t of this.effects)t.setSize(r,e)}initialize(r,e,t){this.renderer=r;for(const s of this.effects)s.initialize(r,e,t);this.updateMaterial(),t!==void 0&&t!==si&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const r of this.effects)r.removeEventListener("change",this.listener),r.dispose()}handleEvent(r){switch(r.type){case"change":this.recompile();break}}},vr,il;function j_(){return il||(il=1,vr={jet:[{index:0,rgb:[0,0,131]},{index:.125,rgb:[0,60,170]},{index:.375,rgb:[5,255,255]},{index:.625,rgb:[255,255,0]},{index:.875,rgb:[250,0,0]},{index:1,rgb:[128,0,0]}],hsv:[{index:0,rgb:[255,0,0]},{index:.169,rgb:[253,255,2]},{index:.173,rgb:[247,255,2]},{index:.337,rgb:[0,252,4]},{index:.341,rgb:[0,252,10]},{index:.506,rgb:[1,249,255]},{index:.671,rgb:[2,0,253]},{index:.675,rgb:[8,0,253]},{index:.839,rgb:[255,0,251]},{index:.843,rgb:[255,0,245]},{index:1,rgb:[255,0,6]}],hot:[{index:0,rgb:[0,0,0]},{index:.3,rgb:[230,0,0]},{index:.6,rgb:[255,210,0]},{index:1,rgb:[255,255,255]}],spring:[{index:0,rgb:[255,0,255]},{index:1,rgb:[255,255,0]}],summer:[{index:0,rgb:[0,128,102]},{index:1,rgb:[255,255,102]}],autumn:[{index:0,rgb:[255,0,0]},{index:1,rgb:[255,255,0]}],winter:[{index:0,rgb:[0,0,255]},{index:1,rgb:[0,255,128]}],bone:[{index:0,rgb:[0,0,0]},{index:.376,rgb:[84,84,116]},{index:.753,rgb:[169,200,200]},{index:1,rgb:[255,255,255]}],copper:[{index:0,rgb:[0,0,0]},{index:.804,rgb:[255,160,102]},{index:1,rgb:[255,199,127]}],greys:[{index:0,rgb:[0,0,0]},{index:1,rgb:[255,255,255]}],yignbu:[{index:0,rgb:[8,29,88]},{index:.125,rgb:[37,52,148]},{index:.25,rgb:[34,94,168]},{index:.375,rgb:[29,145,192]},{index:.5,rgb:[65,182,196]},{index:.625,rgb:[127,205,187]},{index:.75,rgb:[199,233,180]},{index:.875,rgb:[237,248,217]},{index:1,rgb:[255,255,217]}],greens:[{index:0,rgb:[0,68,27]},{index:.125,rgb:[0,109,44]},{index:.25,rgb:[35,139,69]},{index:.375,rgb:[65,171,93]},{index:.5,rgb:[116,196,118]},{index:.625,rgb:[161,217,155]},{index:.75,rgb:[199,233,192]},{index:.875,rgb:[229,245,224]},{index:1,rgb:[247,252,245]}],yiorrd:[{index:0,rgb:[128,0,38]},{index:.125,rgb:[189,0,38]},{index:.25,rgb:[227,26,28]},{index:.375,rgb:[252,78,42]},{index:.5,rgb:[253,141,60]},{index:.625,rgb:[254,178,76]},{index:.75,rgb:[254,217,118]},{index:.875,rgb:[255,237,160]},{index:1,rgb:[255,255,204]}],bluered:[{index:0,rgb:[0,0,255]},{index:1,rgb:[255,0,0]}],rdbu:[{index:0,rgb:[5,10,172]},{index:.35,rgb:[106,137,247]},{index:.5,rgb:[190,190,190]},{index:.6,rgb:[220,170,132]},{index:.7,rgb:[230,145,90]},{index:1,rgb:[178,10,28]}],picnic:[{index:0,rgb:[0,0,255]},{index:.1,rgb:[51,153,255]},{index:.2,rgb:[102,204,255]},{index:.3,rgb:[153,204,255]},{index:.4,rgb:[204,204,255]},{index:.5,rgb:[255,255,255]},{index:.6,rgb:[255,204,255]},{index:.7,rgb:[255,153,255]},{index:.8,rgb:[255,102,204]},{index:.9,rgb:[255,102,102]},{index:1,rgb:[255,0,0]}],rainbow:[{index:0,rgb:[150,0,90]},{index:.125,rgb:[0,0,200]},{index:.25,rgb:[0,25,255]},{index:.375,rgb:[0,152,255]},{index:.5,rgb:[44,255,150]},{index:.625,rgb:[151,255,0]},{index:.75,rgb:[255,234,0]},{index:.875,rgb:[255,111,0]},{index:1,rgb:[255,0,0]}],portland:[{index:0,rgb:[12,51,131]},{index:.25,rgb:[10,136,186]},{index:.5,rgb:[242,211,56]},{index:.75,rgb:[242,143,56]},{index:1,rgb:[217,30,30]}],blackbody:[{index:0,rgb:[0,0,0]},{index:.2,rgb:[230,0,0]},{index:.4,rgb:[230,210,0]},{index:.7,rgb:[255,255,255]},{index:1,rgb:[160,200,255]}],earth:[{index:0,rgb:[0,0,130]},{index:.1,rgb:[0,180,180]},{index:.2,rgb:[40,210,40]},{index:.4,rgb:[230,230,50]},{index:.6,rgb:[120,70,20]},{index:1,rgb:[255,255,255]}],electric:[{index:0,rgb:[0,0,0]},{index:.15,rgb:[30,0,100]},{index:.4,rgb:[120,0,100]},{index:.6,rgb:[160,90,0]},{index:.8,rgb:[230,200,0]},{index:1,rgb:[255,250,220]}],alpha:[{index:0,rgb:[255,255,255,0]},{index:1,rgb:[255,255,255,1]}],viridis:[{index:0,rgb:[68,1,84]},{index:.13,rgb:[71,44,122]},{index:.25,rgb:[59,81,139]},{index:.38,rgb:[44,113,142]},{index:.5,rgb:[33,144,141]},{index:.63,rgb:[39,173,129]},{index:.75,rgb:[92,200,99]},{index:.88,rgb:[170,220,50]},{index:1,rgb:[253,231,37]}],inferno:[{index:0,rgb:[0,0,4]},{index:.13,rgb:[31,12,72]},{index:.25,rgb:[85,15,109]},{index:.38,rgb:[136,34,106]},{index:.5,rgb:[186,54,85]},{index:.63,rgb:[227,89,51]},{index:.75,rgb:[249,140,10]},{index:.88,rgb:[249,201,50]},{index:1,rgb:[252,255,164]}],magma:[{index:0,rgb:[0,0,4]},{index:.13,rgb:[28,16,68]},{index:.25,rgb:[79,18,123]},{index:.38,rgb:[129,37,129]},{index:.5,rgb:[181,54,122]},{index:.63,rgb:[229,80,100]},{index:.75,rgb:[251,135,97]},{index:.88,rgb:[254,194,135]},{index:1,rgb:[252,253,191]}],plasma:[{index:0,rgb:[13,8,135]},{index:.13,rgb:[75,3,161]},{index:.25,rgb:[125,3,168]},{index:.38,rgb:[168,34,150]},{index:.5,rgb:[203,70,121]},{index:.63,rgb:[229,107,93]},{index:.75,rgb:[248,148,65]},{index:.88,rgb:[253,195,40]},{index:1,rgb:[240,249,33]}],warm:[{index:0,rgb:[125,0,179]},{index:.13,rgb:[172,0,187]},{index:.25,rgb:[219,0,170]},{index:.38,rgb:[255,0,130]},{index:.5,rgb:[255,63,74]},{index:.63,rgb:[255,123,0]},{index:.75,rgb:[234,176,0]},{index:.88,rgb:[190,228,0]},{index:1,rgb:[147,255,0]}],cool:[{index:0,rgb:[125,0,179]},{index:.13,rgb:[116,0,218]},{index:.25,rgb:[98,74,237]},{index:.38,rgb:[68,146,231]},{index:.5,rgb:[0,204,197]},{index:.63,rgb:[0,247,146]},{index:.75,rgb:[0,255,88]},{index:.88,rgb:[40,255,8]},{index:1,rgb:[147,255,0]}],"rainbow-soft":[{index:0,rgb:[125,0,179]},{index:.1,rgb:[199,0,180]},{index:.2,rgb:[255,0,121]},{index:.3,rgb:[255,108,0]},{index:.4,rgb:[222,194,0]},{index:.5,rgb:[150,255,0]},{index:.6,rgb:[0,255,55]},{index:.7,rgb:[0,246,150]},{index:.8,rgb:[50,167,222]},{index:.9,rgb:[103,51,235]},{index:1,rgb:[124,0,186]}],bathymetry:[{index:0,rgb:[40,26,44]},{index:.13,rgb:[59,49,90]},{index:.25,rgb:[64,76,139]},{index:.38,rgb:[63,110,151]},{index:.5,rgb:[72,142,158]},{index:.63,rgb:[85,174,163]},{index:.75,rgb:[120,206,163]},{index:.88,rgb:[187,230,172]},{index:1,rgb:[253,254,204]}],cdom:[{index:0,rgb:[47,15,62]},{index:.13,rgb:[87,23,86]},{index:.25,rgb:[130,28,99]},{index:.38,rgb:[171,41,96]},{index:.5,rgb:[206,67,86]},{index:.63,rgb:[230,106,84]},{index:.75,rgb:[242,149,103]},{index:.88,rgb:[249,193,135]},{index:1,rgb:[254,237,176]}],chlorophyll:[{index:0,rgb:[18,36,20]},{index:.13,rgb:[25,63,41]},{index:.25,rgb:[24,91,59]},{index:.38,rgb:[13,119,72]},{index:.5,rgb:[18,148,80]},{index:.63,rgb:[80,173,89]},{index:.75,rgb:[132,196,122]},{index:.88,rgb:[175,221,162]},{index:1,rgb:[215,249,208]}],density:[{index:0,rgb:[54,14,36]},{index:.13,rgb:[89,23,80]},{index:.25,rgb:[110,45,132]},{index:.38,rgb:[120,77,178]},{index:.5,rgb:[120,113,213]},{index:.63,rgb:[115,151,228]},{index:.75,rgb:[134,185,227]},{index:.88,rgb:[177,214,227]},{index:1,rgb:[230,241,241]}],"freesurface-blue":[{index:0,rgb:[30,4,110]},{index:.13,rgb:[47,14,176]},{index:.25,rgb:[41,45,236]},{index:.38,rgb:[25,99,212]},{index:.5,rgb:[68,131,200]},{index:.63,rgb:[114,156,197]},{index:.75,rgb:[157,181,203]},{index:.88,rgb:[200,208,216]},{index:1,rgb:[241,237,236]}],"freesurface-red":[{index:0,rgb:[60,9,18]},{index:.13,rgb:[100,17,27]},{index:.25,rgb:[142,20,29]},{index:.38,rgb:[177,43,27]},{index:.5,rgb:[192,87,63]},{index:.63,rgb:[205,125,105]},{index:.75,rgb:[216,162,148]},{index:.88,rgb:[227,199,193]},{index:1,rgb:[241,237,236]}],oxygen:[{index:0,rgb:[64,5,5]},{index:.13,rgb:[106,6,15]},{index:.25,rgb:[144,26,7]},{index:.38,rgb:[168,64,3]},{index:.5,rgb:[188,100,4]},{index:.63,rgb:[206,136,11]},{index:.75,rgb:[220,174,25]},{index:.88,rgb:[231,215,44]},{index:1,rgb:[248,254,105]}],par:[{index:0,rgb:[51,20,24]},{index:.13,rgb:[90,32,35]},{index:.25,rgb:[129,44,34]},{index:.38,rgb:[159,68,25]},{index:.5,rgb:[182,99,19]},{index:.63,rgb:[199,134,22]},{index:.75,rgb:[212,171,35]},{index:.88,rgb:[221,210,54]},{index:1,rgb:[225,253,75]}],phase:[{index:0,rgb:[145,105,18]},{index:.13,rgb:[184,71,38]},{index:.25,rgb:[186,58,115]},{index:.38,rgb:[160,71,185]},{index:.5,rgb:[110,97,218]},{index:.63,rgb:[50,123,164]},{index:.75,rgb:[31,131,110]},{index:.88,rgb:[77,129,34]},{index:1,rgb:[145,105,18]}],salinity:[{index:0,rgb:[42,24,108]},{index:.13,rgb:[33,50,162]},{index:.25,rgb:[15,90,145]},{index:.38,rgb:[40,118,137]},{index:.5,rgb:[59,146,135]},{index:.63,rgb:[79,175,126]},{index:.75,rgb:[120,203,104]},{index:.88,rgb:[193,221,100]},{index:1,rgb:[253,239,154]}],temperature:[{index:0,rgb:[4,35,51]},{index:.13,rgb:[23,51,122]},{index:.25,rgb:[85,59,157]},{index:.38,rgb:[129,79,143]},{index:.5,rgb:[175,95,130]},{index:.63,rgb:[222,112,101]},{index:.75,rgb:[249,146,66]},{index:.88,rgb:[249,196,65]},{index:1,rgb:[232,250,91]}],turbidity:[{index:0,rgb:[34,31,27]},{index:.13,rgb:[65,50,41]},{index:.25,rgb:[98,69,52]},{index:.38,rgb:[131,89,57]},{index:.5,rgb:[161,112,59]},{index:.63,rgb:[185,140,66]},{index:.75,rgb:[202,174,88]},{index:.88,rgb:[216,209,126]},{index:1,rgb:[233,246,171]}],"velocity-blue":[{index:0,rgb:[17,32,64]},{index:.13,rgb:[35,52,116]},{index:.25,rgb:[29,81,156]},{index:.38,rgb:[31,113,162]},{index:.5,rgb:[50,144,169]},{index:.63,rgb:[87,173,176]},{index:.75,rgb:[149,196,189]},{index:.88,rgb:[203,221,211]},{index:1,rgb:[254,251,230]}],"velocity-green":[{index:0,rgb:[23,35,19]},{index:.13,rgb:[24,64,38]},{index:.25,rgb:[11,95,45]},{index:.38,rgb:[39,123,35]},{index:.5,rgb:[95,146,12]},{index:.63,rgb:[152,165,18]},{index:.75,rgb:[201,186,69]},{index:.88,rgb:[233,216,137]},{index:1,rgb:[255,253,205]}],cubehelix:[{index:0,rgb:[0,0,0]},{index:.07,rgb:[22,5,59]},{index:.13,rgb:[60,4,105]},{index:.2,rgb:[109,1,135]},{index:.27,rgb:[161,0,147]},{index:.33,rgb:[210,2,142]},{index:.4,rgb:[251,11,123]},{index:.47,rgb:[255,29,97]},{index:.53,rgb:[255,54,69]},{index:.6,rgb:[255,85,46]},{index:.67,rgb:[255,120,34]},{index:.73,rgb:[255,157,37]},{index:.8,rgb:[241,191,57]},{index:.87,rgb:[224,220,93]},{index:.93,rgb:[218,241,142]},{index:1,rgb:[227,253,198]}]}),vr}var gr,sl;function K_(){if(sl)return gr;sl=1;function r(e,t,s){return e*(1-s)+t*s}return gr=r,gr}var br,nl;function Y_(){if(nl)return br;nl=1;var r=j_(),e=K_();br=t;function t(h){var c,p,d,f,_,g,v,y,C,b,x;if(h||(h={}),y=(h.nshades||72)-1,v=h.format||"hex",g=h.colormap,g||(g="jet"),typeof g=="string"){if(g=g.toLowerCase(),!r[g])throw Error(g+" not a supported colorscale");_=r[g]}else if(Array.isArray(g))_=g.slice();else throw Error("unsupported colormap option",g);if(_.length>y+1)throw new Error(g+" map requires nshades to be at least size "+_.length);Array.isArray(h.alpha)?h.alpha.length!==2?b=[1,1]:b=h.alpha.slice():typeof h.alpha=="number"?b=[h.alpha,h.alpha]:b=[1,1],c=_.map(function(A){return Math.round(A.index*y)}),b[0]=Math.min(Math.max(b[0],0),1),b[1]=Math.min(Math.max(b[1],0),1);var w=_.map(function(A,M){var R=_[M].index,D=_[M].rgb.slice();return D.length===4&&D[3]>=0&&D[3]<=1||(D[3]=b[0]+(b[1]-b[0])*R),D}),C=[];for(x=0;x<c.length-1;++x){f=c[x+1]-c[x],p=w[x],d=w[x+1];for(var T=0;T<f;T++){var O=T/f;C.push([Math.round(e(p[0],d[0],O)),Math.round(e(p[1],d[1],O)),Math.round(e(p[2],d[2],O)),e(p[3],d[3],O)])}}return C.push(_[_.length-1].rgb.concat(b[1])),v==="hex"?C=C.map(n):v==="rgbaString"?C=C.map(l):v==="float"&&(C=C.map(s)),C}function s(h){return[h[0]/255,h[1]/255,h[2]/255,h[3]]}function n(h){for(var c,p="#",d=0;d<3;++d)c=h[d],c=c.toString(16),p+=("00"+c).substr(c.length);return p}function l(h){return"rgba("+h.join(",")+")"}return br}var $_=Y_();const q_=bl($_),rl=(r,e)=>q_({colormap:r,nshades:e,format:"float",alpha:1}),ol=(r,e,t)=>r*(1-t)+e*t,al=(r,e,t)=>W_((t-r)/(e-r)),W_=(r,e=0,t=1)=>Math.min(t,Math.max(e,r));var Z_=bp();const Me=1024,X_=60,Q_=-10,J_=-5,ev=["perceptualSharpness","perceptualSpread","spectralFlatness","spectralKurtosis","amplitudeSpectrum","loudness"],tv=10,iv=(r,e)=>{const t=[];for(let s=0;s<r;s++)t.push(Array(e).fill(0));return t},sv=(r,e,t=.4,s=.5)=>e*(1+Math.log10((r+1)/Me/2)),nv=r=>Math.floor(r/Me/2),rv=r=>{const{perceptualSpread:e,perceptualSharpness:t,spectralKurtosis:s,spectralFlatness:n,loudness:l}=r;return{loudness:al(0,50,l.total),spectralKurtosis:al(5,40,s),perceptualSharpness:t,perceptualSpread:e,spectralFlatness:n}},ov={audio:{channelCount:{ideal:2,min:1},echoCancellation:!0,autoGainControl:!0,noiseSuppression:!0}},av=["amplitudeSpectrum","spectralCentroid","spectralRolloff","perceptualSharpness","loudness","rms","chroma","mfcc"];class lv{meydaPromise({constrains:e=ov,bufferSize:t=Me}){return!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia?Promise.reject(new Error("getUserMedia is not supported in this browser. Please use a modern browser with Web Audio API support.")):navigator.mediaDevices.getUserMedia(e).then(s=>this.successStream({stream:s,bufferSize:t})).catch(s=>this.errorStream(s))}successStream({stream:e,bufferSize:t}){this.audioContext=new AudioContext;const s=e.getAudioTracks()[0];return s&&(this.streamAudioSettings=s.getSettings()),this.source=this.audioContext.createMediaStreamSource(e),this.meyda=Z_.createMeydaAnalyzer({audioContext:this.audioContext,source:this.source,bufferSize:t}),this.meyda.start(),e}errorStream(e){e.name==="NotAllowedError"?console.error("AudioFeaturesExtractor: Microphone access denied by user"):e.name==="NotFoundError"?console.error("AudioFeaturesExtractor: No microphone device found"):e.name==="NotSupportedError"?console.error("AudioFeaturesExtractor: getUserMedia not supported in this browser"):console.error("AudioFeaturesExtractor:",e.message||e)}features(e=av){return!this.meyda||!this.audioContext?null:this.meyda.get(e)}signal(){return this.meyda?this.meyda._m.signal:null}}function hv(r){return Ol(document,"keydown").pipe(xp(e=>e.keyCode===r),yp(!1),wp(e=>!e))}function cv(r){return Ol(r,"click").pipe(Cp(250),Ep())}function uv(r,e,t){let s=!1;const n=t.subscribe(l=>{s=l,l?r.setAnimationLoop(null):r.setAnimationLoop(e)});return s||r.setAnimationLoop(e),()=>{r.setAnimationLoop(null),n.unsubscribe()}}const dv=Math.min(1.2,window.devicePixelRatio);const he={LEFT:1,RIGHT:2,MIDDLE:4},P=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,SCREEN_PAN:4,OFFSET:8,DOLLY:16,ZOOM:32,TOUCH_ROTATE:64,TOUCH_TRUCK:128,TOUCH_SCREEN_PAN:256,TOUCH_OFFSET:512,TOUCH_DOLLY:1024,TOUCH_ZOOM:2048,TOUCH_DOLLY_TRUCK:4096,TOUCH_DOLLY_SCREEN_PAN:8192,TOUCH_DOLLY_OFFSET:16384,TOUCH_DOLLY_ROTATE:32768,TOUCH_ZOOM_TRUCK:65536,TOUCH_ZOOM_OFFSET:131072,TOUCH_ZOOM_SCREEN_PAN:262144,TOUCH_ZOOM_ROTATE:524288}),bi={NONE:0,IN:1,OUT:-1};function qt(r){return r.isPerspectiveCamera}function St(r){return r.isOrthographicCamera}const Tt=Math.PI*2,ll=Math.PI/2,Lh=1e-5,ss=Math.PI/180;function We(r,e,t){return Math.max(e,Math.min(t,r))}function oe(r,e=Lh){return Math.abs(r)<e}function se(r,e,t=Lh){return oe(r-e,t)}function hl(r,e){return Math.round(r/e)*e}function ns(r){return isFinite(r)?r:r<0?-Number.MAX_VALUE:Number.MAX_VALUE}function rs(r){return Math.abs(r)<Number.MAX_VALUE?r:r*(1/0)}function Ys(r,e,t,s,n=1/0,l){s=Math.max(1e-4,s);const h=2/s,c=h*l,p=1/(1+c+.48*c*c+.235*c*c*c);let d=r-e;const f=e,_=n*s;d=We(d,-_,_),e=r-d;const g=(t.value+h*d)*l;t.value=(t.value-h*g)*p;let v=e+(d+g)*p;return f-r>0==v>f&&(v=f,t.value=(v-f)/l),v}function cl(r,e,t,s,n=1/0,l,h){s=Math.max(1e-4,s);const c=2/s,p=c*l,d=1/(1+p+.48*p*p+.235*p*p*p);let f=e.x,_=e.y,g=e.z,v=r.x-f,y=r.y-_,b=r.z-g;const x=f,w=_,C=g,T=n*s,O=T*T,A=v*v+y*y+b*b;if(A>O){const z=Math.sqrt(A);v=v/z*T,y=y/z*T,b=b/z*T}f=r.x-v,_=r.y-y,g=r.z-b;const M=(t.x+c*v)*l,R=(t.y+c*y)*l,D=(t.z+c*b)*l;t.x=(t.x-c*M)*d,t.y=(t.y-c*R)*d,t.z=(t.z-c*D)*d,h.x=f+(v+M)*d,h.y=_+(y+R)*d,h.z=g+(b+D)*d;const k=x-r.x,I=w-r.y,H=C-r.z,K=h.x-x,ee=h.y-w,q=h.z-C;return k*K+I*ee+H*q>0&&(h.x=x,h.y=w,h.z=C,t.x=(h.x-x)/l,t.y=(h.y-w)/l,t.z=(h.z-C)/l),h}function xr(r,e){e.set(0,0),r.forEach(t=>{e.x+=t.clientX,e.y+=t.clientY}),e.x/=r.length,e.y/=r.length}function yr(r,e){return St(r)?(console.warn(`${e} is not supported in OrthographicCamera`),!0):!1}class pv{_listeners={};addEventListener(e,t){const s=this._listeners;s[e]===void 0&&(s[e]=[]),s[e].indexOf(t)===-1&&s[e].push(t)}hasEventListener(e,t){const s=this._listeners;return s[e]!==void 0&&s[e].indexOf(t)!==-1}removeEventListener(e,t){const n=this._listeners[e];if(n!==void 0){const l=n.indexOf(t);l!==-1&&n.splice(l,1)}}removeAllEventListeners(e){if(!e){this._listeners={};return}Array.isArray(this._listeners[e])&&(this._listeners[e].length=0)}dispatchEvent(e){const s=this._listeners[e.type];if(s!==void 0){e.target=this;const n=s.slice(0);for(let l=0,h=n.length;l<h;l++)n[l].call(this,e)}}}const fv="3.1.2",$s=1/8,mv=/Mac/.test(globalThis?.navigator?.platform);let N,ul,qs,wr,Ae,G,Q,xi,os,st,nt,Wt,dl,pl,Ie,yi,wi,fl,Cr,ml,Er,Tr,Ws;class ws extends pv{static install(e){N=e.THREE,ul=Object.freeze(new N.Vector3(0,0,0)),qs=Object.freeze(new N.Vector3(0,1,0)),wr=Object.freeze(new N.Vector3(0,0,1)),Ae=new N.Vector2,G=new N.Vector3,Q=new N.Vector3,xi=new N.Vector3,os=new N.Vector3,st=new N.Vector3,nt=new N.Vector3,Wt=new N.Vector3,dl=new N.Vector3,pl=new N.Vector3,Ie=new N.Spherical,yi=new N.Spherical,wi=new N.Box3,fl=new N.Box3,Cr=new N.Sphere,ml=new N.Quaternion,Er=new N.Quaternion,Tr=new N.Matrix4,Ws=new N.Raycaster}static get ACTION(){return P}minPolarAngle=0;maxPolarAngle=Math.PI;minAzimuthAngle=-1/0;maxAzimuthAngle=1/0;minDistance=Number.EPSILON;maxDistance=1/0;infinityDolly=!1;minZoom=.01;maxZoom=1/0;smoothTime=.25;draggingSmoothTime=.125;maxSpeed=1/0;azimuthRotateSpeed=1;polarRotateSpeed=1;dollySpeed=1;dollyDragInverted=!1;truckSpeed=2;dollyToCursor=!1;dragToOffset=!1;boundaryFriction=0;restThreshold=.01;colliderMeshes=[];mouseButtons;touches;cancel=()=>{};lockPointer;unlockPointer;_enabled=!0;_camera;_yAxisUpSpace;_yAxisUpSpaceInverse;_state=P.NONE;_domElement;_viewport=null;_target;_targetEnd;_focalOffset;_focalOffsetEnd;_spherical;_sphericalEnd;_lastDistance;_zoom;_zoomEnd;_lastZoom;_cameraUp0;_target0;_position0;_zoom0;_focalOffset0;_dollyControlCoord;_changedDolly=0;_changedZoom=0;_nearPlaneCorners;_hasRested=!0;_boundary;_boundaryEnclosesCamera=!1;_needsUpdate=!0;_updatedLastTime=!1;_elementRect=new DOMRect;_isDragging=!1;_dragNeedsUpdate=!0;_activePointers=[];_lockedPointer=null;_interactiveArea=new DOMRect(0,0,1,1);_isUserControllingRotate=!1;_isUserControllingDolly=!1;_isUserControllingTruck=!1;_isUserControllingOffset=!1;_isUserControllingZoom=!1;_lastDollyDirection=bi.NONE;_thetaVelocity={value:0};_phiVelocity={value:0};_radiusVelocity={value:0};_targetVelocity=new N.Vector3;_focalOffsetVelocity=new N.Vector3;_zoomVelocity={value:0};set verticalDragToForward(e){console.warn("camera-controls: `verticalDragToForward` was removed. Use `mouseButtons.left = CameraControls.ACTION.SCREEN_PAN` instead.")}constructor(e,t){super(),typeof N>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=e,this._yAxisUpSpace=new N.Quaternion().setFromUnitVectors(this._camera.up,qs),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=P.NONE,this._target=new N.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new N.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new N.Spherical().setFromVector3(G.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new N.Vector3,new N.Vector3,new N.Vector3,new N.Vector3],this._updateNearPlaneCorners(),this._boundary=new N.Box3(new N.Vector3(-1/0,-1/0,-1/0),new N.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new N.Vector2,this.mouseButtons={left:P.ROTATE,middle:P.DOLLY,right:P.TRUCK,wheel:qt(this._camera)?P.DOLLY:St(this._camera)?P.ZOOM:P.NONE},this.touches={one:P.TOUCH_ROTATE,two:qt(this._camera)?P.TOUCH_DOLLY_TRUCK:St(this._camera)?P.TOUCH_ZOOM_TRUCK:P.NONE,three:P.TOUCH_TRUCK};const s=new N.Vector2,n=new N.Vector2,l=new N.Vector2,h=w=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const O=this._domElement.getBoundingClientRect(),A=w.clientX/O.width,M=w.clientY/O.height;if(A<this._interactiveArea.left||A>this._interactiveArea.right||M<this._interactiveArea.top||M>this._interactiveArea.bottom)return}const C=w.pointerType!=="mouse"?null:(w.buttons&he.LEFT)===he.LEFT?he.LEFT:(w.buttons&he.MIDDLE)===he.MIDDLE?he.MIDDLE:(w.buttons&he.RIGHT)===he.RIGHT?he.RIGHT:null;if(C!==null){const O=this._findPointerByMouseButton(C);O&&this._disposePointer(O)}if((w.buttons&he.LEFT)===he.LEFT&&this._lockedPointer)return;const T={pointerId:w.pointerId,clientX:w.clientX,clientY:w.clientY,deltaX:0,deltaY:0,mouseButton:C};this._activePointers.push(T),this._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",p),this._domElement.ownerDocument.addEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",p),this._isDragging=!0,g(w)},c=w=>{w.cancelable&&w.preventDefault();const C=w.pointerId,T=this._lockedPointer||this._findPointerById(C);if(T){if(T.clientX=w.clientX,T.clientY=w.clientY,T.deltaX=w.movementX,T.deltaY=w.movementY,this._state=0,w.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(w.buttons&he.LEFT)===he.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(w.buttons&he.MIDDLE)===he.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(w.buttons&he.RIGHT)===he.RIGHT&&(this._state=this._state|this.mouseButtons.right);v()}},p=w=>{const C=this._findPointerById(w.pointerId);if(!(C&&C===this._lockedPointer)){if(C&&this._disposePointer(C),w.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=P.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=P.NONE;y()}};let d=-1;const f=w=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===P.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const R=this._domElement.getBoundingClientRect(),D=w.clientX/R.width,k=w.clientY/R.height;if(D<this._interactiveArea.left||D>this._interactiveArea.right||k<this._interactiveArea.top||k>this._interactiveArea.bottom)return}if(w.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===P.ROTATE||this.mouseButtons.wheel===P.TRUCK){const R=performance.now();d-R<1e3&&this._getClientRect(this._elementRect),d=R}const C=mv?-1:-3,T=w.deltaMode===1&&!w.ctrlKey?w.deltaY/C:w.deltaY/(C*10),O=this.dollyToCursor?(w.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,A=this.dollyToCursor?(w.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(w.ctrlKey?P.ZOOM:this.mouseButtons.wheel){case P.ROTATE:{this._rotateInternal(w.deltaX,w.deltaY),this._isUserControllingRotate=!0;break}case P.TRUCK:{this._truckInternal(w.deltaX,w.deltaY,!1,!1),this._isUserControllingTruck=!0;break}case P.SCREEN_PAN:{this._truckInternal(w.deltaX,w.deltaY,!1,!0),this._isUserControllingTruck=!0;break}case P.OFFSET:{this._truckInternal(w.deltaX,w.deltaY,!0,!1),this._isUserControllingOffset=!0;break}case P.DOLLY:{this._dollyInternal(-T,O,A),this._isUserControllingDolly=!0;break}case P.ZOOM:{this._zoomInternal(-T,O,A),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},_=w=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===ws.ACTION.NONE){const C=w instanceof PointerEvent?w.pointerId:0,T=this._findPointerById(C);T&&this._disposePointer(T),this._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",p);return}w.preventDefault()}},g=w=>{if(!this._enabled)return;if(xr(this._activePointers,Ae),this._getClientRect(this._elementRect),s.copy(Ae),n.copy(Ae),this._activePointers.length>=2){const T=Ae.x-this._activePointers[1].clientX,O=Ae.y-this._activePointers[1].clientY,A=Math.sqrt(T*T+O*O);l.set(0,A);const M=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,R=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;n.set(M,R)}if(this._state=0,!w)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in w&&w.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(w.buttons&he.LEFT)===he.LEFT&&(this._state=this._state|this.mouseButtons.left),(w.buttons&he.MIDDLE)===he.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(w.buttons&he.RIGHT)===he.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&P.ROTATE)===P.ROTATE||(this._state&P.TOUCH_ROTATE)===P.TOUCH_ROTATE||(this._state&P.TOUCH_DOLLY_ROTATE)===P.TOUCH_DOLLY_ROTATE||(this._state&P.TOUCH_ZOOM_ROTATE)===P.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&P.TRUCK)===P.TRUCK||(this._state&P.SCREEN_PAN)===P.SCREEN_PAN||(this._state&P.TOUCH_TRUCK)===P.TOUCH_TRUCK||(this._state&P.TOUCH_SCREEN_PAN)===P.TOUCH_SCREEN_PAN||(this._state&P.TOUCH_DOLLY_TRUCK)===P.TOUCH_DOLLY_TRUCK||(this._state&P.TOUCH_DOLLY_SCREEN_PAN)===P.TOUCH_DOLLY_SCREEN_PAN||(this._state&P.TOUCH_ZOOM_TRUCK)===P.TOUCH_ZOOM_TRUCK||(this._state&P.TOUCH_ZOOM_SCREEN_PAN)===P.TOUCH_DOLLY_SCREEN_PAN)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&P.DOLLY)===P.DOLLY||(this._state&P.TOUCH_DOLLY)===P.TOUCH_DOLLY||(this._state&P.TOUCH_DOLLY_TRUCK)===P.TOUCH_DOLLY_TRUCK||(this._state&P.TOUCH_DOLLY_SCREEN_PAN)===P.TOUCH_DOLLY_SCREEN_PAN||(this._state&P.TOUCH_DOLLY_OFFSET)===P.TOUCH_DOLLY_OFFSET||(this._state&P.TOUCH_DOLLY_ROTATE)===P.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&P.ZOOM)===P.ZOOM||(this._state&P.TOUCH_ZOOM)===P.TOUCH_ZOOM||(this._state&P.TOUCH_ZOOM_TRUCK)===P.TOUCH_ZOOM_TRUCK||(this._state&P.TOUCH_ZOOM_SCREEN_PAN)===P.TOUCH_ZOOM_SCREEN_PAN||(this._state&P.TOUCH_ZOOM_OFFSET)===P.TOUCH_ZOOM_OFFSET||(this._state&P.TOUCH_ZOOM_ROTATE)===P.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&P.OFFSET)===P.OFFSET||(this._state&P.TOUCH_OFFSET)===P.TOUCH_OFFSET||(this._state&P.TOUCH_DOLLY_OFFSET)===P.TOUCH_DOLLY_OFFSET||(this._state&P.TOUCH_ZOOM_OFFSET)===P.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})},v=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,xr(this._activePointers,Ae);const C=this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,T=C?-C.deltaX:n.x-Ae.x,O=C?-C.deltaY:n.y-Ae.y;if(n.copy(Ae),((this._state&P.ROTATE)===P.ROTATE||(this._state&P.TOUCH_ROTATE)===P.TOUCH_ROTATE||(this._state&P.TOUCH_DOLLY_ROTATE)===P.TOUCH_DOLLY_ROTATE||(this._state&P.TOUCH_ZOOM_ROTATE)===P.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(T,O),this._isUserControllingRotate=!0),(this._state&P.DOLLY)===P.DOLLY||(this._state&P.ZOOM)===P.ZOOM){const A=this.dollyToCursor?(s.x-this._elementRect.x)/this._elementRect.width*2-1:0,M=this.dollyToCursor?(s.y-this._elementRect.y)/this._elementRect.height*-2+1:0,R=this.dollyDragInverted?-1:1;(this._state&P.DOLLY)===P.DOLLY?(this._dollyInternal(R*O*$s,A,M),this._isUserControllingDolly=!0):(this._zoomInternal(R*O*$s,A,M),this._isUserControllingZoom=!0)}if((this._state&P.TOUCH_DOLLY)===P.TOUCH_DOLLY||(this._state&P.TOUCH_ZOOM)===P.TOUCH_ZOOM||(this._state&P.TOUCH_DOLLY_TRUCK)===P.TOUCH_DOLLY_TRUCK||(this._state&P.TOUCH_ZOOM_TRUCK)===P.TOUCH_ZOOM_TRUCK||(this._state&P.TOUCH_DOLLY_SCREEN_PAN)===P.TOUCH_DOLLY_SCREEN_PAN||(this._state&P.TOUCH_ZOOM_SCREEN_PAN)===P.TOUCH_ZOOM_SCREEN_PAN||(this._state&P.TOUCH_DOLLY_OFFSET)===P.TOUCH_DOLLY_OFFSET||(this._state&P.TOUCH_ZOOM_OFFSET)===P.TOUCH_ZOOM_OFFSET||(this._state&P.TOUCH_DOLLY_ROTATE)===P.TOUCH_DOLLY_ROTATE||(this._state&P.TOUCH_ZOOM_ROTATE)===P.TOUCH_ZOOM_ROTATE){const A=Ae.x-this._activePointers[1].clientX,M=Ae.y-this._activePointers[1].clientY,R=Math.sqrt(A*A+M*M),D=l.y-R;l.set(0,R);const k=this.dollyToCursor?(n.x-this._elementRect.x)/this._elementRect.width*2-1:0,I=this.dollyToCursor?(n.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&P.TOUCH_DOLLY)===P.TOUCH_DOLLY||(this._state&P.TOUCH_DOLLY_ROTATE)===P.TOUCH_DOLLY_ROTATE||(this._state&P.TOUCH_DOLLY_TRUCK)===P.TOUCH_DOLLY_TRUCK||(this._state&P.TOUCH_DOLLY_SCREEN_PAN)===P.TOUCH_DOLLY_SCREEN_PAN||(this._state&P.TOUCH_DOLLY_OFFSET)===P.TOUCH_DOLLY_OFFSET?(this._dollyInternal(D*$s,k,I),this._isUserControllingDolly=!0):(this._zoomInternal(D*$s,k,I),this._isUserControllingZoom=!0)}((this._state&P.TRUCK)===P.TRUCK||(this._state&P.TOUCH_TRUCK)===P.TOUCH_TRUCK||(this._state&P.TOUCH_DOLLY_TRUCK)===P.TOUCH_DOLLY_TRUCK||(this._state&P.TOUCH_ZOOM_TRUCK)===P.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(T,O,!1,!1),this._isUserControllingTruck=!0),((this._state&P.SCREEN_PAN)===P.SCREEN_PAN||(this._state&P.TOUCH_SCREEN_PAN)===P.TOUCH_SCREEN_PAN||(this._state&P.TOUCH_DOLLY_SCREEN_PAN)===P.TOUCH_DOLLY_SCREEN_PAN||(this._state&P.TOUCH_ZOOM_SCREEN_PAN)===P.TOUCH_ZOOM_SCREEN_PAN)&&(this._truckInternal(T,O,!1,!0),this._isUserControllingTruck=!0),((this._state&P.OFFSET)===P.OFFSET||(this._state&P.TOUCH_OFFSET)===P.TOUCH_OFFSET||(this._state&P.TOUCH_DOLLY_OFFSET)===P.TOUCH_DOLLY_OFFSET||(this._state&P.TOUCH_ZOOM_OFFSET)===P.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(T,O,!0,!1),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},y=()=>{xr(this._activePointers,Ae),n.copy(Ae),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",p),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",p),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",b),this._domElement.ownerDocument.addEventListener("pointerlockerror",x),this._domElement.ownerDocument.addEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",p),g())},this.unlockPointer=()=>{this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),this._domElement?.ownerDocument.exitPointerLock(),this._domElement?.ownerDocument.removeEventListener("pointerlockchange",b),this._domElement?.ownerDocument.removeEventListener("pointerlockerror",x),this.cancel()};const b=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},x=()=>{this.unlockPointer()};this._addAllEventListeners=w=>{this._domElement=w,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",h),this._domElement.addEventListener("pointercancel",p),this._domElement.addEventListener("wheel",f,{passive:!1}),this._domElement.addEventListener("contextmenu",_)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",h),this._domElement.removeEventListener("pointercancel",p),this._domElement.removeEventListener("wheel",f,{passive:!1}),this._domElement.removeEventListener("contextmenu",_),this._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",p),this._domElement.ownerDocument.removeEventListener("pointerlockchange",b),this._domElement.ownerDocument.removeEventListener("pointerlockerror",x))},this.cancel=()=>{this._state!==P.NONE&&(this._state=P.NONE,this._activePointers.length=0,y())},t&&this.connect(t),this.update(0)}get camera(){return this._camera}set camera(e){this._camera=e,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._domElement&&(e?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(e){this._spherical.radius===e&&this._sphericalEnd.radius===e||(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(e){this._spherical.theta===e&&this._sphericalEnd.theta===e||(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(e){this._spherical.phi===e&&this._sphericalEnd.phi===e||(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0}set interactiveArea(e){this._interactiveArea.width=We(e.width,0,1),this._interactiveArea.height=We(e.height,0,1),this._interactiveArea.x=We(e.x,0,1-this._interactiveArea.width),this._interactiveArea.y=We(e.y,0,1-this._interactiveArea.height)}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}rotate(e,t,s=!1){return this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,s)}rotateAzimuthTo(e,t=!1){return this.rotateTo(e,this._sphericalEnd.phi,t)}rotatePolarTo(e,t=!1){return this.rotateTo(this._sphericalEnd.theta,e,t)}rotateTo(e,t,s=!1){this._isUserControllingRotate=!1;const n=We(e,this.minAzimuthAngle,this.maxAzimuthAngle),l=We(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=n,this._sphericalEnd.phi=l,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,s||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const h=!s||se(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&se(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(h)}dolly(e,t=!1){return this.dollyTo(this._sphericalEnd.radius-e,t)}dollyTo(e,t=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=bi.NONE,this._changedDolly=0,this._dollyToNoClamp(We(e,this.minDistance,this.maxDistance),t)}_dollyToNoClamp(e,t=!1){const s=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const h=this._collisionTest(),c=se(h,this._spherical.radius);if(!(s>e)&&c)return Promise.resolve();this._sphericalEnd.radius=Math.min(e,h)}else this._sphericalEnd.radius=e;this._needsUpdate=!0,t||(this._spherical.radius=this._sphericalEnd.radius);const l=!t||se(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(l)}dollyInFixed(e,t=!1){this._targetEnd.add(this._getCameraDirection(os).multiplyScalar(e)),t||this._target.copy(this._targetEnd);const s=!t||se(this._target.x,this._targetEnd.x,this.restThreshold)&&se(this._target.y,this._targetEnd.y,this.restThreshold)&&se(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(s)}zoom(e,t=!1){return this.zoomTo(this._zoomEnd+e,t)}zoomTo(e,t=!1){this._isUserControllingZoom=!1,this._zoomEnd=We(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,t||(this._zoom=this._zoomEnd);const s=!t||se(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(s)}pan(e,t,s=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(e,t,s)}truck(e,t,s=!1){this._camera.updateMatrix(),st.setFromMatrixColumn(this._camera.matrix,0),nt.setFromMatrixColumn(this._camera.matrix,1),st.multiplyScalar(e),nt.multiplyScalar(-t);const n=G.copy(st).add(nt),l=Q.copy(this._targetEnd).add(n);return this.moveTo(l.x,l.y,l.z,s)}forward(e,t=!1){G.setFromMatrixColumn(this._camera.matrix,0),G.crossVectors(this._camera.up,G),G.multiplyScalar(e);const s=Q.copy(this._targetEnd).add(G);return this.moveTo(s.x,s.y,s.z,t)}elevate(e,t=!1){return G.copy(this._camera.up).multiplyScalar(e),this.moveTo(this._targetEnd.x+G.x,this._targetEnd.y+G.y,this._targetEnd.z+G.z,t)}moveTo(e,t,s,n=!1){this._isUserControllingTruck=!1;const l=G.set(e,t,s).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,l,this.boundaryFriction),this._needsUpdate=!0,n||this._target.copy(this._targetEnd);const h=!n||se(this._target.x,this._targetEnd.x,this.restThreshold)&&se(this._target.y,this._targetEnd.y,this.restThreshold)&&se(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(h)}lookInDirectionOf(e,t,s,n=!1){const c=G.set(e,t,s).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius).add(this._targetEnd);return this.setPosition(c.x,c.y,c.z,n)}fitToBox(e,t,{cover:s=!1,paddingLeft:n=0,paddingRight:l=0,paddingBottom:h=0,paddingTop:c=0}={}){const p=[],d=e.isBox3?wi.copy(e):wi.setFromObject(e);d.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const f=hl(this._sphericalEnd.theta,ll),_=hl(this._sphericalEnd.phi,ll);p.push(this.rotateTo(f,_,t));const g=G.setFromSpherical(this._sphericalEnd).normalize(),v=ml.setFromUnitVectors(g,wr),y=se(Math.abs(g.y),1);y&&v.multiply(Er.setFromAxisAngle(qs,f)),v.multiply(this._yAxisUpSpaceInverse);const b=fl.makeEmpty();Q.copy(d.min).applyQuaternion(v),b.expandByPoint(Q),Q.copy(d.min).setX(d.max.x).applyQuaternion(v),b.expandByPoint(Q),Q.copy(d.min).setY(d.max.y).applyQuaternion(v),b.expandByPoint(Q),Q.copy(d.max).setZ(d.min.z).applyQuaternion(v),b.expandByPoint(Q),Q.copy(d.min).setZ(d.max.z).applyQuaternion(v),b.expandByPoint(Q),Q.copy(d.max).setY(d.min.y).applyQuaternion(v),b.expandByPoint(Q),Q.copy(d.max).setX(d.min.x).applyQuaternion(v),b.expandByPoint(Q),Q.copy(d.max).applyQuaternion(v),b.expandByPoint(Q),b.min.x-=n,b.min.y-=h,b.max.x+=l,b.max.y+=c,v.setFromUnitVectors(wr,g),y&&v.premultiply(Er.invert()),v.premultiply(this._yAxisUpSpace);const x=b.getSize(G),w=b.getCenter(Q).applyQuaternion(v);if(qt(this._camera)){const C=this.getDistanceToFitBox(x.x,x.y,x.z,s);p.push(this.moveTo(w.x,w.y,w.z,t)),p.push(this.dollyTo(C,t)),p.push(this.setFocalOffset(0,0,0,t))}else if(St(this._camera)){const C=this._camera,T=C.right-C.left,O=C.top-C.bottom,A=s?Math.max(T/x.x,O/x.y):Math.min(T/x.x,O/x.y);p.push(this.moveTo(w.x,w.y,w.z,t)),p.push(this.zoomTo(A,t)),p.push(this.setFocalOffset(0,0,0,t))}return Promise.all(p)}fitToSphere(e,t){const s=[],l="isObject3D"in e?ws.createBoundingSphere(e,Cr):Cr.copy(e);if(s.push(this.moveTo(l.center.x,l.center.y,l.center.z,t)),qt(this._camera)){const h=this.getDistanceToFitSphere(l.radius);s.push(this.dollyTo(h,t))}else if(St(this._camera)){const h=this._camera.right-this._camera.left,c=this._camera.top-this._camera.bottom,p=2*l.radius,d=Math.min(h/p,c/p);s.push(this.zoomTo(d,t))}return s.push(this.setFocalOffset(0,0,0,t)),Promise.all(s)}setLookAt(e,t,s,n,l,h,c=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=bi.NONE,this._changedDolly=0;const p=Q.set(n,l,h),d=G.set(e,t,s);this._targetEnd.copy(p),this._sphericalEnd.setFromVector3(d.sub(p).applyQuaternion(this._yAxisUpSpace)),this._needsUpdate=!0,c||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const f=!c||se(this._target.x,this._targetEnd.x,this.restThreshold)&&se(this._target.y,this._targetEnd.y,this.restThreshold)&&se(this._target.z,this._targetEnd.z,this.restThreshold)&&se(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&se(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&se(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(f)}lerp(e,t,s,n=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=bi.NONE,this._changedDolly=0;const l=G.set(...e.target);if("spherical"in e)Ie.set(...e.spherical);else{const _=Q.set(...e.position);Ie.setFromVector3(_.sub(l).applyQuaternion(this._yAxisUpSpace))}const h=xi.set(...t.target);if("spherical"in t)yi.set(...t.spherical);else{const _=Q.set(...t.position);yi.setFromVector3(_.sub(h).applyQuaternion(this._yAxisUpSpace))}this._targetEnd.copy(l.lerp(h,s));const c=yi.theta-Ie.theta,p=yi.phi-Ie.phi,d=yi.radius-Ie.radius;this._sphericalEnd.set(Ie.radius+d*s,Ie.phi+p*s,Ie.theta+c*s),this._needsUpdate=!0,n||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const f=!n||se(this._target.x,this._targetEnd.x,this.restThreshold)&&se(this._target.y,this._targetEnd.y,this.restThreshold)&&se(this._target.z,this._targetEnd.z,this.restThreshold)&&se(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&se(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&se(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(f)}lerpLookAt(e,t,s,n,l,h,c,p,d,f,_,g,v,y=!1){return this.lerp({position:[e,t,s],target:[n,l,h]},{position:[c,p,d],target:[f,_,g]},v,y)}setPosition(e,t,s,n=!1){return this.setLookAt(e,t,s,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,n)}setTarget(e,t,s,n=!1){const l=this.getPosition(G),h=this.setLookAt(l.x,l.y,l.z,e,t,s,n);return this._sphericalEnd.phi=We(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),h}setFocalOffset(e,t,s,n=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(e,t,s),this._needsUpdate=!0,n||this._focalOffset.copy(this._focalOffsetEnd);const l=!n||se(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&se(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&se(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(l)}setOrbitPoint(e,t,s){this._camera.updateMatrixWorld(),st.setFromMatrixColumn(this._camera.matrixWorldInverse,0),nt.setFromMatrixColumn(this._camera.matrixWorldInverse,1),Wt.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const n=G.set(e,t,s),l=n.distanceTo(this._camera.position),h=n.sub(this._camera.position);st.multiplyScalar(h.x),nt.multiplyScalar(h.y),Wt.multiplyScalar(h.z),G.copy(st).add(nt).add(Wt),G.z=G.z+l,this.dollyTo(l,!1),this.setFocalOffset(-G.x,G.y,-G.z,!1),this.moveTo(e,t,s,!1)}setBoundary(e){if(!e){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(e,t,s,n){if(e===null){this._viewport=null;return}this._viewport=this._viewport||new N.Vector4,typeof e=="number"?this._viewport.set(e,t,s,n):this._viewport.copy(e)}getDistanceToFitBox(e,t,s,n=!1){if(yr(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const l=e/t,h=this._camera.getEffectiveFOV()*ss,c=this._camera.aspect;return((n?l>c:l<c)?t:e/c)*.5/Math.tan(h*.5)+s*.5}getDistanceToFitSphere(e){if(yr(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const t=this._camera.getEffectiveFOV()*ss,s=Math.atan(Math.tan(t*.5)*this._camera.aspect)*2,n=1<this._camera.aspect?t:s;return e/Math.sin(n*.5)}getTarget(e,t=!0){return(e&&e.isVector3?e:new N.Vector3).copy(t?this._targetEnd:this._target)}getPosition(e,t=!0){return(e&&e.isVector3?e:new N.Vector3).setFromSpherical(t?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(t?this._targetEnd:this._target)}getSpherical(e,t=!0){return(e||new N.Spherical).copy(t?this._sphericalEnd:this._spherical)}getFocalOffset(e,t=!0){return(e&&e.isVector3?e:new N.Vector3).copy(t?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){return this._sphericalEnd.theta=(this._sphericalEnd.theta%Tt+Tt)%Tt,this._sphericalEnd.theta>Math.PI&&(this._sphericalEnd.theta-=Tt),this._spherical.theta+=Tt*Math.round((this._sphericalEnd.theta-this._spherical.theta)/Tt),this}stop(){this._focalOffset.copy(this._focalOffsetEnd),this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd),this._zoom=this._zoomEnd}reset(e=!1){if(!se(this._camera.up.x,this._cameraUp0.x)||!se(this._camera.up.y,this._cameraUp0.y)||!se(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const s=this.getPosition(G);this.updateCameraUp(),this.setPosition(s.x,s.y,s.z)}const t=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)];return Promise.all(t)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,qs),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const e=G.subVectors(this._target,this._camera.position).normalize(),t=Q.crossVectors(e,this._camera.up);this._camera.up.crossVectors(t,e).normalize(),this._camera.updateMatrixWorld();const s=this.getPosition(G);this.updateCameraUp(),this.setPosition(s.x,s.y,s.z)}update(e){const t=this._sphericalEnd.theta-this._spherical.theta,s=this._sphericalEnd.phi-this._spherical.phi,n=this._sphericalEnd.radius-this._spherical.radius,l=dl.subVectors(this._targetEnd,this._target),h=pl.subVectors(this._focalOffsetEnd,this._focalOffset),c=this._zoomEnd-this._zoom;if(oe(t))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const _=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=Ys(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,_,1/0,e),this._needsUpdate=!0}if(oe(s))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const _=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=Ys(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,_,1/0,e),this._needsUpdate=!0}if(oe(n))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const _=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=Ys(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,_,this.maxSpeed,e),this._needsUpdate=!0}if(oe(l.x)&&oe(l.y)&&oe(l.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const _=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;cl(this._target,this._targetEnd,this._targetVelocity,_,this.maxSpeed,e,this._target),this._needsUpdate=!0}if(oe(h.x)&&oe(h.y)&&oe(h.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const _=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;cl(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,_,this.maxSpeed,e,this._focalOffset),this._needsUpdate=!0}if(oe(c))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const _=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=Ys(this._zoom,this._zoomEnd,this._zoomVelocity,_,1/0,e)}if(this.dollyToCursor){if(qt(this._camera)&&this._changedDolly!==0){const _=this._spherical.radius-this._lastDistance,g=this._camera,v=this._getCameraDirection(os),y=G.copy(v).cross(g.up).normalize();y.lengthSq()===0&&(y.x=1);const b=Q.crossVectors(y,v),x=this._sphericalEnd.radius*Math.tan(g.getEffectiveFOV()*ss*.5),C=(this._sphericalEnd.radius-_-this._sphericalEnd.radius)/this._sphericalEnd.radius,T=xi.copy(this._targetEnd).add(y.multiplyScalar(this._dollyControlCoord.x*x*g.aspect)).add(b.multiplyScalar(this._dollyControlCoord.y*x)),O=G.copy(this._targetEnd).lerp(T,C),A=this._lastDollyDirection===bi.IN&&this._spherical.radius<=this.minDistance,M=this._lastDollyDirection===bi.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(A||M)){this._sphericalEnd.radius-=_,this._spherical.radius-=_;const D=Q.copy(v).multiplyScalar(-_);O.add(D)}this._boundary.clampPoint(O,O);const R=Q.subVectors(O,this._targetEnd);this._targetEnd.copy(O),this._target.add(R),this._changedDolly-=_,oe(this._changedDolly)&&(this._changedDolly=0)}else if(St(this._camera)&&this._changedZoom!==0){const _=this._zoom-this._lastZoom,g=this._camera,v=G.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(g.near+g.far)/(g.near-g.far)).unproject(g),y=Q.set(0,0,-1).applyQuaternion(g.quaternion),b=xi.copy(v).add(y.multiplyScalar(-v.dot(g.up))),w=-(this._zoom-_-this._zoom)/this._zoom,C=this._getCameraDirection(os),T=this._targetEnd.dot(C),O=G.copy(this._targetEnd).lerp(b,w),A=O.dot(C),M=C.multiplyScalar(A-T);O.sub(M),this._boundary.clampPoint(O,O);const R=Q.subVectors(O,this._targetEnd);this._targetEnd.copy(O),this._target.add(R),this._changedZoom-=_,oe(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const p=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,p),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!oe(this._focalOffset.x)||!oe(this._focalOffset.y)||!oe(this._focalOffset.z))&&(this._camera.matrix.compose(this._camera.position,this._camera.quaternion,this._camera.scale),st.setFromMatrixColumn(this._camera.matrix,0),nt.setFromMatrixColumn(this._camera.matrix,1),Wt.setFromMatrixColumn(this._camera.matrix,2),st.multiplyScalar(this._focalOffset.x),nt.multiplyScalar(-this._focalOffset.y),Wt.multiplyScalar(this._focalOffset.z),G.copy(st).add(nt).add(Wt),this._camera.position.add(G),this._camera.updateMatrixWorld()),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),G.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const f=this._needsUpdate;return f&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):f?(this.dispatchEvent({type:"update"}),oe(t,this.restThreshold)&&oe(s,this.restThreshold)&&oe(n,this.restThreshold)&&oe(l.x,this.restThreshold)&&oe(l.y,this.restThreshold)&&oe(l.z,this.restThreshold)&&oe(h.x,this.restThreshold)&&oe(h.y,this.restThreshold)&&oe(h.z,this.restThreshold)&&oe(c,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!f&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=f,this._needsUpdate=!1,f}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:ns(this.maxDistance),minZoom:this.minZoom,maxZoom:ns(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:ns(this.maxPolarAngle),minAzimuthAngle:ns(this.minAzimuthAngle),maxAzimuthAngle:ns(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,target:this._targetEnd.toArray(),position:G.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(e,t=!1){const s=JSON.parse(e);this.enabled=s.enabled,this.minDistance=s.minDistance,this.maxDistance=rs(s.maxDistance),this.minZoom=s.minZoom,this.maxZoom=rs(s.maxZoom),this.minPolarAngle=s.minPolarAngle,this.maxPolarAngle=rs(s.maxPolarAngle),this.minAzimuthAngle=rs(s.minAzimuthAngle),this.maxAzimuthAngle=rs(s.maxAzimuthAngle),this.smoothTime=s.smoothTime,this.draggingSmoothTime=s.draggingSmoothTime,this.dollySpeed=s.dollySpeed,this.truckSpeed=s.truckSpeed,this.dollyToCursor=s.dollyToCursor,this._target0.fromArray(s.target0),this._position0.fromArray(s.position0),this._zoom0=s.zoom0,this._focalOffset0.fromArray(s.focalOffset0),this.moveTo(s.target[0],s.target[1],s.target[2],t),Ie.setFromVector3(G.fromArray(s.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(Ie.theta,Ie.phi,t),this.dollyTo(Ie.radius,t),this.zoomTo(s.zoom,t),this.setFocalOffset(s.focalOffset[0],s.focalOffset[1],s.focalOffset[2],t),this._needsUpdate=!0}connect(e){if(this._domElement){console.warn("camera-controls is already connected.");return}e.setAttribute("data-camera-controls-version",fv),this._addAllEventListeners(e),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(e){return e.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(e){return this._getTargetDirection(e).negate()}_findPointerById(e){return this._activePointers.find(t=>t.pointerId===e)}_findPointerByMouseButton(e){return this._activePointers.find(t=>t.mouseButton===e)}_disposePointer(e){this._activePointers.splice(this._activePointers.indexOf(e),1)}_encloseToBoundary(e,t,s){const n=t.lengthSq();if(n===0)return e;const l=Q.copy(t).add(e),c=this._boundary.clampPoint(l,xi).sub(l),p=c.lengthSq();if(p===0)return e.add(t);if(p===n)return e;if(s===0)return e.add(t).add(c);{const d=1+s*p/t.dot(c);return e.add(Q.copy(t).multiplyScalar(d)).add(c.multiplyScalar(1-s))}}_updateNearPlaneCorners(){if(qt(this._camera)){const e=this._camera,t=e.near,s=e.getEffectiveFOV()*ss,n=Math.tan(s*.5)*t,l=n*e.aspect;this._nearPlaneCorners[0].set(-l,-n,0),this._nearPlaneCorners[1].set(l,-n,0),this._nearPlaneCorners[2].set(l,n,0),this._nearPlaneCorners[3].set(-l,n,0)}else if(St(this._camera)){const e=this._camera,t=1/e.zoom,s=e.left*t,n=e.right*t,l=e.top*t,h=e.bottom*t;this._nearPlaneCorners[0].set(s,l,0),this._nearPlaneCorners[1].set(n,l,0),this._nearPlaneCorners[2].set(n,h,0),this._nearPlaneCorners[3].set(s,h,0)}}_truckInternal=(e,t,s,n)=>{let l,h;if(qt(this._camera)){const c=G.copy(this._camera.position).sub(this._target),p=this._camera.getEffectiveFOV()*ss,d=c.length()*Math.tan(p*.5);l=this.truckSpeed*e*d/this._elementRect.height,h=this.truckSpeed*t*d/this._elementRect.height}else if(St(this._camera)){const c=this._camera;l=this.truckSpeed*e*(c.right-c.left)/c.zoom/this._elementRect.width,h=this.truckSpeed*t*(c.top-c.bottom)/c.zoom/this._elementRect.height}else return;n?(s?this.setFocalOffset(this._focalOffsetEnd.x+l,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(l,0,!0),this.forward(-h,!0)):s?this.setFocalOffset(this._focalOffsetEnd.x+l,this._focalOffsetEnd.y+h,this._focalOffsetEnd.z,!0):this.truck(l,h,!0)};_rotateInternal=(e,t)=>{const s=Tt*this.azimuthRotateSpeed*e/this._elementRect.height,n=Tt*this.polarRotateSpeed*t/this._elementRect.height;this.rotate(s,n,!0)};_dollyInternal=(e,t,s)=>{const n=Math.pow(.95,-e*this.dollySpeed),l=this._sphericalEnd.radius,h=this._sphericalEnd.radius*n,c=We(h,this.minDistance,this.maxDistance),p=c-h;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(h,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(p,!0),this._dollyToNoClamp(c,!0)):this._dollyToNoClamp(c,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?h:c)-l,this._dollyControlCoord.set(t,s)),this._lastDollyDirection=Math.sign(-e)};_zoomInternal=(e,t,s)=>{const n=Math.pow(.95,e*this.dollySpeed),l=this._zoom,h=this._zoom*n;this.zoomTo(h,!0),this.dollyToCursor&&(this._changedZoom+=h-l,this._dollyControlCoord.set(t,s))};_collisionTest(){let e=1/0;if(!(this.colliderMeshes.length>=1)||yr(this._camera,"_collisionTest"))return e;const s=this._getTargetDirection(os);Tr.lookAt(ul,s,this._camera.up);for(let n=0;n<4;n++){const l=Q.copy(this._nearPlaneCorners[n]);l.applyMatrix4(Tr);const h=xi.addVectors(this._target,l);Ws.set(h,s),Ws.far=this._spherical.radius+1;const c=Ws.intersectObjects(this.colliderMeshes);c.length!==0&&c[0].distance<e&&(e=c[0].distance)}return e}_getClientRect(e){if(!this._domElement)return;const t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=t.width,e.height=t.height),e}_createOnRestPromise(e){return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(t=>{const s=()=>{this.removeEventListener("rest",s),t()};this.addEventListener("rest",s)}))}_addAllEventListeners(e){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(e){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(e){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(e,t=new N.Sphere){const s=t,n=s.center;wi.makeEmpty(),e.traverseVisible(h=>{h.isMesh&&wi.expandByObject(h)}),wi.getCenter(n);let l=0;return e.traverseVisible(h=>{if(!h.isMesh)return;const c=h;if(!c.geometry)return;const p=c.geometry.clone();p.applyMatrix4(c.matrixWorld);const f=p.attributes.position;for(let _=0,g=f.count;_<g;_++)G.fromBufferAttribute(f,_),l=Math.max(l,n.distanceToSquared(G))}),s.radius=Math.sqrt(l),s}}ws.install({THREE:Tp});const _v=50,vv=4/3,gv=.1,bv=1e4,xv=1,yv=1;function wv(){return new El(_v,vv,gv,bv)}function Cv(r,e){return new ws(r,e)}function Ev(r=-10,e=10,t=10,s=-10,n=.1,l=1e3){return new wl(r,e,t,s,n,l)}function _l(){const r=new Sp(16777215,2236962,1.5),e=new Pp(16777215,2);return e.position.set(0,xv,yv),[r,e]}function Tv(){const r=new U_({luminanceThreshold:0,intensity:1.4,radius:1,mipmapBlur:!0,blendFunction:j.SCREEN}),e=new F_({density:1.5});return[r,e]}const Sv=32,Pv=-5,Ov=100,Av=30,Mv=15,vl=-8,Sr=new lv,Rv=document.querySelector("#cover"),gl=document.querySelector("#canvas"),Uh=new Wf;document.querySelector("#stats").appendChild(Uh.dom);const Vr={amount:5,xscale:100},zr={loudness:0,perceptualSharpness:0,perceptualSpread:0,spectralFlatness:0,spectralKurtosis:0};Jf(Vr,zr);class Dv{init(){this.scene=new tn,this.signalScene=new tn,this.camera=wv(),this.camera.position.set(0,Pv,Ov),this.camera.lookAt(0,0,0),this.signalCamera=Ev(-20,20,15,-15,.1,1e3),this.signalCamera.position.set(vl,0,10),this.signalCamera.lookAt(vl,0,0),this.clock=new Op,this.renderer=new Ap({canvas:gl,antialias:!1,alpha:!0,powerPreference:"high-performance"}),this.renderer.setPixelRatio(dv),this.controls=Cv(this.camera,gl);const[e,t]=_l();this.scene.add(e,t);const[s,n]=_l();this.signalScene.add(s,n);const l=new I_(this.scene,this.camera),h=new G_(this.camera,...Tv());this.composer=new Fm(this.renderer),this.composer.addPass(l,0),this.composer.addPass(h,1),this.ffts=iv(X_,Me),console.log(this.ffts.length*(Me/2)),this.iSignalPalette=rl("bone",Me).map(p=>new us().fromArray(p)),this.iFFTPalette=rl("viridis",Me/2).map(p=>new us().fromArray(p)),this.iSignalMesh=new B(new va(.5,.5,.5),new ga,{capacity:Me,createEntities:!0,allowsEuler:!0}),this.iSignalMesh.addInstances(Me,p=>{this.iSignalMesh.setColorAt(p.id,16777215)}),this.signalScene.add(this.iSignalMesh),this.iFFTMesh=new B(new va(.75,.75,.75),new ga({color:16777215}),{capacity:this.ffts.length*(Me/2),allowsEuler:!0}),this.iFFTMesh.addInstances(this.ffts.length*(Me/2)),this.scene.add(this.iFFTMesh),new ResizeObserver(()=>this.resize()).observe(this.renderer.domElement)}intro(){this.controls.rotateTo(ba.degToRad(45),ba.degToRad(55),!0),this.controls.dollyTo(40,!0),this.controls.truck(0,-30,!0),Fr.timeline().to("#cover",{duration:1,autoAlpha:0,ease:"power2.out"}).to("#cover",{duration:1,delay:1,autoAlpha:0,ease:"power2.out"})}render(){const e=this.clock.getDelta(),t=Sr.features(ev);if(!t)return;const{amplitudeSpectrum:s}=t;this.ffts.pop(),this.ffts.unshift(s),Object.assign(zr,rv(t));const{loudness:n,perceptualSharpness:l,spectralKurtosis:h,perceptualSpread:c}=zr,[p]=this.composer.passes[1].effects;p.intensity=ol(.5,2.5,n),p.radius=ol(.5,2,l),this.iFFTMesh.updateInstances((g,v)=>{const y=nv(v),b=v%(Me/2),x=this.ffts[y][b];g.scale.set(4.2+x,4.2+h*1,4.2+c),g.position.set(sv(b,Vr.xscale),Q_+x*(Vr.amount*n),J_-y*(tv*1)),g.opacity=Math.min(1,.1+x*2);const C=1-Math.min(0,x*4),T=new us(C,0,0);this.iFFTMesh.setColorAt(g.id,T)});const d=Sr.signal();d&&this.iSignalMesh&&this.iSignalMesh.updateInstances((g,v)=>{g.position.set(-10+Mv*v/Me,d[v]*Av,0),g.rotation.y+=1}),this.controls.update(e);const{clientWidth:f,clientHeight:_}=this.renderer.domElement;if(this.renderer.setViewport(0,0,f,_),this.renderer.setScissor(0,0,f,_),this.composer.render(),this.iSignalMesh&&this.signalCamera){const b=f-400-0,x=0;this.renderer.setViewport(b,x,400,200),this.renderer.setScissor(b,x,400,200),this.renderer.setScissorTest(!0),this.renderer.render(this.signalScene,this.signalCamera),this.renderer.setScissorTest(!1)}Uh.update()}resize(){const{clientWidth:e,clientHeight:t}=this.renderer.domElement;this.renderer.setSize(e,t,!1),this.composer.setSize(e,t),this.camera.aspect=e/t,this.camera.updateProjectionMatrix()}run$(){Fr.timeline().to("#cover",{duration:2,autoAlpha:1,ease:"expo.inOut"});const e=hv(Sv);return Mp(Rp([cv(Rv),Dp(Sr.meydaPromise({fftSize:Me}))]).pipe(kp({count:2,delay:1e3}),Lp(()=>{this.init(),uv(this.renderer,this.render.bind(this),e),this.intro()}))).pipe(Up(t=>(console.error("Error:",t),Ip))).subscribe()}}document.addEventListener("DOMContentLoaded",()=>{new Dv().run$()});
